<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml' lang='en'><head><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><title>org.mozilla.javascript.json.JsonParser.java</title><link rel='stylesheet' href='../.resources/report.css' type='text/css'/><link rel='stylesheet' href='../.resources/prettify.css' type='text/css'/><link rel='stylesheet' href='../.resources/custom.css' type='text/css'/><script type='text/javascript' src='../.resources/prettify.js'></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><h1>org.mozilla.javascript.json.JsonParser.java</h1><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table><pre class='source lang-java linenums'>/* -*- Mode: java; tab-width: 4; indent-tabs-mode: 1; c-basic-offset: 4 -*-
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

package org.mozilla.javascript.json;

import org.mozilla.javascript.Context;
import org.mozilla.javascript.Scriptable;
import org.mozilla.javascript.ScriptRuntime;

import java.util.ArrayList;
import java.util.List;

/**
 * This class converts a stream of JSON tokens into a JSON value.
 *
 * See ECMA 15.12.
 * @author Raphael Speyer
 * @author Hannes Wallnoefer
 */
<span class='upc' id='L23' title='1|1|1 - Total: 2'>public class JsonParser {
</span>
    private Context cx;
    private Scriptable scope;

    private int pos;
    private int length;
    private String src;

<span class='uc' id='L32' title='2|2|2 - Total: 2'>    public JsonParser(Context cx, Scriptable scope) {
</span><span class='uc' id='L33' title='3|3|3 - Total: 3'>        this.cx = cx;
</span><span class='uc' id='L34' title='3|3|3 - Total: 3'>        this.scope = scope;
</span><span class='uc' id='L35' title='1|1|1 - Total: 1'>    }
</span>
    public synchronized Object parseValue(String json) throws ParseException {
<span class='uc' id='L38' title='2|2|2 - Total: 2'>        if (json == null) {
</span><span class='uc' id='L39' title='5|5|5 - Total: 5'>            throw new ParseException("Input string may not be null");
</span>        }
<span class='uc' id='L41' title='3|3|3 - Total: 3'>        pos = 0;
</span><span class='uc' id='L42' title='4|4|4 - Total: 4'>        length = json.length();
</span><span class='uc' id='L43' title='3|3|3 - Total: 3'>        src = json;
</span><span class='uc' id='L44' title='3|3|3 - Total: 3'>        Object value = readValue();
</span><span class='uc' id='L45' title='2|2|2 - Total: 2'>        consumeWhitespace();
</span><span class='uc' id='L46' title='2|2|2 - Total: 2'>        if (pos < length) {
</span><span class='uc' id='L47' title='13|13|13 - Total: 13'>            throw new ParseException("Expected end of stream at char " + pos);
</span>        }
<span class='uc' id='L49' title='2|2|2 - Total: 2'>        return value;
</span>    }

    private Object readValue() throws ParseException {
<span class='uc' id='L53' title='2|2|2 - Total: 2'>        consumeWhitespace();
</span><span class='uc' id='L54' title='2|2|2 - Total: 2'>        while (pos < length) {
</span><span class='uc' id='L55' title='11|11|11 - Total: 11'>            char c = src.charAt(pos++);
</span><span class='uc' id='L56' title='8|8|8 - Total: 8'>            switch (c) {
</span>                case '{':
<span class='uc' id='L58' title='3|3|3 - Total: 3'>                    return readObject();
</span>                case '[':
<span class='uc' id='L60' title='3|3|3 - Total: 3'>                    return readArray();
</span>                case 't':
<span class='uc' id='L62' title='3|3|3 - Total: 3'>                    return readTrue();
</span>                case 'f':
<span class='uc' id='L64' title='3|3|3 - Total: 3'>                    return readFalse();
</span>                case '"':
<span class='uc' id='L66' title='3|3|3 - Total: 3'>                    return readString();
</span>                case 'n':
<span class='uc' id='L68' title='3|3|3 - Total: 3'>                    return readNull();
</span>                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                case '6':
                case '7':
                case '8':
                case '9':
                case '0':
                case '-':
<span class='uc' id='L80' title='4|4|4 - Total: 4'>                    return readNumber(c);
</span>                default:
<span class='uc' id='L82' title='12|12|12 - Total: 12'>                    throw new ParseException("Unexpected token: " + c);
</span>            }
        }
<span class='uc' id='L85' title='5|5|5 - Total: 5'>        throw new ParseException("Empty JSON string");
</span>    }

    private Object readObject() throws ParseException {
<span class='uc' id='L89' title='2|2|2 - Total: 2'>        consumeWhitespace();
</span><span class='uc' id='L90' title='6|6|6 - Total: 6'>        Scriptable object = cx.newObject(scope);
</span>        // handle empty object literal case early
<span class='upc' id='L92' title='3|3|3 - Total: 4'>        if (pos < length && src.charAt(pos) == '}') {
</span><span class='uc' id='L93' title='6|6|6 - Total: 6'>            pos += 1;
</span><span class='uc' id='L94' title='2|2|2 - Total: 2'>            return object;
</span>        }
        String id;
        Object value;
<span class='uc' id='L98' title='2|2|2 - Total: 2'>        boolean needsComma = false;
</span><span class='upc' id='L99' title='1|1|1 - Total: 2'>        while (pos < length) {
</span><span class='uc' id='L100' title='11|11|11 - Total: 11'>            char c = src.charAt(pos++);
</span><span class='upc' id='L101' title='3|3|3 - Total: 4'>            switch(c) {
</span>                case '}':
<span class='uc' id='L103' title='2|2|2 - Total: 2'>                    if (!needsComma) {
</span><span class='uc' id='L104' title='5|5|5 - Total: 5'>                        throw new ParseException("Unexpected comma in object literal");
</span>                    }
<span class='uc' id='L106' title='2|2|2 - Total: 2'>                    return object;
</span>                case ',':
<span class='uc' id='L108' title='2|2|2 - Total: 2'>                    if (!needsComma) {
</span><span class='uc' id='L109' title='5|5|5 - Total: 5'>                        throw new ParseException("Unexpected comma in object literal");
</span>                    }
<span class='uc' id='L111' title='2|2|2 - Total: 2'>                    needsComma = false;
</span><span class='uc' id='L112' title='1|1|1 - Total: 1'>                    break;
</span>                case '"':
<span class='upc' id='L114' title='1|1|1 - Total: 2'>                    if (needsComma) {
</span><span class='nc' id='L115' title='0|0|0 - Total: 5'>                        throw new ParseException("Missing comma in object literal");
</span>                    }
<span class='uc' id='L117' title='3|3|3 - Total: 3'>                    id = readString();
</span><span class='uc' id='L118' title='3|3|3 - Total: 3'>                    consume(':');
</span><span class='uc' id='L119' title='3|3|3 - Total: 3'>                    value = readValue();
</span>
<span class='uc' id='L121' title='3|3|3 - Total: 3'>                    long index = ScriptRuntime.indexFromString(id);
</span><span class='uc' id='L122' title='2|2|2 - Total: 2'>                    if (index < 0) {
</span><span class='uc' id='L123' title='6|6|6 - Total: 6'>                      object.put(id, object, value);
</span>                    } else {
<span class='uc' id='L125' title='6|6|6 - Total: 6'>                      object.put((int)index, object, value);
</span>                    }

<span class='uc' id='L128' title='2|2|2 - Total: 2'>                    needsComma = true;
</span><span class='uc' id='L129' title='1|1|1 - Total: 1'>                    break;
</span>                default:
<span class='nc' id='L131' title='0|0|0 - Total: 5'>                    throw new ParseException("Unexpected token in object literal");
</span>            }
<span class='uc' id='L133' title='2|2|2 - Total: 2'>            consumeWhitespace();
</span><span class='uc' id='L134' title='1|1|1 - Total: 1'>        }
</span><span class='nc' id='L135' title='0|0|0 - Total: 5'>        throw new ParseException("Unterminated object literal");
</span>    }

    private Object readArray() throws ParseException {
<span class='uc' id='L139' title='2|2|2 - Total: 2'>        consumeWhitespace();
</span>        // handle empty array literal case early
<span class='upc' id='L141' title='3|3|3 - Total: 4'>        if (pos < length && src.charAt(pos) == ']') {
</span><span class='uc' id='L142' title='6|6|6 - Total: 6'>            pos += 1;
</span><span class='uc' id='L143' title='7|7|7 - Total: 7'>            return cx.newArray(scope, 0);
</span>        }
<span class='uc' id='L145' title='4|4|4 - Total: 4'>        List<Object> list = new ArrayList<Object>();
</span><span class='uc' id='L146' title='2|2|2 - Total: 2'>        boolean needsComma = false;
</span><span class='uc' id='L147' title='2|2|2 - Total: 2'>        while (pos < length) {
</span><span class='uc' id='L148' title='6|6|6 - Total: 6'>            char c = src.charAt(pos);
</span><span class='uc' id='L149' title='3|3|3 - Total: 3'>            switch(c) {
</span>                case ']':
<span class='uc' id='L151' title='2|2|2 - Total: 2'>                    if (!needsComma) {
</span><span class='uc' id='L152' title='5|5|5 - Total: 5'>                        throw new ParseException("Unexpected comma in array literal");
</span>                    }
<span class='uc' id='L154' title='6|6|6 - Total: 6'>                    pos += 1;
</span><span class='uc' id='L155' title='8|8|8 - Total: 8'>                    return cx.newArray(scope, list.toArray());
</span>                case ',':
<span class='uc' id='L157' title='2|2|2 - Total: 2'>                    if (!needsComma) {
</span><span class='uc' id='L158' title='5|5|5 - Total: 5'>                        throw new ParseException("Unexpected comma in array literal");
</span>                    }
<span class='uc' id='L160' title='2|2|2 - Total: 2'>                    needsComma = false;
</span><span class='uc' id='L161' title='6|6|6 - Total: 6'>                    pos += 1;
</span><span class='uc' id='L162' title='1|1|1 - Total: 1'>                    break;
</span>                default:
<span class='upc' id='L164' title='1|1|1 - Total: 2'>                    if (needsComma) {
</span><span class='nc' id='L165' title='0|0|0 - Total: 5'>                        throw new ParseException("Missing comma in array literal");
</span>                    }
<span class='uc' id='L167' title='5|5|5 - Total: 5'>                    list.add(readValue());
</span><span class='uc' id='L168' title='2|2|2 - Total: 2'>                    needsComma = true;
</span>            }
<span class='uc' id='L170' title='2|2|2 - Total: 2'>            consumeWhitespace();
</span><span class='uc' id='L171' title='1|1|1 - Total: 1'>        }
</span><span class='uc' id='L172' title='5|5|5 - Total: 5'>        throw new ParseException("Unterminated array literal");
</span>    }

    private String readString() throws ParseException {
        /*
         * Optimization: if the source contains no escaped characters, create the
         * string directly from the source text.
         */
<span class='uc' id='L180' title='3|3|3 - Total: 3'>        int stringStart = pos;
</span><span class='uc' id='L181' title='2|2|2 - Total: 2'>        while (pos < length) {
</span><span class='uc' id='L182' title='11|11|11 - Total: 11'>            char c = src.charAt(pos++);
</span><span class='uc' id='L183' title='2|2|2 - Total: 2'>            if (c <= '\u001F') {
</span><span class='uc' id='L184' title='5|5|5 - Total: 5'>                throw new ParseException("String contains control character");
</span><span class='uc' id='L185' title='2|2|2 - Total: 2'>            } else if (c == '\\') {
</span><span class='uc' id='L186' title='1|1|1 - Total: 1'>                break;
</span><span class='uc' id='L187' title='2|2|2 - Total: 2'>            } else if (c == '"') {
</span><span class='uc' id='L188' title='9|9|9 - Total: 9'>                return src.substring(stringStart, pos - 1);
</span>            }
<span class='uc' id='L190' title='1|1|1 - Total: 1'>        }
</span>
        /*
         * Slow case: string contains escaped characters.  Copy a maximal sequence
         * of unescaped characters into a temporary buffer, then an escaped
         * character, and repeat until the entire string is consumed.
         */
<span class='uc' id='L197' title='4|4|4 - Total: 4'>        StringBuilder b = new StringBuilder();
</span><span class='uc' id='L198' title='2|2|2 - Total: 2'>        while (pos < length) {
</span><span class='upc' id='L199' title='2|2|2 - Total: 4'>            assert src.charAt(pos - 1) == '\\';
</span><span class='uc' id='L200' title='10|10|10 - Total: 10'>            b.append(src, stringStart, pos - 1);
</span><span class='upc' id='L201' title='1|1|1 - Total: 2'>            if (pos >= length) {
</span><span class='nc' id='L202' title='0|0|0 - Total: 5'>                throw new ParseException("Unterminated string");
</span>            }
<span class='uc' id='L204' title='11|11|11 - Total: 11'>            char c = src.charAt(pos++);
</span><span class='upc' id='L205' title='7|7|7 - Total: 10'>            switch (c) {
</span>                case '"':
<span class='uc' id='L207' title='4|4|4 - Total: 4'>                    b.append('"');
</span><span class='uc' id='L208' title='1|1|1 - Total: 1'>                    break;
</span>                case '\\':
<span class='uc' id='L210' title='4|4|4 - Total: 4'>                    b.append('\\');
</span><span class='uc' id='L211' title='1|1|1 - Total: 1'>                    break;
</span>                case '/':
<span class='uc' id='L213' title='4|4|4 - Total: 4'>                    b.append('/');
</span><span class='uc' id='L214' title='1|1|1 - Total: 1'>                    break;
</span>                case 'b':
<span class='nc' id='L216' title='0|0|0 - Total: 4'>                    b.append('\b');
</span><span class='nc' id='L217' title='0|0|0 - Total: 1'>                    break;
</span>                case 'f':
<span class='nc' id='L219' title='0|0|0 - Total: 4'>                    b.append('\f');
</span><span class='nc' id='L220' title='0|0|0 - Total: 1'>                    break;
</span>                case 'n':
<span class='uc' id='L222' title='4|4|4 - Total: 4'>                    b.append('\n');
</span><span class='uc' id='L223' title='1|1|1 - Total: 1'>                    break;
</span>                case 'r':
<span class='uc' id='L225' title='4|4|4 - Total: 4'>                    b.append('\r');
</span><span class='uc' id='L226' title='1|1|1 - Total: 1'>                    break;
</span>                case 't':
<span class='uc' id='L228' title='4|4|4 - Total: 4'>                    b.append('\t');
</span><span class='uc' id='L229' title='1|1|1 - Total: 1'>                    break;
</span>                case 'u':
<span class='uc' id='L231' title='2|2|2 - Total: 2'>                    if (length - pos < 5) {
</span><span class='uc' id='L232' title='16|16|16 - Total: 16'>                        throw new ParseException("Invalid character code: \\u" + src.substring(pos));
</span>                    }
<span class='uc' id='L234' title='18|18|18 - Total: 18'>                    int code = fromHex(src.charAt(pos + 0)) << 12
</span><span class='uc' id='L235' title='12|12|12 - Total: 12'>                             | fromHex(src.charAt(pos + 1)) << 8
</span><span class='uc' id='L236' title='12|12|12 - Total: 12'>                             | fromHex(src.charAt(pos + 2)) << 4
</span><span class='uc' id='L237' title='4|4|4 - Total: 4'>                             | fromHex(src.charAt(pos + 3));
</span><span class='uc' id='L238' title='2|2|2 - Total: 2'>                    if (code < 0) {
</span><span class='uc' id='L239' title='20|20|20 - Total: 20'>                        throw new ParseException("Invalid character code: " + src.substring(pos, pos + 4));
</span>                    }
<span class='uc' id='L241' title='6|6|6 - Total: 6'>                    pos += 4;
</span><span class='uc' id='L242' title='5|5|5 - Total: 5'>                    b.append((char) code);
</span><span class='uc' id='L243' title='1|1|1 - Total: 1'>                    break;
</span>                default:
<span class='nc' id='L245' title='0|0|0 - Total: 14'>                    throw new ParseException("Unexpected character in string: '\\" + c + "'");
</span>            }
<span class='uc' id='L247' title='3|3|3 - Total: 3'>            stringStart = pos;
</span><span class='uc' id='L248' title='2|2|2 - Total: 2'>            while (pos < length) {
</span><span class='uc' id='L249' title='11|11|11 - Total: 11'>                c = src.charAt(pos++);
</span><span class='upc' id='L250' title='1|1|1 - Total: 2'>                if (c <= '\u001F') {
</span><span class='nc' id='L251' title='0|0|0 - Total: 5'>                    throw new ParseException("String contains control character");
</span><span class='uc' id='L252' title='2|2|2 - Total: 2'>                } else if (c == '\\') {
</span><span class='uc' id='L253' title='1|1|1 - Total: 1'>                    break;
</span><span class='uc' id='L254' title='2|2|2 - Total: 2'>                } else if (c == '"') {
</span><span class='uc' id='L255' title='10|10|10 - Total: 10'>                    b.append(src, stringStart, pos - 1);
</span><span class='uc' id='L256' title='3|3|3 - Total: 3'>                    return b.toString();
</span>                }
            }
<span class='uc' id='L259' title='1|1|1 - Total: 1'>        }
</span><span class='uc' id='L260' title='5|5|5 - Total: 5'>        throw new ParseException("Unterminated string literal");
</span>    }

    private int fromHex(char c) {
<span class='upc' id='L264' title='11|11|11 - Total: 12'>        return c >= '0' && c <= '9' ? c - '0'
</span>                : c >= 'A' && c <= 'F' ? c - 'A' + 10
                : c >= 'a' && c <= 'f' ? c - 'a' + 10
                : -1;
    }

    private Number readNumber(char c) throws ParseException {
<span class='upc' id='L271' title='5|5|5 - Total: 8'>        assert c == '-' || (c >= '0' && c <= '9');
</span><span class='uc' id='L272' title='5|5|5 - Total: 5'>        final int numberStart = pos - 1;
</span><span class='uc' id='L273' title='2|2|2 - Total: 2'>        if (c == '-') {
</span><span class='uc' id='L274' title='4|4|4 - Total: 4'>            c = nextOrNumberError(numberStart);
</span><span class='upc' id='L275' title='3|3|3 - Total: 4'>            if (!(c >= '0' && c <= '9')) {
</span><span class='uc' id='L276' title='6|6|6 - Total: 6'>                throw numberError(numberStart, pos);
</span>            }
        }
<span class='uc' id='L279' title='2|2|2 - Total: 2'>        if (c != '0') {
</span><span class='uc' id='L280' title='2|2|2 - Total: 2'>            readDigits();
</span>        }
        // read optional fraction part
<span class='uc' id='L283' title='2|2|2 - Total: 2'>        if (pos < length) {
</span><span class='uc' id='L284' title='6|6|6 - Total: 6'>            c = src.charAt(pos);
</span><span class='uc' id='L285' title='2|2|2 - Total: 2'>            if (c == '.') {
</span><span class='uc' id='L286' title='6|6|6 - Total: 6'>                pos += 1;
</span><span class='uc' id='L287' title='4|4|4 - Total: 4'>                c = nextOrNumberError(numberStart);
</span><span class='upc' id='L288' title='2|2|2 - Total: 4'>                if (!(c >= '0' && c <= '9')) {
</span><span class='nc' id='L289' title='0|0|0 - Total: 6'>                    throw numberError(numberStart, pos);
</span>                }
<span class='uc' id='L291' title='2|2|2 - Total: 2'>                readDigits();
</span>            }
        }
        // read optional exponent part
<span class='uc' id='L295' title='2|2|2 - Total: 2'>        if (pos < length) {
</span><span class='uc' id='L296' title='6|6|6 - Total: 6'>            c = src.charAt(pos);
</span><span class='upc' id='L297' title='3|3|3 - Total: 4'>            if (c == 'e' || c == 'E') {
</span><span class='uc' id='L298' title='6|6|6 - Total: 6'>                pos += 1;
</span><span class='uc' id='L299' title='4|4|4 - Total: 4'>                c = nextOrNumberError(numberStart);
</span><span class='upc' id='L300' title='2|2|2 - Total: 4'>                if (c == '-' || c == '+') {
</span><span class='nc' id='L301' title='0|0|0 - Total: 4'>                    c = nextOrNumberError(numberStart);
</span>                }
<span class='upc' id='L303' title='2|2|2 - Total: 4'>                if (!(c >= '0' && c <= '9')) {
</span><span class='nc' id='L304' title='0|0|0 - Total: 6'>                    throw numberError(numberStart, pos);
</span>                }
<span class='uc' id='L306' title='2|2|2 - Total: 2'>                readDigits();
</span>            }
        }
<span class='uc' id='L309' title='7|7|7 - Total: 7'>        String num = src.substring(numberStart, pos);
</span><span class='uc' id='L310' title='3|3|3 - Total: 3'>        final double dval = Double.parseDouble(num);
</span><span class='uc' id='L311' title='3|3|3 - Total: 3'>        final int ival = (int)dval;
</span><span class='uc' id='L312' title='2|2|2 - Total: 2'>        if (ival == dval) {
</span><span class='uc' id='L313' title='3|3|3 - Total: 3'>            return Integer.valueOf(ival);
</span>        } else {
<span class='uc' id='L315' title='3|3|3 - Total: 3'>            return Double.valueOf(dval);
</span>        }
    }

    private ParseException numberError(int start, int end) {
<span class='uc' id='L320' title='16|16|16 - Total: 16'>        return new ParseException("Unsupported number format: " + src.substring(start, end));
</span>    }

    private char nextOrNumberError(int numberStart) throws ParseException {
<span class='uc' id='L324' title='2|2|2 - Total: 2'>        if (pos >= length) {
</span><span class='uc' id='L325' title='6|6|6 - Total: 6'>            throw numberError(numberStart, length);
</span>        }
<span class='uc' id='L327' title='11|11|11 - Total: 11'>        return src.charAt(pos++);
</span>    }

    private void readDigits() {
<span class='uc' id='L331' title='2|2|2 - Total: 2'>        for (; pos < length; ++pos) {
</span><span class='uc' id='L332' title='6|6|6 - Total: 6'>            char c = src.charAt(pos);
</span><span class='uc' id='L333' title='4|4|4 - Total: 4'>            if (!(c >= '0' && c <= '9')) {
</span><span class='uc' id='L334' title='1|1|1 - Total: 1'>                break;
</span>            }
        }
<span class='uc' id='L337' title='1|1|1 - Total: 1'>    }
</span>
    private Boolean readTrue() throws ParseException {
<span class='upc' id='L340' title='1|1|1 - Total: 2'>        if (length - pos < 3
</span><span class='upc' id='L341' title='1|1|1 - Total: 2'>                || src.charAt(pos) != 'r'
</span><span class='upc' id='L342' title='1|1|1 - Total: 2'>                || src.charAt(pos + 1) != 'u'
</span><span class='upc' id='L343' title='1|1|1 - Total: 2'>                || src.charAt(pos + 2) != 'e') {
</span><span class='nc' id='L344' title='0|0|0 - Total: 5'>            throw new ParseException("Unexpected token: t");
</span>        }
<span class='uc' id='L346' title='6|6|6 - Total: 6'>        pos += 3;
</span><span class='uc' id='L347' title='2|2|2 - Total: 2'>        return Boolean.TRUE;
</span>    }

    private Boolean readFalse() throws ParseException {
<span class='upc' id='L351' title='1|1|1 - Total: 2'>        if (length - pos < 4
</span><span class='upc' id='L352' title='1|1|1 - Total: 2'>                || src.charAt(pos) != 'a'
</span><span class='upc' id='L353' title='1|1|1 - Total: 2'>                || src.charAt(pos + 1) != 'l'
</span><span class='upc' id='L354' title='1|1|1 - Total: 2'>                || src.charAt(pos + 2) != 's'
</span><span class='upc' id='L355' title='1|1|1 - Total: 2'>                || src.charAt(pos + 3) != 'e') {
</span><span class='nc' id='L356' title='0|0|0 - Total: 5'>            throw new ParseException("Unexpected token: f");
</span>        }
<span class='uc' id='L358' title='6|6|6 - Total: 6'>        pos += 4;
</span><span class='uc' id='L359' title='2|2|2 - Total: 2'>        return Boolean.FALSE;
</span>    }

    private Object readNull() throws ParseException {
<span class='upc' id='L363' title='1|1|1 - Total: 2'>        if (length - pos < 3
</span><span class='upc' id='L364' title='1|1|1 - Total: 2'>                || src.charAt(pos) != 'u'
</span><span class='upc' id='L365' title='1|1|1 - Total: 2'>                || src.charAt(pos + 1) != 'l'
</span><span class='upc' id='L366' title='1|1|1 - Total: 2'>                || src.charAt(pos + 2) != 'l') {
</span><span class='nc' id='L367' title='0|0|0 - Total: 5'>            throw new ParseException("Unexpected token: n");
</span>        }
<span class='uc' id='L369' title='6|6|6 - Total: 6'>        pos += 3;
</span><span class='uc' id='L370' title='2|2|2 - Total: 2'>        return null;
</span>    }

    private void consumeWhitespace() {
<span class='uc' id='L374' title='2|2|2 - Total: 2'>        while (pos < length) {
</span><span class='uc' id='L375' title='6|6|6 - Total: 6'>            char c = src.charAt(pos);
</span><span class='uc' id='L376' title='2|2|2 - Total: 2'>            switch (c) {
</span>                case ' ':
                case '\t':
                case '\r':
                case '\n':
<span class='uc' id='L381' title='6|6|6 - Total: 6'>                    pos += 1;
</span><span class='uc' id='L382' title='1|1|1 - Total: 1'>                    break;
</span>                default:
<span class='uc' id='L384' title='1|1|1 - Total: 1'>                    return;
</span>            }
<span class='uc' id='L386' title='1|1|1 - Total: 1'>        }
</span><span class='uc' id='L387' title='1|1|1 - Total: 1'>    }
</span>
    private void consume(char token) throws ParseException {
<span class='uc' id='L390' title='2|2|2 - Total: 2'>        consumeWhitespace();
</span><span class='uc' id='L391' title='2|2|2 - Total: 2'>        if (pos >= length) {
</span><span class='uc' id='L392' title='14|14|14 - Total: 14'>            throw new ParseException("Expected " + token + " but reached end of stream");
</span>        }
<span class='uc' id='L394' title='11|11|11 - Total: 11'>        char c = src.charAt(pos++);
</span><span class='uc' id='L395' title='2|2|2 - Total: 2'>        if (c == token) {
</span><span class='uc' id='L396' title='1|1|1 - Total: 1'>            return;
</span>        } else {
<span class='uc' id='L398' title='16|16|16 - Total: 16'>            throw new ParseException("Expected " + token + " found " + c);
</span>        }
    }

    public static class ParseException extends Exception {
        
        static final long serialVersionUID = 4804542791749920772L;
        
        ParseException(String message) {
            super(message);
        }

        ParseException(Exception cause) {
            super(cause);
        }
    }

}
</pre></body></html><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table>