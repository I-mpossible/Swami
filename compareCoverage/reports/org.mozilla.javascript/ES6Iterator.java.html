<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml' lang='en'><head><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><title>org.mozilla.javascript.ES6Iterator.java</title><link rel='stylesheet' href='../.resources/report.css' type='text/css'/><link rel='stylesheet' href='../.resources/prettify.css' type='text/css'/><link rel='stylesheet' href='../.resources/custom.css' type='text/css'/><script type='text/javascript' src='../.resources/prettify.js'></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><h1>org.mozilla.javascript.ES6Iterator.java</h1><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table><pre class='source lang-java linenums'>/* -*- Mode: java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

package org.mozilla.javascript;

public abstract class ES6Iterator extends IdScriptableObject {

    static void init(ScriptableObject scope, boolean sealed, IdScriptableObject prototype, String tag) {
<span class='upc' id='L12' title='1|1|1 - Total: 2'>        if (scope != null) {
</span><span class='uc' id='L13' title='3|3|3 - Total: 3'>            prototype.setParentScope(scope);
</span><span class='uc' id='L14' title='4|4|4 - Total: 4'>            prototype.setPrototype(getObjectPrototype(scope));
</span>        }
<span class='uc' id='L16' title='3|3|3 - Total: 3'>        prototype.activatePrototypeMap(MAX_PROTOTYPE_ID);
</span><span class='uc' id='L17' title='2|2|2 - Total: 2'>        if (sealed) {
</span><span class='uc' id='L18' title='2|2|2 - Total: 2'>            prototype.sealObject();
</span>        }

        // Need to access Iterator prototype when constructing
        // Iterator instances, but don't have a iterator constructor
        // to use to find the prototype. Use the "associateValue"
        // approach instead.
<span class='upc' id='L25' title='1|1|1 - Total: 2'>        if (scope != null) {
</span><span class='uc' id='L26' title='5|5|5 - Total: 5'>            scope.associateValue(tag, prototype);
</span>        }
<span class='uc' id='L28' title='1|1|1 - Total: 1'>    }
</span>
<span class='uc' id='L30' title='6|6|6 - Total: 6'>    protected boolean exhausted = false;
</span>
<span class='uc' id='L32' title='3|3|3 - Total: 3'>    ES6Iterator() {}
</span>
<span class='uc' id='L34' title='2|2|2 - Total: 2'>    ES6Iterator(Scriptable scope) {
</span>        // Set parent and prototype properties. Since we don't have a
        // "Iterator" constructor in the top scope, we stash the
        // prototype in the top scope's associated value.
<span class='uc' id='L38' title='3|3|3 - Total: 3'>        Scriptable top = ScriptableObject.getTopLevelScope(scope);
</span><span class='uc' id='L39' title='3|3|3 - Total: 3'>        this.setParentScope(top);
</span><span class='uc' id='L40' title='2|2|2 - Total: 2'>        IdScriptableObject prototype = (IdScriptableObject)
</span><span class='uc' id='L41' title='4|4|4 - Total: 4'>            ScriptableObject.getTopScopeValue(top, getTag());
</span><span class='uc' id='L42' title='3|3|3 - Total: 3'>        setPrototype(prototype);
</span><span class='uc' id='L43' title='1|1|1 - Total: 1'>    }
</span>
    @Override
    protected void initPrototypeId(int id)
    {
<span class='upc' id='L48' title='1|1|1 - Total: 4'>        switch (id) {
</span>            case Id_next:
<span class='uc' id='L50' title='8|8|8 - Total: 8'>                initPrototypeMethod(getTag(), id, NEXT_METHOD, 0);
</span><span class='uc' id='L51' title='1|1|1 - Total: 1'>                return;
</span>            case Id_iterator:
<span class='nc' id='L53' title='0|0|0 - Total: 9'>                initPrototypeMethod(getTag(), id, SymbolKey.ITERATOR, "[Symbol.iterator]", 0);
</span><span class='nc' id='L54' title='0|0|0 - Total: 1'>                return;
</span>            case Id_toStringTag:
<span class='nc' id='L56' title='0|0|0 - Total: 7'>                initPrototypeValue(Id_toStringTag, SymbolKey.TO_STRING_TAG, getClassName(), DONTENUM | READONLY);
</span><span class='nc' id='L57' title='0|0|0 - Total: 1'>                return;
</span><span class='nc' id='L58' title='0|0|0 - Total: 6'>            default: throw new IllegalArgumentException(String.valueOf(id));
</span>        }
    }

    @Override
    public Object execIdCall(IdFunctionObject f, Context cx, Scriptable scope,
                             Scriptable thisObj, Object[] args)
    {
<span class='upc' id='L66' title='1|1|1 - Total: 2'>        if (!f.hasTag(getTag())) {
</span><span class='nc' id='L67' title='0|0|0 - Total: 8'>            return super.execIdCall(f, cx, scope, thisObj, args);
</span>        }
<span class='uc' id='L69' title='3|3|3 - Total: 3'>        int id = f.methodId();
</span>
<span class='upc' id='L71' title='1|1|1 - Total: 2'>        if (!(thisObj instanceof ES6Iterator))
</span><span class='nc' id='L72' title='0|0|0 - Total: 3'>            throw incompatibleCallError(f);
</span>
<span class='uc' id='L74' title='3|3|3 - Total: 3'>        ES6Iterator iterator = (ES6Iterator) thisObj;
</span>
<span class='upc' id='L76' title='1|1|1 - Total: 3'>        switch (id) {
</span>        case Id_next:
<span class='uc' id='L78' title='5|5|5 - Total: 5'>            return iterator.next(cx, scope);
</span>        case Id_iterator:
<span class='nc' id='L80' title='0|0|0 - Total: 2'>            return iterator;
</span>        default:
<span class='nc' id='L82' title='0|0|0 - Total: 6'>            throw new IllegalArgumentException(String.valueOf(id));
</span>        }
    }

    @Override
    protected int findPrototypeId(Symbol k) {
<span class='nc' id='L88' title='0|0|0 - Total: 2'>        if (SymbolKey.ITERATOR.equals(k)) {
</span><span class='nc' id='L89' title='0|0|0 - Total: 2'>            return Id_iterator;
</span><span class='nc' id='L90' title='0|0|0 - Total: 2'>        } else if (SymbolKey.TO_STRING_TAG.equals(k)) {
</span><span class='nc' id='L91' title='0|0|0 - Total: 2'>            return Id_toStringTag;
</span>        }
<span class='nc' id='L93' title='0|0|0 - Total: 2'>        return 0;
</span>    }

    @Override
    protected int findPrototypeId(String s) {
<span class='upc' id='L98' title='1|1|1 - Total: 2'>        if ("next".equals(s)) {
</span><span class='uc' id='L99' title='2|2|2 - Total: 2'>            return Id_next;
</span>        }
<span class='nc' id='L101' title='0|0|0 - Total: 2'>        return 0;
</span>    }

    abstract protected boolean isDone(Context cx, Scriptable scope);

    abstract protected Object nextValue(Context cx, Scriptable scope);

    protected Object next(Context cx, Scriptable scope) {
<span class='uc' id='L109' title='2|2|2 - Total: 2'>        Object value = Undefined.instance;
</span><span class='upc' id='L110' title='3|3|3 - Total: 4'>        boolean done = isDone(cx, scope) || this.exhausted;
</span><span class='uc' id='L111' title='2|2|2 - Total: 2'>        if (!done) {
</span><span class='uc' id='L112' title='6|6|6 - Total: 6'>            value = nextValue(cx, scope);
</span>        } else {
<span class='uc' id='L114' title='3|3|3 - Total: 3'>            this.exhausted = true;
</span>        }
<span class='uc' id='L116' title='7|7|7 - Total: 7'>        return makeIteratorResult(cx, scope, done, value);
</span>    }

    abstract protected String getTag();

    // 25.1.1.3 The IteratorResult Interface
    private Scriptable makeIteratorResult(Context cx, Scriptable scope, boolean done, Object value) {
<span class='uc' id='L123' title='4|4|4 - Total: 4'>        Scriptable iteratorResult = cx.newObject(scope);
</span><span class='uc' id='L124' title='4|4|4 - Total: 4'>        ScriptableObject.putProperty(iteratorResult, VALUE_PROPERTY, value);
</span><span class='uc' id='L125' title='5|5|5 - Total: 5'>        ScriptableObject.putProperty(iteratorResult, DONE_PROPERTY, done);
</span><span class='uc' id='L126' title='2|2|2 - Total: 2'>        return iteratorResult;
</span>    }

    private static final int
        Id_next             = 1,
        Id_iterator         = 2,
        Id_toStringTag      = 3,
        MAX_PROTOTYPE_ID    = Id_toStringTag;

    public static final String NEXT_METHOD = "next";
    public static final String DONE_PROPERTY = "done";
    public static final String VALUE_PROPERTY = "value";
}
</pre></body></html><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table>