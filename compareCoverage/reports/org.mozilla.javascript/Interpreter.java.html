<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml' lang='en'><head><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><title>org.mozilla.javascript.Interpreter.java</title><link rel='stylesheet' href='../.resources/report.css' type='text/css'/><link rel='stylesheet' href='../.resources/prettify.css' type='text/css'/><link rel='stylesheet' href='../.resources/custom.css' type='text/css'/><script type='text/javascript' src='../.resources/prettify.js'></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><h1>org.mozilla.javascript.Interpreter.java</h1><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table><pre class='source lang-java linenums'>/* -*- Mode: java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

package org.mozilla.javascript;

import java.io.PrintStream;
import java.io.Serializable;
import java.util.List;
import java.util.ArrayList;

import org.mozilla.javascript.ast.FunctionNode;
import org.mozilla.javascript.ast.ScriptNode;
import org.mozilla.javascript.ScriptRuntime.NoSuchMethodShim;
import org.mozilla.javascript.debug.DebugFrame;

import static org.mozilla.javascript.UniqueTag.DOUBLE_MARK;

<span class='bc' id='L21' title='0|3|3 - Total: 3'>public final class Interpreter extends Icode implements Evaluator
</span>{
    // data for parsing
    InterpreterData itsData;

    static final int EXCEPTION_TRY_START_SLOT  = 0;
    static final int EXCEPTION_TRY_END_SLOT    = 1;
    static final int EXCEPTION_HANDLER_SLOT    = 2;
    static final int EXCEPTION_TYPE_SLOT       = 3;
    static final int EXCEPTION_LOCAL_SLOT      = 4;
    static final int EXCEPTION_SCOPE_SLOT      = 5;
    // SLOT_SIZE: space for try start/end, handler, start, handler type,
    //            exception local and scope local
    static final int EXCEPTION_SLOT_SIZE       = 6;

    /**
     * Class to hold data corresponding to one interpreted call stack frame.
     */
    private static class CallFrame implements Cloneable, Serializable
    {
        static final long serialVersionUID = -2843792508994958978L;

        CallFrame parentFrame;
        // amount of stack frames before this one on the interpretation stack
        int frameIndex;
        // If true indicates read-only frame that is a part of continuation
        boolean frozen;

        InterpretedFunction fnOrScript;
        InterpreterData idata;

// Stack structure
// stack[0 <= i < localShift]: arguments and local variables
// stack[localShift <= i <= emptyStackTop]: used for local temporaries
// stack[emptyStackTop < i < stack.length]: stack data
// sDbl[i]: if stack[i] is UniqueTag.DOUBLE_MARK, sDbl[i] holds the number value

        Object[] stack;
        int[] stackAttributes;
        double[] sDbl;
        CallFrame varSource; // defaults to this unless continuation frame
        int localShift;
        int emptyStackTop;

        DebugFrame debuggerFrame;
        boolean useActivation;
        boolean isContinuationsTopFrame;

        Scriptable thisObj;

// The values that change during interpretation

        Object result;
        double resultDbl;
        int pc;
        int pcPrevBranch;
        int pcSourceLineStart;
        Scriptable scope;

        int savedStackTop;
        int savedCallOp;
        Object throwable;

        CallFrame cloneFrozen()
        {
            if (!frozen) Kit.codeBug();

            CallFrame copy;
            try {
                copy = (CallFrame)clone();
            } catch (CloneNotSupportedException ex) {
                throw new IllegalStateException();
            }

            // clone stack but keep varSource to point to values
            // from this frame to share variables.

            copy.stack = stack.clone();
            copy.stackAttributes = stackAttributes.clone();
            copy.sDbl = sDbl.clone();

            copy.frozen = false;
            return copy;
        }
    }

    private static final class ContinuationJump implements Serializable
    {
        static final long serialVersionUID = 7687739156004308247L;

        CallFrame capturedFrame;
        CallFrame branchFrame;
        Object result;
        double resultDbl;

        ContinuationJump(NativeContinuation c, CallFrame current)
        {
            this.capturedFrame = (CallFrame)c.getImplementation();
            if (this.capturedFrame == null || current == null) {
                // Continuation and current execution does not share
                // any frames if there is nothing to capture or
                // if there is no currently executed frames
                this.branchFrame = null;
            } else {
                // Search for branch frame where parent frame chains starting
                // from captured and current meet.
                CallFrame chain1 = this.capturedFrame;
                CallFrame chain2 = current;

                // First work parents of chain1 or chain2 until the same
                // frame depth.
                int diff = chain1.frameIndex - chain2.frameIndex;
                if (diff != 0) {
                    if (diff < 0) {
                        // swap to make sure that
                        // chain1.frameIndex > chain2.frameIndex and diff > 0
                        chain1 = current;
                        chain2 = this.capturedFrame;
                        diff = -diff;
                    }
                    do {
                        chain1 = chain1.parentFrame;
                    } while (--diff != 0);
                    if (chain1.frameIndex != chain2.frameIndex) Kit.codeBug();
                }

                // Now walk parents in parallel until a shared frame is found
                // or until the root is reached.
                while (chain1 != chain2 && chain1 != null) {
                    chain1 = chain1.parentFrame;
                    chain2 = chain2.parentFrame;
                }

                this.branchFrame = chain1;
                if (this.branchFrame != null && !this.branchFrame.frozen)
                    Kit.codeBug();
            }
        }
    }

    private static CallFrame captureFrameForGenerator(CallFrame frame) {
<span class='bc' id='L162' title='0|3|3 - Total: 3'>      frame.frozen = true;
</span><span class='bc' id='L163' title='0|3|3 - Total: 3'>      CallFrame result = frame.cloneFrozen();
</span><span class='bc' id='L164' title='0|3|3 - Total: 3'>      frame.frozen = false;
</span>
      // now isolate this frame from its previous context
<span class='bc' id='L167' title='0|3|3 - Total: 3'>      result.parentFrame = null;
</span><span class='bc' id='L168' title='0|3|3 - Total: 3'>      result.frameIndex = 0;
</span>
<span class='bc' id='L170' title='0|2|2 - Total: 2'>      return result;
</span>    }

    static {
        // Checks for byte code consistencies, good compiler can eliminate them

        if (Token.LAST_BYTECODE_TOKEN > 127) {
            String str = "Violation of Token.LAST_BYTECODE_TOKEN <= 127";
            System.err.println(str);
            throw new IllegalStateException(str);
        }
        if (MIN_ICODE < -128) {
            String str = "Violation of Interpreter.MIN_ICODE >= -128";
            System.err.println(str);
            throw new IllegalStateException(str);
        }
<span class='bc' id='L186' title='0|1|1 - Total: 1'>    }
</span>
    public Object compile(CompilerEnvirons compilerEnv,
                          ScriptNode tree,
                          String encodedSource,
                          boolean returnFunction)
    {
<span class='bc' id='L193' title='0|4|4 - Total: 4'>        CodeGenerator cgen = new CodeGenerator();
</span><span class='bc' id='L194' title='0|8|8 - Total: 8'>        itsData = cgen.compile(compilerEnv, tree, encodedSource, returnFunction);
</span><span class='bc' id='L195' title='0|3|3 - Total: 3'>        return itsData;
</span>    }

    public Script createScriptObject(Object bytecode, Object staticSecurityDomain)
    {
<span class='bpc' id='L200' title='0|1|1 - Total: 2'>        if(bytecode != itsData)
</span>        {
<span class='nc' id='L202' title='0|0|0 - Total: 2'>            Kit.codeBug();
</span>        }
<span class='bc' id='L204' title='0|5|5 - Total: 5'>        return InterpretedFunction.createScript(itsData,
</span>                                                staticSecurityDomain);
    }

    public void setEvalScriptFlag(Script script) {
<span class='bc' id='L209' title='0|5|5 - Total: 5'>        ((InterpretedFunction)script).idata.evalScriptFlag = true;
</span><span class='bc' id='L210' title='0|1|1 - Total: 1'>    }
</span>

    public Function createFunctionObject(Context cx, Scriptable scope,
            Object bytecode, Object staticSecurityDomain)
    {
<span class='bpc' id='L216' title='0|1|1 - Total: 2'>        if(bytecode != itsData)
</span>        {
<span class='nc' id='L218' title='0|0|0 - Total: 2'>            Kit.codeBug();
</span>        }
<span class='bc' id='L220' title='0|7|7 - Total: 7'>        return InterpretedFunction.createFunction(cx, scope, itsData,
</span>                                                  staticSecurityDomain);
    }

    private static int getShort(byte[] iCode, int pc) {
<span class='bc' id='L225' title='0|14|14 - Total: 14'>        return (iCode[pc] << 8) | (iCode[pc + 1] & 0xFF);
</span>    }

    private static int getIndex(byte[] iCode, int pc) {
<span class='bc' id='L229' title='0|16|16 - Total: 16'>        return ((iCode[pc] & 0xFF) << 8) | (iCode[pc + 1] & 0xFF);
</span>    }

    private static int getInt(byte[] iCode, int pc) {
<span class='bc' id='L233' title='0|34|34 - Total: 34'>        return (iCode[pc] << 24) | ((iCode[pc + 1] & 0xFF) << 16)
</span>               | ((iCode[pc + 2] & 0xFF) << 8) | (iCode[pc + 3] & 0xFF);
    }

    private static int getExceptionHandler(CallFrame frame,
                                           boolean onlyFinally)
    {
<span class='bc' id='L240' title='0|4|4 - Total: 4'>        int[] exceptionTable = frame.idata.itsExceptionTable;
</span><span class='bc' id='L241' title='0|2|2 - Total: 2'>        if (exceptionTable == null) {
</span>            // No exception handlers
<span class='bc' id='L243' title='0|2|2 - Total: 2'>            return -1;
</span>        }

        // Icode switch in the interpreter increments PC immediately
        // and it is necessary to subtract 1 from the saved PC
        // to point it before the start of the next instruction.
<span class='bc' id='L249' title='0|5|5 - Total: 5'>        int pc = frame.pc - 1;
</span>
        // OPT: use binary search
<span class='bc' id='L252' title='0|6|6 - Total: 6'>        int best = -1, bestStart = 0, bestEnd = 0;
</span><span class='bc' id='L253' title='0|2|2 - Total: 2'>        for (int i = 0; i != exceptionTable.length; i += EXCEPTION_SLOT_SIZE) {
</span><span class='bc' id='L254' title='0|6|6 - Total: 6'>            int start = exceptionTable[i + EXCEPTION_TRY_START_SLOT];
</span><span class='bc' id='L255' title='0|6|6 - Total: 6'>            int end = exceptionTable[i + EXCEPTION_TRY_END_SLOT];
</span><span class='bc' id='L256' title='0|4|4 - Total: 4'>            if (!(start <= pc && pc < end)) {
</span><span class='bc' id='L257' title='0|1|1 - Total: 1'>                continue;
</span>            }
<span class='bc' id='L259' title='0|4|4 - Total: 4'>            if (onlyFinally && exceptionTable[i + EXCEPTION_TYPE_SLOT] != 1) {
</span><span class='bc' id='L260' title='0|1|1 - Total: 1'>                continue;
</span>            }
<span class='bc' id='L262' title='0|2|2 - Total: 2'>            if (best >= 0) {
</span>                // Since handlers always nest and they never have shared end
                // although they can share start  it is sufficient to compare
                // handlers ends
<span class='bpc' id='L266' title='0|1|1 - Total: 2'>                if (bestEnd < end) {
</span><span class='bc' id='L267' title='0|1|1 - Total: 1'>                    continue;
</span>                }
                // Check the above assumption
<span class='nc' id='L270' title='0|0|0 - Total: 2'>                if (bestStart > start) Kit.codeBug(); // should be nested
</span><span class='nc' id='L271' title='0|0|0 - Total: 2'>                if (bestEnd == end) Kit.codeBug();  // no ens sharing
</span>            }
<span class='bc' id='L273' title='0|2|2 - Total: 2'>            best = i;
</span><span class='bc' id='L274' title='0|2|2 - Total: 2'>            bestStart = start;
</span><span class='bc' id='L275' title='0|2|2 - Total: 2'>            bestEnd = end;
</span>        }
<span class='bc' id='L277' title='0|2|2 - Total: 2'>        return best;
</span>    }

    static void dumpICode(InterpreterData idata)
    {
        if (!Token.printICode) {
<span class='nc' id='L283' title='0|0|0 - Total: 1'>            return;
</span>        }

        byte iCode[] = idata.itsICode;
        int iCodeLength = iCode.length;
        String[] strings = idata.itsStringTable;
        PrintStream out = System.out;
        out.println("ICode dump, for " + idata.itsName
                    + ", length = " + iCodeLength);
        out.println("MaxStack = " + idata.itsMaxStack);

        int indexReg = 0;
        for (int pc = 0; pc < iCodeLength; ) {
            out.flush();
            out.print(" [" + pc + "] ");
            int token = iCode[pc];
            int icodeLength = bytecodeSpan(token);
            String tname = Icode.bytecodeName(token);
            int old_pc = pc;
            ++pc;
            switch (token) {
              default:
                if (icodeLength != 1) Kit.codeBug();
                out.println(tname);
                break;

              case Icode_GOSUB :
              case Token.GOTO :
              case Token.IFEQ :
              case Token.IFNE :
              case Icode_IFEQ_POP :
              case Icode_LEAVEDQ : {
                int newPC = pc + getShort(iCode, pc) - 1;
                out.println(tname + " " + newPC);
                pc += 2;
                break;
              }
              case Icode_VAR_INC_DEC :
              case Icode_NAME_INC_DEC :
              case Icode_PROP_INC_DEC :
              case Icode_ELEM_INC_DEC :
              case Icode_REF_INC_DEC: {
                int incrDecrType = iCode[pc];
                out.println(tname + " " + incrDecrType);
                ++pc;
                break;
              }

              case Icode_CALLSPECIAL : {
                int callType = iCode[pc] & 0xFF;
                boolean isNew =  (iCode[pc + 1] != 0);
                int line = getIndex(iCode, pc+2);
                out.println(tname+" "+callType+" "+isNew+" "+indexReg+" "+line);
                pc += 4;
                break;
              }

              case Token.CATCH_SCOPE:
                {
                    boolean afterFisrtFlag =  (iCode[pc] != 0);
                    out.println(tname+" "+afterFisrtFlag);
                    ++pc;
                }
                break;
              case Token.REGEXP :
                out.println(tname+" "+idata.itsRegExpLiterals[indexReg]);
                break;
              case Token.OBJECTLIT :
              case Icode_SPARE_ARRAYLIT :
                out.println(tname+" "+idata.literalIds[indexReg]);
                break;
              case Icode_CLOSURE_EXPR :
              case Icode_CLOSURE_STMT :
                out.println(tname+" "+idata.itsNestedFunctions[indexReg]);
                break;
              case Token.CALL :
              case Icode_TAIL_CALL :
              case Token.REF_CALL :
              case Token.NEW :
                out.println(tname+' '+indexReg);
                break;
              case Token.THROW :
              case Token.YIELD :
              case Icode_GENERATOR :
              case Icode_GENERATOR_END :
              {
                int line = getIndex(iCode, pc);
                out.println(tname + " : " + line);
                pc += 2;
                break;
              }
              case Icode_SHORTNUMBER : {
                int value = getShort(iCode, pc);
                out.println(tname + " " + value);
                pc += 2;
                break;
              }
              case Icode_INTNUMBER : {
                int value = getInt(iCode, pc);
                out.println(tname + " " + value);
                pc += 4;
                break;
              }
              case Token.NUMBER : {
                double value = idata.itsDoubleTable[indexReg];
                out.println(tname + " " + value);
                break;
              }
              case Icode_LINE : {
                int line = getIndex(iCode, pc);
                out.println(tname + " : " + line);
                pc += 2;
                break;
              }
              case Icode_REG_STR1: {
                String str = strings[0xFF & iCode[pc]];
                out.println(tname + " \"" + str + '"');
                ++pc;
                break;
              }
              case Icode_REG_STR2: {
                String str = strings[getIndex(iCode, pc)];
                out.println(tname + " \"" + str + '"');
                pc += 2;
                break;
              }
              case Icode_REG_STR4: {
                String str = strings[getInt(iCode, pc)];
                out.println(tname + " \"" + str + '"');
                pc += 4;
                break;
              }
              case Icode_REG_IND_C0:
                  indexReg = 0;
                  out.println(tname);
                  break;
              case Icode_REG_IND_C1:
                  indexReg = 1;
                  out.println(tname);
                  break;
              case Icode_REG_IND_C2:
                  indexReg = 2;
                  out.println(tname);
                  break;
              case Icode_REG_IND_C3:
                  indexReg = 3;
                  out.println(tname);
                  break;
              case Icode_REG_IND_C4:
                  indexReg = 4;
                  out.println(tname);
                  break;
              case Icode_REG_IND_C5:
                  indexReg = 5;
                  out.println(tname);
                  break;
              case Icode_REG_IND1: {
                indexReg = 0xFF & iCode[pc];
                out.println(tname+" "+indexReg);
                ++pc;
                break;
              }
              case Icode_REG_IND2: {
                indexReg = getIndex(iCode, pc);
                out.println(tname+" "+indexReg);
                pc += 2;
                break;
              }
              case Icode_REG_IND4: {
                indexReg = getInt(iCode, pc);
                out.println(tname+" "+indexReg);
                pc += 4;
                break;
              }
              case Icode_GETVAR1:
              case Icode_SETVAR1:
              case Icode_SETCONSTVAR1:
                indexReg = iCode[pc];
                out.println(tname+" "+indexReg);
                ++pc;
                break;
            }
            if (old_pc + icodeLength != pc) Kit.codeBug();
        }

        int[] table = idata.itsExceptionTable;
        if (table != null) {
            out.println("Exception handlers: "
                         +table.length / EXCEPTION_SLOT_SIZE);
            for (int i = 0; i != table.length;
                 i += EXCEPTION_SLOT_SIZE)
            {
                int tryStart       = table[i + EXCEPTION_TRY_START_SLOT];
                int tryEnd         = table[i + EXCEPTION_TRY_END_SLOT];
                int handlerStart   = table[i + EXCEPTION_HANDLER_SLOT];
                int type           = table[i + EXCEPTION_TYPE_SLOT];
                int exceptionLocal = table[i + EXCEPTION_LOCAL_SLOT];
                int scopeLocal     = table[i + EXCEPTION_SCOPE_SLOT];

                out.println(" tryStart="+tryStart+" tryEnd="+tryEnd
                            +" handlerStart="+handlerStart
                            +" type="+(type == 0 ? "catch" : "finally")
                            +" exceptionLocal="+exceptionLocal);
            }
        }
        out.flush();
    }

    private static int bytecodeSpan(int bytecode)
    {
<span class='nc' id='L493' title='0|0|0 - Total: 16'>        switch (bytecode) {
</span>            case Token.THROW :
            case Token.YIELD:
            case Icode_GENERATOR:
            case Icode_GENERATOR_END:
                // source line
<span class='nc' id='L499' title='0|0|0 - Total: 2'>                return 1 + 2;
</span>
            case Icode_GOSUB :
            case Token.GOTO :
            case Token.IFEQ :
            case Token.IFNE :
            case Icode_IFEQ_POP :
            case Icode_LEAVEDQ :
                // target pc offset
<span class='nc' id='L508' title='0|0|0 - Total: 2'>                return 1 + 2;
</span>
            case Icode_CALLSPECIAL :
                // call type
                // is new
                // line number
<span class='nc' id='L514' title='0|0|0 - Total: 2'>                return 1 + 1 + 1 + 2;
</span>
            case Token.CATCH_SCOPE:
                // scope flag
<span class='nc' id='L518' title='0|0|0 - Total: 2'>                return 1 + 1;
</span>
            case Icode_VAR_INC_DEC:
            case Icode_NAME_INC_DEC:
            case Icode_PROP_INC_DEC:
            case Icode_ELEM_INC_DEC:
            case Icode_REF_INC_DEC:
                // type of ++/--
<span class='nc' id='L526' title='0|0|0 - Total: 2'>                return 1 + 1;
</span>
            case Icode_SHORTNUMBER :
                // short number
<span class='nc' id='L530' title='0|0|0 - Total: 2'>                return 1 + 2;
</span>
            case Icode_INTNUMBER :
                // int number
<span class='nc' id='L534' title='0|0|0 - Total: 2'>                return 1 + 4;
</span>
            case Icode_REG_IND1:
                // ubyte index
<span class='nc' id='L538' title='0|0|0 - Total: 2'>                return 1 + 1;
</span>
            case Icode_REG_IND2:
                // ushort index
<span class='nc' id='L542' title='0|0|0 - Total: 2'>                return 1 + 2;
</span>
            case Icode_REG_IND4:
                // int index
<span class='nc' id='L546' title='0|0|0 - Total: 2'>                return 1 + 4;
</span>
            case Icode_REG_STR1:
                // ubyte string index
<span class='nc' id='L550' title='0|0|0 - Total: 2'>                return 1 + 1;
</span>
            case Icode_REG_STR2:
                // ushort string index
<span class='nc' id='L554' title='0|0|0 - Total: 2'>                return 1 + 2;
</span>
            case Icode_REG_STR4:
                // int string index
<span class='nc' id='L558' title='0|0|0 - Total: 2'>                return 1 + 4;
</span>
            case Icode_GETVAR1:
            case Icode_SETVAR1:
            case Icode_SETCONSTVAR1:
                // byte var index
<span class='nc' id='L564' title='0|0|0 - Total: 2'>                return 1 + 1;
</span>
            case Icode_LINE :
                // line number
<span class='nc' id='L568' title='0|0|0 - Total: 2'>                return 1 + 2;
</span>        }
<span class='nc' id='L570' title='0|0|0 - Total: 2'>        if (!validBytecode(bytecode)) throw Kit.codeBug();
</span><span class='nc' id='L571' title='0|0|0 - Total: 2'>        return 1;
</span>    }

    static int[] getLineNumbers(InterpreterData data)
    {
<span class='nc' id='L576' title='0|0|0 - Total: 4'>        UintMap presentLines = new UintMap();
</span>
<span class='nc' id='L578' title='0|0|0 - Total: 3'>        byte[] iCode = data.itsICode;
</span><span class='nc' id='L579' title='0|0|0 - Total: 3'>        int iCodeLength = iCode.length;
</span><span class='nc' id='L580' title='0|0|0 - Total: 2'>        for (int pc = 0; pc != iCodeLength;) {
</span><span class='nc' id='L581' title='0|0|0 - Total: 4'>            int bytecode = iCode[pc];
</span><span class='nc' id='L582' title='0|0|0 - Total: 3'>            int span = bytecodeSpan(bytecode);
</span><span class='nc' id='L583' title='0|0|0 - Total: 2'>            if (bytecode == Icode_LINE) {
</span><span class='nc' id='L584' title='0|0|0 - Total: 2'>                if (span != 3) Kit.codeBug();
</span><span class='nc' id='L585' title='0|0|0 - Total: 6'>                int line = getIndex(iCode, pc + 1);
</span><span class='nc' id='L586' title='0|0|0 - Total: 4'>                presentLines.put(line, 0);
</span>            }
<span class='nc' id='L588' title='0|0|0 - Total: 4'>            pc += span;
</span><span class='nc' id='L589' title='0|0|0 - Total: 1'>        }
</span>
<span class='nc' id='L591' title='0|0|0 - Total: 3'>        return presentLines.getKeys();
</span>    }

    public void captureStackInfo(RhinoException ex)
    {
<span class='bc' id='L596' title='0|2|2 - Total: 2'>        Context cx = Context.getCurrentContext();
</span><span class='bc' id='L597' title='0|4|4 - Total: 4'>        if (cx == null || cx.lastInterpreterFrame == null) {
</span>            // No interpreter invocations
<span class='bc' id='L599' title='0|3|3 - Total: 3'>            ex.interpreterStackInfo = null;
</span><span class='bc' id='L600' title='0|3|3 - Total: 3'>            ex.interpreterLineData = null;
</span><span class='bc' id='L601' title='0|1|1 - Total: 1'>            return;
</span>        }
        // has interpreter frame on the stack
        CallFrame[] array;
<span class='bc' id='L605' title='0|2|2 - Total: 2'>        if (cx.previousInterpreterInvocations == null
</span><span class='bc' id='L606' title='0|2|2 - Total: 2'>            || cx.previousInterpreterInvocations.size() == 0)
</span>        {
<span class='bc' id='L608' title='0|4|4 - Total: 4'>            array = new CallFrame[1];
</span>        } else {
<span class='bc' id='L610' title='0|4|4 - Total: 4'>            int previousCount = cx.previousInterpreterInvocations.size();
</span><span class='bc' id='L611' title='0|2|2 - Total: 2'>            if (cx.previousInterpreterInvocations.peek()
</span>                == cx.lastInterpreterFrame)
            {
                // It can happen if exception was generated after
                // frame was pushed to cx.previousInterpreterInvocations
                // but before assignment to cx.lastInterpreterFrame.
                // In this case frames has to be ignored.
<span class='bc' id='L618' title='0|1|1 - Total: 1'>                --previousCount;
</span>            }
<span class='bc' id='L620' title='0|5|5 - Total: 5'>            array = new CallFrame[previousCount + 1];
</span><span class='bc' id='L621' title='0|4|4 - Total: 4'>            cx.previousInterpreterInvocations.toArray(array);
</span>        }
<span class='bc' id='L623' title='0|9|9 - Total: 9'>        array[array.length - 1]  = (CallFrame)cx.lastInterpreterFrame;
</span>
<span class='bc' id='L625' title='0|2|2 - Total: 2'>        int interpreterFrameCount = 0;
</span><span class='bc' id='L626' title='0|2|2 - Total: 2'>        for (int i = 0; i != array.length; ++i) {
</span><span class='bc' id='L627' title='0|9|9 - Total: 9'>            interpreterFrameCount += 1 + array[i].frameIndex;
</span>        }

<span class='bc' id='L630' title='0|3|3 - Total: 3'>        int[] linePC = new int[interpreterFrameCount];
</span>        // Fill linePC with pc positions from all interpreter frames.
        // Start from the most nested frame
<span class='bc' id='L633' title='0|2|2 - Total: 2'>        int linePCIndex = interpreterFrameCount;
</span><span class='bc' id='L634' title='0|2|2 - Total: 2'>        for (int i = array.length; i != 0;) {
</span><span class='bc' id='L635' title='0|1|1 - Total: 1'>            --i;
</span><span class='bc' id='L636' title='0|4|4 - Total: 4'>            CallFrame frame = array[i];
</span><span class='bc' id='L637' title='0|2|2 - Total: 2'>            while (frame != null) {
</span><span class='bc' id='L638' title='0|1|1 - Total: 1'>                --linePCIndex;
</span><span class='bc' id='L639' title='0|5|5 - Total: 5'>                linePC[linePCIndex] = frame.pcSourceLineStart;
</span><span class='bc' id='L640' title='0|4|4 - Total: 4'>                frame = frame.parentFrame;
</span>            }
<span class='bc' id='L642' title='0|1|1 - Total: 1'>        }
</span><span class='bpc' id='L643' title='0|1|1 - Total: 2'>        if (linePCIndex != 0) Kit.codeBug();
</span>
<span class='bc' id='L645' title='0|3|3 - Total: 3'>        ex.interpreterStackInfo = array;
</span><span class='bc' id='L646' title='0|3|3 - Total: 3'>        ex.interpreterLineData = linePC;
</span><span class='bc' id='L647' title='0|1|1 - Total: 1'>    }
</span>
    public String getSourcePositionFromStack(Context cx, int[] linep)
    {
<span class='bc' id='L651' title='0|4|4 - Total: 4'>        CallFrame frame = (CallFrame)cx.lastInterpreterFrame;
</span><span class='bc' id='L652' title='0|3|3 - Total: 3'>        InterpreterData idata = frame.idata;
</span><span class='bc' id='L653' title='0|2|2 - Total: 2'>        if (frame.pcSourceLineStart >= 0) {
</span><span class='bc' id='L654' title='0|9|9 - Total: 9'>            linep[0] = getIndex(idata.itsICode, frame.pcSourceLineStart);
</span>        } else {
<span class='bc' id='L656' title='0|4|4 - Total: 4'>            linep[0] = 0;
</span>        }
<span class='bc' id='L658' title='0|3|3 - Total: 3'>        return idata.itsSourceFile;
</span>    }

    public String getPatchedStack(RhinoException ex,
                                  String nativeStackTrace)
    {
<span class='nc' id='L664' title='0|0|0 - Total: 2'>        String tag = "org.mozilla.javascript.Interpreter.interpretLoop";
</span><span class='nc' id='L665' title='0|0|0 - Total: 8'>        StringBuilder sb = new StringBuilder(nativeStackTrace.length() + 1000);
</span><span class='nc' id='L666' title='0|0|0 - Total: 3'>        String lineSeparator = SecurityUtilities.getSystemProperty("line.separator");
</span>
<span class='nc' id='L668' title='0|0|0 - Total: 5'>        CallFrame[] array = (CallFrame[])ex.interpreterStackInfo;
</span><span class='nc' id='L669' title='0|0|0 - Total: 3'>        int[] linePC = ex.interpreterLineData;
</span><span class='nc' id='L670' title='0|0|0 - Total: 3'>        int arrayIndex = array.length;
</span><span class='nc' id='L671' title='0|0|0 - Total: 3'>        int linePCIndex = linePC.length;
</span><span class='nc' id='L672' title='0|0|0 - Total: 2'>        int offset = 0;
</span><span class='nc' id='L673' title='0|0|0 - Total: 2'>        while (arrayIndex != 0) {
</span><span class='nc' id='L674' title='0|0|0 - Total: 1'>            --arrayIndex;
</span><span class='nc' id='L675' title='0|0|0 - Total: 5'>            int pos = nativeStackTrace.indexOf(tag, offset);
</span><span class='nc' id='L676' title='0|0|0 - Total: 2'>            if (pos < 0) {
</span><span class='nc' id='L677' title='0|0|0 - Total: 1'>                break;
</span>            }

            // Skip tag length
<span class='nc' id='L681' title='0|0|0 - Total: 5'>            pos += tag.length();
</span>            // Skip until the end of line
<span class='nc' id='L683' title='0|0|0 - Total: 2'>            for (; pos != nativeStackTrace.length(); ++pos) {
</span><span class='nc' id='L684' title='0|0|0 - Total: 4'>                char c = nativeStackTrace.charAt(pos);
</span><span class='nc' id='L685' title='0|0|0 - Total: 4'>                if (c == '\n' || c == '\r') {
</span><span class='nc' id='L686' title='0|0|0 - Total: 1'>                    break;
</span>                }
            }
<span class='nc' id='L689' title='0|0|0 - Total: 7'>            sb.append(nativeStackTrace.substring(offset, pos));
</span><span class='nc' id='L690' title='0|0|0 - Total: 2'>            offset = pos;
</span>
<span class='nc' id='L692' title='0|0|0 - Total: 4'>            CallFrame frame = array[arrayIndex];
</span><span class='nc' id='L693' title='0|0|0 - Total: 2'>            while (frame != null) {
</span><span class='nc' id='L694' title='0|0|0 - Total: 2'>                if (linePCIndex == 0) Kit.codeBug();
</span><span class='nc' id='L695' title='0|0|0 - Total: 1'>                --linePCIndex;
</span><span class='nc' id='L696' title='0|0|0 - Total: 3'>                InterpreterData idata = frame.idata;
</span><span class='nc' id='L697' title='0|0|0 - Total: 4'>                sb.append(lineSeparator);
</span><span class='nc' id='L698' title='0|0|0 - Total: 4'>                sb.append("\tat script");
</span><span class='nc' id='L699' title='0|0|0 - Total: 4'>                if (idata.itsName != null && idata.itsName.length() != 0) {
</span><span class='nc' id='L700' title='0|0|0 - Total: 4'>                    sb.append('.');
</span><span class='nc' id='L701' title='0|0|0 - Total: 5'>                    sb.append(idata.itsName);
</span>                }
<span class='nc' id='L703' title='0|0|0 - Total: 4'>                sb.append('(');
</span><span class='nc' id='L704' title='0|0|0 - Total: 5'>                sb.append(idata.itsSourceFile);
</span><span class='nc' id='L705' title='0|0|0 - Total: 4'>                int pc = linePC[linePCIndex];
</span><span class='nc' id='L706' title='0|0|0 - Total: 2'>                if (pc >= 0) {
</span>                    // Include line info only if available
<span class='nc' id='L708' title='0|0|0 - Total: 4'>                    sb.append(':');
</span><span class='nc' id='L709' title='0|0|0 - Total: 7'>                    sb.append(getIndex(idata.itsICode, pc));
</span>                }
<span class='nc' id='L711' title='0|0|0 - Total: 4'>                sb.append(')');
</span><span class='nc' id='L712' title='0|0|0 - Total: 3'>                frame = frame.parentFrame;
</span><span class='nc' id='L713' title='0|0|0 - Total: 1'>            }
</span><span class='nc' id='L714' title='0|0|0 - Total: 1'>        }
</span><span class='nc' id='L715' title='0|0|0 - Total: 6'>        sb.append(nativeStackTrace.substring(offset));
</span>
<span class='nc' id='L717' title='0|0|0 - Total: 3'>        return sb.toString();
</span>    }

    public List<String> getScriptStack(RhinoException ex) {
<span class='nc' id='L721' title='0|0|0 - Total: 4'>        ScriptStackElement[][] stack = getScriptStackElements(ex);
</span><span class='nc' id='L722' title='0|0|0 - Total: 6'>        List<String> list = new ArrayList<String>(stack.length);
</span><span class='nc' id='L723' title='0|0|0 - Total: 1'>        String lineSeparator =
</span><span class='nc' id='L724' title='0|0|0 - Total: 2'>                SecurityUtilities.getSystemProperty("line.separator");
</span><span class='nc' id='L725' title='0|0|0 - Total: 2'>        for (ScriptStackElement[] group : stack) {
</span><span class='nc' id='L726' title='0|0|0 - Total: 4'>            StringBuilder sb = new StringBuilder();
</span><span class='nc' id='L727' title='0|0|0 - Total: 2'>            for (ScriptStackElement elem : group) {
</span><span class='nc' id='L728' title='0|0|0 - Total: 3'>                elem.renderJavaStyle(sb);
</span><span class='nc' id='L729' title='0|0|0 - Total: 4'>                sb.append(lineSeparator);
</span>            }
<span class='nc' id='L731' title='0|0|0 - Total: 5'>            list.add(sb.toString());
</span>        }
<span class='nc' id='L733' title='0|0|0 - Total: 2'>        return list;
</span>    }

    public ScriptStackElement[][] getScriptStackElements(RhinoException ex)
    {
<span class='bpc' id='L738' title='0|1|1 - Total: 2'>        if (ex.interpreterStackInfo == null) {
</span><span class='nc' id='L739' title='0|0|0 - Total: 3'>            return null;
</span>        }

<span class='bc' id='L742' title='0|4|4 - Total: 4'>        List<ScriptStackElement[]> list = new ArrayList<ScriptStackElement[]>();
</span>
<span class='bc' id='L744' title='0|5|5 - Total: 5'>        CallFrame[] array = (CallFrame[])ex.interpreterStackInfo;
</span><span class='bc' id='L745' title='0|3|3 - Total: 3'>        int[] linePC = ex.interpreterLineData;
</span><span class='bc' id='L746' title='0|3|3 - Total: 3'>        int arrayIndex = array.length;
</span><span class='bc' id='L747' title='0|3|3 - Total: 3'>        int linePCIndex = linePC.length;
</span><span class='bc' id='L748' title='0|2|2 - Total: 2'>        while (arrayIndex != 0) {
</span><span class='bc' id='L749' title='0|1|1 - Total: 1'>            --arrayIndex;
</span><span class='bc' id='L750' title='0|4|4 - Total: 4'>            CallFrame frame = array[arrayIndex];
</span><span class='bc' id='L751' title='0|4|4 - Total: 4'>            List<ScriptStackElement> group = new ArrayList<ScriptStackElement>();
</span><span class='bc' id='L752' title='0|2|2 - Total: 2'>            while (frame != null) {
</span><span class='bpc' id='L753' title='0|1|1 - Total: 2'>                if (linePCIndex == 0) Kit.codeBug();
</span><span class='bc' id='L754' title='0|1|1 - Total: 1'>                --linePCIndex;
</span><span class='bc' id='L755' title='0|3|3 - Total: 3'>                InterpreterData idata = frame.idata;
</span><span class='bc' id='L756' title='0|3|3 - Total: 3'>                String fileName = idata.itsSourceFile;
</span><span class='bc' id='L757' title='0|2|2 - Total: 2'>                String functionName = null;
</span><span class='bc' id='L758' title='0|2|2 - Total: 2'>                int lineNumber = -1;
</span><span class='bc' id='L759' title='0|4|4 - Total: 4'>                int pc = linePC[linePCIndex];
</span><span class='bc' id='L760' title='0|2|2 - Total: 2'>                if (pc >= 0) {
</span><span class='bc' id='L761' title='0|5|5 - Total: 5'>                    lineNumber = getIndex(idata.itsICode, pc);
</span>                }
<span class='bpc' id='L763' title='0|3|3 - Total: 4'>                if (idata.itsName != null && idata.itsName.length() != 0) {
</span><span class='bc' id='L764' title='0|3|3 - Total: 3'>                    functionName = idata.itsName;
</span>                }
<span class='bc' id='L766' title='0|3|3 - Total: 3'>                frame = frame.parentFrame;
</span><span class='bc' id='L767' title='0|9|9 - Total: 9'>                group.add(new ScriptStackElement(fileName, functionName, lineNumber));
</span><span class='bc' id='L768' title='0|1|1 - Total: 1'>            }
</span><span class='bc' id='L769' title='0|8|8 - Total: 8'>            list.add(group.toArray(new ScriptStackElement[group.size()]));
</span><span class='bc' id='L770' title='0|1|1 - Total: 1'>        }
</span><span class='bc' id='L771' title='0|7|7 - Total: 7'>        return list.toArray(new ScriptStackElement[list.size()][]);
</span>    }

    static String getEncodedSource(InterpreterData idata)
    {
<span class='bpc' id='L776' title='0|1|1 - Total: 2'>        if (idata.encodedSource == null) {
</span><span class='nc' id='L777' title='0|0|0 - Total: 2'>            return null;
</span>        }
<span class='bc' id='L779' title='0|8|8 - Total: 8'>        return idata.encodedSource.substring(idata.encodedSourceStart,
</span>                                             idata.encodedSourceEnd);
    }

    private static void initFunction(Context cx, Scriptable scope,
                                     InterpretedFunction parent, int index)
    {
        InterpretedFunction fn;
<span class='bc' id='L787' title='0|6|6 - Total: 6'>        fn = InterpretedFunction.createFunction(cx, scope, parent, index);
</span><span class='bc' id='L788' title='0|10|10 - Total: 10'>        ScriptRuntime.initFunction(cx, scope, fn, fn.idata.itsFunctionType,
</span>                                   parent.idata.evalScriptFlag);
<span class='bc' id='L790' title='0|1|1 - Total: 1'>    }
</span>
    static Object interpret(InterpretedFunction ifun,
                            Context cx, Scriptable scope,
                            Scriptable thisObj, Object[] args)
    {
<span class='bpc' id='L796' title='0|1|1 - Total: 2'>        if (!ScriptRuntime.hasTopCall(cx)) Kit.codeBug();
</span>
<span class='bpc' id='L798' title='0|1|1 - Total: 2'>        if (cx.interpreterSecurityDomain != ifun.securityDomain) {
</span><span class='nc' id='L799' title='0|0|0 - Total: 3'>            Object savedDomain = cx.interpreterSecurityDomain;
</span><span class='nc' id='L800' title='0|0|0 - Total: 4'>            cx.interpreterSecurityDomain = ifun.securityDomain;
</span>            try {
<span class='nc' id='L802' title='0|0|0 - Total: 13'>                return ifun.securityController.callWithDomain(
</span>                    ifun.securityDomain, cx, ifun, scope, thisObj, args);
            } finally {
<span class='nc' id='L805' title='0|0|0 - Total: 7'>                cx.interpreterSecurityDomain = savedDomain;
</span><span class='nc' id='L806' title='0|0|0 - Total: 2'>            }
</span>        }

<span class='bc' id='L809' title='0|5|5 - Total: 5'>        CallFrame frame = new CallFrame();
</span><span class='bc' id='L810' title='0|12|12 - Total: 12'>        initFrame(cx, scope, thisObj, args, null, 0, args.length,
</span>                  ifun, null, frame);
<span class='bc' id='L812' title='0|4|4 - Total: 4'>        frame.isContinuationsTopFrame = cx.isContinuationsTopCall;
</span><span class='bc' id='L813' title='0|3|3 - Total: 3'>        cx.isContinuationsTopCall = false;
</span>
<span class='bc' id='L815' title='0|5|5 - Total: 5'>        return interpretLoop(cx, frame, null);
</span>    }

    static class GeneratorState {
        GeneratorState(int operation, Object value) {
            this.operation = operation;
            this.value = value;
        }
        int operation;
        Object value;
        RuntimeException returnedException;
    }

    public static Object resumeGenerator(Context cx,
                                         Scriptable scope,
                                         int operation,
                                         Object savedState,
                                         Object value)
    {
<span class='bc' id='L834' title='0|3|3 - Total: 3'>      CallFrame frame = (CallFrame) savedState;
</span><span class='bc' id='L835' title='0|6|6 - Total: 6'>      GeneratorState generatorState = new GeneratorState(operation, value);
</span><span class='bc' id='L836' title='0|2|2 - Total: 2'>      if (operation == NativeGenerator.GENERATOR_CLOSE) {
</span>          try {
<span class='nc' id='L838' title='0|0|0 - Total: 5'>              return interpretLoop(cx, frame, generatorState);
</span><span class='bc' id='L839' title='0|1|1 - Total: 1'>          } catch (RuntimeException e) {
</span>              // Only propagate exceptions other than closingException
<span class='bpc' id='L841' title='0|1|1 - Total: 2'>              if (e != value)
</span><span class='nc' id='L842' title='0|0|0 - Total: 2'>                  throw e;
</span>          }
<span class='bc' id='L844' title='0|2|2 - Total: 2'>          return Undefined.instance;
</span>      }
<span class='bc' id='L846' title='0|5|5 - Total: 5'>      Object result = interpretLoop(cx, frame, generatorState);
</span><span class='bc' id='L847' title='0|2|2 - Total: 2'>      if (generatorState.returnedException != null)
</span><span class='bc' id='L848' title='0|3|3 - Total: 3'>          throw generatorState.returnedException;
</span><span class='bc' id='L849' title='0|2|2 - Total: 2'>      return result;
</span>    }

    public static Object restartContinuation(NativeContinuation c, Context cx,
                                             Scriptable scope, Object[] args)
    {
<span class='bc' id='L855' title='0|2|2 - Total: 2'>        if (!ScriptRuntime.hasTopCall(cx)) {
</span><span class='bc' id='L856' title='0|9|9 - Total: 9'>            return ScriptRuntime.doTopCall(c, cx, scope, null, args, cx.isTopLevelStrict);
</span>        }

        Object arg;
<span class='bpc' id='L860' title='0|1|1 - Total: 2'>        if (args.length == 0) {
</span><span class='nc' id='L861' title='0|0|0 - Total: 3'>            arg = Undefined.instance;
</span>        } else {
<span class='bc' id='L863' title='0|4|4 - Total: 4'>            arg = args[0];
</span>        }

<span class='bc' id='L866' title='0|4|4 - Total: 4'>        CallFrame capturedFrame = (CallFrame)c.getImplementation();
</span><span class='bpc' id='L867' title='0|1|1 - Total: 2'>        if (capturedFrame == null) {
</span>            // No frames to restart
<span class='nc' id='L869' title='0|0|0 - Total: 2'>            return arg;
</span>        }

<span class='bc' id='L872' title='0|6|6 - Total: 6'>        ContinuationJump cjump = new ContinuationJump(c, null);
</span>
<span class='bc' id='L874' title='0|3|3 - Total: 3'>        cjump.result = arg;
</span><span class='bc' id='L875' title='0|5|5 - Total: 5'>        return interpretLoop(cx, null, cjump);
</span>    }

    private static Object interpretLoop(Context cx, CallFrame frame,
                                        Object throwable)
    {
        // throwable holds exception object to rethrow or catch
        // It is also used for continuation restart in which case
        // it holds ContinuationJump

<span class='bc' id='L885' title='0|2|2 - Total: 2'>        final Object DBL_MRK = DOUBLE_MARK;
</span><span class='bc' id='L886' title='0|2|2 - Total: 2'>        final Object undefined = Undefined.instance;
</span>
<span class='bc' id='L888' title='0|2|2 - Total: 2'>        final boolean instructionCounting = (cx.instructionThreshold != 0);
</span>        // arbitrary number to add to instructionCount when calling
        // other functions
<span class='bc' id='L891' title='0|2|2 - Total: 2'>        final int INVOCATION_COST = 100;
</span>        // arbitrary exception cost for instruction counting
<span class='bc' id='L893' title='0|2|2 - Total: 2'>        final int EXCEPTION_COST = 100;
</span>
<span class='bc' id='L895' title='0|2|2 - Total: 2'>        String stringReg = null;
</span><span class='bc' id='L896' title='0|2|2 - Total: 2'>        int indexReg = -1;
</span>
<span class='bc' id='L898' title='0|2|2 - Total: 2'>        if (cx.lastInterpreterFrame != null) {
</span>            // save the top frame from the previous interpretLoop
            // invocation on the stack
<span class='bc' id='L901' title='0|2|2 - Total: 2'>            if (cx.previousInterpreterInvocations == null) {
</span><span class='bc' id='L902' title='0|5|5 - Total: 5'>                cx.previousInterpreterInvocations = new ObjArray();
</span>            }
<span class='bc' id='L904' title='0|5|5 - Total: 5'>            cx.previousInterpreterInvocations.push(cx.lastInterpreterFrame);
</span>        }

        // When restarting continuation throwable is not null and to jump
        // to the code that rewind continuation state indexReg should be set
        // to -1.
        // With the normal call throwable == null and indexReg == -1 allows to
        // catch bugs with using indeReg to access array elements before
        // initializing indexReg.

<span class='bc' id='L914' title='0|2|2 - Total: 2'>        GeneratorState generatorState = null;
</span><span class='bc' id='L915' title='0|2|2 - Total: 2'>        if (throwable != null) {
</span><span class='bc' id='L916' title='0|2|2 - Total: 2'>            if (throwable instanceof GeneratorState) {
</span><span class='bc' id='L917' title='0|3|3 - Total: 3'>              generatorState = (GeneratorState) throwable;
</span>
              // reestablish this call frame
<span class='bc' id='L920' title='0|5|5 - Total: 5'>              enterFrame(cx, frame, ScriptRuntime.emptyArgs, true);
</span><span class='bc' id='L921' title='0|3|3 - Total: 3'>              throwable = null;
</span><span class='bpc' id='L922' title='0|1|1 - Total: 2'>            } else if (!(throwable instanceof ContinuationJump)) {
</span>                // It should be continuation
<span class='nc' id='L924' title='0|0|0 - Total: 2'>                Kit.codeBug();
</span>            }
        }

<span class='bc' id='L928' title='0|2|2 - Total: 2'>        Object interpreterResult = null;
</span><span class='bc' id='L929' title='0|2|2 - Total: 2'>        double interpreterResultDbl = 0.0;
</span>
        StateLoop: for (;;) {
            withoutExceptions: try {

<span class='bc' id='L934' title='0|2|2 - Total: 2'>                if (throwable != null) {
</span>                    // Need to return both 'frame' and 'throwable' from
                    // 'processThrowable', so just added a 'throwable'
                    // member in 'frame'.
<span class='bc' id='L938' title='0|7|7 - Total: 7'>                    frame = processThrowable(cx, throwable, frame, indexReg,
</span>                                             instructionCounting);
<span class='bc' id='L940' title='0|3|3 - Total: 3'>                    throwable = frame.throwable;
</span><span class='bc' id='L941' title='0|4|4 - Total: 4'>                    frame.throwable = null;
</span>                } else {
<span class='bpc' id='L943' title='0|3|3 - Total: 4'>                    if (generatorState == null && frame.frozen) Kit.codeBug();
</span>                }

                // Use local variables for constant values in frame
                // for faster access
<span class='bc' id='L948' title='0|3|3 - Total: 3'>                Object[] stack = frame.stack;
</span><span class='bc' id='L949' title='0|3|3 - Total: 3'>                double[] sDbl = frame.sDbl;
</span><span class='bc' id='L950' title='0|4|4 - Total: 4'>                Object[] vars = frame.varSource.stack;
</span><span class='bc' id='L951' title='0|4|4 - Total: 4'>                double[] varDbls = frame.varSource.sDbl;
</span><span class='bc' id='L952' title='0|4|4 - Total: 4'>                int[] varAttributes = frame.varSource.stackAttributes;
</span><span class='bc' id='L953' title='0|4|4 - Total: 4'>                byte[] iCode = frame.idata.itsICode;
</span><span class='bc' id='L954' title='0|4|4 - Total: 4'>                String[] strings = frame.idata.itsStringTable;
</span>
                // Use local for stackTop as well. Since execption handlers
                // can only exist at statement level where stack is empty,
                // it is necessary to save/restore stackTop only across
                // function calls and normal returns.
<span class='bc' id='L960' title='0|3|3 - Total: 3'>                int stackTop = frame.savedStackTop;
</span>
                // Store new frame in cx which is used for error reporting etc.
<span class='bc' id='L963' title='0|3|3 - Total: 3'>                cx.lastInterpreterFrame = frame;
</span>
                Loop: for (;;) {

                    // Exception handler assumes that PC is already incremented
                    // pass the instruction start when it searches the
                    // exception handler
<span class='bc' id='L970' title='0|10|10 - Total: 10'>                    int op = iCode[frame.pc++];
</span>                    jumplessRun: {

    // Back indent to ease implementation reading
<span class='bpc' id='L974' title='0|114|114 - Total: 122'>switch (op) {
</span>    case Icode_GENERATOR: {
<span class='bc' id='L976' title='0|2|2 - Total: 2'>        if (!frame.frozen) {
</span>          // First time encountering this opcode: create new generator
          // object and return
<span class='bc' id='L979' title='0|6|6 - Total: 6'>          frame.pc--; // we want to come back here when we resume
</span><span class='bc' id='L980' title='0|3|3 - Total: 3'>          CallFrame generatorFrame = captureFrameForGenerator(frame);
</span><span class='bc' id='L981' title='0|3|3 - Total: 3'>          generatorFrame.frozen = true;
</span><span class='bc' id='L982' title='0|9|9 - Total: 9'>          NativeGenerator generator = new NativeGenerator(frame.scope,
</span>              generatorFrame.fnOrScript, generatorFrame);
<span class='bc' id='L984' title='0|3|3 - Total: 3'>          frame.result = generator;
</span><span class='bc' id='L985' title='0|1|1 - Total: 1'>          break Loop;
</span>        } else {
          // We are now resuming execution. Fall through to YIELD case.
        }
    }
    // fall through...
    case Token.YIELD: {
<span class='bc' id='L992' title='0|2|2 - Total: 2'>        if (!frame.frozen) {
</span><span class='bc' id='L993' title='0|6|6 - Total: 6'>            return freezeGenerator(cx, frame, stackTop, generatorState);
</span>        } else {
<span class='bc' id='L995' title='0|6|6 - Total: 6'>            Object obj = thawGenerator(frame, stackTop, generatorState, op);
</span><span class='bc' id='L996' title='0|2|2 - Total: 2'>            if (obj != Scriptable.NOT_FOUND) {
</span><span class='bc' id='L997' title='0|2|2 - Total: 2'>                throwable = obj;
</span><span class='bc' id='L998' title='0|1|1 - Total: 1'>                break withoutExceptions;
</span>            }
            continue Loop;
        }
    }
    case Icode_GENERATOR_END: {
      // throw StopIteration
<span class='bc' id='L1005' title='0|3|3 - Total: 3'>      frame.frozen = true;
</span><span class='bc' id='L1006' title='0|5|5 - Total: 5'>      int sourceLine = getIndex(iCode, frame.pc);
</span><span class='bc' id='L1007' title='0|5|5 - Total: 5'>      generatorState.returnedException = new JavaScriptException(
</span><span class='bc' id='L1008' title='0|7|7 - Total: 7'>          NativeIterator.getStopIterationObject(frame.scope),
</span>          frame.idata.itsSourceFile, sourceLine);
<span class='bc' id='L1010' title='0|1|1 - Total: 1'>      break Loop;
</span>    }
    case Token.THROW: {
<span class='bc' id='L1013' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bc' id='L1014' title='0|2|2 - Total: 2'>        if (value == DBL_MRK) value = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1015' title='0|1|1 - Total: 1'>        --stackTop;
</span>
<span class='bc' id='L1017' title='0|5|5 - Total: 5'>        int sourceLine = getIndex(iCode, frame.pc);
</span><span class='bc' id='L1018' title='0|9|9 - Total: 9'>        throwable = new JavaScriptException(value,
</span>                                            frame.idata.itsSourceFile,
                                            sourceLine);
<span class='bc' id='L1021' title='0|1|1 - Total: 1'>        break withoutExceptions;
</span>    }
    case Token.RETHROW: {
<span class='bc' id='L1024' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span><span class='bc' id='L1025' title='0|4|4 - Total: 4'>        throwable = stack[indexReg];
</span><span class='bc' id='L1026' title='0|1|1 - Total: 1'>        break withoutExceptions;
</span>    }
    case Token.GE :
    case Token.LE :
    case Token.GT :
    case Token.LT : {
<span class='bc' id='L1032' title='0|7|7 - Total: 7'>        stackTop = doCompare(frame, op, stack, sDbl, stackTop);
</span><span class='bc' id='L1033' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.IN :
    case Token.INSTANCEOF : {
<span class='bc' id='L1037' title='0|7|7 - Total: 7'>        stackTop = doInOrInstanceof(cx, op, stack, sDbl, stackTop);
</span><span class='bc' id='L1038' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.EQ :
    case Token.NE : {
<span class='bc' id='L1042' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1043' title='0|5|5 - Total: 5'>        boolean valBln = doEquals(stack, sDbl, stackTop);
</span><span class='bc' id='L1044' title='0|2|2 - Total: 2'>        valBln ^= (op == Token.NE);
</span><span class='bc' id='L1045' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.wrapBoolean(valBln);
</span><span class='bc' id='L1046' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.SHEQ :
    case Token.SHNE : {
<span class='bc' id='L1050' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1051' title='0|5|5 - Total: 5'>        boolean valBln = doShallowEquals(stack, sDbl, stackTop);
</span><span class='bc' id='L1052' title='0|2|2 - Total: 2'>        valBln ^= (op == Token.SHNE);
</span><span class='bc' id='L1053' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.wrapBoolean(valBln);
</span><span class='bc' id='L1054' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.IFNE :
<span class='bc' id='L1057' title='0|2|2 - Total: 2'>        if (stack_boolean(frame, stackTop--)) {
</span><span class='bc' id='L1058' title='0|6|6 - Total: 6'>            frame.pc += 2;
</span><span class='bc' id='L1059' title='0|1|1 - Total: 1'>            continue Loop;
</span>        }
        break jumplessRun;
    case Token.IFEQ :
<span class='bc' id='L1063' title='0|2|2 - Total: 2'>        if (!stack_boolean(frame, stackTop--)) {
</span><span class='bc' id='L1064' title='0|6|6 - Total: 6'>            frame.pc += 2;
</span><span class='bc' id='L1065' title='0|1|1 - Total: 1'>            continue Loop;
</span>        }
        break jumplessRun;
    case Icode_IFEQ_POP :
<span class='bc' id='L1069' title='0|2|2 - Total: 2'>        if (!stack_boolean(frame, stackTop--)) {
</span><span class='bc' id='L1070' title='0|6|6 - Total: 6'>            frame.pc += 2;
</span><span class='bc' id='L1071' title='0|1|1 - Total: 1'>            continue Loop;
</span>        }
<span class='bc' id='L1073' title='0|5|5 - Total: 5'>        stack[stackTop--] = null;
</span><span class='bc' id='L1074' title='0|1|1 - Total: 1'>        break jumplessRun;
</span>    case Token.GOTO :
<span class='bc' id='L1076' title='0|1|1 - Total: 1'>        break jumplessRun;
</span>    case Icode_GOSUB :
<span class='bc' id='L1078' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1079' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1080' title='0|8|8 - Total: 8'>        sDbl[stackTop] = frame.pc + 2;
</span><span class='bc' id='L1081' title='0|1|1 - Total: 1'>        break jumplessRun;
</span>    case Icode_STARTSUB :
<span class='bc' id='L1083' title='0|2|2 - Total: 2'>        if (stackTop == frame.emptyStackTop + 1) {
</span>            // Call from Icode_GOSUB: store return PC address in the local
<span class='bc' id='L1085' title='0|5|5 - Total: 5'>            indexReg += frame.localShift;
</span><span class='bc' id='L1086' title='0|6|6 - Total: 6'>            stack[indexReg] = stack[stackTop];
</span><span class='bc' id='L1087' title='0|6|6 - Total: 6'>            sDbl[indexReg] = sDbl[stackTop];
</span><span class='bc' id='L1088' title='0|2|2 - Total: 2'>            --stackTop;
</span>        } else {
            // Call from exception handler: exception object is already stored
            // in the local
<span class='bpc' id='L1092' title='0|1|1 - Total: 2'>            if (stackTop != frame.emptyStackTop) Kit.codeBug();
</span>        }
        continue Loop;
    case Icode_RETSUB : {
        // indexReg: local to store return address
<span class='bpc' id='L1097' title='0|1|1 - Total: 2'>        if (instructionCounting) {
</span><span class='nc' id='L1098' title='0|0|0 - Total: 4'>            addInstructionCount(cx, frame, 0);
</span>        }
<span class='bc' id='L1100' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span><span class='bc' id='L1101' title='0|4|4 - Total: 4'>        Object value = stack[indexReg];
</span><span class='bc' id='L1102' title='0|2|2 - Total: 2'>        if (value != DBL_MRK) {
</span>            // Invocation from exception handler, restore object to rethrow
<span class='bc' id='L1104' title='0|2|2 - Total: 2'>            throwable = value;
</span><span class='bc' id='L1105' title='0|1|1 - Total: 1'>            break withoutExceptions;
</span>        }
        // Normal return from GOSUB
<span class='bc' id='L1108' title='0|6|6 - Total: 6'>        frame.pc = (int)sDbl[indexReg];
</span><span class='bpc' id='L1109' title='0|1|1 - Total: 2'>        if (instructionCounting) {
</span><span class='nc' id='L1110' title='0|0|0 - Total: 5'>            frame.pcPrevBranch = frame.pc;
</span>        }
        continue Loop;
    }
    case Icode_POP :
<span class='bc' id='L1115' title='0|4|4 - Total: 4'>        stack[stackTop] = null;
</span><span class='bc' id='L1116' title='0|1|1 - Total: 1'>        stackTop--;
</span><span class='bc' id='L1117' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_POP_RESULT :
<span class='bc' id='L1119' title='0|5|5 - Total: 5'>        frame.result = stack[stackTop];
</span><span class='bc' id='L1120' title='0|5|5 - Total: 5'>        frame.resultDbl = sDbl[stackTop];
</span><span class='bc' id='L1121' title='0|4|4 - Total: 4'>        stack[stackTop] = null;
</span><span class='bc' id='L1122' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1123' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_DUP :
<span class='bc' id='L1125' title='0|8|8 - Total: 8'>        stack[stackTop + 1] = stack[stackTop];
</span><span class='bc' id='L1126' title='0|8|8 - Total: 8'>        sDbl[stackTop + 1] = sDbl[stackTop];
</span><span class='bc' id='L1127' title='0|1|1 - Total: 1'>        stackTop++;
</span><span class='bc' id='L1128' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_DUP2 :
<span class='bc' id='L1130' title='0|10|10 - Total: 10'>        stack[stackTop + 1] = stack[stackTop - 1];
</span><span class='bc' id='L1131' title='0|10|10 - Total: 10'>        sDbl[stackTop + 1] = sDbl[stackTop - 1];
</span><span class='bc' id='L1132' title='0|8|8 - Total: 8'>        stack[stackTop + 2] = stack[stackTop];
</span><span class='bc' id='L1133' title='0|8|8 - Total: 8'>        sDbl[stackTop + 2] = sDbl[stackTop];
</span><span class='bc' id='L1134' title='0|1|1 - Total: 1'>        stackTop += 2;
</span><span class='bc' id='L1135' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_SWAP : {
<span class='nc' id='L1137' title='0|0|0 - Total: 4'>        Object o = stack[stackTop];
</span><span class='nc' id='L1138' title='0|0|0 - Total: 8'>        stack[stackTop] = stack[stackTop - 1];
</span><span class='nc' id='L1139' title='0|0|0 - Total: 6'>        stack[stackTop - 1] = o;
</span><span class='nc' id='L1140' title='0|0|0 - Total: 4'>        double d = sDbl[stackTop];
</span><span class='nc' id='L1141' title='0|0|0 - Total: 8'>        sDbl[stackTop] = sDbl[stackTop - 1];
</span><span class='nc' id='L1142' title='0|0|0 - Total: 6'>        sDbl[stackTop - 1] = d;
</span><span class='nc' id='L1143' title='0|0|0 - Total: 1'>        continue Loop;
</span>    }
    case Token.RETURN :
<span class='bc' id='L1146' title='0|5|5 - Total: 5'>        frame.result = stack[stackTop];
</span><span class='bc' id='L1147' title='0|5|5 - Total: 5'>        frame.resultDbl = sDbl[stackTop];
</span><span class='bc' id='L1148' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1149' title='0|1|1 - Total: 1'>        break Loop;
</span>    case Token.RETURN_RESULT :
<span class='bc' id='L1151' title='0|1|1 - Total: 1'>        break Loop;
</span>    case Icode_RETUNDEF :
<span class='bc' id='L1153' title='0|3|3 - Total: 3'>        frame.result = undefined;
</span><span class='bc' id='L1154' title='0|1|1 - Total: 1'>        break Loop;
</span>    case Token.BITNOT : {
<span class='bc' id='L1156' title='0|4|4 - Total: 4'>        int rIntValue = stack_int32(frame, stackTop);
</span><span class='bc' id='L1157' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1158' title='0|7|7 - Total: 7'>        sDbl[stackTop] = ~rIntValue;
</span><span class='bc' id='L1159' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.BITAND :
    case Token.BITOR :
    case Token.BITXOR :
    case Token.LSH :
    case Token.RSH : {
<span class='bc' id='L1166' title='0|7|7 - Total: 7'>        stackTop = doBitOp(frame, op, stack, sDbl, stackTop);
</span><span class='bc' id='L1167' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.URSH : {
<span class='bc' id='L1170' title='0|6|6 - Total: 6'>        double lDbl = stack_double(frame, stackTop - 1);
</span><span class='bc' id='L1171' title='0|6|6 - Total: 6'>        int rIntValue = stack_int32(frame, stackTop) & 0x1F;
</span><span class='bc' id='L1172' title='0|5|5 - Total: 5'>        stack[--stackTop] = DBL_MRK;
</span><span class='bc' id='L1173' title='0|8|8 - Total: 8'>        sDbl[stackTop] = ScriptRuntime.toUint32(lDbl) >>> rIntValue;
</span><span class='bc' id='L1174' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.NEG :
    case Token.POS : {
<span class='bc' id='L1178' title='0|4|4 - Total: 4'>        double rDbl = stack_double(frame, stackTop);
</span><span class='bc' id='L1179' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1180' title='0|2|2 - Total: 2'>        if (op == Token.NEG) {
</span><span class='bc' id='L1181' title='0|3|3 - Total: 3'>            rDbl = -rDbl;
</span>        }
<span class='bc' id='L1183' title='0|4|4 - Total: 4'>        sDbl[stackTop] = rDbl;
</span><span class='bc' id='L1184' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.ADD :
<span class='bc' id='L1187' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1188' title='0|5|5 - Total: 5'>        doAdd(stack, sDbl, stackTop, cx);
</span><span class='bc' id='L1189' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.SUB :
    case Token.MUL :
    case Token.DIV :
    case Token.MOD : {
<span class='bc' id='L1194' title='0|7|7 - Total: 7'>        stackTop = doArithmetic(frame, op, stack, sDbl, stackTop);
</span><span class='bc' id='L1195' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.NOT :
<span class='bc' id='L1198' title='0|6|6 - Total: 6'>        stack[stackTop] = ScriptRuntime.wrapBoolean(
</span><span class='bc' id='L1199' title='0|2|2 - Total: 2'>                              !stack_boolean(frame, stackTop));
</span><span class='bc' id='L1200' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.BINDNAME :
<span class='bc' id='L1202' title='0|9|9 - Total: 9'>        stack[++stackTop] = ScriptRuntime.bind(cx, frame.scope, stringReg);
</span><span class='bc' id='L1203' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.STRICT_SETNAME:
    case Token.SETNAME : {
<span class='bc' id='L1206' title='0|4|4 - Total: 4'>        Object rhs = stack[stackTop];
</span><span class='bc' id='L1207' title='0|2|2 - Total: 2'>        if (rhs == DBL_MRK) rhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1208' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1209' title='0|5|5 - Total: 5'>        Scriptable lhs = (Scriptable)stack[stackTop];
</span><span class='bpc' id='L1210' title='0|1|1 - Total: 2'>        stack[stackTop] = op == Token.SETNAME ?
</span><span class='bpc' id='L1211' title='0|2|2 - Total: 8'>                ScriptRuntime.setName(lhs, rhs, cx,
</span>                                      frame.scope, stringReg) :
<span class='bpc' id='L1213' title='0|1|1 - Total: 2'>                ScriptRuntime.strictSetName(lhs, rhs, cx,
</span>                                      frame.scope, stringReg);
<span class='bc' id='L1215' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_SETCONST: {
<span class='bc' id='L1218' title='0|4|4 - Total: 4'>        Object rhs = stack[stackTop];
</span><span class='bc' id='L1219' title='0|2|2 - Total: 2'>        if (rhs == DBL_MRK) rhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1220' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1221' title='0|5|5 - Total: 5'>        Scriptable lhs = (Scriptable)stack[stackTop];
</span><span class='bc' id='L1222' title='0|8|8 - Total: 8'>        stack[stackTop] = ScriptRuntime.setConst(lhs, rhs, cx, stringReg);
</span><span class='bc' id='L1223' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.DELPROP :
    case Icode_DELNAME : {
<span class='bc' id='L1227' title='0|8|8 - Total: 8'>        stackTop = doDelName(cx, frame, op, stack, sDbl, stackTop);
</span><span class='bc' id='L1228' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.GETPROPNOWARN : {
<span class='bc' id='L1231' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bpc' id='L1232' title='0|1|1 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1233' title='0|9|9 - Total: 9'>        stack[stackTop] = ScriptRuntime.getObjectPropNoWarn(lhs, stringReg,
</span>                                                            cx, frame.scope);
<span class='bc' id='L1235' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.GETPROP : {
<span class='bc' id='L1238' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L1239' title='0|2|2 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1240' title='0|9|9 - Total: 9'>        stack[stackTop] = ScriptRuntime.getObjectProp(lhs, stringReg,
</span>                                                      cx, frame.scope);
<span class='bc' id='L1242' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.SETPROP : {
<span class='bc' id='L1245' title='0|4|4 - Total: 4'>        Object rhs = stack[stackTop];
</span><span class='bc' id='L1246' title='0|2|2 - Total: 2'>        if (rhs == DBL_MRK) rhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1247' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1248' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bpc' id='L1249' title='0|1|1 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1250' title='0|10|10 - Total: 10'>        stack[stackTop] = ScriptRuntime.setObjectProp(lhs, stringReg, rhs,
</span>                                                      cx, frame.scope);
<span class='bc' id='L1252' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_PROP_INC_DEC : {
<span class='bc' id='L1255' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bpc' id='L1256' title='0|1|1 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1257' title='0|13|13 - Total: 13'>        stack[stackTop] = ScriptRuntime.propIncrDecr(lhs, stringReg,
</span>                                                     cx, frame.scope,
                                                     iCode[frame.pc]);
<span class='bc' id='L1260' title='0|6|6 - Total: 6'>        ++frame.pc;
</span><span class='bc' id='L1261' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.GETELEM : {
<span class='bc' id='L1264' title='0|7|7 - Total: 7'>        stackTop = doGetElem(cx, frame, stack, sDbl, stackTop);
</span><span class='bc' id='L1265' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.SETELEM : {
<span class='bc' id='L1268' title='0|7|7 - Total: 7'>        stackTop = doSetElem(cx, frame, stack, sDbl, stackTop);
</span><span class='bc' id='L1269' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_ELEM_INC_DEC: {
<span class='bc' id='L1272' title='0|8|8 - Total: 8'>        stackTop = doElemIncDec(cx, frame, iCode, stack, sDbl, stackTop);
</span><span class='bc' id='L1273' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.GET_REF : {
<span class='bc' id='L1276' title='0|5|5 - Total: 5'>        Ref ref = (Ref)stack[stackTop];
</span><span class='bc' id='L1277' title='0|6|6 - Total: 6'>        stack[stackTop] = ScriptRuntime.refGet(ref, cx);
</span><span class='bc' id='L1278' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.SET_REF : {
<span class='bc' id='L1281' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bc' id='L1282' title='0|2|2 - Total: 2'>        if (value == DBL_MRK) value = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1283' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1284' title='0|5|5 - Total: 5'>        Ref ref = (Ref)stack[stackTop];
</span><span class='bc' id='L1285' title='0|9|9 - Total: 9'>        stack[stackTop] = ScriptRuntime.refSet(ref, value, cx, frame.scope);
</span><span class='bc' id='L1286' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.DEL_REF : {
<span class='bc' id='L1289' title='0|5|5 - Total: 5'>        Ref ref = (Ref)stack[stackTop];
</span><span class='bc' id='L1290' title='0|6|6 - Total: 6'>        stack[stackTop] = ScriptRuntime.refDel(ref, cx);
</span><span class='bc' id='L1291' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_REF_INC_DEC : {
<span class='nc' id='L1294' title='0|0|0 - Total: 5'>        Ref ref = (Ref)stack[stackTop];
</span><span class='nc' id='L1295' title='0|0|0 - Total: 12'>        stack[stackTop] = ScriptRuntime.refIncrDecr(ref, cx, frame.scope,
</span>                                                    iCode[frame.pc]);
<span class='nc' id='L1297' title='0|0|0 - Total: 6'>        ++frame.pc;
</span><span class='nc' id='L1298' title='0|0|0 - Total: 1'>        continue Loop;
</span>    }
    case Token.LOCAL_LOAD :
<span class='bc' id='L1301' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1302' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span><span class='bc' id='L1303' title='0|6|6 - Total: 6'>        stack[stackTop] = stack[indexReg];
</span><span class='bc' id='L1304' title='0|6|6 - Total: 6'>        sDbl[stackTop] = sDbl[indexReg];
</span><span class='bc' id='L1305' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_LOCAL_CLEAR :
<span class='bc' id='L1307' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span><span class='bc' id='L1308' title='0|4|4 - Total: 4'>        stack[indexReg] = null;
</span><span class='bc' id='L1309' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_NAME_AND_THIS :
        // stringReg: name
<span class='bc' id='L1312' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1313' title='0|8|8 - Total: 8'>        stack[stackTop] = ScriptRuntime.getNameFunctionAndThis(stringReg,
</span>                                                               cx, frame.scope);
<span class='bc' id='L1315' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1316' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.lastStoredScriptable(cx);
</span><span class='bc' id='L1317' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_PROP_AND_THIS: {
<span class='bc' id='L1319' title='0|4|4 - Total: 4'>        Object obj = stack[stackTop];
</span><span class='bc' id='L1320' title='0|2|2 - Total: 2'>        if (obj == DBL_MRK) obj = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span>        // stringReg: property
<span class='bc' id='L1322' title='0|9|9 - Total: 9'>        stack[stackTop] = ScriptRuntime.getPropFunctionAndThis(obj, stringReg,
</span>                                                               cx, frame.scope);
<span class='bc' id='L1324' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1325' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.lastStoredScriptable(cx);
</span><span class='bc' id='L1326' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_ELEM_AND_THIS: {
<span class='bc' id='L1329' title='0|6|6 - Total: 6'>        Object obj = stack[stackTop - 1];
</span><span class='bpc' id='L1330' title='0|1|1 - Total: 2'>        if (obj == DBL_MRK) obj = ScriptRuntime.wrapNumber(sDbl[stackTop - 1]);
</span><span class='bc' id='L1331' title='0|4|4 - Total: 4'>        Object id = stack[stackTop];
</span><span class='bc' id='L1332' title='0|2|2 - Total: 2'>        if (id == DBL_MRK) id = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1333' title='0|11|11 - Total: 11'>        stack[stackTop - 1] = ScriptRuntime.getElemFunctionAndThis(obj, id, cx,
</span>                                                                   frame.scope);
<span class='bc' id='L1335' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.lastStoredScriptable(cx);
</span><span class='bc' id='L1336' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_VALUE_AND_THIS : {
<span class='bc' id='L1339' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bc' id='L1340' title='0|2|2 - Total: 2'>        if (value == DBL_MRK) value = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1341' title='0|6|6 - Total: 6'>        stack[stackTop] = ScriptRuntime.getValueFunctionAndThis(value, cx);
</span><span class='bc' id='L1342' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1343' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.lastStoredScriptable(cx);
</span><span class='bc' id='L1344' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_CALLSPECIAL : {
<span class='bpc' id='L1347' title='0|1|1 - Total: 2'>        if (instructionCounting) {
</span><span class='nc' id='L1348' title='0|0|0 - Total: 6'>            cx.instructionCount += INVOCATION_COST;
</span>        }
<span class='bc' id='L1350' title='0|9|9 - Total: 9'>        stackTop = doCallSpecial(cx, frame, stack, sDbl, stackTop, iCode, indexReg);
</span><span class='bc' id='L1351' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.CALL :
    case Icode_TAIL_CALL :
    case Token.REF_CALL : {
<span class='bc' id='L1356' title='0|2|2 - Total: 2'>        if (instructionCounting) {
</span><span class='bc' id='L1357' title='0|6|6 - Total: 6'>            cx.instructionCount += INVOCATION_COST;
</span>        }
        // stack change: function thisObj arg0 .. argN -> result
        // indexReg: number of arguments
<span class='bc' id='L1361' title='0|6|6 - Total: 6'>        stackTop -= 1 + indexReg;
</span>
        // CALL generation ensures that fun and funThisObj
        // are already Scriptable and Callable objects respectively
<span class='bc' id='L1365' title='0|5|5 - Total: 5'>        Callable fun = (Callable)stack[stackTop];
</span><span class='bc' id='L1366' title='0|7|7 - Total: 7'>        Scriptable funThisObj = (Scriptable)stack[stackTop + 1];
</span><span class='bc' id='L1367' title='0|2|2 - Total: 2'>        if (op == Token.REF_CALL) {
</span><span class='bc' id='L1368' title='0|8|8 - Total: 8'>            Object[] outArgs = getArgsArray(stack, sDbl, stackTop + 2,
</span>                                            indexReg);
<span class='nc' id='L1370' title='0|0|0 - Total: 8'>            stack[stackTop] = ScriptRuntime.callRef(fun, funThisObj,
</span>                                                    outArgs, cx);
<span class='nc' id='L1372' title='0|0|0 - Total: 1'>            continue Loop;
</span>        }
<span class='bc' id='L1374' title='0|3|3 - Total: 3'>        Scriptable calleeScope = frame.scope;
</span><span class='bc' id='L1375' title='0|2|2 - Total: 2'>        if (frame.useActivation) {
</span><span class='bc' id='L1376' title='0|4|4 - Total: 4'>            calleeScope = ScriptableObject.getTopLevelScope(frame.scope);
</span>        }
<span class='bc' id='L1378' title='0|2|2 - Total: 2'>        if (fun instanceof InterpretedFunction) {
</span><span class='bc' id='L1379' title='0|3|3 - Total: 3'>            InterpretedFunction ifun = (InterpretedFunction)fun;
</span><span class='bpc' id='L1380' title='0|1|1 - Total: 2'>            if (frame.fnOrScript.securityDomain == ifun.securityDomain) {
</span><span class='bc' id='L1381' title='0|2|2 - Total: 2'>                CallFrame callParentFrame = frame;
</span><span class='bc' id='L1382' title='0|5|5 - Total: 5'>                CallFrame calleeFrame = new CallFrame();
</span><span class='bc' id='L1383' title='0|2|2 - Total: 2'>                if (op == Icode_TAIL_CALL) {
</span>                    // In principle tail call can re-use the current
                    // frame and its stack arrays but it is hard to
                    // do properly. Any exceptions that can legally
                    // happen during frame re-initialization including
                    // StackOverflowException during innocent looking
                    // System.arraycopy may leave the current frame
                    // data corrupted leading to undefined behaviour
                    // in the catch code bellow that unwinds JS stack
                    // on exceptions. Then there is issue about frame release
                    // end exceptions there.
                    // To avoid frame allocation a released frame
                    // can be cached for re-use which would also benefit
                    // non-tail calls but it is not clear that this caching
                    // would gain in performance due to potentially
                    // bad interaction with GC.
<span class='bc' id='L1399' title='0|3|3 - Total: 3'>                    callParentFrame = frame.parentFrame;
</span>                    // Release the current frame. See Bug #344501 to see why
                    // it is being done here.
<span class='bc' id='L1402' title='0|4|4 - Total: 4'>                    exitFrame(cx, frame, null);
</span>                }
<span class='bc' id='L1404' title='0|13|13 - Total: 13'>                initFrame(cx, calleeScope, funThisObj, stack, sDbl,
</span>                          stackTop + 2, indexReg, ifun, callParentFrame,
                          calleeFrame);
<span class='bc' id='L1407' title='0|2|2 - Total: 2'>                if (op != Icode_TAIL_CALL) {
</span><span class='bc' id='L1408' title='0|3|3 - Total: 3'>                    frame.savedStackTop = stackTop;
</span><span class='bc' id='L1409' title='0|3|3 - Total: 3'>                    frame.savedCallOp = op;
</span>                }
<span class='bc' id='L1411' title='0|2|2 - Total: 2'>                frame = calleeFrame;
</span><span class='bc' id='L1412' title='0|1|1 - Total: 1'>                continue StateLoop;
</span>            }
        }

<span class='bc' id='L1416' title='0|2|2 - Total: 2'>        if (fun instanceof NativeContinuation) {
</span>            // Jump to the captured continuation
            ContinuationJump cjump;
<span class='bc' id='L1419' title='0|7|7 - Total: 7'>            cjump = new ContinuationJump((NativeContinuation)fun, frame);
</span>
            // continuation result is the first argument if any
            // of continuation call
<span class='bpc' id='L1423' title='0|1|1 - Total: 2'>            if (indexReg == 0) {
</span><span class='nc' id='L1424' title='0|0|0 - Total: 4'>                cjump.result = undefined;
</span>            } else {
<span class='bc' id='L1426' title='0|7|7 - Total: 7'>                cjump.result = stack[stackTop + 2];
</span><span class='bc' id='L1427' title='0|7|7 - Total: 7'>                cjump.resultDbl = sDbl[stackTop + 2];
</span>            }

            // Start the real unwind job
<span class='bc' id='L1431' title='0|2|2 - Total: 2'>            throwable = cjump;
</span><span class='bc' id='L1432' title='0|1|1 - Total: 1'>            break withoutExceptions;
</span>        }

<span class='bc' id='L1435' title='0|2|2 - Total: 2'>        if (fun instanceof IdFunctionObject) {
</span><span class='bc' id='L1436' title='0|3|3 - Total: 3'>            IdFunctionObject ifun = (IdFunctionObject)fun;
</span><span class='bpc' id='L1437' title='0|1|1 - Total: 2'>            if (NativeContinuation.isContinuationConstructor(ifun)) {
</span><span class='nc' id='L1438' title='0|0|0 - Total: 9'>                frame.stack[stackTop] = captureContinuation(cx,
</span>                        frame.parentFrame, false);
<span class='nc' id='L1440' title='0|0|0 - Total: 1'>                continue Loop;
</span>            }
            // Bug 405654 -- make best effort to keep Function.apply and
            // Function.call within this interpreter loop invocation
<span class='bc' id='L1444' title='0|2|2 - Total: 2'>            if (BaseFunction.isApplyOrCall(ifun)) {
</span><span class='bc' id='L1445' title='0|3|3 - Total: 3'>                Callable applyCallable = ScriptRuntime.getCallable(funThisObj);
</span><span class='bc' id='L1446' title='0|2|2 - Total: 2'>                if (applyCallable instanceof InterpretedFunction) {
</span><span class='bc' id='L1447' title='0|3|3 - Total: 3'>                    InterpretedFunction iApplyCallable = (InterpretedFunction)applyCallable;
</span><span class='bpc' id='L1448' title='0|1|1 - Total: 2'>                    if (frame.fnOrScript.securityDomain == iApplyCallable.securityDomain) {
</span><span class='bc' id='L1449' title='0|12|12 - Total: 12'>                        frame = initFrameForApplyOrCall(cx, frame, indexReg,
</span>                                stack, sDbl, stackTop, op, calleeScope, ifun,
                                iApplyCallable);
<span class='bc' id='L1452' title='0|1|1 - Total: 1'>                        continue StateLoop;
</span>                    }
                }
            }
        }

        // Bug 447697 -- make best effort to keep __noSuchMethod__ within this
        // interpreter loop invocation
<span class='bc' id='L1460' title='0|2|2 - Total: 2'>        if (fun instanceof NoSuchMethodShim) {
</span>            // get the shim and the actual method
<span class='bc' id='L1462' title='0|3|3 - Total: 3'>            NoSuchMethodShim noSuchMethodShim = (NoSuchMethodShim) fun;
</span><span class='bc' id='L1463' title='0|3|3 - Total: 3'>            Callable noSuchMethodMethod = noSuchMethodShim.noSuchMethodMethod;
</span>            // if the method is in fact an InterpretedFunction
<span class='bpc' id='L1465' title='0|1|1 - Total: 2'>            if (noSuchMethodMethod instanceof InterpretedFunction) {
</span><span class='bc' id='L1466' title='0|3|3 - Total: 3'>                InterpretedFunction ifun = (InterpretedFunction) noSuchMethodMethod;
</span><span class='bpc' id='L1467' title='0|1|1 - Total: 2'>                if (frame.fnOrScript.securityDomain == ifun.securityDomain) {
</span><span class='bc' id='L1468' title='0|13|13 - Total: 13'>                    frame = initFrameForNoSuchMethod(cx, frame, indexReg, stack, sDbl,
</span>                                             stackTop, op, funThisObj, calleeScope,
                                             noSuchMethodShim, ifun);
<span class='bc' id='L1471' title='0|1|1 - Total: 1'>                    continue StateLoop;
</span>                }
            }
        }

<span class='bc' id='L1476' title='0|3|3 - Total: 3'>        cx.lastInterpreterFrame = frame;
</span><span class='bc' id='L1477' title='0|3|3 - Total: 3'>        frame.savedCallOp = op;
</span><span class='bc' id='L1478' title='0|3|3 - Total: 3'>        frame.savedStackTop = stackTop;
</span><span class='bc' id='L1479' title='0|14|14 - Total: 14'>        stack[stackTop] = fun.call(cx, calleeScope, funThisObj,
</span><span class='bc' id='L1480' title='0|1|1 - Total: 1'>                getArgsArray(stack, sDbl, stackTop + 2, indexReg));
</span>
<span class='bc' id='L1482' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.NEW : {
<span class='bpc' id='L1485' title='0|1|1 - Total: 2'>        if (instructionCounting) {
</span><span class='nc' id='L1486' title='0|0|0 - Total: 6'>            cx.instructionCount += INVOCATION_COST;
</span>        }
        // stack change: function arg0 .. argN -> newResult
        // indexReg: number of arguments
<span class='bc' id='L1490' title='0|4|4 - Total: 4'>        stackTop -= indexReg;
</span>
<span class='bc' id='L1492' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L1493' title='0|2|2 - Total: 2'>        if (lhs instanceof InterpretedFunction) {
</span><span class='bc' id='L1494' title='0|3|3 - Total: 3'>            InterpretedFunction f = (InterpretedFunction)lhs;
</span><span class='bpc' id='L1495' title='0|1|1 - Total: 2'>            if (frame.fnOrScript.securityDomain == f.securityDomain) {
</span><span class='bc' id='L1496' title='0|6|6 - Total: 6'>                Scriptable newInstance = f.createObject(cx, frame.scope);
</span><span class='bc' id='L1497' title='0|5|5 - Total: 5'>                CallFrame calleeFrame = new CallFrame();
</span><span class='bc' id='L1498' title='0|14|14 - Total: 14'>                initFrame(cx, frame.scope, newInstance, stack, sDbl,
</span>                          stackTop + 1, indexReg, f, frame,
                          calleeFrame);

<span class='bc' id='L1502' title='0|4|4 - Total: 4'>                stack[stackTop] = newInstance;
</span><span class='bc' id='L1503' title='0|3|3 - Total: 3'>                frame.savedStackTop = stackTop;
</span><span class='bc' id='L1504' title='0|3|3 - Total: 3'>                frame.savedCallOp = op;
</span><span class='bc' id='L1505' title='0|2|2 - Total: 2'>                frame = calleeFrame;
</span><span class='bc' id='L1506' title='0|1|1 - Total: 1'>                continue StateLoop;
</span>            }
        }
<span class='bc' id='L1509' title='0|2|2 - Total: 2'>        if (!(lhs instanceof Function)) {
</span><span class='bc' id='L1510' title='0|2|2 - Total: 2'>            if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1511' title='0|3|3 - Total: 3'>            throw ScriptRuntime.notFunctionError(lhs);
</span>        }
<span class='bc' id='L1513' title='0|3|3 - Total: 3'>        Function fun = (Function)lhs;
</span>
<span class='bc' id='L1515' title='0|2|2 - Total: 2'>        if (fun instanceof IdFunctionObject) {
</span><span class='bc' id='L1516' title='0|3|3 - Total: 3'>            IdFunctionObject ifun = (IdFunctionObject)fun;
</span><span class='bc' id='L1517' title='0|2|2 - Total: 2'>            if (NativeContinuation.isContinuationConstructor(ifun)) {
</span><span class='bc' id='L1518' title='0|7|7 - Total: 7'>                frame.stack[stackTop] =
</span><span class='bc' id='L1519' title='0|2|2 - Total: 2'>                    captureContinuation(cx, frame.parentFrame, false);
</span><span class='bc' id='L1520' title='0|1|1 - Total: 1'>                continue Loop;
</span>            }
        }

<span class='bc' id='L1524' title='0|8|8 - Total: 8'>        Object[] outArgs = getArgsArray(stack, sDbl, stackTop + 1, indexReg);
</span><span class='bc' id='L1525' title='0|9|9 - Total: 9'>        stack[stackTop] = fun.construct(cx, frame.scope, outArgs);
</span><span class='bc' id='L1526' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.TYPEOF : {
<span class='bc' id='L1529' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L1530' title='0|2|2 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1531' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.typeof(lhs);
</span><span class='bc' id='L1532' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_TYPEOFNAME :
<span class='bc' id='L1535' title='0|8|8 - Total: 8'>        stack[++stackTop] = ScriptRuntime.typeofName(frame.scope, stringReg);
</span><span class='bc' id='L1536' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.STRING :
<span class='bc' id='L1538' title='0|5|5 - Total: 5'>        stack[++stackTop] = stringReg;
</span><span class='bc' id='L1539' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_SHORTNUMBER :
<span class='bc' id='L1541' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1542' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1543' title='0|8|8 - Total: 8'>        sDbl[stackTop] = getShort(iCode, frame.pc);
</span><span class='bc' id='L1544' title='0|6|6 - Total: 6'>        frame.pc += 2;
</span><span class='bc' id='L1545' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_INTNUMBER :
<span class='bc' id='L1547' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1548' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1549' title='0|8|8 - Total: 8'>        sDbl[stackTop] = getInt(iCode, frame.pc);
</span><span class='bc' id='L1550' title='0|6|6 - Total: 6'>        frame.pc += 4;
</span><span class='bc' id='L1551' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.NUMBER :
<span class='bc' id='L1553' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1554' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1555' title='0|8|8 - Total: 8'>        sDbl[stackTop] = frame.idata.itsDoubleTable[indexReg];
</span><span class='bc' id='L1556' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.NAME :
<span class='bc' id='L1558' title='0|9|9 - Total: 9'>        stack[++stackTop] = ScriptRuntime.name(cx, frame.scope, stringReg);
</span><span class='bc' id='L1559' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_NAME_INC_DEC :
<span class='bc' id='L1561' title='0|13|13 - Total: 13'>        stack[++stackTop] = ScriptRuntime.nameIncrDecr(frame.scope, stringReg,
</span>                                                       cx, iCode[frame.pc]);
<span class='bc' id='L1563' title='0|6|6 - Total: 6'>        ++frame.pc;
</span><span class='bc' id='L1564' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_SETCONSTVAR1:
<span class='bc' id='L1566' title='0|10|10 - Total: 10'>        indexReg = iCode[frame.pc++];
</span>        // fallthrough
    case Token.SETCONSTVAR :
<span class='bc' id='L1569' title='0|10|10 - Total: 10'>        stackTop = doSetConstVar(frame, stack, sDbl, stackTop, vars, varDbls,
</span>                                 varAttributes, indexReg);
<span class='bc' id='L1571' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_SETVAR1:
<span class='bc' id='L1573' title='0|10|10 - Total: 10'>        indexReg = iCode[frame.pc++];
</span>        // fallthrough
    case Token.SETVAR :
<span class='bc' id='L1576' title='0|10|10 - Total: 10'>        stackTop = doSetVar(frame, stack, sDbl, stackTop, vars, varDbls,
</span>                            varAttributes, indexReg);
<span class='bc' id='L1578' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_GETVAR1:
<span class='bc' id='L1580' title='0|10|10 - Total: 10'>        indexReg = iCode[frame.pc++];
</span>        // fallthrough
    case Token.GETVAR :
<span class='bc' id='L1583' title='0|9|9 - Total: 9'>        stackTop = doGetVar(frame, stack, sDbl, stackTop, vars, varDbls, indexReg);
</span><span class='bc' id='L1584' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_VAR_INC_DEC : {
<span class='bc' id='L1586' title='0|11|11 - Total: 11'>        stackTop = doVarIncDec(cx, frame, stack, sDbl, stackTop,
</span>                               vars, varDbls, varAttributes, indexReg);
<span class='bc' id='L1588' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_ZERO :
<span class='bc' id='L1591' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1592' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1593' title='0|4|4 - Total: 4'>        sDbl[stackTop] = 0;
</span><span class='bc' id='L1594' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_ONE :
<span class='bc' id='L1596' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1597' title='0|4|4 - Total: 4'>        stack[stackTop] = DBL_MRK;
</span><span class='bc' id='L1598' title='0|4|4 - Total: 4'>        sDbl[stackTop] = 1;
</span><span class='bc' id='L1599' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.NULL :
<span class='bc' id='L1601' title='0|5|5 - Total: 5'>        stack[++stackTop] = null;
</span><span class='bc' id='L1602' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.THIS :
<span class='bc' id='L1604' title='0|6|6 - Total: 6'>        stack[++stackTop] = frame.thisObj;
</span><span class='bc' id='L1605' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.THISFN :
<span class='bc' id='L1607' title='0|6|6 - Total: 6'>        stack[++stackTop] = frame.fnOrScript;
</span><span class='bc' id='L1608' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.FALSE :
<span class='bc' id='L1610' title='0|5|5 - Total: 5'>        stack[++stackTop] = Boolean.FALSE;
</span><span class='bc' id='L1611' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.TRUE :
<span class='bc' id='L1613' title='0|5|5 - Total: 5'>        stack[++stackTop] = Boolean.TRUE;
</span><span class='bc' id='L1614' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_UNDEF :
<span class='bc' id='L1616' title='0|5|5 - Total: 5'>        stack[++stackTop] = undefined;
</span><span class='bc' id='L1617' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.ENTERWITH : {
<span class='bc' id='L1619' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L1620' title='0|2|2 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1621' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1622' title='0|7|7 - Total: 7'>        frame.scope = ScriptRuntime.enterWith(lhs, cx, frame.scope);
</span><span class='bc' id='L1623' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.LEAVEWITH :
<span class='bc' id='L1626' title='0|5|5 - Total: 5'>        frame.scope = ScriptRuntime.leaveWith(frame.scope);
</span><span class='bc' id='L1627' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.CATCH_SCOPE : {
        // stack top: exception object
        // stringReg: name of exception variable
        // indexReg: local for exception scope
<span class='bc' id='L1632' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1633' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span>
<span class='bc' id='L1635' title='0|2|2 - Total: 2'>        boolean afterFirstScope =  (frame.idata.itsICode[frame.pc] != 0);
</span><span class='bc' id='L1636' title='0|7|7 - Total: 7'>        Throwable caughtException = (Throwable)stack[stackTop + 1];
</span>        Scriptable lastCatchScope;
<span class='bc' id='L1638' title='0|2|2 - Total: 2'>        if (!afterFirstScope) {
</span><span class='bc' id='L1639' title='0|3|3 - Total: 3'>            lastCatchScope = null;
</span>        } else {
<span class='bc' id='L1641' title='0|5|5 - Total: 5'>            lastCatchScope = (Scriptable)stack[indexReg];
</span>        }
<span class='bc' id='L1643' title='0|10|10 - Total: 10'>        stack[indexReg] = ScriptRuntime.newCatchScope(caughtException,
</span>                                                      lastCatchScope, stringReg,
                                                      cx, frame.scope);
<span class='bc' id='L1646' title='0|6|6 - Total: 6'>        ++frame.pc;
</span><span class='bc' id='L1647' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.ENUM_INIT_KEYS :
    case Token.ENUM_INIT_VALUES :
    case Token.ENUM_INIT_ARRAY :
    case Token.ENUM_INIT_VALUES_IN_ORDER : {
<span class='bc' id='L1653' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L1654' title='0|2|2 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1655' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1656' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span><span class='bc' id='L1657' title='0|6|6 - Total: 6'>        int enumType = op == Token.ENUM_INIT_KEYS
</span>                         ? ScriptRuntime.ENUMERATE_KEYS :
                       op == Token.ENUM_INIT_VALUES
                         ? ScriptRuntime.ENUMERATE_VALUES :
                       op == Token.ENUM_INIT_VALUES_IN_ORDER
                         ? ScriptRuntime.ENUMERATE_VALUES_IN_ORDER :
                       ScriptRuntime.ENUMERATE_ARRAY;
<span class='bc' id='L1664' title='0|9|9 - Total: 9'>        stack[indexReg] = ScriptRuntime.enumInit(lhs, cx, frame.scope, enumType);
</span><span class='bc' id='L1665' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.ENUM_NEXT :
    case Token.ENUM_ID : {
<span class='bc' id='L1669' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span><span class='bc' id='L1670' title='0|4|4 - Total: 4'>        Object val = stack[indexReg];
</span><span class='bc' id='L1671' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1672' title='0|2|2 - Total: 2'>        stack[stackTop] = (op == Token.ENUM_NEXT)
</span><span class='bc' id='L1673' title='0|4|4 - Total: 4'>                          ? (Object)ScriptRuntime.enumNext(val)
</span><span class='bc' id='L1674' title='0|2|2 - Total: 2'>                          : (Object)ScriptRuntime.enumId(val, cx);
</span><span class='bc' id='L1675' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.REF_SPECIAL : {
        //stringReg: name of special property
<span class='bc' id='L1679' title='0|4|4 - Total: 4'>        Object obj = stack[stackTop];
</span><span class='bpc' id='L1680' title='0|1|1 - Total: 2'>        if (obj == DBL_MRK) obj = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1681' title='0|9|9 - Total: 9'>        stack[stackTop] = ScriptRuntime.specialRef(obj, stringReg,
</span>                                                   cx, frame.scope);
<span class='bc' id='L1683' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.REF_MEMBER: {
        //indexReg: flags
<span class='bc' id='L1687' title='0|7|7 - Total: 7'>        stackTop = doRefMember(cx, stack, sDbl, stackTop, indexReg);
</span><span class='bc' id='L1688' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.REF_NS_MEMBER: {
        //indexReg: flags
<span class='bc' id='L1692' title='0|7|7 - Total: 7'>        stackTop = doRefNsMember(cx, stack, sDbl, stackTop, indexReg);
</span><span class='bc' id='L1693' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.REF_NAME: {
        //indexReg: flags
<span class='bc' id='L1697' title='0|4|4 - Total: 4'>        Object name = stack[stackTop];
</span><span class='bpc' id='L1698' title='0|1|1 - Total: 2'>        if (name == DBL_MRK) name = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1699' title='0|9|9 - Total: 9'>        stack[stackTop] = ScriptRuntime.nameRef(name, cx, frame.scope,
</span>                                                indexReg);
<span class='bc' id='L1701' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.REF_NS_NAME: {
        //indexReg: flags
<span class='bc' id='L1705' title='0|8|8 - Total: 8'>        stackTop = doRefNsName(cx, frame, stack, sDbl, stackTop, indexReg);
</span><span class='bc' id='L1706' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_SCOPE_LOAD :
<span class='nc' id='L1709' title='0|0|0 - Total: 5'>        indexReg += frame.localShift;
</span><span class='nc' id='L1710' title='0|0|0 - Total: 6'>        frame.scope = (Scriptable)stack[indexReg];
</span><span class='nc' id='L1711' title='0|0|0 - Total: 1'>        continue Loop;
</span>    case Icode_SCOPE_SAVE :
<span class='bc' id='L1713' title='0|5|5 - Total: 5'>        indexReg += frame.localShift;
</span><span class='bc' id='L1714' title='0|5|5 - Total: 5'>        stack[indexReg] = frame.scope;
</span><span class='bc' id='L1715' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_CLOSURE_EXPR :
<span class='bc' id='L1717' title='0|8|8 - Total: 8'>        InterpretedFunction fn = InterpretedFunction.createFunction(cx, frame.scope,
</span>                                                                    frame.fnOrScript,
                                                                    indexReg);
<span class='bc' id='L1720' title='0|2|2 - Total: 2'>        if (fn.idata.itsFunctionType == FunctionNode.ARROW_FUNCTION) {
</span><span class='bc' id='L1721' title='0|14|14 - Total: 14'>            stack[++stackTop] = new ArrowFunction(cx, frame.scope, fn, frame.thisObj);
</span>        } else {
<span class='bc' id='L1723' title='0|5|5 - Total: 5'>            stack[++stackTop] = fn;
</span>        }
<span class='bc' id='L1725' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_CLOSURE_STMT :
<span class='bc' id='L1727' title='0|7|7 - Total: 7'>        initFunction(cx, frame.scope, frame.fnOrScript, indexReg);
</span><span class='bc' id='L1728' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Token.REGEXP :
<span class='bc' id='L1730' title='0|6|6 - Total: 6'>        Object re = frame.idata.itsRegExpLiterals[indexReg];
</span><span class='bc' id='L1731' title='0|9|9 - Total: 9'>        stack[++stackTop] = ScriptRuntime.wrapRegExp(cx, frame.scope, re);
</span><span class='bc' id='L1732' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_LITERAL_NEW :
        // indexReg: number of values in the literal
<span class='bc' id='L1735' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1736' title='0|5|5 - Total: 5'>        stack[stackTop] = new int[indexReg];
</span><span class='bc' id='L1737' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L1738' title='0|5|5 - Total: 5'>        stack[stackTop] = new Object[indexReg];
</span><span class='bc' id='L1739' title='0|4|4 - Total: 4'>        sDbl[stackTop] = 0;
</span><span class='bc' id='L1740' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_LITERAL_SET : {
<span class='bc' id='L1742' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bc' id='L1743' title='0|2|2 - Total: 2'>        if (value == DBL_MRK) value = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1744' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1745' title='0|5|5 - Total: 5'>        int i = (int)sDbl[stackTop];
</span><span class='bc' id='L1746' title='0|8|8 - Total: 8'>        ((Object[])stack[stackTop])[i] = value;
</span><span class='bc' id='L1747' title='0|7|7 - Total: 7'>        sDbl[stackTop] = i + 1;
</span><span class='bc' id='L1748' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_LITERAL_GETTER : {
<span class='bc' id='L1751' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bc' id='L1752' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1753' title='0|5|5 - Total: 5'>        int i = (int)sDbl[stackTop];
</span><span class='bc' id='L1754' title='0|8|8 - Total: 8'>        ((Object[])stack[stackTop])[i] = value;
</span><span class='bc' id='L1755' title='0|10|10 - Total: 10'>        ((int[])stack[stackTop - 1])[i] = -1;
</span><span class='bc' id='L1756' title='0|7|7 - Total: 7'>        sDbl[stackTop] = i + 1;
</span><span class='bc' id='L1757' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_LITERAL_SETTER : {
<span class='bc' id='L1760' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bc' id='L1761' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1762' title='0|5|5 - Total: 5'>        int i = (int)sDbl[stackTop];
</span><span class='bc' id='L1763' title='0|8|8 - Total: 8'>        ((Object[])stack[stackTop])[i] = value;
</span><span class='bc' id='L1764' title='0|10|10 - Total: 10'>        ((int[])stack[stackTop - 1])[i] = +1;
</span><span class='bc' id='L1765' title='0|7|7 - Total: 7'>        sDbl[stackTop] = i + 1;
</span><span class='bc' id='L1766' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.ARRAYLIT :
    case Icode_SPARE_ARRAYLIT :
    case Token.OBJECTLIT : {
<span class='bc' id='L1771' title='0|6|6 - Total: 6'>        Object[] data = (Object[])stack[stackTop];
</span><span class='bc' id='L1772' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1773' title='0|6|6 - Total: 6'>        int[] getterSetters = (int[])stack[stackTop];
</span>        Object val;
<span class='bc' id='L1775' title='0|2|2 - Total: 2'>        if (op == Token.OBJECTLIT) {
</span><span class='bc' id='L1776' title='0|8|8 - Total: 8'>            Object[] ids = (Object[])frame.idata.literalIds[indexReg];
</span><span class='bc' id='L1777' title='0|8|8 - Total: 8'>            val = ScriptRuntime.newObjectLiteral(ids, data, getterSetters, cx,
</span>                    frame.scope);
<span class='bc' id='L1779' title='0|1|1 - Total: 1'>        } else {
</span><span class='bc' id='L1780' title='0|2|2 - Total: 2'>            int[] skipIndexces = null;
</span><span class='bc' id='L1781' title='0|2|2 - Total: 2'>            if (op == Icode_SPARE_ARRAYLIT) {
</span><span class='bc' id='L1782' title='0|8|8 - Total: 8'>                skipIndexces = (int[])frame.idata.literalIds[indexReg];
</span>            }
<span class='bc' id='L1784' title='0|7|7 - Total: 7'>            val = ScriptRuntime.newArrayLiteral(data, skipIndexces, cx,
</span>                                                frame.scope);
        }
<span class='bc' id='L1787' title='0|4|4 - Total: 4'>        stack[stackTop] = val;
</span><span class='bc' id='L1788' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_ENTERDQ : {
<span class='bc' id='L1791' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L1792' title='0|2|2 - Total: 2'>        if (lhs == DBL_MRK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1793' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1794' title='0|6|6 - Total: 6'>        frame.scope = ScriptRuntime.enterDotQuery(lhs, frame.scope);
</span><span class='bc' id='L1795' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Icode_LEAVEDQ : {
<span class='bc' id='L1798' title='0|4|4 - Total: 4'>        boolean valBln = stack_boolean(frame, stackTop);
</span><span class='bc' id='L1799' title='0|5|5 - Total: 5'>        Object x = ScriptRuntime.updateDotQuery(valBln, frame.scope);
</span><span class='bc' id='L1800' title='0|2|2 - Total: 2'>        if (x != null) {
</span><span class='bc' id='L1801' title='0|4|4 - Total: 4'>            stack[stackTop] = x;
</span><span class='bc' id='L1802' title='0|5|5 - Total: 5'>            frame.scope = ScriptRuntime.leaveDotQuery(frame.scope);
</span><span class='bc' id='L1803' title='0|6|6 - Total: 6'>            frame.pc += 2;
</span><span class='bc' id='L1804' title='0|1|1 - Total: 1'>            continue Loop;
</span>        }
        // reset stack and PC to code after ENTERDQ
<span class='bc' id='L1807' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L1808' title='0|1|1 - Total: 1'>        break jumplessRun;
</span>    }
    case Token.DEFAULTNAMESPACE : {
<span class='bc' id='L1811' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bpc' id='L1812' title='0|1|1 - Total: 2'>        if (value == DBL_MRK) value = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L1813' title='0|6|6 - Total: 6'>        stack[stackTop] = ScriptRuntime.setDefaultNamespace(value, cx);
</span><span class='bc' id='L1814' title='0|1|1 - Total: 1'>        continue Loop;
</span>    }
    case Token.ESCXMLATTR : {
<span class='bc' id='L1817' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bpc' id='L1818' title='0|1|1 - Total: 2'>        if (value != DBL_MRK) {
</span><span class='bc' id='L1819' title='0|7|7 - Total: 7'>            stack[stackTop] = ScriptRuntime.escapeAttributeValue(value, cx);
</span>        }
        continue Loop;
    }
    case Token.ESCXMLTEXT : {
<span class='bc' id='L1824' title='0|4|4 - Total: 4'>        Object value = stack[stackTop];
</span><span class='bpc' id='L1825' title='0|1|1 - Total: 2'>        if (value != DBL_MRK) {
</span><span class='bc' id='L1826' title='0|7|7 - Total: 7'>            stack[stackTop] = ScriptRuntime.escapeTextValue(value, cx);
</span>        }
        continue Loop;
    }
    case Icode_DEBUGGER:
<span class='nc' id='L1831' title='0|0|0 - Total: 2'>        if (frame.debuggerFrame != null) {
</span><span class='nc' id='L1832' title='0|0|0 - Total: 5'>            frame.debuggerFrame.onDebuggerStatement(cx);
</span>        }
        continue Loop;
    case Icode_LINE :
<span class='bc' id='L1836' title='0|4|4 - Total: 4'>        frame.pcSourceLineStart = frame.pc;
</span><span class='bpc' id='L1837' title='0|1|1 - Total: 2'>        if (frame.debuggerFrame != null) {
</span><span class='nc' id='L1838' title='0|0|0 - Total: 5'>            int line = getIndex(iCode, frame.pc);
</span><span class='nc' id='L1839' title='0|0|0 - Total: 5'>            frame.debuggerFrame.onLineChange(cx, line);
</span>        }
<span class='bc' id='L1841' title='0|6|6 - Total: 6'>        frame.pc += 2;
</span><span class='bc' id='L1842' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND_C0:
<span class='bc' id='L1844' title='0|2|2 - Total: 2'>        indexReg = 0;
</span><span class='bc' id='L1845' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND_C1:
<span class='bc' id='L1847' title='0|2|2 - Total: 2'>        indexReg = 1;
</span><span class='bc' id='L1848' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND_C2:
<span class='bc' id='L1850' title='0|2|2 - Total: 2'>        indexReg = 2;
</span><span class='bc' id='L1851' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND_C3:
<span class='bc' id='L1853' title='0|2|2 - Total: 2'>        indexReg = 3;
</span><span class='bc' id='L1854' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND_C4:
<span class='bc' id='L1856' title='0|2|2 - Total: 2'>        indexReg = 4;
</span><span class='bc' id='L1857' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND_C5:
<span class='bc' id='L1859' title='0|2|2 - Total: 2'>        indexReg = 5;
</span><span class='bc' id='L1860' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND1:
<span class='bc' id='L1862' title='0|7|7 - Total: 7'>        indexReg = 0xFF & iCode[frame.pc];
</span><span class='bc' id='L1863' title='0|6|6 - Total: 6'>        ++frame.pc;
</span><span class='bc' id='L1864' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND2:
<span class='bc' id='L1866' title='0|5|5 - Total: 5'>        indexReg = getIndex(iCode, frame.pc);
</span><span class='bc' id='L1867' title='0|6|6 - Total: 6'>        frame.pc += 2;
</span><span class='bc' id='L1868' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_IND4:
<span class='bc' id='L1870' title='0|5|5 - Total: 5'>        indexReg = getInt(iCode, frame.pc);
</span><span class='bc' id='L1871' title='0|6|6 - Total: 6'>        frame.pc += 4;
</span><span class='bc' id='L1872' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_STR_C0:
<span class='bc' id='L1874' title='0|4|4 - Total: 4'>        stringReg = strings[0];
</span><span class='bc' id='L1875' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_STR_C1:
<span class='bc' id='L1877' title='0|4|4 - Total: 4'>        stringReg = strings[1];
</span><span class='bc' id='L1878' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_STR_C2:
<span class='bc' id='L1880' title='0|4|4 - Total: 4'>        stringReg = strings[2];
</span><span class='bc' id='L1881' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_STR_C3:
<span class='bc' id='L1883' title='0|4|4 - Total: 4'>        stringReg = strings[3];
</span><span class='bc' id='L1884' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_STR1:
<span class='bc' id='L1886' title='0|9|9 - Total: 9'>        stringReg = strings[0xFF & iCode[frame.pc]];
</span><span class='bc' id='L1887' title='0|6|6 - Total: 6'>        ++frame.pc;
</span><span class='bc' id='L1888' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_STR2:
<span class='bc' id='L1890' title='0|7|7 - Total: 7'>        stringReg = strings[getIndex(iCode, frame.pc)];
</span><span class='bc' id='L1891' title='0|6|6 - Total: 6'>        frame.pc += 2;
</span><span class='bc' id='L1892' title='0|1|1 - Total: 1'>        continue Loop;
</span>    case Icode_REG_STR4:
<span class='bc' id='L1894' title='0|7|7 - Total: 7'>        stringReg = strings[getInt(iCode, frame.pc)];
</span><span class='bc' id='L1895' title='0|6|6 - Total: 6'>        frame.pc += 4;
</span><span class='bc' id='L1896' title='0|1|1 - Total: 1'>        continue Loop;
</span>    default :
<span class='nc' id='L1898' title='0|0|0 - Total: 3'>        dumpICode(frame.idata);
</span><span class='nc' id='L1899' title='0|0|0 - Total: 19'>        throw new RuntimeException("Unknown icode : " + op
</span>                                 + " @ pc : " + (frame.pc-1));
}  // end of interpreter switch

                    } // end of jumplessRun label block

                    // This should be reachable only for jump implementation
                    // when pc points to encoded target offset
<span class='bc' id='L1907' title='0|2|2 - Total: 2'>                    if (instructionCounting) {
</span><span class='bc' id='L1908' title='0|4|4 - Total: 4'>                        addInstructionCount(cx, frame, 2);
</span>                    }
<span class='bc' id='L1910' title='0|5|5 - Total: 5'>                    int offset = getShort(iCode, frame.pc);
</span><span class='bc' id='L1911' title='0|2|2 - Total: 2'>                    if (offset != 0) {
</span>                        // -1 accounts for pc pointing to jump opcode + 1
<span class='bc' id='L1913' title='0|9|9 - Total: 9'>                        frame.pc += offset - 1;
</span>                    } else {
<span class='bc' id='L1915' title='0|6|6 - Total: 6'>                        frame.pc = frame.idata.longJumps.
</span><span class='bc' id='L1916' title='0|2|2 - Total: 2'>                                       getExistingInt(frame.pc);
</span>                    }
<span class='bc' id='L1918' title='0|2|2 - Total: 2'>                    if (instructionCounting) {
</span><span class='bc' id='L1919' title='0|5|5 - Total: 5'>                        frame.pcPrevBranch = frame.pc;
</span>                    }
                    continue Loop;

                } // end of Loop: for

<span class='bc' id='L1925' title='0|4|4 - Total: 4'>                exitFrame(cx, frame, null);
</span><span class='bc' id='L1926' title='0|3|3 - Total: 3'>                interpreterResult = frame.result;
</span><span class='bc' id='L1927' title='0|3|3 - Total: 3'>                interpreterResultDbl = frame.resultDbl;
</span><span class='bc' id='L1928' title='0|2|2 - Total: 2'>                if (frame.parentFrame != null) {
</span><span class='bc' id='L1929' title='0|3|3 - Total: 3'>                    frame = frame.parentFrame;
</span><span class='bc' id='L1930' title='0|2|2 - Total: 2'>                    if (frame.frozen) {
</span><span class='bc' id='L1931' title='0|3|3 - Total: 3'>                        frame = frame.cloneFrozen();
</span>                    }
<span class='bc' id='L1933' title='0|4|4 - Total: 4'>                    setCallResult(
</span>                        frame, interpreterResult, interpreterResultDbl);
<span class='bc' id='L1935' title='0|2|2 - Total: 2'>                    interpreterResult = null; // Help GC
</span><span class='bc' id='L1936' title='0|1|1 - Total: 1'>                    continue StateLoop;
</span>                }
<span class='bc' id='L1938' title='0|1|1 - Total: 1'>                break StateLoop;
</span>
            }  // end of interpreter withoutExceptions: try
<span class='bc' id='L1941' title='0|1|1 - Total: 1'>            catch (Throwable ex) {
</span><span class='bpc' id='L1942' title='0|1|1 - Total: 2'>                if (throwable != null) {
</span>                    // This is serious bug and it is better to track it ASAP
<span class='nc' id='L1944' title='0|0|0 - Total: 3'>                    ex.printStackTrace(System.err);
</span><span class='nc' id='L1945' title='0|0|0 - Total: 4'>                    throw new IllegalStateException();
</span>                }
<span class='bc' id='L1947' title='0|2|2 - Total: 2'>                throwable = ex;
</span>            }

            // This should be reachable only after above catch or from
            // finally when it needs to propagate exception or from
            // explicit throw
<span class='bpc' id='L1953' title='0|1|1 - Total: 2'>            if (throwable == null) Kit.codeBug();
</span>
            // Exception type
<span class='bc' id='L1956' title='0|2|2 - Total: 2'>            final int EX_CATCH_STATE = 2; // Can execute JS catch
</span><span class='bc' id='L1957' title='0|2|2 - Total: 2'>            final int EX_FINALLY_STATE = 1; // Can execute JS finally
</span><span class='bc' id='L1958' title='0|2|2 - Total: 2'>            final int EX_NO_JS_STATE = 0; // Terminate JS execution
</span>
            int exState;
<span class='bc' id='L1961' title='0|2|2 - Total: 2'>            ContinuationJump cjump = null;
</span>
<span class='bpc' id='L1963' title='0|5|5 - Total: 6'>            if (generatorState != null &&
</span>                generatorState.operation == NativeGenerator.GENERATOR_CLOSE &&
                throwable == generatorState.value)
            {
<span class='bc' id='L1967' title='0|3|3 - Total: 3'>                exState = EX_FINALLY_STATE;
</span><span class='bc' id='L1968' title='0|2|2 - Total: 2'>            } else if (throwable instanceof JavaScriptException) {
</span><span class='bc' id='L1969' title='0|3|3 - Total: 3'>                exState = EX_CATCH_STATE;
</span><span class='bc' id='L1970' title='0|2|2 - Total: 2'>            } else if (throwable instanceof EcmaError) {
</span>                // an offical ECMA error object,
<span class='bc' id='L1972' title='0|3|3 - Total: 3'>                exState = EX_CATCH_STATE;
</span><span class='bc' id='L1973' title='0|2|2 - Total: 2'>            } else if (throwable instanceof EvaluatorException) {
</span><span class='bc' id='L1974' title='0|3|3 - Total: 3'>                exState = EX_CATCH_STATE;
</span><span class='bc' id='L1975' title='0|2|2 - Total: 2'>            } else if (throwable instanceof ContinuationPending) {
</span><span class='bc' id='L1976' title='0|3|3 - Total: 3'>                exState = EX_NO_JS_STATE;
</span><span class='bc' id='L1977' title='0|2|2 - Total: 2'>            } else if (throwable instanceof RuntimeException) {
</span><span class='bpc' id='L1978' title='0|1|1 - Total: 2'>                exState = cx.hasFeature(Context.FEATURE_ENHANCED_JAVA_ACCESS)
</span>                          ? EX_CATCH_STATE
                          : EX_FINALLY_STATE;
<span class='bpc' id='L1981' title='0|1|1 - Total: 2'>            } else if (throwable instanceof Error) {
</span><span class='nc' id='L1982' title='0|0|0 - Total: 2'>                exState = cx.hasFeature(Context.FEATURE_ENHANCED_JAVA_ACCESS)
</span>                          ? EX_CATCH_STATE
                          : EX_NO_JS_STATE;
<span class='bpc' id='L1985' title='0|1|1 - Total: 2'>            } else if (throwable instanceof ContinuationJump) {
</span>                // It must be ContinuationJump
<span class='bc' id='L1987' title='0|2|2 - Total: 2'>                exState = EX_FINALLY_STATE;
</span><span class='bc' id='L1988' title='0|4|4 - Total: 4'>                cjump = (ContinuationJump)throwable;
</span>            } else {
<span class='nc' id='L1990' title='0|0|0 - Total: 2'>                exState = cx.hasFeature(Context.FEATURE_ENHANCED_JAVA_ACCESS)
</span>                          ? EX_CATCH_STATE
                          : EX_FINALLY_STATE;
            }

<span class='bc' id='L1995' title='0|2|2 - Total: 2'>            if (instructionCounting) {
</span>                try {
<span class='nc' id='L1997' title='0|0|0 - Total: 4'>                    addInstructionCount(cx, frame, EXCEPTION_COST);
</span><span class='bc' id='L1998' title='0|1|1 - Total: 1'>                } catch (RuntimeException ex) {
</span><span class='bc' id='L1999' title='0|2|2 - Total: 2'>                    throwable = ex;
</span><span class='bc' id='L2000' title='0|2|2 - Total: 2'>                    exState = EX_FINALLY_STATE;
</span><span class='nc' id='L2001' title='0|0|0 - Total: 1'>                } catch (Error ex) {
</span>                    // Error from instruction counting
                    //     => unconditionally terminate JS
<span class='nc' id='L2004' title='0|0|0 - Total: 2'>                    throwable = ex;
</span><span class='nc' id='L2005' title='0|0|0 - Total: 2'>                    cjump = null;
</span><span class='nc' id='L2006' title='0|0|0 - Total: 2'>                    exState = EX_NO_JS_STATE;
</span><span class='bpc' id='L2007' title='0|1|1 - Total: 2'>                }
</span>            }
<span class='bpc' id='L2009' title='0|1|1 - Total: 4'>            if (frame.debuggerFrame != null
</span>                && throwable instanceof RuntimeException)
            {
                // Call debugger only for RuntimeException
<span class='nc' id='L2013' title='0|0|0 - Total: 3'>                RuntimeException rex = (RuntimeException)throwable;
</span>                try {
<span class='nc' id='L2015' title='0|0|0 - Total: 5'>                    frame.debuggerFrame.onExceptionThrown(cx, rex);
</span><span class='nc' id='L2016' title='0|0|0 - Total: 1'>                } catch (Throwable ex) {
</span>                    // Any exception from debugger
                    //     => unconditionally terminate JS
<span class='nc' id='L2019' title='0|0|0 - Total: 2'>                    throwable = ex;
</span><span class='nc' id='L2020' title='0|0|0 - Total: 2'>                    cjump = null;
</span><span class='nc' id='L2021' title='0|0|0 - Total: 2'>                    exState = EX_NO_JS_STATE;
</span><span class='nc' id='L2022' title='0|0|0 - Total: 1'>                }
</span>            }

            for (;;) {
<span class='bc' id='L2026' title='0|2|2 - Total: 2'>                if (exState != EX_NO_JS_STATE) {
</span><span class='bc' id='L2027' title='0|2|2 - Total: 2'>                    boolean onlyFinally = (exState != EX_CATCH_STATE);
</span><span class='bc' id='L2028' title='0|4|4 - Total: 4'>                    indexReg = getExceptionHandler(frame, onlyFinally);
</span><span class='bc' id='L2029' title='0|2|2 - Total: 2'>                    if (indexReg >= 0) {
</span>                        // We caught an exception, restart the loop
                        // with exception pending the processing at the loop
                        // start
<span class='bc' id='L2033' title='0|1|1 - Total: 1'>                        continue StateLoop;
</span>                    }
                }
                // No allowed exception handlers in this frame, unwind
                // to parent and try to look there

<span class='bc' id='L2039' title='0|4|4 - Total: 4'>                exitFrame(cx, frame, throwable);
</span>
<span class='bc' id='L2041' title='0|3|3 - Total: 3'>                frame = frame.parentFrame;
</span><span class='bc' id='L2042' title='0|2|2 - Total: 2'>                if (frame == null) { break; }
</span><span class='bpc' id='L2043' title='0|3|3 - Total: 4'>                if (cjump != null && cjump.branchFrame == frame) {
</span>                    // Continuation branch point was hit,
                    // restart the state loop to reenter continuation
<span class='nc' id='L2046' title='0|0|0 - Total: 2'>                    indexReg = -1;
</span><span class='nc' id='L2047' title='0|0|0 - Total: 1'>                    continue StateLoop;
</span>                }
            }

            // No more frames, rethrow the exception or deal with continuation
<span class='bc' id='L2052' title='0|2|2 - Total: 2'>            if (cjump != null) {
</span><span class='bpc' id='L2053' title='0|1|1 - Total: 2'>                if (cjump.branchFrame != null) {
</span>                    // The above loop should locate the top frame
<span class='nc' id='L2055' title='0|0|0 - Total: 2'>                    Kit.codeBug();
</span>                }
<span class='bpc' id='L2057' title='0|1|1 - Total: 2'>                if (cjump.capturedFrame != null) {
</span>                    // Restarting detached continuation
<span class='nc' id='L2059' title='0|0|0 - Total: 2'>                    indexReg = -1;
</span><span class='nc' id='L2060' title='0|0|0 - Total: 1'>                    continue StateLoop;
</span>                }
                // Return continuation result to the caller
<span class='bc' id='L2063' title='0|3|3 - Total: 3'>                interpreterResult = cjump.result;
</span><span class='bc' id='L2064' title='0|3|3 - Total: 3'>                interpreterResultDbl = cjump.resultDbl;
</span><span class='bc' id='L2065' title='0|3|3 - Total: 3'>                throwable = null;
</span>            }
            break StateLoop;

        } // end of StateLoop: for(;;)

        // Do cleanups/restorations before the final return or throw

<span class='bc' id='L2073' title='0|2|2 - Total: 2'>        if (cx.previousInterpreterInvocations != null
</span><span class='bc' id='L2074' title='0|2|2 - Total: 2'>            && cx.previousInterpreterInvocations.size() != 0)
</span>        {
<span class='bc' id='L2076' title='0|3|3 - Total: 3'>            cx.lastInterpreterFrame
</span><span class='bc' id='L2077' title='0|3|3 - Total: 3'>                = cx.previousInterpreterInvocations.pop();
</span>        } else {
            // It was the last interpreter frame on the stack
<span class='bc' id='L2080' title='0|3|3 - Total: 3'>            cx.lastInterpreterFrame = null;
</span>            // Force GC of the value cx.previousInterpreterInvocations
<span class='bc' id='L2082' title='0|3|3 - Total: 3'>            cx.previousInterpreterInvocations = null;
</span>        }

<span class='bc' id='L2085' title='0|2|2 - Total: 2'>        if (throwable != null) {
</span><span class='bpc' id='L2086' title='0|1|1 - Total: 2'>            if (throwable instanceof RuntimeException) {
</span><span class='bc' id='L2087' title='0|3|3 - Total: 3'>                throw (RuntimeException)throwable;
</span>            } else {
                // Must be instance of Error or code bug
<span class='nc' id='L2090' title='0|0|0 - Total: 3'>                throw (Error)throwable;
</span>            }
        }

<span class='bc' id='L2094' title='0|2|2 - Total: 2'>        return (interpreterResult != DBL_MRK)
</span>               ? interpreterResult
<span class='bc' id='L2096' title='0|1|1 - Total: 1'>               : ScriptRuntime.wrapNumber(interpreterResultDbl);
</span>    }

    private static int doInOrInstanceof(Context cx, int op, Object[] stack,
                                        double[] sDbl, int stackTop) {
<span class='bc' id='L2101' title='0|4|4 - Total: 4'>        Object rhs = stack[stackTop];
</span><span class='bpc' id='L2102' title='0|1|1 - Total: 2'>        if (rhs == DOUBLE_MARK) rhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2103' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2104' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L2105' title='0|2|2 - Total: 2'>        if (lhs == DOUBLE_MARK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span>        boolean valBln;
<span class='bc' id='L2107' title='0|2|2 - Total: 2'>        if (op == Token.IN) {
</span><span class='bc' id='L2108' title='0|6|6 - Total: 6'>            valBln = ScriptRuntime.in(lhs, rhs, cx);
</span>        } else {
<span class='bc' id='L2110' title='0|5|5 - Total: 5'>            valBln = ScriptRuntime.instanceOf(lhs, rhs, cx);
</span>        }
<span class='bc' id='L2112' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.wrapBoolean(valBln);
</span><span class='bc' id='L2113' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doCompare(CallFrame frame, int op, Object[] stack,
                                 double[] sDbl, int stackTop) {
<span class='bc' id='L2118' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2119' title='0|6|6 - Total: 6'>        Object rhs = stack[stackTop + 1];
</span><span class='bc' id='L2120' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span>        boolean valBln;
        object_compare:
        {
            number_compare:
            {
                double rDbl, lDbl;
<span class='bc' id='L2127' title='0|2|2 - Total: 2'>                if (rhs == DOUBLE_MARK) {
</span><span class='bc' id='L2128' title='0|6|6 - Total: 6'>                    rDbl = sDbl[stackTop + 1];
</span><span class='bc' id='L2129' title='0|5|5 - Total: 5'>                    lDbl = stack_double(frame, stackTop);
</span><span class='bc' id='L2130' title='0|2|2 - Total: 2'>                } else if (lhs == DOUBLE_MARK) {
</span><span class='bc' id='L2131' title='0|3|3 - Total: 3'>                    rDbl = ScriptRuntime.toNumber(rhs);
</span><span class='bc' id='L2132' title='0|4|4 - Total: 4'>                    lDbl = sDbl[stackTop];
</span>                } else {
                    break number_compare;
                }
<span class='bpc' id='L2136' title='0|4|4 - Total: 5'>                switch (op) {
</span>                    case Token.GE:
<span class='bc' id='L2138' title='0|2|2 - Total: 2'>                        valBln = (lDbl >= rDbl);
</span><span class='bc' id='L2139' title='0|1|1 - Total: 1'>                        break object_compare;
</span>                    case Token.LE:
<span class='bc' id='L2141' title='0|2|2 - Total: 2'>                        valBln = (lDbl <= rDbl);
</span><span class='bc' id='L2142' title='0|1|1 - Total: 1'>                        break object_compare;
</span>                    case Token.GT:
<span class='bc' id='L2144' title='0|2|2 - Total: 2'>                        valBln = (lDbl > rDbl);
</span><span class='bc' id='L2145' title='0|1|1 - Total: 1'>                        break object_compare;
</span>                    case Token.LT:
<span class='bc' id='L2147' title='0|2|2 - Total: 2'>                        valBln = (lDbl < rDbl);
</span><span class='bc' id='L2148' title='0|1|1 - Total: 1'>                        break object_compare;
</span>                    default:
<span class='nc' id='L2150' title='0|0|0 - Total: 2'>                        throw Kit.codeBug();
</span>                }
            }
<span class='bpc' id='L2153' title='0|4|4 - Total: 5'>            switch (op) {
</span>                case Token.GE:
<span class='bc' id='L2155' title='0|4|4 - Total: 4'>                    valBln = ScriptRuntime.cmp_LE(rhs, lhs);
</span><span class='bc' id='L2156' title='0|1|1 - Total: 1'>                    break;
</span>                case Token.LE:
<span class='bc' id='L2158' title='0|4|4 - Total: 4'>                    valBln = ScriptRuntime.cmp_LE(lhs, rhs);
</span><span class='bc' id='L2159' title='0|1|1 - Total: 1'>                    break;
</span>                case Token.GT:
<span class='bc' id='L2161' title='0|4|4 - Total: 4'>                    valBln = ScriptRuntime.cmp_LT(rhs, lhs);
</span><span class='bc' id='L2162' title='0|1|1 - Total: 1'>                    break;
</span>                case Token.LT:
<span class='bc' id='L2164' title='0|4|4 - Total: 4'>                    valBln = ScriptRuntime.cmp_LT(lhs, rhs);
</span><span class='bc' id='L2165' title='0|1|1 - Total: 1'>                    break;
</span>                default:
<span class='nc' id='L2167' title='0|0|0 - Total: 2'>                    throw Kit.codeBug();
</span>            }
        }
<span class='bc' id='L2170' title='0|5|5 - Total: 5'>        stack[stackTop] = ScriptRuntime.wrapBoolean(valBln);
</span><span class='bc' id='L2171' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doBitOp(CallFrame frame, int op, Object[] stack,
                               double[] sDbl, int stackTop) {
<span class='bc' id='L2176' title='0|6|6 - Total: 6'>        int lIntValue = stack_int32(frame, stackTop - 1);
</span><span class='bc' id='L2177' title='0|4|4 - Total: 4'>        int rIntValue = stack_int32(frame, stackTop);
</span><span class='bc' id='L2178' title='0|5|5 - Total: 5'>        stack[--stackTop] = DOUBLE_MARK;
</span><span class='bpc' id='L2179' title='0|5|5 - Total: 6'>        switch (op) {
</span>          case Token.BITAND:
<span class='bc' id='L2181' title='0|4|4 - Total: 4'>            lIntValue &= rIntValue;
</span><span class='bc' id='L2182' title='0|1|1 - Total: 1'>            break;
</span>          case Token.BITOR:
<span class='bc' id='L2184' title='0|4|4 - Total: 4'>            lIntValue |= rIntValue;
</span><span class='bc' id='L2185' title='0|1|1 - Total: 1'>            break;
</span>          case Token.BITXOR:
<span class='bc' id='L2187' title='0|4|4 - Total: 4'>            lIntValue ^= rIntValue;
</span><span class='bc' id='L2188' title='0|1|1 - Total: 1'>            break;
</span>          case Token.LSH:
<span class='bc' id='L2190' title='0|4|4 - Total: 4'>            lIntValue <<= rIntValue;
</span><span class='bc' id='L2191' title='0|1|1 - Total: 1'>            break;
</span>          case Token.RSH:
<span class='bc' id='L2193' title='0|4|4 - Total: 4'>            lIntValue >>= rIntValue;
</span>            break;
        }
<span class='bc' id='L2196' title='0|5|5 - Total: 5'>        sDbl[stackTop] = lIntValue;
</span><span class='bc' id='L2197' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doDelName(Context cx, CallFrame frame, int op,
                                 Object[] stack, double[] sDbl, int stackTop) {
<span class='bc' id='L2202' title='0|4|4 - Total: 4'>        Object rhs = stack[stackTop];
</span><span class='bc' id='L2203' title='0|2|2 - Total: 2'>        if (rhs == DOUBLE_MARK) rhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2204' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2205' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bpc' id='L2206' title='0|1|1 - Total: 2'>        if (lhs == DOUBLE_MARK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2207' title='0|2|2 - Total: 2'>        stack[stackTop] = ScriptRuntime.delete(lhs, rhs, cx, frame.scope,
</span>                                               op == Icode_DELNAME);
<span class='bc' id='L2209' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doGetElem(Context cx, CallFrame frame, Object[] stack,
                                 double[] sDbl, int stackTop) {
<span class='bc' id='L2214' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2215' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bpc' id='L2216' title='0|1|1 - Total: 2'>        if (lhs == DOUBLE_MARK) {
</span><span class='nc' id='L2217' title='0|0|0 - Total: 5'>            lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span>        }
        Object value;
<span class='bc' id='L2220' title='0|6|6 - Total: 6'>        Object id = stack[stackTop + 1];
</span><span class='bc' id='L2221' title='0|2|2 - Total: 2'>        if (id != DOUBLE_MARK) {
</span><span class='bc' id='L2222' title='0|8|8 - Total: 8'>            value = ScriptRuntime.getObjectElem(lhs, id, cx, frame.scope);
</span>        } else {
<span class='bc' id='L2224' title='0|6|6 - Total: 6'>            double d = sDbl[stackTop + 1];
</span><span class='bc' id='L2225' title='0|7|7 - Total: 7'>            value = ScriptRuntime.getObjectIndex(lhs, d, cx, frame.scope);
</span>        }
<span class='bc' id='L2227' title='0|4|4 - Total: 4'>        stack[stackTop] = value;
</span><span class='bc' id='L2228' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doSetElem(Context cx, CallFrame frame, Object[] stack,
                                 double[] sDbl, int stackTop) {
<span class='bc' id='L2233' title='0|1|1 - Total: 1'>        stackTop -= 2;
</span><span class='bc' id='L2234' title='0|6|6 - Total: 6'>        Object rhs = stack[stackTop + 2];
</span><span class='bc' id='L2235' title='0|2|2 - Total: 2'>        if (rhs == DOUBLE_MARK) {
</span><span class='bc' id='L2236' title='0|7|7 - Total: 7'>            rhs = ScriptRuntime.wrapNumber(sDbl[stackTop + 2]);
</span>        }
<span class='bc' id='L2238' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L2239' title='0|2|2 - Total: 2'>        if (lhs == DOUBLE_MARK) {
</span><span class='bc' id='L2240' title='0|5|5 - Total: 5'>            lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span>        }
        Object value;
<span class='bc' id='L2243' title='0|6|6 - Total: 6'>        Object id = stack[stackTop + 1];
</span><span class='bc' id='L2244' title='0|2|2 - Total: 2'>        if (id != DOUBLE_MARK) {
</span><span class='bc' id='L2245' title='0|9|9 - Total: 9'>            value = ScriptRuntime.setObjectElem(lhs, id, rhs, cx, frame.scope);
</span>        } else {
<span class='bc' id='L2247' title='0|6|6 - Total: 6'>            double d = sDbl[stackTop + 1];
</span><span class='bc' id='L2248' title='0|8|8 - Total: 8'>            value = ScriptRuntime.setObjectIndex(lhs, d, rhs, cx, frame.scope);
</span>        }
<span class='bc' id='L2250' title='0|4|4 - Total: 4'>        stack[stackTop] = value;
</span><span class='bc' id='L2251' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doElemIncDec(Context cx, CallFrame frame, byte[] iCode,
                                    Object[] stack, double[] sDbl, int stackTop) {
<span class='bc' id='L2256' title='0|4|4 - Total: 4'>        Object rhs = stack[stackTop];
</span><span class='bc' id='L2257' title='0|2|2 - Total: 2'>        if (rhs == DOUBLE_MARK) rhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2258' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2259' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bpc' id='L2260' title='0|1|1 - Total: 2'>        if (lhs == DOUBLE_MARK) lhs = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2261' title='0|13|13 - Total: 13'>        stack[stackTop] = ScriptRuntime.elemIncrDecr(lhs, rhs, cx, frame.scope,
</span>                                                     iCode[frame.pc]);
<span class='bc' id='L2263' title='0|6|6 - Total: 6'>        ++frame.pc;
</span><span class='bc' id='L2264' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doCallSpecial(Context cx, CallFrame frame,
                                     Object[] stack, double[] sDbl,
                                     int stackTop, byte[] iCode,
                                     int indexReg) {
<span class='bc' id='L2271' title='0|7|7 - Total: 7'>        int callType = iCode[frame.pc] & 0xFF;
</span><span class='bc' id='L2272' title='0|2|2 - Total: 2'>        boolean isNew =  (iCode[frame.pc + 1] != 0);
</span><span class='bc' id='L2273' title='0|7|7 - Total: 7'>        int sourceLine = getIndex(iCode, frame.pc + 2);
</span>
        // indexReg: number of arguments
<span class='bc' id='L2276' title='0|2|2 - Total: 2'>        if (isNew) {
</span>            // stack change: function arg0 .. argN -> newResult
<span class='bc' id='L2278' title='0|4|4 - Total: 4'>            stackTop -= indexReg;
</span>
<span class='bc' id='L2280' title='0|4|4 - Total: 4'>            Object function = stack[stackTop];
</span><span class='bpc' id='L2281' title='0|1|1 - Total: 2'>            if (function == DOUBLE_MARK)
</span><span class='nc' id='L2282' title='0|0|0 - Total: 5'>                function = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2283' title='0|8|8 - Total: 8'>            Object[] outArgs = getArgsArray(
</span>                                   stack, sDbl, stackTop + 1, indexReg);
<span class='nc' id='L2285' title='0|0|0 - Total: 10'>            stack[stackTop] = ScriptRuntime.newSpecial(
</span>                                  cx, function, outArgs, frame.scope, callType);
<span class='nc' id='L2287' title='0|0|0 - Total: 1'>        } else {
</span>            // stack change: function thisObj arg0 .. argN -> result
<span class='bc' id='L2289' title='0|6|6 - Total: 6'>            stackTop -= 1 + indexReg;
</span>
            // Call code generation ensure that stack here
            // is ... Callable Scriptable
<span class='bc' id='L2293' title='0|7|7 - Total: 7'>            Scriptable functionThis = (Scriptable)stack[stackTop + 1];
</span><span class='bc' id='L2294' title='0|5|5 - Total: 5'>            Callable function = (Callable)stack[stackTop];
</span><span class='bc' id='L2295' title='0|8|8 - Total: 8'>            Object[] outArgs = getArgsArray(
</span>                                   stack, sDbl, stackTop + 2, indexReg);
<span class='bc' id='L2297' title='0|17|17 - Total: 17'>            stack[stackTop] = ScriptRuntime.callSpecial(
</span>                                  cx, function, functionThis, outArgs,
                                  frame.scope, frame.thisObj, callType,
                                  frame.idata.itsSourceFile, sourceLine);
        }
<span class='bc' id='L2302' title='0|6|6 - Total: 6'>        frame.pc += 4;
</span><span class='bc' id='L2303' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doSetConstVar(CallFrame frame, Object[] stack,
                                     double[] sDbl, int stackTop,
                                     Object[] vars, double[] varDbls,
                                     int[] varAttributes, int indexReg) {
<span class='bpc' id='L2310' title='0|1|1 - Total: 2'>        if (!frame.useActivation) {
</span><span class='bpc' id='L2311' title='0|1|1 - Total: 2'>            if ((varAttributes[indexReg] & ScriptableObject.READONLY) == 0) {
</span><span class='nc' id='L2312' title='0|0|0 - Total: 8'>                throw Context.reportRuntimeError1("msg.var.redecl",
</span>                                                  frame.idata.argNames[indexReg]);
            }
<span class='bpc' id='L2315' title='0|1|1 - Total: 2'>            if ((varAttributes[indexReg] & ScriptableObject.UNINITIALIZED_CONST)
</span>                != 0)
            {
<span class='bc' id='L2318' title='0|6|6 - Total: 6'>                vars[indexReg] = stack[stackTop];
</span><span class='bc' id='L2319' title='0|7|7 - Total: 7'>                varAttributes[indexReg] &= ~ScriptableObject.UNINITIALIZED_CONST;
</span><span class='bc' id='L2320' title='0|7|7 - Total: 7'>                varDbls[indexReg] = sDbl[stackTop];
</span>            }
        } else {
<span class='nc' id='L2323' title='0|0|0 - Total: 4'>            Object val = stack[stackTop];
</span><span class='nc' id='L2324' title='0|0|0 - Total: 2'>            if (val == DOUBLE_MARK) val = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='nc' id='L2325' title='0|0|0 - Total: 6'>            String stringReg = frame.idata.argNames[indexReg];
</span><span class='nc' id='L2326' title='0|0|0 - Total: 2'>            if (frame.scope instanceof ConstProperties) {
</span><span class='nc' id='L2327' title='0|0|0 - Total: 4'>                ConstProperties cp = (ConstProperties)frame.scope;
</span><span class='nc' id='L2328' title='0|0|0 - Total: 6'>                cp.putConst(stringReg, frame.scope, val);
</span><span class='nc' id='L2329' title='0|0|0 - Total: 1'>            } else
</span><span class='nc' id='L2330' title='0|0|0 - Total: 2'>                throw Kit.codeBug();
</span>        }
<span class='bc' id='L2332' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doSetVar(CallFrame frame, Object[] stack,
                                double[] sDbl, int stackTop,
                                Object[] vars, double[] varDbls,
                                int[] varAttributes, int indexReg) {
<span class='bpc' id='L2339' title='0|1|1 - Total: 2'>        if (!frame.useActivation) {
</span><span class='bc' id='L2340' title='0|2|2 - Total: 2'>            if ((varAttributes[indexReg] & ScriptableObject.READONLY) == 0) {
</span><span class='bc' id='L2341' title='0|6|6 - Total: 6'>                vars[indexReg] = stack[stackTop];
</span><span class='bc' id='L2342' title='0|7|7 - Total: 7'>                varDbls[indexReg] = sDbl[stackTop];
</span>            }
        } else {
<span class='nc' id='L2345' title='0|0|0 - Total: 4'>            Object val = stack[stackTop];
</span><span class='nc' id='L2346' title='0|0|0 - Total: 2'>            if (val == DOUBLE_MARK) val = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='nc' id='L2347' title='0|0|0 - Total: 6'>            String stringReg = frame.idata.argNames[indexReg];
</span><span class='nc' id='L2348' title='0|0|0 - Total: 7'>            frame.scope.put(stringReg, frame.scope, val);
</span>        }
<span class='bc' id='L2350' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doGetVar(CallFrame frame, Object[] stack,
                                double[] sDbl, int stackTop,
                                Object[] vars, double[] varDbls,
                                int indexReg) {
<span class='bc' id='L2357' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bpc' id='L2358' title='0|1|1 - Total: 2'>        if (!frame.useActivation) {
</span><span class='bc' id='L2359' title='0|6|6 - Total: 6'>            stack[stackTop] = vars[indexReg];
</span><span class='bc' id='L2360' title='0|7|7 - Total: 7'>            sDbl[stackTop] = varDbls[indexReg];
</span>        } else {
<span class='nc' id='L2362' title='0|0|0 - Total: 6'>            String stringReg = frame.idata.argNames[indexReg];
</span><span class='nc' id='L2363' title='0|0|0 - Total: 9'>            stack[stackTop] = frame.scope.get(stringReg, frame.scope);
</span>        }
<span class='bc' id='L2365' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doVarIncDec(Context cx, CallFrame frame,
                                   Object[] stack, double[] sDbl,
                                   int stackTop, Object[] vars,
                                   double[] varDbls, int[] varAttributes,
                                   int indexReg) {
        // indexReg : varindex
<span class='bc' id='L2374' title='0|1|1 - Total: 1'>        ++stackTop;
</span><span class='bc' id='L2375' title='0|7|7 - Total: 7'>        int incrDecrMask = frame.idata.itsICode[frame.pc];
</span><span class='bpc' id='L2376' title='0|1|1 - Total: 2'>        if (!frame.useActivation) {
</span><span class='bc' id='L2377' title='0|4|4 - Total: 4'>            Object varValue = vars[indexReg];
</span>            double d;
<span class='bc' id='L2379' title='0|2|2 - Total: 2'>            if (varValue == DOUBLE_MARK) {
</span><span class='bc' id='L2380' title='0|5|5 - Total: 5'>                d = varDbls[indexReg];
</span>            } else {
<span class='bc' id='L2382' title='0|3|3 - Total: 3'>                d = ScriptRuntime.toNumber(varValue);
</span>            }
<span class='bc' id='L2384' title='0|2|2 - Total: 2'>            double d2 = ((incrDecrMask & Node.DECR_FLAG) == 0)
</span>                        ? d + 1.0 : d - 1.0;
<span class='bc' id='L2386' title='0|2|2 - Total: 2'>            boolean post = ((incrDecrMask & Node.POST_FLAG) != 0);
</span><span class='bc' id='L2387' title='0|2|2 - Total: 2'>            if ((varAttributes[indexReg] & ScriptableObject.READONLY) == 0) {
</span><span class='bc' id='L2388' title='0|2|2 - Total: 2'>                if (varValue != DOUBLE_MARK) {
</span><span class='bc' id='L2389' title='0|4|4 - Total: 4'>                    vars[indexReg] = DOUBLE_MARK;
</span>                }
<span class='bc' id='L2391' title='0|4|4 - Total: 4'>                varDbls[indexReg] = d2;
</span><span class='bc' id='L2392' title='0|4|4 - Total: 4'>                stack[stackTop] = DOUBLE_MARK;
</span><span class='bc' id='L2393' title='0|2|2 - Total: 2'>                sDbl[stackTop] = post ? d : d2;
</span>            } else {
<span class='bc' id='L2395' title='0|4|4 - Total: 4'>                if (post && varValue != DOUBLE_MARK) {
</span><span class='bc' id='L2396' title='0|5|5 - Total: 5'>                    stack[stackTop] = varValue;
</span>                } else {
<span class='bc' id='L2398' title='0|4|4 - Total: 4'>                    stack[stackTop] = DOUBLE_MARK;
</span><span class='bc' id='L2399' title='0|2|2 - Total: 2'>                    sDbl[stackTop] = post ? d : d2;
</span>                }
            }
<span class='bc' id='L2402' title='0|1|1 - Total: 1'>        } else {
</span><span class='nc' id='L2403' title='0|0|0 - Total: 6'>            String varName = frame.idata.argNames[indexReg];
</span><span class='nc' id='L2404' title='0|0|0 - Total: 9'>            stack[stackTop] = ScriptRuntime.nameIncrDecr(frame.scope, varName,
</span>                                                         cx, incrDecrMask);
        }
<span class='bc' id='L2407' title='0|6|6 - Total: 6'>        ++frame.pc;
</span><span class='bc' id='L2408' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doRefMember(Context cx, Object[] stack, double[] sDbl,
                                   int stackTop, int flags) {
<span class='bc' id='L2413' title='0|4|4 - Total: 4'>        Object elem = stack[stackTop];
</span><span class='bpc' id='L2414' title='0|1|1 - Total: 2'>        if (elem == DOUBLE_MARK) elem = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2415' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2416' title='0|4|4 - Total: 4'>        Object obj = stack[stackTop];
</span><span class='bpc' id='L2417' title='0|1|1 - Total: 2'>        if (obj == DOUBLE_MARK) obj = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2418' title='0|8|8 - Total: 8'>        stack[stackTop] = ScriptRuntime.memberRef(obj, elem, cx, flags);
</span><span class='bc' id='L2419' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doRefNsMember(Context cx, Object[] stack, double[] sDbl,
                                     int stackTop, int flags) {
<span class='bc' id='L2424' title='0|4|4 - Total: 4'>        Object elem = stack[stackTop];
</span><span class='bpc' id='L2425' title='0|1|1 - Total: 2'>        if (elem == DOUBLE_MARK) elem = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2426' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2427' title='0|4|4 - Total: 4'>        Object ns = stack[stackTop];
</span><span class='bpc' id='L2428' title='0|1|1 - Total: 2'>        if (ns == DOUBLE_MARK) ns = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2429' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2430' title='0|4|4 - Total: 4'>        Object obj = stack[stackTop];
</span><span class='bpc' id='L2431' title='0|1|1 - Total: 2'>        if (obj == DOUBLE_MARK) obj = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2432' title='0|9|9 - Total: 9'>        stack[stackTop] = ScriptRuntime.memberRef(obj, ns, elem, cx, flags);
</span><span class='bc' id='L2433' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static int doRefNsName(Context cx, CallFrame frame,
                                   Object[] stack, double[] sDbl,
                                   int stackTop, int flags) {
<span class='bc' id='L2439' title='0|4|4 - Total: 4'>        Object name = stack[stackTop];
</span><span class='bpc' id='L2440' title='0|1|1 - Total: 2'>        if (name == DOUBLE_MARK) name = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2441' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L2442' title='0|4|4 - Total: 4'>        Object ns = stack[stackTop];
</span><span class='bpc' id='L2443' title='0|1|1 - Total: 2'>        if (ns == DOUBLE_MARK) ns = ScriptRuntime.wrapNumber(sDbl[stackTop]);
</span><span class='bc' id='L2444' title='0|10|10 - Total: 10'>        stack[stackTop] = ScriptRuntime.nameRef(ns, name, cx, frame.scope, flags);
</span><span class='bc' id='L2445' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    /**
     * Call __noSuchMethod__.
     */
    private static CallFrame initFrameForNoSuchMethod(Context cx,
            CallFrame frame, int indexReg, Object[] stack, double[] sDbl,
            int stackTop, int op, Scriptable funThisObj, Scriptable calleeScope,
            NoSuchMethodShim noSuchMethodShim, InterpretedFunction ifun)
    {
        // create an args array from the stack
<span class='bc' id='L2457' title='0|2|2 - Total: 2'>        Object[] argsArray = null;
</span>        // exactly like getArgsArray except that the first argument
        // is the method name from the shim
<span class='bc' id='L2460' title='0|4|4 - Total: 4'>        int shift = stackTop + 2;
</span><span class='bc' id='L2461' title='0|3|3 - Total: 3'>        Object[] elements = new Object[indexReg];
</span><span class='bc' id='L2462' title='0|2|2 - Total: 2'>        for (int i=0; i < indexReg; ++i, ++shift) {
</span><span class='bc' id='L2463' title='0|4|4 - Total: 4'>            Object val = stack[shift];
</span><span class='bpc' id='L2464' title='0|1|1 - Total: 2'>            if (val == DOUBLE_MARK) {
</span><span class='bc' id='L2465' title='0|5|5 - Total: 5'>                val = ScriptRuntime.wrapNumber(sDbl[shift]);
</span>            }
<span class='bc' id='L2467' title='0|4|4 - Total: 4'>            elements[i] = val;
</span>        }
<span class='bc' id='L2469' title='0|3|3 - Total: 3'>        argsArray = new Object[2];
</span><span class='bc' id='L2470' title='0|5|5 - Total: 5'>        argsArray[0] = noSuchMethodShim.methodName;
</span><span class='bc' id='L2471' title='0|7|7 - Total: 7'>        argsArray[1] = cx.newArray(calleeScope, elements);
</span>
        // exactly the same as if it's a regular InterpretedFunction
<span class='bc' id='L2474' title='0|2|2 - Total: 2'>        CallFrame callParentFrame = frame;
</span><span class='bc' id='L2475' title='0|5|5 - Total: 5'>        CallFrame calleeFrame = new CallFrame();
</span><span class='bpc' id='L2476' title='0|1|1 - Total: 2'>        if (op == Icode_TAIL_CALL) {
</span><span class='nc' id='L2477' title='0|0|0 - Total: 3'>            callParentFrame = frame.parentFrame;
</span><span class='nc' id='L2478' title='0|0|0 - Total: 4'>            exitFrame(cx, frame, null);
</span>        }
        // init the frame with the underlying method with the
        // adjusted args array and shim's function
<span class='bc' id='L2482' title='0|11|11 - Total: 11'>        initFrame(cx, calleeScope, funThisObj, argsArray, null,
</span>          0, 2, ifun, callParentFrame, calleeFrame);
<span class='bpc' id='L2484' title='0|1|1 - Total: 2'>        if (op != Icode_TAIL_CALL) {
</span><span class='bc' id='L2485' title='0|3|3 - Total: 3'>            frame.savedStackTop = stackTop;
</span><span class='bc' id='L2486' title='0|3|3 - Total: 3'>            frame.savedCallOp = op;
</span>        }
<span class='bc' id='L2488' title='0|2|2 - Total: 2'>        return calleeFrame;
</span>    }

    private static boolean doEquals(Object[] stack, double[] sDbl,
                                    int stackTop) {
<span class='bc' id='L2493' title='0|6|6 - Total: 6'>        Object rhs = stack[stackTop + 1];
</span><span class='bc' id='L2494' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L2495' title='0|2|2 - Total: 2'>        if (rhs == DOUBLE_MARK) {
</span><span class='bc' id='L2496' title='0|2|2 - Total: 2'>            if (lhs == DOUBLE_MARK) {
</span><span class='bc' id='L2497' title='0|2|2 - Total: 2'>                return (sDbl[stackTop] == sDbl[stackTop + 1]);
</span>            } else {
<span class='bc' id='L2499' title='0|8|8 - Total: 8'>                return ScriptRuntime.eqNumber(sDbl[stackTop + 1], lhs);
</span>            }
        } else {
<span class='bc' id='L2502' title='0|2|2 - Total: 2'>            if (lhs == DOUBLE_MARK) {
</span><span class='bc' id='L2503' title='0|6|6 - Total: 6'>                return ScriptRuntime.eqNumber(sDbl[stackTop], rhs);
</span>            } else {
<span class='bc' id='L2505' title='0|4|4 - Total: 4'>                return ScriptRuntime.eq(lhs, rhs);
</span>            }
        }
    }

    private static boolean doShallowEquals(Object[] stack, double[] sDbl,
                                           int stackTop)
    {
<span class='bc' id='L2513' title='0|6|6 - Total: 6'>        Object rhs = stack[stackTop + 1];
</span><span class='bc' id='L2514' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span><span class='bc' id='L2515' title='0|2|2 - Total: 2'>        final Object DBL_MRK = DOUBLE_MARK;
</span>        double rdbl, ldbl;
<span class='bc' id='L2517' title='0|2|2 - Total: 2'>        if (rhs == DBL_MRK) {
</span><span class='bc' id='L2518' title='0|6|6 - Total: 6'>            rdbl = sDbl[stackTop + 1];
</span><span class='bc' id='L2519' title='0|2|2 - Total: 2'>            if (lhs == DBL_MRK) {
</span><span class='bc' id='L2520' title='0|5|5 - Total: 5'>                ldbl = sDbl[stackTop];
</span><span class='bc' id='L2521' title='0|2|2 - Total: 2'>            } else if (lhs instanceof Number) {
</span><span class='bc' id='L2522' title='0|5|5 - Total: 5'>                ldbl = ((Number)lhs).doubleValue();
</span>            } else {
<span class='bc' id='L2524' title='0|2|2 - Total: 2'>                return false;
</span>            }
<span class='bc' id='L2526' title='0|2|2 - Total: 2'>        } else if (lhs == DBL_MRK) {
</span><span class='bc' id='L2527' title='0|4|4 - Total: 4'>            ldbl = sDbl[stackTop];
</span><span class='bc' id='L2528' title='0|2|2 - Total: 2'>            if (rhs instanceof Number) {
</span><span class='bc' id='L2529' title='0|5|5 - Total: 5'>                rdbl = ((Number)rhs).doubleValue();
</span>            } else {
<span class='bc' id='L2531' title='0|2|2 - Total: 2'>                return false;
</span>            }
        } else {
<span class='bc' id='L2534' title='0|4|4 - Total: 4'>            return ScriptRuntime.shallowEq(lhs, rhs);
</span>        }
<span class='bc' id='L2536' title='0|2|2 - Total: 2'>        return (ldbl == rdbl);
</span>    }

    private static CallFrame processThrowable(Context cx, Object throwable,
                                              CallFrame frame, int indexReg,
                                              boolean instructionCounting)
    {
        // Recovering from exception, indexReg contains
        // the index of handler

<span class='bc' id='L2546' title='0|2|2 - Total: 2'>        if (indexReg >= 0) {
</span>            // Normal exception handler, transfer
            // control appropriately

<span class='bpc' id='L2550' title='0|1|1 - Total: 2'>            if (frame.frozen) {
</span>                // XXX Deal with exceptios!!!
<span class='nc' id='L2552' title='0|0|0 - Total: 3'>                frame = frame.cloneFrozen();
</span>            }

<span class='bc' id='L2555' title='0|4|4 - Total: 4'>            int[] table = frame.idata.itsExceptionTable;
</span>
<span class='bc' id='L2557' title='0|7|7 - Total: 7'>            frame.pc = table[indexReg + EXCEPTION_HANDLER_SLOT];
</span><span class='bpc' id='L2558' title='0|1|1 - Total: 2'>            if (instructionCounting) {
</span><span class='nc' id='L2559' title='0|0|0 - Total: 4'>                frame.pcPrevBranch = frame.pc;
</span>            }

<span class='bc' id='L2562' title='0|4|4 - Total: 4'>            frame.savedStackTop = frame.emptyStackTop;
</span><span class='bc' id='L2563' title='0|9|9 - Total: 9'>            int scopeLocal = frame.localShift
</span>                             + table[indexReg
                                     + EXCEPTION_SCOPE_SLOT];
<span class='bc' id='L2566' title='0|9|9 - Total: 9'>            int exLocal = frame.localShift
</span>                             + table[indexReg
                                     + EXCEPTION_LOCAL_SLOT];
<span class='bc' id='L2569' title='0|7|7 - Total: 7'>            frame.scope = (Scriptable)frame.stack[scopeLocal];
</span><span class='bc' id='L2570' title='0|5|5 - Total: 5'>            frame.stack[exLocal] = throwable;
</span>
<span class='bc' id='L2572' title='0|2|2 - Total: 2'>            throwable = null;
</span><span class='bc' id='L2573' title='0|1|1 - Total: 1'>        } else {
</span>            // Continuation restoration
<span class='bc' id='L2575' title='0|3|3 - Total: 3'>            ContinuationJump cjump = (ContinuationJump)throwable;
</span>
            // Clear throwable to indicate that exceptions are OK
<span class='bc' id='L2578' title='0|2|2 - Total: 2'>            throwable = null;
</span>
<span class='bpc' id='L2580' title='0|1|1 - Total: 2'>            if (cjump.branchFrame != frame) Kit.codeBug();
</span>
            // Check that we have at least one frozen frame
            // in the case of detached continuation restoration:
            // unwind code ensure that
<span class='bpc' id='L2585' title='0|1|1 - Total: 2'>            if (cjump.capturedFrame == null) Kit.codeBug();
</span>
            // Need to rewind branchFrame, capturedFrame
            // and all frames in between
<span class='bc' id='L2589' title='0|6|6 - Total: 6'>            int rewindCount = cjump.capturedFrame.frameIndex + 1;
</span><span class='bpc' id='L2590' title='0|1|1 - Total: 2'>            if (cjump.branchFrame != null) {
</span><span class='nc' id='L2591' title='0|0|0 - Total: 6'>                rewindCount -= cjump.branchFrame.frameIndex;
</span>            }

<span class='bc' id='L2594' title='0|2|2 - Total: 2'>            int enterCount = 0;
</span><span class='bc' id='L2595' title='0|2|2 - Total: 2'>            CallFrame[] enterFrames = null;
</span>
<span class='bc' id='L2597' title='0|3|3 - Total: 3'>            CallFrame x = cjump.capturedFrame;
</span><span class='bc' id='L2598' title='0|2|2 - Total: 2'>            for (int i = 0; i != rewindCount; ++i) {
</span><span class='bpc' id='L2599' title='0|1|1 - Total: 2'>                if (!x.frozen) Kit.codeBug();
</span><span class='bc' id='L2600' title='0|2|2 - Total: 2'>                if (isFrameEnterExitRequired(x)) {
</span><span class='bpc' id='L2601' title='0|1|1 - Total: 2'>                    if (enterFrames == null) {
</span>                        // Allocate enough space to store the rest
                        // of rewind frames in case all of them
                        // would require to enter
<span class='bc' id='L2605' title='0|5|5 - Total: 5'>                        enterFrames = new CallFrame[rewindCount
</span>                                                    - i];
                    }
<span class='bc' id='L2608' title='0|4|4 - Total: 4'>                    enterFrames[enterCount] = x;
</span><span class='bc' id='L2609' title='0|1|1 - Total: 1'>                    ++enterCount;
</span>                }
<span class='bc' id='L2611' title='0|3|3 - Total: 3'>                x = x.parentFrame;
</span>            }

<span class='bc' id='L2614' title='0|2|2 - Total: 2'>            while (enterCount != 0) {
</span>                // execute enter: walk enterFrames in the reverse
                // order since they were stored starting from
                // the capturedFrame, not branchFrame
<span class='bc' id='L2618' title='0|1|1 - Total: 1'>                --enterCount;
</span><span class='bc' id='L2619' title='0|4|4 - Total: 4'>                x = enterFrames[enterCount];
</span><span class='bc' id='L2620' title='0|6|6 - Total: 6'>                enterFrame(cx, x, ScriptRuntime.emptyArgs, true);
</span>            }

            // Continuation jump is almost done: capturedFrame
            // points to the call to the function that captured
            // continuation, so clone capturedFrame and
            // emulate return that function with the suplied result
<span class='bc' id='L2627' title='0|4|4 - Total: 4'>            frame = cjump.capturedFrame.cloneFrozen();
</span><span class='bc' id='L2628' title='0|6|6 - Total: 6'>            setCallResult(frame, cjump.result, cjump.resultDbl);
</span>            // restart the execution
        }
<span class='bc' id='L2631' title='0|3|3 - Total: 3'>        frame.throwable = throwable;
</span><span class='bc' id='L2632' title='0|2|2 - Total: 2'>        return frame;
</span>    }

    private static Object freezeGenerator(Context cx, CallFrame frame,
                                          int stackTop,
                                          GeneratorState generatorState)
    {
<span class='bpc' id='L2639' title='0|1|1 - Total: 2'>          if (generatorState.operation == NativeGenerator.GENERATOR_CLOSE) {
</span>              // Error: no yields when generator is closing
<span class='nc' id='L2641' title='0|0|0 - Total: 3'>              throw ScriptRuntime.typeError0("msg.yield.closing");
</span>          }
          // return to our caller (which should be a method of NativeGenerator)
<span class='bc' id='L2644' title='0|3|3 - Total: 3'>          frame.frozen = true;
</span><span class='bc' id='L2645' title='0|6|6 - Total: 6'>          frame.result = frame.stack[stackTop];
</span><span class='bc' id='L2646' title='0|6|6 - Total: 6'>          frame.resultDbl = frame.sDbl[stackTop];
</span><span class='bc' id='L2647' title='0|3|3 - Total: 3'>          frame.savedStackTop = stackTop;
</span><span class='bc' id='L2648' title='0|6|6 - Total: 6'>          frame.pc--; // we want to come back here when we resume
</span><span class='bc' id='L2649' title='0|2|2 - Total: 2'>          ScriptRuntime.exitActivationFunction(cx);
</span><span class='bc' id='L2650' title='0|2|2 - Total: 2'>          return (frame.result != DOUBLE_MARK)
</span>              ? frame.result
<span class='bc' id='L2652' title='0|1|1 - Total: 1'>              : ScriptRuntime.wrapNumber(frame.resultDbl);
</span>    }

    private static Object thawGenerator(CallFrame frame, int stackTop,
                                        GeneratorState generatorState, int op)
    {
          // we are resuming execution
<span class='bc' id='L2659' title='0|3|3 - Total: 3'>          frame.frozen = false;
</span><span class='bc' id='L2660' title='0|7|7 - Total: 7'>          int sourceLine = getIndex(frame.idata.itsICode, frame.pc);
</span><span class='bc' id='L2661' title='0|6|6 - Total: 6'>          frame.pc += 2; // skip line number data
</span><span class='bc' id='L2662' title='0|2|2 - Total: 2'>          if (generatorState.operation == NativeGenerator.GENERATOR_THROW) {
</span>              // processing a call to <generator>.throw(exception): must
              // act as if exception was thrown from resumption point
<span class='bc' id='L2665' title='0|10|10 - Total: 10'>              return new JavaScriptException(generatorState.value,
</span>                                                  frame.idata.itsSourceFile,
                                                  sourceLine);
          }
<span class='bc' id='L2669' title='0|2|2 - Total: 2'>          if (generatorState.operation == NativeGenerator.GENERATOR_CLOSE) {
</span><span class='bc' id='L2670' title='0|3|3 - Total: 3'>              return generatorState.value;
</span>          }
<span class='bpc' id='L2672' title='0|1|1 - Total: 2'>          if (generatorState.operation != NativeGenerator.GENERATOR_SEND)
</span><span class='nc' id='L2673' title='0|0|0 - Total: 2'>              throw Kit.codeBug();
</span><span class='bc' id='L2674' title='0|2|2 - Total: 2'>          if (op == Token.YIELD)
</span><span class='bc' id='L2675' title='0|6|6 - Total: 6'>              frame.stack[stackTop] = generatorState.value;
</span><span class='bc' id='L2676' title='0|2|2 - Total: 2'>          return Scriptable.NOT_FOUND;
</span>    }

    private static CallFrame initFrameForApplyOrCall(Context cx, CallFrame frame,
            int indexReg, Object[] stack, double[] sDbl, int stackTop, int op,
            Scriptable calleeScope, IdFunctionObject ifun,
            InterpretedFunction iApplyCallable)
    {
        Scriptable applyThis;
<span class='bc' id='L2685' title='0|2|2 - Total: 2'>        if (indexReg != 0) {
</span><span class='bc' id='L2686' title='0|6|6 - Total: 6'>            Object obj = stack[stackTop + 2];
</span><span class='bc' id='L2687' title='0|2|2 - Total: 2'>            if (obj == DOUBLE_MARK)
</span><span class='bc' id='L2688' title='0|7|7 - Total: 7'>                obj = ScriptRuntime.wrapNumber(sDbl[stackTop + 2]);
</span><span class='bc' id='L2689' title='0|6|6 - Total: 6'>            applyThis = ScriptRuntime.toObjectOrNull(cx, obj, frame.scope);
</span><span class='bc' id='L2690' title='0|1|1 - Total: 1'>        }
</span>        else {
<span class='bc' id='L2692' title='0|2|2 - Total: 2'>            applyThis = null;
</span>        }
<span class='bc' id='L2694' title='0|2|2 - Total: 2'>        if (applyThis == null) {
</span>            // This covers the case of args[0] == (null|undefined) as well.
<span class='bc' id='L2696' title='0|3|3 - Total: 3'>            applyThis = ScriptRuntime.getTopCallScope(cx);
</span>        }
<span class='bc' id='L2698' title='0|2|2 - Total: 2'>        if(op == Icode_TAIL_CALL) {
</span><span class='bc' id='L2699' title='0|4|4 - Total: 4'>            exitFrame(cx, frame, null);
</span><span class='bc' id='L2700' title='0|4|4 - Total: 4'>            frame = frame.parentFrame;
</span>        }
        else {
<span class='bc' id='L2703' title='0|3|3 - Total: 3'>            frame.savedStackTop = stackTop;
</span><span class='bc' id='L2704' title='0|3|3 - Total: 3'>            frame.savedCallOp = op;
</span>        }
<span class='bc' id='L2706' title='0|5|5 - Total: 5'>        CallFrame calleeFrame = new CallFrame();
</span><span class='bc' id='L2707' title='0|2|2 - Total: 2'>        if(BaseFunction.isApply(ifun)) {
</span><span class='bc' id='L2708' title='0|2|2 - Total: 2'>            Object[] callArgs = indexReg < 2 ? ScriptRuntime.emptyArgs :
</span><span class='bc' id='L2709' title='0|2|2 - Total: 2'>                ScriptRuntime.getApplyArguments(cx, stack[stackTop + 3]);
</span><span class='bc' id='L2710' title='0|12|12 - Total: 12'>            initFrame(cx, calleeScope, applyThis, callArgs, null, 0,
</span>                    callArgs.length, iApplyCallable, frame, calleeFrame);
<span class='bc' id='L2712' title='0|1|1 - Total: 1'>        }
</span>        else {
            // Shift args left
<span class='bc' id='L2715' title='0|2|2 - Total: 2'>            for(int i = 1; i < indexReg; ++i) {
</span><span class='bc' id='L2716' title='0|14|14 - Total: 14'>                stack[stackTop + 1 + i] = stack[stackTop + 2 + i];
</span><span class='bc' id='L2717' title='0|14|14 - Total: 14'>                sDbl[stackTop + 1 + i] = sDbl[stackTop + 2 + i];
</span>            }
<span class='bc' id='L2719' title='0|2|2 - Total: 2'>            int argCount = indexReg < 2 ? 0 : indexReg - 1;
</span><span class='bc' id='L2720' title='0|13|13 - Total: 13'>            initFrame(cx, calleeScope, applyThis, stack, sDbl, stackTop + 2,
</span>                    argCount, iApplyCallable, frame, calleeFrame);
        }

<span class='bc' id='L2724' title='0|2|2 - Total: 2'>        frame = calleeFrame;
</span><span class='bc' id='L2725' title='0|2|2 - Total: 2'>        return frame;
</span>    }

    private static void initFrame(Context cx, Scriptable callerScope,
                                  Scriptable thisObj,
                                  Object[] args, double[] argsDbl,
                                  int argShift, int argCount,
                                  InterpretedFunction fnOrScript,
                                  CallFrame parentFrame, CallFrame frame)
    {
<span class='bc' id='L2735' title='0|3|3 - Total: 3'>        InterpreterData idata = fnOrScript.idata;
</span>
<span class='bc' id='L2737' title='0|3|3 - Total: 3'>        boolean useActivation = idata.itsNeedsActivation;
</span><span class='bc' id='L2738' title='0|2|2 - Total: 2'>        DebugFrame debuggerFrame = null;
</span><span class='bpc' id='L2739' title='0|1|1 - Total: 2'>        if (cx.debugger != null) {
</span><span class='nc' id='L2740' title='0|0|0 - Total: 6'>            debuggerFrame = cx.debugger.getFrame(cx, idata);
</span><span class='nc' id='L2741' title='0|0|0 - Total: 2'>            if (debuggerFrame != null) {
</span><span class='nc' id='L2742' title='0|0|0 - Total: 2'>                useActivation = true;
</span>            }
        }

<span class='bc' id='L2746' title='0|2|2 - Total: 2'>        if (useActivation) {
</span>            // Copy args to new array to pass to enterActivationFunction
            // or debuggerFrame.onEnter
<span class='bc' id='L2749' title='0|2|2 - Total: 2'>            if (argsDbl != null) {
</span><span class='bc' id='L2750' title='0|6|6 - Total: 6'>                args = getArgsArray(args, argsDbl, argShift, argCount);
</span>            }
<span class='bc' id='L2752' title='0|2|2 - Total: 2'>            argShift = 0;
</span><span class='bc' id='L2753' title='0|2|2 - Total: 2'>            argsDbl = null;
</span>        }

        Scriptable scope;
<span class='bc' id='L2757' title='0|2|2 - Total: 2'>        if (idata.itsFunctionType != 0) {
</span><span class='bc' id='L2758' title='0|3|3 - Total: 3'>            scope = fnOrScript.getParentScope();
</span>
<span class='bc' id='L2760' title='0|2|2 - Total: 2'>            if (useActivation) {
</span><span class='bc' id='L2761' title='0|2|2 - Total: 2'>                if (idata.itsFunctionType == FunctionNode.ARROW_FUNCTION) {
</span><span class='bc' id='L2762' title='0|8|8 - Total: 8'>                    scope = ScriptRuntime.createArrowFunctionActivation(fnOrScript, scope, args, idata.isStrict);
</span>                } else {
<span class='bc' id='L2764' title='0|8|8 - Total: 8'>                    scope = ScriptRuntime.createFunctionActivation(fnOrScript, scope, args, idata.isStrict);
</span>                }
            }
        } else {
<span class='bc' id='L2768' title='0|2|2 - Total: 2'>            scope = callerScope;
</span><span class='bc' id='L2769' title='0|8|8 - Total: 8'>            ScriptRuntime.initScript(fnOrScript, thisObj, cx, scope,
</span>                                     fnOrScript.idata.evalScriptFlag);
        }

<span class='bc' id='L2773' title='0|2|2 - Total: 2'>        if (idata.itsNestedFunctions != null) {
</span><span class='bpc' id='L2774' title='0|3|3 - Total: 4'>            if (idata.itsFunctionType != 0 && !idata.itsNeedsActivation)
</span><span class='nc' id='L2775' title='0|0|0 - Total: 2'>                Kit.codeBug();
</span><span class='bc' id='L2776' title='0|2|2 - Total: 2'>            for (int i = 0; i < idata.itsNestedFunctions.length; i++) {
</span><span class='bc' id='L2777' title='0|5|5 - Total: 5'>                InterpreterData fdata = idata.itsNestedFunctions[i];
</span><span class='bc' id='L2778' title='0|2|2 - Total: 2'>                if (fdata.itsFunctionType == FunctionNode.FUNCTION_STATEMENT) {
</span><span class='bc' id='L2779' title='0|5|5 - Total: 5'>                    initFunction(cx, scope, fnOrScript, i);
</span>                }
            }
        }

        // Initialize args, vars, locals and stack

<span class='bc' id='L2786' title='0|8|8 - Total: 8'>        int emptyStackTop = idata.itsMaxVars + idata.itsMaxLocals - 1;
</span><span class='bc' id='L2787' title='0|3|3 - Total: 3'>        int maxFrameArray = idata.itsMaxFrameArray;
</span><span class='bpc' id='L2788' title='0|1|1 - Total: 2'>        if (maxFrameArray != emptyStackTop + idata.itsMaxStack + 1)
</span><span class='nc' id='L2789' title='0|0|0 - Total: 2'>            Kit.codeBug();
</span>
        Object[] stack;
        int[] stackAttributes;
        double[] sDbl;
        boolean stackReuse;
<span class='bpc' id='L2795' title='0|1|1 - Total: 4'>        if (frame.stack != null && maxFrameArray <= frame.stack.length) {
</span>            // Reuse stacks from old frame
<span class='nc' id='L2797' title='0|0|0 - Total: 2'>            stackReuse = true;
</span><span class='nc' id='L2798' title='0|0|0 - Total: 3'>            stack = frame.stack;
</span><span class='nc' id='L2799' title='0|0|0 - Total: 3'>            stackAttributes = frame.stackAttributes;
</span><span class='nc' id='L2800' title='0|0|0 - Total: 4'>            sDbl = frame.sDbl;
</span>        } else {
<span class='bc' id='L2802' title='0|2|2 - Total: 2'>            stackReuse = false;
</span><span class='bc' id='L2803' title='0|3|3 - Total: 3'>            stack = new Object[maxFrameArray];
</span><span class='bc' id='L2804' title='0|3|3 - Total: 3'>            stackAttributes = new int[maxFrameArray];
</span><span class='bc' id='L2805' title='0|3|3 - Total: 3'>            sDbl = new double[maxFrameArray];
</span>        }

<span class='bc' id='L2808' title='0|3|3 - Total: 3'>        int varCount = idata.getParamAndVarCount();
</span><span class='bc' id='L2809' title='0|2|2 - Total: 2'>        for (int i = 0; i < varCount; i++) {
</span><span class='bc' id='L2810' title='0|2|2 - Total: 2'>            if (idata.getParamOrVarConst(i))
</span><span class='bc' id='L2811' title='0|4|4 - Total: 4'>                stackAttributes[i] = ScriptableObject.CONST;
</span>        }
<span class='bc' id='L2813' title='0|3|3 - Total: 3'>        int definedArgs = idata.argCount;
</span><span class='bc' id='L2814' title='0|2|2 - Total: 2'>        if (definedArgs > argCount) { definedArgs = argCount; }
</span>
        // Fill the frame structure

<span class='bc' id='L2818' title='0|3|3 - Total: 3'>        frame.parentFrame = parentFrame;
</span><span class='bc' id='L2819' title='0|2|2 - Total: 2'>        frame.frameIndex = (parentFrame == null)
</span>                           ? 0 : parentFrame.frameIndex + 1;
<span class='bpc' id='L2821' title='0|1|1 - Total: 2'>        if(frame.frameIndex > cx.getMaximumInterpreterStackDepth())
</span>        {
<span class='nc' id='L2823' title='0|0|0 - Total: 3'>            throw Context.reportRuntimeError("Exceeded maximum stack depth");
</span>        }
<span class='bc' id='L2825' title='0|3|3 - Total: 3'>        frame.frozen = false;
</span>
<span class='bc' id='L2827' title='0|3|3 - Total: 3'>        frame.fnOrScript = fnOrScript;
</span><span class='bc' id='L2828' title='0|3|3 - Total: 3'>        frame.idata = idata;
</span>
<span class='bc' id='L2830' title='0|3|3 - Total: 3'>        frame.stack = stack;
</span><span class='bc' id='L2831' title='0|3|3 - Total: 3'>        frame.stackAttributes = stackAttributes;
</span><span class='bc' id='L2832' title='0|3|3 - Total: 3'>        frame.sDbl = sDbl;
</span><span class='bc' id='L2833' title='0|3|3 - Total: 3'>        frame.varSource = frame;
</span><span class='bc' id='L2834' title='0|4|4 - Total: 4'>        frame.localShift = idata.itsMaxVars;
</span><span class='bc' id='L2835' title='0|3|3 - Total: 3'>        frame.emptyStackTop = emptyStackTop;
</span>
<span class='bc' id='L2837' title='0|3|3 - Total: 3'>        frame.debuggerFrame = debuggerFrame;
</span><span class='bc' id='L2838' title='0|3|3 - Total: 3'>        frame.useActivation = useActivation;
</span>
<span class='bc' id='L2840' title='0|3|3 - Total: 3'>        frame.thisObj = thisObj;
</span>
        // Initialize initial values of variables that change during
        // interpretation.
<span class='bc' id='L2844' title='0|3|3 - Total: 3'>        frame.result = Undefined.instance;
</span><span class='bc' id='L2845' title='0|3|3 - Total: 3'>        frame.pc = 0;
</span><span class='bc' id='L2846' title='0|3|3 - Total: 3'>        frame.pcPrevBranch = 0;
</span><span class='bc' id='L2847' title='0|4|4 - Total: 4'>        frame.pcSourceLineStart = idata.firstLinePC;
</span><span class='bc' id='L2848' title='0|3|3 - Total: 3'>        frame.scope = scope;
</span>
<span class='bc' id='L2850' title='0|3|3 - Total: 3'>        frame.savedStackTop = emptyStackTop;
</span><span class='bc' id='L2851' title='0|3|3 - Total: 3'>        frame.savedCallOp = 0;
</span>
<span class='bc' id='L2853' title='0|6|6 - Total: 6'>        System.arraycopy(args, argShift, stack, 0, definedArgs);
</span><span class='bc' id='L2854' title='0|2|2 - Total: 2'>        if (argsDbl != null) {
</span><span class='bc' id='L2855' title='0|6|6 - Total: 6'>            System.arraycopy(argsDbl, argShift, sDbl, 0, definedArgs);
</span>        }
<span class='bc' id='L2857' title='0|2|2 - Total: 2'>        for (int i = definedArgs; i != idata.itsMaxVars; ++i) {
</span><span class='bc' id='L2858' title='0|4|4 - Total: 4'>            stack[i] = Undefined.instance;
</span>        }
<span class='bpc' id='L2860' title='0|1|1 - Total: 2'>        if (stackReuse) {
</span>            // Clean the stack part and space beyond stack if any
            // of the old array to allow to GC objects there
<span class='nc' id='L2863' title='0|0|0 - Total: 2'>            for (int i = emptyStackTop + 1; i != stack.length; ++i) {
</span><span class='nc' id='L2864' title='0|0|0 - Total: 4'>                stack[i] = null;
</span>            }
        }

<span class='bc' id='L2868' title='0|5|5 - Total: 5'>        enterFrame(cx, frame, args, false);
</span><span class='bc' id='L2869' title='0|1|1 - Total: 1'>    }
</span>
    private static boolean isFrameEnterExitRequired(CallFrame frame)
    {
<span class='bpc' id='L2873' title='0|3|3 - Total: 4'>        return frame.debuggerFrame != null || frame.idata.itsNeedsActivation;
</span>    }

    private static void enterFrame(Context cx, CallFrame frame, Object[] args,
                                   boolean continuationRestart)
    {
<span class='bc' id='L2879' title='0|4|4 - Total: 4'>        boolean usesActivation = frame.idata.itsNeedsActivation;
</span><span class='bpc' id='L2880' title='0|1|1 - Total: 2'>        boolean isDebugged = frame.debuggerFrame != null;
</span><span class='bpc' id='L2881' title='0|3|3 - Total: 4'>        if(usesActivation || isDebugged) {
</span><span class='bc' id='L2882' title='0|3|3 - Total: 3'>            Scriptable scope = frame.scope;
</span><span class='bpc' id='L2883' title='0|1|1 - Total: 2'>            if(scope == null) {
</span><span class='nc' id='L2884' title='0|0|0 - Total: 3'>                Kit.codeBug();
</span><span class='bc' id='L2885' title='0|2|2 - Total: 2'>            } else if (continuationRestart) {
</span>                // Walk the parent chain of frame.scope until a NativeCall is
                // found. Normally, frame.scope is a NativeCall when called
                // from initFrame() for a debugged or activatable function.
                // However, when called from interpretLoop() as part of
                // restarting a continuation, it can also be a NativeWith if
                // the continuation was captured within a "with" or "catch"
                // block ("catch" implicitly uses NativeWith to create a scope
                // to expose the exception variable).
                for(;;) {
<span class='bc' id='L2895' title='0|2|2 - Total: 2'>                    if(scope instanceof NativeWith) {
</span><span class='bc' id='L2896' title='0|3|3 - Total: 3'>                        scope = scope.getParentScope();
</span><span class='bpc' id='L2897' title='0|2|2 - Total: 6'>                        if (scope == null || (frame.parentFrame != null &&
</span>                                              frame.parentFrame.scope == scope))
                        {
                            // If we get here, we didn't find a NativeCall in
                            // the call chain before reaching parent frame's
                            // scope. This should not be possible.
<span class='nc' id='L2903' title='0|0|0 - Total: 2'>                            Kit.codeBug();
</span><span class='nc' id='L2904' title='0|0|0 - Total: 1'>                            break; // Never reached, but keeps the static analyzer
</span>                            // happy about "scope" not being null 5 lines above.
                        }
                    }
                    else {
                        break;
                    }
                }
            }
<span class='bpc' id='L2913' title='0|1|1 - Total: 2'>            if (isDebugged) {
</span><span class='nc' id='L2914' title='0|0|0 - Total: 8'>                frame.debuggerFrame.onEnter(cx, scope, frame.thisObj, args);
</span>            }
            // Enter activation only when itsNeedsActivation true,
            // since debugger should not interfere with activation
            // chaining
<span class='bpc' id='L2919' title='0|1|1 - Total: 2'>            if (usesActivation) {
</span><span class='bc' id='L2920' title='0|3|3 - Total: 3'>                ScriptRuntime.enterActivationFunction(cx, scope);
</span>            }
        }
<span class='bc' id='L2923' title='0|1|1 - Total: 1'>    }
</span>
    private static void exitFrame(Context cx, CallFrame frame,
                                  Object throwable)
    {
<span class='bc' id='L2928' title='0|2|2 - Total: 2'>        if (frame.idata.itsNeedsActivation) {
</span><span class='bc' id='L2929' title='0|2|2 - Total: 2'>            ScriptRuntime.exitActivationFunction(cx);
</span>        }

<span class='bpc' id='L2932' title='0|1|1 - Total: 2'>        if (frame.debuggerFrame != null) {
</span>            try {
<span class='nc' id='L2934' title='0|0|0 - Total: 2'>                if (throwable instanceof Throwable) {
</span><span class='nc' id='L2935' title='0|0|0 - Total: 7'>                    frame.debuggerFrame.onExit(cx, true, throwable);
</span>                } else {
                    Object result;
<span class='nc' id='L2938' title='0|0|0 - Total: 3'>                    ContinuationJump cjump = (ContinuationJump)throwable;
</span><span class='nc' id='L2939' title='0|0|0 - Total: 2'>                    if (cjump == null) {
</span><span class='nc' id='L2940' title='0|0|0 - Total: 4'>                        result = frame.result;
</span>                    } else {
<span class='nc' id='L2942' title='0|0|0 - Total: 3'>                        result = cjump.result;
</span>                    }
<span class='nc' id='L2944' title='0|0|0 - Total: 2'>                    if (result == DOUBLE_MARK) {
</span>                        double resultDbl;
<span class='nc' id='L2946' title='0|0|0 - Total: 2'>                        if (cjump == null) {
</span><span class='nc' id='L2947' title='0|0|0 - Total: 4'>                            resultDbl = frame.resultDbl;
</span>                        } else {
<span class='nc' id='L2949' title='0|0|0 - Total: 3'>                            resultDbl = cjump.resultDbl;
</span>                        }
<span class='nc' id='L2951' title='0|0|0 - Total: 3'>                        result = ScriptRuntime.wrapNumber(resultDbl);
</span>                    }
<span class='nc' id='L2953' title='0|0|0 - Total: 6'>                    frame.debuggerFrame.onExit(cx, false, result);
</span>                }
<span class='nc' id='L2955' title='0|0|0 - Total: 1'>            } catch (Throwable ex) {
</span><span class='nc' id='L2956' title='0|0|0 - Total: 3'>                System.err.println(
</span>"RHINO USAGE WARNING: onExit terminated with exception");
<span class='nc' id='L2958' title='0|0|0 - Total: 3'>                ex.printStackTrace(System.err);
</span><span class='nc' id='L2959' title='0|0|0 - Total: 1'>            }
</span>        }
<span class='bc' id='L2961' title='0|1|1 - Total: 1'>    }
</span>
    private static void setCallResult(CallFrame frame,
                                      Object callResult,
                                      double callResultDbl)
    {
<span class='bc' id='L2967' title='0|2|2 - Total: 2'>        if (frame.savedCallOp == Token.CALL) {
</span><span class='bc' id='L2968' title='0|6|6 - Total: 6'>            frame.stack[frame.savedStackTop] = callResult;
</span><span class='bc' id='L2969' title='0|7|7 - Total: 7'>            frame.sDbl[frame.savedStackTop] = callResultDbl;
</span><span class='bpc' id='L2970' title='0|1|1 - Total: 2'>        } else if (frame.savedCallOp == Token.NEW) {
</span>            // If construct returns scriptable,
            // then it replaces on stack top saved original instance
            // of the object.
<span class='bc' id='L2974' title='0|2|2 - Total: 2'>            if (callResult instanceof Scriptable) {
</span><span class='bc' id='L2975' title='0|7|7 - Total: 7'>                frame.stack[frame.savedStackTop] = callResult;
</span>            }
        } else {
<span class='nc' id='L2978' title='0|0|0 - Total: 2'>            Kit.codeBug();
</span>        }
<span class='bc' id='L2980' title='0|3|3 - Total: 3'>        frame.savedCallOp = 0;
</span><span class='bc' id='L2981' title='0|1|1 - Total: 1'>    }
</span>
    public static NativeContinuation captureContinuation(Context cx) {
<span class='bpc' id='L2984' title='0|2|2 - Total: 4'>        if (cx.lastInterpreterFrame == null ||
</span>            !(cx.lastInterpreterFrame instanceof CallFrame))
        {
<span class='nc' id='L2987' title='0|0|0 - Total: 5'>            throw new IllegalStateException("Interpreter frames not found");
</span>        }
<span class='bc' id='L2989' title='0|7|7 - Total: 7'>        return captureContinuation(cx, (CallFrame)cx.lastInterpreterFrame, true);
</span>    }

    private static NativeContinuation captureContinuation(Context cx, CallFrame frame,
        boolean requireContinuationsTopFrame)
    {
<span class='bc' id='L2995' title='0|4|4 - Total: 4'>        NativeContinuation c = new NativeContinuation();
</span><span class='bc' id='L2996' title='0|3|3 - Total: 3'>        ScriptRuntime.setObjectProtoAndParent(
</span><span class='bc' id='L2997' title='0|1|1 - Total: 1'>            c, ScriptRuntime.getTopCallScope(cx));
</span>
        // Make sure that all frames are frozen
<span class='bc' id='L3000' title='0|2|2 - Total: 2'>        CallFrame x = frame;
</span><span class='bc' id='L3001' title='0|2|2 - Total: 2'>        CallFrame outermost = frame;
</span><span class='bc' id='L3002' title='0|4|4 - Total: 4'>        while (x != null && !x.frozen) {
</span><span class='bc' id='L3003' title='0|3|3 - Total: 3'>            x.frozen = true;
</span>            // Allow to GC unused stack space
<span class='bc' id='L3005' title='0|2|2 - Total: 2'>            for (int i = x.savedStackTop + 1; i != x.stack.length; ++i) {
</span>                // Allow to GC unused stack space
<span class='bc' id='L3007' title='0|5|5 - Total: 5'>                x.stack[i] = null;
</span><span class='bc' id='L3008' title='0|5|5 - Total: 5'>                x.stackAttributes[i] = ScriptableObject.EMPTY;
</span>            }
<span class='bpc' id='L3010' title='0|1|1 - Total: 2'>            if (x.savedCallOp == Token.CALL) {
</span>                // the call will always overwrite the stack top with the result
<span class='bc' id='L3012' title='0|7|7 - Total: 7'>                x.stack[x.savedStackTop] = null;
</span>            } else {
<span class='nc' id='L3014' title='0|0|0 - Total: 2'>                if (x.savedCallOp != Token.NEW) Kit.codeBug();
</span>                // the new operator uses stack top to store the constructed
                // object so it shall not be cleared: see comments in
                // setCallResult
            }
<span class='bc' id='L3019' title='0|2|2 - Total: 2'>            outermost = x;
</span><span class='bc' id='L3020' title='0|4|4 - Total: 4'>            x = x.parentFrame;
</span>        }

<span class='bc' id='L3023' title='0|2|2 - Total: 2'>        if (requireContinuationsTopFrame) {
</span><span class='bpc' id='L3024' title='0|1|1 - Total: 2'>            while (outermost.parentFrame != null)
</span><span class='nc' id='L3025' title='0|0|0 - Total: 4'>                outermost = outermost.parentFrame;
</span>
<span class='bc' id='L3027' title='0|2|2 - Total: 2'>            if (!outermost.isContinuationsTopFrame) {
</span><span class='bc' id='L3028' title='0|5|5 - Total: 5'>                throw new IllegalStateException("Cannot capture continuation " +
</span>                        "from JavaScript code not called directly by " +
                        "executeScriptWithContinuations or " +
                        "callFunctionWithContinuations");
            }
        }

<span class='bc' id='L3035' title='0|3|3 - Total: 3'>        c.initImplementation(frame);
</span><span class='bc' id='L3036' title='0|2|2 - Total: 2'>        return c;
</span>    }

    private static int stack_int32(CallFrame frame, int i)
    {
<span class='bc' id='L3041' title='0|5|5 - Total: 5'>        Object x = frame.stack[i];
</span><span class='bc' id='L3042' title='0|2|2 - Total: 2'>        if (x == UniqueTag.DOUBLE_MARK) {
</span><span class='bc' id='L3043' title='0|6|6 - Total: 6'>            return ScriptRuntime.toInt32(frame.sDbl[i]);
</span>        } else {
<span class='bc' id='L3045' title='0|3|3 - Total: 3'>            return ScriptRuntime.toInt32(x);
</span>        }
    }

    private static double stack_double(CallFrame frame, int i)
    {
<span class='bc' id='L3051' title='0|5|5 - Total: 5'>        Object x = frame.stack[i];
</span><span class='bc' id='L3052' title='0|2|2 - Total: 2'>        if (x != UniqueTag.DOUBLE_MARK) {
</span><span class='bc' id='L3053' title='0|3|3 - Total: 3'>            return ScriptRuntime.toNumber(x);
</span>        } else {
<span class='bc' id='L3055' title='0|5|5 - Total: 5'>            return frame.sDbl[i];
</span>        }
    }

    private static boolean stack_boolean(CallFrame frame, int i)
    {
<span class='bc' id='L3061' title='0|5|5 - Total: 5'>        Object x = frame.stack[i];
</span><span class='bc' id='L3062' title='0|2|2 - Total: 2'>        if (x == Boolean.TRUE) {
</span><span class='bc' id='L3063' title='0|2|2 - Total: 2'>            return true;
</span><span class='bc' id='L3064' title='0|2|2 - Total: 2'>        } else if (x == Boolean.FALSE) {
</span><span class='bc' id='L3065' title='0|2|2 - Total: 2'>            return false;
</span><span class='bc' id='L3066' title='0|2|2 - Total: 2'>        } else if (x == UniqueTag.DOUBLE_MARK) {
</span><span class='bc' id='L3067' title='0|5|5 - Total: 5'>            double d = frame.sDbl[i];
</span><span class='bc' id='L3068' title='0|4|4 - Total: 4'>            return d == d && d != 0.0;
</span><span class='bc' id='L3069' title='0|4|4 - Total: 4'>        } else if (x == null || x == Undefined.instance) {
</span><span class='bc' id='L3070' title='0|2|2 - Total: 2'>            return false;
</span><span class='bc' id='L3071' title='0|2|2 - Total: 2'>        } else if (x instanceof Number) {
</span><span class='bc' id='L3072' title='0|4|4 - Total: 4'>            double d = ((Number)x).doubleValue();
</span><span class='bc' id='L3073' title='0|4|4 - Total: 4'>            return (d == d && d != 0.0);
</span><span class='bc' id='L3074' title='0|2|2 - Total: 2'>        } else if (x instanceof Boolean) {
</span><span class='bc' id='L3075' title='0|4|4 - Total: 4'>            return ((Boolean)x).booleanValue();
</span>        } else {
<span class='bc' id='L3077' title='0|3|3 - Total: 3'>            return ScriptRuntime.toBoolean(x);
</span>        }
    }

    private static void doAdd(Object[] stack, double[] sDbl, int stackTop,
                              Context cx)
    {
<span class='bc' id='L3084' title='0|6|6 - Total: 6'>        Object rhs = stack[stackTop + 1];
</span><span class='bc' id='L3085' title='0|4|4 - Total: 4'>        Object lhs = stack[stackTop];
</span>        double d;
        boolean leftRightOrder;
<span class='bc' id='L3088' title='0|2|2 - Total: 2'>        if (rhs == DOUBLE_MARK) {
</span><span class='bc' id='L3089' title='0|6|6 - Total: 6'>            d = sDbl[stackTop + 1];
</span><span class='bc' id='L3090' title='0|2|2 - Total: 2'>            if (lhs == DOUBLE_MARK) {
</span><span class='bc' id='L3091' title='0|7|7 - Total: 7'>                sDbl[stackTop] += d;
</span><span class='bc' id='L3092' title='0|1|1 - Total: 1'>                return;
</span>            }
<span class='bc' id='L3094' title='0|3|3 - Total: 3'>            leftRightOrder = true;
</span>            // fallthrough to object + number code
<span class='bc' id='L3096' title='0|2|2 - Total: 2'>        } else if (lhs == DOUBLE_MARK) {
</span><span class='bc' id='L3097' title='0|4|4 - Total: 4'>            d = sDbl[stackTop];
</span><span class='bc' id='L3098' title='0|2|2 - Total: 2'>            lhs = rhs;
</span><span class='bc' id='L3099' title='0|3|3 - Total: 3'>            leftRightOrder = false;
</span>            // fallthrough to object + number code
        } else {
<span class='bc' id='L3102' title='0|4|4 - Total: 4'>            if (lhs instanceof Scriptable || rhs instanceof Scriptable) {
</span><span class='bc' id='L3103' title='0|8|8 - Total: 8'>                stack[stackTop] = ScriptRuntime.add(lhs, rhs, cx);
</span><span class='bc' id='L3104' title='0|4|4 - Total: 4'>            } else if (lhs instanceof CharSequence || rhs instanceof CharSequence) {
</span><span class='bc' id='L3105' title='0|3|3 - Total: 3'>                CharSequence lstr = ScriptRuntime.toCharSequence(lhs);
</span><span class='bc' id='L3106' title='0|3|3 - Total: 3'>                CharSequence rstr = ScriptRuntime.toCharSequence(rhs);
</span><span class='bc' id='L3107' title='0|8|8 - Total: 8'>                stack[stackTop] = new ConsString(lstr, rstr);
</span><span class='bc' id='L3108' title='0|1|1 - Total: 1'>            } else {
</span><span class='bc' id='L3109' title='0|2|2 - Total: 2'>                double lDbl = (lhs instanceof Number)
</span><span class='bc' id='L3110' title='0|5|5 - Total: 5'>                    ? ((Number)lhs).doubleValue() : ScriptRuntime.toNumber(lhs);
</span><span class='bc' id='L3111' title='0|2|2 - Total: 2'>                double rDbl = (rhs instanceof Number)
</span><span class='bc' id='L3112' title='0|5|5 - Total: 5'>                    ? ((Number)rhs).doubleValue() : ScriptRuntime.toNumber(rhs);
</span><span class='bc' id='L3113' title='0|4|4 - Total: 4'>                stack[stackTop] = DOUBLE_MARK;
</span><span class='bc' id='L3114' title='0|6|6 - Total: 6'>                sDbl[stackTop] = lDbl + rDbl;
</span>            }
<span class='bc' id='L3116' title='0|1|1 - Total: 1'>            return;
</span>        }

        // handle object(lhs) + number(d) code
<span class='bc' id='L3120' title='0|2|2 - Total: 2'>        if (lhs instanceof Scriptable) {
</span><span class='bc' id='L3121' title='0|3|3 - Total: 3'>            rhs = ScriptRuntime.wrapNumber(d);
</span><span class='bc' id='L3122' title='0|2|2 - Total: 2'>            if (!leftRightOrder) {
</span><span class='bc' id='L3123' title='0|2|2 - Total: 2'>                Object tmp = lhs;
</span><span class='bc' id='L3124' title='0|2|2 - Total: 2'>                lhs = rhs;
</span><span class='bc' id='L3125' title='0|2|2 - Total: 2'>                rhs = tmp;
</span>            }
<span class='bc' id='L3127' title='0|8|8 - Total: 8'>            stack[stackTop] = ScriptRuntime.add(lhs, rhs, cx);
</span><span class='bc' id='L3128' title='0|2|2 - Total: 2'>        } else if (lhs instanceof CharSequence) {
</span><span class='bc' id='L3129' title='0|3|3 - Total: 3'>            CharSequence lstr = (CharSequence)lhs;
</span><span class='bc' id='L3130' title='0|4|4 - Total: 4'>            CharSequence rstr = ScriptRuntime.toCharSequence(d);
</span><span class='bc' id='L3131' title='0|2|2 - Total: 2'>            if (leftRightOrder) {
</span><span class='bc' id='L3132' title='0|9|9 - Total: 9'>                stack[stackTop] = new ConsString(lstr, rstr);
</span>            } else {
<span class='bc' id='L3134' title='0|8|8 - Total: 8'>                stack[stackTop] = new ConsString(rstr, lstr);
</span>            }
<span class='bc' id='L3136' title='0|1|1 - Total: 1'>        } else {
</span><span class='bc' id='L3137' title='0|2|2 - Total: 2'>            double lDbl = (lhs instanceof Number)
</span><span class='bc' id='L3138' title='0|5|5 - Total: 5'>                ? ((Number)lhs).doubleValue() : ScriptRuntime.toNumber(lhs);
</span><span class='bc' id='L3139' title='0|4|4 - Total: 4'>            stack[stackTop] = DOUBLE_MARK;
</span><span class='bc' id='L3140' title='0|6|6 - Total: 6'>            sDbl[stackTop] = lDbl + d;
</span>        }
<span class='bc' id='L3142' title='0|1|1 - Total: 1'>    }
</span>
    private static int doArithmetic(CallFrame frame, int op, Object[] stack,
                                    double[] sDbl, int stackTop) {
<span class='bc' id='L3146' title='0|4|4 - Total: 4'>        double rDbl = stack_double(frame, stackTop);
</span><span class='bc' id='L3147' title='0|1|1 - Total: 1'>        --stackTop;
</span><span class='bc' id='L3148' title='0|4|4 - Total: 4'>        double lDbl = stack_double(frame, stackTop);
</span><span class='bc' id='L3149' title='0|4|4 - Total: 4'>        stack[stackTop] = DOUBLE_MARK;
</span><span class='bpc' id='L3150' title='0|4|4 - Total: 5'>        switch (op) {
</span>          case Token.SUB:
<span class='bc' id='L3152' title='0|4|4 - Total: 4'>            lDbl -= rDbl;
</span><span class='bc' id='L3153' title='0|1|1 - Total: 1'>            break;
</span>          case Token.MUL:
<span class='bc' id='L3155' title='0|4|4 - Total: 4'>            lDbl *= rDbl;
</span><span class='bc' id='L3156' title='0|1|1 - Total: 1'>            break;
</span>          case Token.DIV:
<span class='bc' id='L3158' title='0|4|4 - Total: 4'>            lDbl /= rDbl;
</span><span class='bc' id='L3159' title='0|1|1 - Total: 1'>            break;
</span>          case Token.MOD:
<span class='bc' id='L3161' title='0|4|4 - Total: 4'>            lDbl %= rDbl;
</span>            break;
        }
<span class='bc' id='L3164' title='0|4|4 - Total: 4'>        sDbl[stackTop] = lDbl;
</span><span class='bc' id='L3165' title='0|2|2 - Total: 2'>        return stackTop;
</span>    }

    private static Object[] getArgsArray(Object[] stack, double[] sDbl,
                                         int shift, int count)
    {
<span class='bc' id='L3171' title='0|2|2 - Total: 2'>        if (count == 0) {
</span><span class='bc' id='L3172' title='0|2|2 - Total: 2'>            return ScriptRuntime.emptyArgs;
</span>        }
<span class='bc' id='L3174' title='0|3|3 - Total: 3'>        Object[] args = new Object[count];
</span><span class='bc' id='L3175' title='0|2|2 - Total: 2'>        for (int i = 0; i != count; ++i, ++shift) {
</span><span class='bc' id='L3176' title='0|4|4 - Total: 4'>            Object val = stack[shift];
</span><span class='bc' id='L3177' title='0|2|2 - Total: 2'>            if (val == UniqueTag.DOUBLE_MARK) {
</span><span class='bc' id='L3178' title='0|5|5 - Total: 5'>                val = ScriptRuntime.wrapNumber(sDbl[shift]);
</span>            }
<span class='bc' id='L3180' title='0|4|4 - Total: 4'>            args[i] = val;
</span>        }
<span class='bc' id='L3182' title='0|2|2 - Total: 2'>        return args;
</span>    }

    private static void addInstructionCount(Context cx, CallFrame frame,
                                            int extra)
    {
<span class='bc' id='L3188' title='0|12|12 - Total: 12'>        cx.instructionCount += frame.pc - frame.pcPrevBranch + extra;
</span><span class='bc' id='L3189' title='0|2|2 - Total: 2'>        if (cx.instructionCount > cx.instructionThreshold) {
</span><span class='bc' id='L3190' title='0|4|4 - Total: 4'>            cx.observeInstructionCount(cx.instructionCount);
</span><span class='bc' id='L3191' title='0|3|3 - Total: 3'>            cx.instructionCount = 0;
</span>        }
<span class='bc' id='L3193' title='0|1|1 - Total: 1'>    }
</span>}
</pre></body></html><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table>