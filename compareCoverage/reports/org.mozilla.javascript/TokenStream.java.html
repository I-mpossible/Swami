<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml' lang='en'><head><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><title>org.mozilla.javascript.TokenStream.java</title><link rel='stylesheet' href='../.resources/report.css' type='text/css'/><link rel='stylesheet' href='../.resources/prettify.css' type='text/css'/><link rel='stylesheet' href='../.resources/custom.css' type='text/css'/><script type='text/javascript' src='../.resources/prettify.js'></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><h1>org.mozilla.javascript.TokenStream.java</h1><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table><pre class='source lang-java linenums'>/* -*- Mode: java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

package org.mozilla.javascript;

import java.io.*;

/**
 * This class implements the JavaScript scanner.
 *
 * It is based on the C source files jsscan.c and jsscan.h
 * in the jsref package.
 *
 * @see org.mozilla.javascript.Parser
 *
 * @author Mike McCabe
 * @author Brendan Eich
 */

<span class='upc' id='L23' title='1|1|1 - Total: 2'>class TokenStream
</span>{
    /*
     * For chars - because we need something out-of-range
     * to check.  (And checking EOF by exception is annoying.)
     * Note distinction from EOF token type!
     */
    private final static int
        EOF_CHAR = -1;

    private final static char BYTE_ORDER_MARK = '\uFEFF';

    TokenStream(Parser parser, Reader sourceReader, String sourceString,
                int lineno)
<span class='uc' id='L37' title='2|2|2 - Total: 2'>    {
</span><span class='uc' id='L38' title='3|3|3 - Total: 3'>        this.parser = parser;
</span><span class='uc' id='L39' title='3|3|3 - Total: 3'>        this.lineno = lineno;
</span><span class='uc' id='L40' title='2|2|2 - Total: 2'>        if (sourceReader != null) {
</span><span class='upc' id='L41' title='1|1|1 - Total: 2'>            if (sourceString != null) Kit.codeBug();
</span><span class='uc' id='L42' title='3|3|3 - Total: 3'>            this.sourceReader = sourceReader;
</span><span class='uc' id='L43' title='4|4|4 - Total: 4'>            this.sourceBuffer = new char[512];
</span><span class='uc' id='L44' title='4|4|4 - Total: 4'>            this.sourceEnd = 0;
</span>        } else {
<span class='upc' id='L46' title='1|1|1 - Total: 2'>            if (sourceString == null) Kit.codeBug();
</span><span class='uc' id='L47' title='3|3|3 - Total: 3'>            this.sourceString = sourceString;
</span><span class='uc' id='L48' title='4|4|4 - Total: 4'>            this.sourceEnd = sourceString.length();
</span>        }
<span class='uc' id='L50' title='6|6|6 - Total: 6'>        this.sourceCursor = this.cursor = 0;
</span><span class='uc' id='L51' title='1|1|1 - Total: 1'>    }
</span>
    /* This function uses the cached op, string and number fields in
     * TokenStream; if getToken has been called since the passed token
     * was scanned, the op or string printed may be incorrect.
     */
    String tokenToString(int token)
    {
        if (Token.printTrees) {
            String name = Token.name(token);

            switch (token) {
            case Token.STRING:
            case Token.REGEXP:
            case Token.NAME:
                return name + " `" + this.string + "'";

            case Token.NUMBER:
                return "NUMBER " + this.number;
            }

            return name;
        }
<span class='nc' id='L74' title='0|0|0 - Total: 2'>        return "";
</span>    }

    static boolean isKeyword(String s, int version, boolean isStrict)
    {
<span class='uc' id='L79' title='2|2|2 - Total: 2'>        return Token.EOF != stringToKeyword(s, version, isStrict);
</span>    }

    private static int stringToKeyword(String name, int version, boolean isStrict)
    {
<span class='uc' id='L84' title='2|2|2 - Total: 2'>        if (version < Context.VERSION_ES6) {
</span><span class='uc' id='L85' title='3|3|3 - Total: 3'>            return stringToKeywordForJS(name);
</span>        } else {
<span class='uc' id='L87' title='4|4|4 - Total: 4'>            return stringToKeywordForES(name, isStrict);
</span>        }
    }

    /**
     * JavaScript 1.8 and earlier
     */
    private static int stringToKeywordForJS(String name)
    {
// #string_id_map#
// The following assumes that Token.EOF == 0
        final int
<span class='uc' id='L99' title='2|2|2 - Total: 2'>            Id_break         = Token.BREAK,
</span><span class='uc' id='L100' title='2|2|2 - Total: 2'>            Id_case          = Token.CASE,
</span><span class='uc' id='L101' title='2|2|2 - Total: 2'>            Id_continue      = Token.CONTINUE,
</span><span class='uc' id='L102' title='2|2|2 - Total: 2'>            Id_default       = Token.DEFAULT,
</span><span class='uc' id='L103' title='2|2|2 - Total: 2'>            Id_delete        = Token.DELPROP,
</span><span class='uc' id='L104' title='2|2|2 - Total: 2'>            Id_do            = Token.DO,
</span><span class='uc' id='L105' title='2|2|2 - Total: 2'>            Id_else          = Token.ELSE,
</span><span class='uc' id='L106' title='2|2|2 - Total: 2'>            Id_export        = Token.RESERVED,
</span><span class='uc' id='L107' title='2|2|2 - Total: 2'>            Id_false         = Token.FALSE,
</span><span class='uc' id='L108' title='2|2|2 - Total: 2'>            Id_for           = Token.FOR,
</span><span class='uc' id='L109' title='2|2|2 - Total: 2'>            Id_function      = Token.FUNCTION,
</span><span class='uc' id='L110' title='2|2|2 - Total: 2'>            Id_if            = Token.IF,
</span><span class='uc' id='L111' title='2|2|2 - Total: 2'>            Id_in            = Token.IN,
</span><span class='uc' id='L112' title='2|2|2 - Total: 2'>            Id_let           = Token.LET,  // reserved ES5 strict
</span><span class='uc' id='L113' title='2|2|2 - Total: 2'>            Id_new           = Token.NEW,
</span><span class='uc' id='L114' title='2|2|2 - Total: 2'>            Id_null          = Token.NULL,
</span><span class='uc' id='L115' title='2|2|2 - Total: 2'>            Id_return        = Token.RETURN,
</span><span class='uc' id='L116' title='2|2|2 - Total: 2'>            Id_switch        = Token.SWITCH,
</span><span class='uc' id='L117' title='2|2|2 - Total: 2'>            Id_this          = Token.THIS,
</span><span class='uc' id='L118' title='2|2|2 - Total: 2'>            Id_true          = Token.TRUE,
</span><span class='uc' id='L119' title='2|2|2 - Total: 2'>            Id_typeof        = Token.TYPEOF,
</span><span class='uc' id='L120' title='2|2|2 - Total: 2'>            Id_var           = Token.VAR,
</span><span class='uc' id='L121' title='2|2|2 - Total: 2'>            Id_void          = Token.VOID,
</span><span class='uc' id='L122' title='2|2|2 - Total: 2'>            Id_while         = Token.WHILE,
</span><span class='uc' id='L123' title='2|2|2 - Total: 2'>            Id_with          = Token.WITH,
</span><span class='uc' id='L124' title='2|2|2 - Total: 2'>            Id_yield         = Token.YIELD,  // reserved ES5 strict
</span>
            // the following are #ifdef RESERVE_JAVA_KEYWORDS in jsscan.c
<span class='uc' id='L127' title='2|2|2 - Total: 2'>            Id_abstract      = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L128' title='2|2|2 - Total: 2'>            Id_boolean       = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L129' title='2|2|2 - Total: 2'>            Id_byte          = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L130' title='2|2|2 - Total: 2'>            Id_catch         = Token.CATCH,
</span><span class='uc' id='L131' title='2|2|2 - Total: 2'>            Id_char          = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L132' title='2|2|2 - Total: 2'>            Id_class         = Token.RESERVED,
</span><span class='uc' id='L133' title='2|2|2 - Total: 2'>            Id_const         = Token.CONST,     // reserved
</span><span class='uc' id='L134' title='2|2|2 - Total: 2'>            Id_debugger      = Token.DEBUGGER,
</span><span class='uc' id='L135' title='2|2|2 - Total: 2'>            Id_double        = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L136' title='2|2|2 - Total: 2'>            Id_enum          = Token.RESERVED,
</span><span class='uc' id='L137' title='2|2|2 - Total: 2'>            Id_extends       = Token.RESERVED,
</span><span class='uc' id='L138' title='2|2|2 - Total: 2'>            Id_final         = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L139' title='2|2|2 - Total: 2'>            Id_finally       = Token.FINALLY,
</span><span class='uc' id='L140' title='2|2|2 - Total: 2'>            Id_float         = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L141' title='2|2|2 - Total: 2'>            Id_goto          = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L142' title='2|2|2 - Total: 2'>            Id_implements    = Token.RESERVED,  // ES3, ES5 strict
</span><span class='uc' id='L143' title='2|2|2 - Total: 2'>            Id_import        = Token.RESERVED,
</span><span class='uc' id='L144' title='2|2|2 - Total: 2'>            Id_instanceof    = Token.INSTANCEOF,
</span><span class='uc' id='L145' title='2|2|2 - Total: 2'>            Id_int           = Token.RESERVED,  // ES3
</span><span class='uc' id='L146' title='2|2|2 - Total: 2'>            Id_interface     = Token.RESERVED,  // ES3, ES5 strict
</span><span class='uc' id='L147' title='2|2|2 - Total: 2'>            Id_long          = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L148' title='2|2|2 - Total: 2'>            Id_native        = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L149' title='2|2|2 - Total: 2'>            Id_package       = Token.RESERVED,  // ES3, ES5 strict
</span><span class='uc' id='L150' title='2|2|2 - Total: 2'>            Id_private       = Token.RESERVED,  // ES3, ES5 strict
</span><span class='uc' id='L151' title='2|2|2 - Total: 2'>            Id_protected     = Token.RESERVED,  // ES3, ES5 strict
</span><span class='uc' id='L152' title='2|2|2 - Total: 2'>            Id_public        = Token.RESERVED,  // ES3, ES5 strict
</span><span class='uc' id='L153' title='2|2|2 - Total: 2'>            Id_short         = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L154' title='2|2|2 - Total: 2'>            Id_static        = Token.RESERVED,  // ES3, ES5 strict
</span><span class='uc' id='L155' title='2|2|2 - Total: 2'>            Id_super         = Token.RESERVED,
</span><span class='uc' id='L156' title='2|2|2 - Total: 2'>            Id_synchronized  = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L157' title='2|2|2 - Total: 2'>            Id_throw         = Token.THROW,
</span><span class='uc' id='L158' title='2|2|2 - Total: 2'>            Id_throws        = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L159' title='2|2|2 - Total: 2'>            Id_transient     = Token.RESERVED,  // ES3 only
</span><span class='uc' id='L160' title='2|2|2 - Total: 2'>            Id_try           = Token.TRY,
</span><span class='uc' id='L161' title='2|2|2 - Total: 2'>            Id_volatile      = Token.RESERVED;  // ES3 only
</span>
        int id;
<span class='uc' id='L164' title='2|2|2 - Total: 2'>        String s = name;
</span>// #generated# Last update: 2007-04-18 13:53:30 PDT
<span class='uc' id='L166' title='4|4|4 - Total: 4'>        L0: { id = 0; String X = null; int c;
</span><span class='uc' id='L167' title='11|11|11 - Total: 11'>            L: switch (s.length()) {
</span><span class='uc' id='L168' title='4|4|4 - Total: 4'>            case 2: c=s.charAt(1);
</span><span class='uc' id='L169' title='4|4|4 - Total: 4'>                if (c=='f') { if (s.charAt(0)=='i') {id=Id_if; break L0;} }
</span><span class='uc' id='L170' title='4|4|4 - Total: 4'>                else if (c=='n') { if (s.charAt(0)=='i') {id=Id_in; break L0;} }
</span><span class='uc' id='L171' title='4|4|4 - Total: 4'>                else if (c=='o') { if (s.charAt(0)=='d') {id=Id_do; break L0;} }
</span>                break L;
<span class='uc' id='L173' title='7|7|7 - Total: 7'>            case 3: switch (s.charAt(0)) {
</span><span class='upc' id='L174' title='3|3|3 - Total: 4'>                case 'f': if (s.charAt(2)=='r' && s.charAt(1)=='o') {id=Id_for; break L0;} break L;
</span><span class='upc' id='L175' title='3|3|3 - Total: 4'>                case 'i': if (s.charAt(2)=='t' && s.charAt(1)=='n') {id=Id_int; break L0;} break L;
</span><span class='upc' id='L176' title='3|3|3 - Total: 4'>                case 'l': if (s.charAt(2)=='t' && s.charAt(1)=='e') {id=Id_let; break L0;} break L;
</span><span class='uc' id='L177' title='4|4|4 - Total: 4'>                case 'n': if (s.charAt(2)=='w' && s.charAt(1)=='e') {id=Id_new; break L0;} break L;
</span><span class='uc' id='L178' title='4|4|4 - Total: 4'>                case 't': if (s.charAt(2)=='y' && s.charAt(1)=='r') {id=Id_try; break L0;} break L;
</span><span class='uc' id='L179' title='4|4|4 - Total: 4'>                case 'v': if (s.charAt(2)=='r' && s.charAt(1)=='a') {id=Id_var; break L0;} break L;
</span><span class='uc' id='L180' title='1|1|1 - Total: 1'>                } break L;
</span><span class='uc' id='L181' title='10|10|10 - Total: 10'>            case 4: switch (s.charAt(0)) {
</span><span class='uc' id='L182' title='5|5|5 - Total: 5'>                case 'b': X="byte";id=Id_byte; break L;
</span><span class='uc' id='L183' title='4|4|4 - Total: 4'>                case 'c': c=s.charAt(3);
</span><span class='upc' id='L184' title='5|5|5 - Total: 6'>                    if (c=='e') { if (s.charAt(2)=='s' && s.charAt(1)=='a') {id=Id_case; break L0;} }
</span><span class='upc' id='L185' title='3|3|3 - Total: 6'>                    else if (c=='r') { if (s.charAt(2)=='a' && s.charAt(1)=='h') {id=Id_char; break L0;} }
</span>                    break L;
<span class='uc' id='L187' title='4|4|4 - Total: 4'>                case 'e': c=s.charAt(3);
</span><span class='upc' id='L188' title='4|4|4 - Total: 6'>                    if (c=='e') { if (s.charAt(2)=='s' && s.charAt(1)=='l') {id=Id_else; break L0;} }
</span><span class='upc' id='L189' title='5|5|5 - Total: 6'>                    else if (c=='m') { if (s.charAt(2)=='u' && s.charAt(1)=='n') {id=Id_enum; break L0;} }
</span>                    break L;
<span class='uc' id='L191' title='5|5|5 - Total: 5'>                case 'g': X="goto";id=Id_goto; break L;
</span><span class='uc' id='L192' title='5|5|5 - Total: 5'>                case 'l': X="long";id=Id_long; break L;
</span><span class='uc' id='L193' title='5|5|5 - Total: 5'>                case 'n': X="null";id=Id_null; break L;
</span><span class='uc' id='L194' title='4|4|4 - Total: 4'>                case 't': c=s.charAt(3);
</span><span class='upc' id='L195' title='5|5|5 - Total: 6'>                    if (c=='e') { if (s.charAt(2)=='u' && s.charAt(1)=='r') {id=Id_true; break L0;} }
</span><span class='upc' id='L196' title='4|4|4 - Total: 6'>                    else if (c=='s') { if (s.charAt(2)=='i' && s.charAt(1)=='h') {id=Id_this; break L0;} }
</span>                    break L;
<span class='uc' id='L198' title='5|5|5 - Total: 5'>                case 'v': X="void";id=Id_void; break L;
</span><span class='uc' id='L199' title='5|5|5 - Total: 5'>                case 'w': X="with";id=Id_with; break L;
</span><span class='uc' id='L200' title='1|1|1 - Total: 1'>                } break L;
</span><span class='uc' id='L201' title='10|10|10 - Total: 10'>            case 5: switch (s.charAt(2)) {
</span><span class='uc' id='L202' title='5|5|5 - Total: 5'>                case 'a': X="class";id=Id_class; break L;
</span><span class='uc' id='L203' title='4|4|4 - Total: 4'>                case 'e': c=s.charAt(0);
</span><span class='uc' id='L204' title='2|2|2 - Total: 2'>                    if (c=='b') { X="break";id=Id_break; }
</span><span class='uc' id='L205' title='2|2|2 - Total: 2'>                    else if (c=='y') { X="yield";id=Id_yield; }
</span>                    break L;
<span class='uc' id='L207' title='5|5|5 - Total: 5'>                case 'i': X="while";id=Id_while; break L;
</span><span class='uc' id='L208' title='5|5|5 - Total: 5'>                case 'l': X="false";id=Id_false; break L;
</span><span class='uc' id='L209' title='4|4|4 - Total: 4'>                case 'n': c=s.charAt(0);
</span><span class='uc' id='L210' title='2|2|2 - Total: 2'>                    if (c=='c') { X="const";id=Id_const; }
</span><span class='uc' id='L211' title='2|2|2 - Total: 2'>                    else if (c=='f') { X="final";id=Id_final; }
</span>                    break L;
<span class='uc' id='L213' title='4|4|4 - Total: 4'>                case 'o': c=s.charAt(0);
</span><span class='uc' id='L214' title='2|2|2 - Total: 2'>                    if (c=='f') { X="float";id=Id_float; }
</span><span class='uc' id='L215' title='2|2|2 - Total: 2'>                    else if (c=='s') { X="short";id=Id_short; }
</span>                    break L;
<span class='uc' id='L217' title='5|5|5 - Total: 5'>                case 'p': X="super";id=Id_super; break L;
</span><span class='uc' id='L218' title='5|5|5 - Total: 5'>                case 'r': X="throw";id=Id_throw; break L;
</span><span class='uc' id='L219' title='5|5|5 - Total: 5'>                case 't': X="catch";id=Id_catch; break L;
</span><span class='uc' id='L220' title='1|1|1 - Total: 1'>                } break L;
</span><span class='uc' id='L221' title='11|11|11 - Total: 11'>            case 6: switch (s.charAt(1)) {
</span><span class='uc' id='L222' title='5|5|5 - Total: 5'>                case 'a': X="native";id=Id_native; break L;
</span><span class='uc' id='L223' title='4|4|4 - Total: 4'>                case 'e': c=s.charAt(0);
</span><span class='uc' id='L224' title='2|2|2 - Total: 2'>                    if (c=='d') { X="delete";id=Id_delete; }
</span><span class='uc' id='L225' title='2|2|2 - Total: 2'>                    else if (c=='r') { X="return";id=Id_return; }
</span>                    break L;
<span class='uc' id='L227' title='5|5|5 - Total: 5'>                case 'h': X="throws";id=Id_throws; break L;
</span><span class='uc' id='L228' title='5|5|5 - Total: 5'>                case 'm': X="import";id=Id_import; break L;
</span><span class='uc' id='L229' title='5|5|5 - Total: 5'>                case 'o': X="double";id=Id_double; break L;
</span><span class='uc' id='L230' title='5|5|5 - Total: 5'>                case 't': X="static";id=Id_static; break L;
</span><span class='uc' id='L231' title='5|5|5 - Total: 5'>                case 'u': X="public";id=Id_public; break L;
</span><span class='uc' id='L232' title='5|5|5 - Total: 5'>                case 'w': X="switch";id=Id_switch; break L;
</span><span class='uc' id='L233' title='5|5|5 - Total: 5'>                case 'x': X="export";id=Id_export; break L;
</span><span class='uc' id='L234' title='5|5|5 - Total: 5'>                case 'y': X="typeof";id=Id_typeof; break L;
</span><span class='uc' id='L235' title='1|1|1 - Total: 1'>                } break L;
</span><span class='uc' id='L236' title='7|7|7 - Total: 7'>            case 7: switch (s.charAt(1)) {
</span><span class='uc' id='L237' title='5|5|5 - Total: 5'>                case 'a': X="package";id=Id_package; break L;
</span><span class='uc' id='L238' title='5|5|5 - Total: 5'>                case 'e': X="default";id=Id_default; break L;
</span><span class='uc' id='L239' title='5|5|5 - Total: 5'>                case 'i': X="finally";id=Id_finally; break L;
</span><span class='uc' id='L240' title='5|5|5 - Total: 5'>                case 'o': X="boolean";id=Id_boolean; break L;
</span><span class='uc' id='L241' title='5|5|5 - Total: 5'>                case 'r': X="private";id=Id_private; break L;
</span><span class='uc' id='L242' title='5|5|5 - Total: 5'>                case 'x': X="extends";id=Id_extends; break L;
</span><span class='uc' id='L243' title='1|1|1 - Total: 1'>                } break L;
</span><span class='uc' id='L244' title='6|6|6 - Total: 6'>            case 8: switch (s.charAt(0)) {
</span><span class='uc' id='L245' title='5|5|5 - Total: 5'>                case 'a': X="abstract";id=Id_abstract; break L;
</span><span class='uc' id='L246' title='5|5|5 - Total: 5'>                case 'c': X="continue";id=Id_continue; break L;
</span><span class='uc' id='L247' title='5|5|5 - Total: 5'>                case 'd': X="debugger";id=Id_debugger; break L;
</span><span class='uc' id='L248' title='5|5|5 - Total: 5'>                case 'f': X="function";id=Id_function; break L;
</span><span class='uc' id='L249' title='5|5|5 - Total: 5'>                case 'v': X="volatile";id=Id_volatile; break L;
</span><span class='uc' id='L250' title='1|1|1 - Total: 1'>                } break L;
</span><span class='uc' id='L251' title='4|4|4 - Total: 4'>            case 9: c=s.charAt(0);
</span><span class='uc' id='L252' title='2|2|2 - Total: 2'>                if (c=='i') { X="interface";id=Id_interface; }
</span><span class='uc' id='L253' title='2|2|2 - Total: 2'>                else if (c=='p') { X="protected";id=Id_protected; }
</span><span class='uc' id='L254' title='2|2|2 - Total: 2'>                else if (c=='t') { X="transient";id=Id_transient; }
</span>                break L;
<span class='uc' id='L256' title='4|4|4 - Total: 4'>            case 10: c=s.charAt(1);
</span><span class='uc' id='L257' title='2|2|2 - Total: 2'>                if (c=='m') { X="implements";id=Id_implements; }
</span><span class='uc' id='L258' title='2|2|2 - Total: 2'>                else if (c=='n') { X="instanceof";id=Id_instanceof; }
</span>                break L;
<span class='uc' id='L260' title='5|5|5 - Total: 5'>            case 12: X="synchronized";id=Id_synchronized; break L;
</span>            }
<span class='upc' id='L262' title='5|5|5 - Total: 6'>            if (X!=null && X!=s && !X.equals(s)) id = 0;
</span>        }
// #/generated#
// #/string_id_map#
<span class='uc' id='L266' title='2|2|2 - Total: 2'>        if (id == 0) { return Token.EOF; }
</span><span class='uc' id='L267' title='4|4|4 - Total: 4'>        return id & 0xff;
</span>    }

    /**
     * ECMAScript 6.
     */
    private static int stringToKeywordForES(String name, boolean isStrict)
    {
// #string_id_map#
// The following assumes that Token.EOF == 0
        final int
            // 11.6.2.1 Keywords (ECMAScript2015)
<span class='uc' id='L279' title='2|2|2 - Total: 2'>            Id_break         = Token.BREAK,
</span><span class='uc' id='L280' title='2|2|2 - Total: 2'>            Id_case          = Token.CASE,
</span><span class='uc' id='L281' title='2|2|2 - Total: 2'>            Id_catch         = Token.CATCH,
</span><span class='uc' id='L282' title='2|2|2 - Total: 2'>            Id_class         = Token.RESERVED,
</span><span class='uc' id='L283' title='2|2|2 - Total: 2'>            Id_const         = Token.CONST,
</span><span class='uc' id='L284' title='2|2|2 - Total: 2'>            Id_continue      = Token.CONTINUE,
</span><span class='uc' id='L285' title='2|2|2 - Total: 2'>            Id_debugger      = Token.DEBUGGER,
</span><span class='uc' id='L286' title='2|2|2 - Total: 2'>            Id_default       = Token.DEFAULT,
</span><span class='uc' id='L287' title='2|2|2 - Total: 2'>            Id_delete        = Token.DELPROP,
</span><span class='uc' id='L288' title='2|2|2 - Total: 2'>            Id_do            = Token.DO,
</span><span class='uc' id='L289' title='2|2|2 - Total: 2'>            Id_else          = Token.ELSE,
</span><span class='uc' id='L290' title='2|2|2 - Total: 2'>            Id_export        = Token.RESERVED,
</span><span class='uc' id='L291' title='2|2|2 - Total: 2'>            Id_extends       = Token.RESERVED,
</span><span class='uc' id='L292' title='2|2|2 - Total: 2'>            Id_finally       = Token.FINALLY,
</span><span class='uc' id='L293' title='2|2|2 - Total: 2'>            Id_for           = Token.FOR,
</span><span class='uc' id='L294' title='2|2|2 - Total: 2'>            Id_function      = Token.FUNCTION,
</span><span class='uc' id='L295' title='2|2|2 - Total: 2'>            Id_if            = Token.IF,
</span><span class='uc' id='L296' title='2|2|2 - Total: 2'>            Id_import        = Token.RESERVED,
</span><span class='uc' id='L297' title='2|2|2 - Total: 2'>            Id_in            = Token.IN,
</span><span class='uc' id='L298' title='2|2|2 - Total: 2'>            Id_instanceof    = Token.INSTANCEOF,
</span><span class='uc' id='L299' title='2|2|2 - Total: 2'>            Id_new           = Token.NEW,
</span><span class='uc' id='L300' title='2|2|2 - Total: 2'>            Id_return        = Token.RETURN,
</span><span class='uc' id='L301' title='2|2|2 - Total: 2'>            Id_super         = Token.RESERVED,
</span><span class='uc' id='L302' title='2|2|2 - Total: 2'>            Id_switch        = Token.SWITCH,
</span><span class='uc' id='L303' title='2|2|2 - Total: 2'>            Id_this          = Token.THIS,
</span><span class='uc' id='L304' title='2|2|2 - Total: 2'>            Id_throw         = Token.THROW,
</span><span class='uc' id='L305' title='2|2|2 - Total: 2'>            Id_try           = Token.TRY,
</span><span class='uc' id='L306' title='2|2|2 - Total: 2'>            Id_typeof        = Token.TYPEOF,
</span><span class='uc' id='L307' title='2|2|2 - Total: 2'>            Id_var           = Token.VAR,
</span><span class='uc' id='L308' title='2|2|2 - Total: 2'>            Id_void          = Token.VOID,
</span><span class='uc' id='L309' title='2|2|2 - Total: 2'>            Id_while         = Token.WHILE,
</span><span class='uc' id='L310' title='2|2|2 - Total: 2'>            Id_with          = Token.WITH,
</span><span class='uc' id='L311' title='2|2|2 - Total: 2'>            Id_yield         = Token.YIELD,
</span>
            // 11.6.2.2 Future Reserved Words
<span class='uc' id='L314' title='2|2|2 - Total: 2'>            Id_await         = Token.RESERVED,
</span><span class='uc' id='L315' title='2|2|2 - Total: 2'>            Id_enum          = Token.RESERVED,
</span>
            // 11.6.2.2 NOTE Strict Future Reserved Words
<span class='uc' id='L318' title='2|2|2 - Total: 2'>            Id_implements    = Token.RESERVED,
</span><span class='uc' id='L319' title='2|2|2 - Total: 2'>            Id_interface     = Token.RESERVED,
</span><span class='uc' id='L320' title='2|2|2 - Total: 2'>            Id_package       = Token.RESERVED,
</span><span class='uc' id='L321' title='2|2|2 - Total: 2'>            Id_private       = Token.RESERVED,
</span><span class='uc' id='L322' title='2|2|2 - Total: 2'>            Id_protected     = Token.RESERVED,
</span><span class='uc' id='L323' title='2|2|2 - Total: 2'>            Id_public        = Token.RESERVED,
</span>
            // 11.8 Literals
<span class='uc' id='L326' title='2|2|2 - Total: 2'>            Id_false         = Token.FALSE,
</span><span class='uc' id='L327' title='2|2|2 - Total: 2'>            Id_null          = Token.NULL,
</span><span class='uc' id='L328' title='2|2|2 - Total: 2'>            Id_true          = Token.TRUE,
</span>
            // Non ReservedWord, but Non IdentifierName in strict mode code.
            // 12.1.1 Static Semantics: Early Errors
<span class='uc' id='L332' title='2|2|2 - Total: 2'>            Id_let           = Token.LET,   // TODO : Valid IdentifierName in non-strict mode.
</span><span class='uc' id='L333' title='2|2|2 - Total: 2'>            Id_static        = Token.RESERVED; 
</span>
        int id;
<span class='uc' id='L336' title='2|2|2 - Total: 2'>        String s = name;
</span>// #generated# Last update: 2007-04-18 13:53:30 PDT
<span class='uc' id='L338' title='4|4|4 - Total: 4'>        L0: { id = 0; String X = null; int c;
</span><span class='uc' id='L339' title='10|10|10 - Total: 10'>            L: switch (s.length()) {
</span><span class='uc' id='L340' title='4|4|4 - Total: 4'>            case 2: c=s.charAt(1);
</span><span class='uc' id='L341' title='4|4|4 - Total: 4'>                if (c=='f') { if (s.charAt(0)=='i') {id=Id_if; break L0;} }
</span><span class='upc' id='L342' title='3|3|3 - Total: 4'>                else if (c=='n') { if (s.charAt(0)=='i') {id=Id_in; break L0;} }
</span><span class='upc' id='L343' title='1|1|1 - Total: 4'>                else if (c=='o') { if (s.charAt(0)=='d') {id=Id_do; break L0;} }
</span>                break L;
<span class='upc' id='L345' title='5|5|5 - Total: 6'>            case 3: switch (s.charAt(0)) {
</span><span class='upc' id='L346' title='3|3|3 - Total: 4'>                case 'f': if (s.charAt(2)=='r' && s.charAt(1)=='o') {id=Id_for; break L0;} break L;
</span><span class='nc' id='L347' title='0|0|0 - Total: 4'>                case 'l': if (s.charAt(2)=='t' && s.charAt(1)=='e') {id=Id_let; break L0;} break L;
</span><span class='upc' id='L348' title='2|2|2 - Total: 4'>                case 'n': if (s.charAt(2)=='w' && s.charAt(1)=='e') {id=Id_new; break L0;} break L;
</span><span class='upc' id='L349' title='3|3|3 - Total: 4'>                case 't': if (s.charAt(2)=='y' && s.charAt(1)=='r') {id=Id_try; break L0;} break L;
</span><span class='upc' id='L350' title='3|3|3 - Total: 4'>                case 'v': if (s.charAt(2)=='r' && s.charAt(1)=='a') {id=Id_var; break L0;} break L;
</span><span class='uc' id='L351' title='1|1|1 - Total: 1'>                } break L;
</span><span class='upc' id='L352' title='5|5|5 - Total: 7'>            case 4: switch (s.charAt(0)) {
</span><span class='uc' id='L353' title='4|4|4 - Total: 4'>                case 'c': c=s.charAt(3);
</span><span class='upc' id='L354' title='5|5|5 - Total: 6'>                    if (c=='e') { if (s.charAt(2)=='s' && s.charAt(1)=='a') {id=Id_case; break L0;} }
</span>                    break L;
<span class='uc' id='L356' title='4|4|4 - Total: 4'>                case 'e': c=s.charAt(3);
</span><span class='upc' id='L357' title='4|4|4 - Total: 6'>                    if (c=='e') { if (s.charAt(2)=='s' && s.charAt(1)=='l') {id=Id_else; break L0;} }
</span><span class='upc' id='L358' title='1|1|1 - Total: 6'>                    else if (c=='m') { if (s.charAt(2)=='u' && s.charAt(1)=='n') {id=Id_enum; break L0;} }
</span>                    break L;
<span class='uc' id='L360' title='5|5|5 - Total: 5'>                case 'n': X="null";id=Id_null; break L;
</span><span class='uc' id='L361' title='4|4|4 - Total: 4'>                case 't': c=s.charAt(3);
</span><span class='upc' id='L362' title='5|5|5 - Total: 6'>                    if (c=='e') { if (s.charAt(2)=='u' && s.charAt(1)=='r') {id=Id_true; break L0;} }
</span><span class='upc' id='L363' title='3|3|3 - Total: 6'>                    else if (c=='s') { if (s.charAt(2)=='i' && s.charAt(1)=='h') {id=Id_this; break L0;} }
</span>                    break L;
<span class='nc' id='L365' title='0|0|0 - Total: 5'>                case 'v': X="void";id=Id_void; break L;
</span><span class='nc' id='L366' title='0|0|0 - Total: 5'>                case 'w': X="with";id=Id_with; break L;
</span><span class='uc' id='L367' title='1|1|1 - Total: 1'>                } break L;
</span><span class='upc' id='L368' title='8|8|8 - Total: 9'>            case 5: switch (s.charAt(2)) {
</span><span class='uc' id='L369' title='4|4|4 - Total: 4'>                case 'a': c=s.charAt(0);
</span><span class='upc' id='L370' title='1|1|1 - Total: 2'>                    if (c=='c') { X="class";id=Id_class; }
</span><span class='upc' id='L371' title='1|1|1 - Total: 2'>                    else if (c=='a') { X="await";id=Id_await; }
</span>                    break L;
<span class='uc' id='L373' title='4|4|4 - Total: 4'>                case 'e': c=s.charAt(0);
</span><span class='upc' id='L374' title='1|1|1 - Total: 2'>                    if (c=='b') { X="break";id=Id_break; }
</span><span class='nc' id='L375' title='0|0|0 - Total: 2'>                    else if (c=='y') { X="yield";id=Id_yield; }
</span>                    break L;
<span class='uc' id='L377' title='5|5|5 - Total: 5'>                case 'i': X="while";id=Id_while; break L;
</span><span class='uc' id='L378' title='5|5|5 - Total: 5'>                case 'l': X="false";id=Id_false; break L;
</span><span class='nc' id='L379' title='0|0|0 - Total: 5'>                case 'n': X="const";id=Id_const; break L;
</span><span class='uc' id='L380' title='5|5|5 - Total: 5'>                case 'p': X="super";id=Id_super; break L;
</span><span class='uc' id='L381' title='5|5|5 - Total: 5'>                case 'r': X="throw";id=Id_throw; break L;
</span><span class='uc' id='L382' title='5|5|5 - Total: 5'>                case 't': X="catch";id=Id_catch; break L;
</span><span class='uc' id='L383' title='1|1|1 - Total: 1'>                } break L;
</span><span class='upc' id='L384' title='6|6|6 - Total: 8'>            case 6: switch (s.charAt(1)) {
</span><span class='uc' id='L385' title='4|4|4 - Total: 4'>                case 'e': c=s.charAt(0);
</span><span class='uc' id='L386' title='2|2|2 - Total: 2'>                    if (c=='d') { X="delete";id=Id_delete; }
</span><span class='uc' id='L387' title='2|2|2 - Total: 2'>                    else if (c=='r') { X="return";id=Id_return; }
</span>                    break L;
<span class='nc' id='L389' title='0|0|0 - Total: 5'>                case 'm': X="import";id=Id_import; break L;
</span><span class='upc' id='L390' title='1|1|1 - Total: 2'>                case 't': if (isStrict) {
</span><span class='nc' id='L391' title='0|0|0 - Total: 5'>                    X="static";id=Id_static; break L;
</span>                }
                // fallthru
<span class='upc' id='L394' title='1|1|1 - Total: 2'>                case 'u': if (isStrict) {
</span><span class='nc' id='L395' title='0|0|0 - Total: 5'>                    X="public";id=Id_public; break L;
</span>                }
                // fallthru
<span class='uc' id='L398' title='5|5|5 - Total: 5'>                case 'w': X="switch";id=Id_switch; break L;
</span><span class='nc' id='L399' title='0|0|0 - Total: 5'>                case 'x': X="export";id=Id_export; break L;
</span><span class='uc' id='L400' title='5|5|5 - Total: 5'>                case 'y': X="typeof";id=Id_typeof; break L;
</span><span class='uc' id='L401' title='1|1|1 - Total: 1'>                } break L;
</span><span class='upc' id='L402' title='3|3|3 - Total: 6'>            case 7: switch (s.charAt(1)) {
</span><span class='upc' id='L403' title='1|1|1 - Total: 2'>                case 'a': if (isStrict) {
</span><span class='nc' id='L404' title='0|0|0 - Total: 5'>                    X="package";id=Id_package; break L;
</span>                }
                // fallthru
<span class='uc' id='L407' title='5|5|5 - Total: 5'>                case 'e': X="default";id=Id_default; break L;
</span><span class='nc' id='L408' title='0|0|0 - Total: 5'>                case 'i': X="finally";id=Id_finally; break L;
</span><span class='nc' id='L409' title='0|0|0 - Total: 2'>                case 'r': if (isStrict) {
</span><span class='nc' id='L410' title='0|0|0 - Total: 5'>                    X="private";id=Id_private; break L;
</span>                }
                // fallthru
<span class='nc' id='L413' title='0|0|0 - Total: 5'>                case 'x': X="extends";id=Id_extends; break L;
</span><span class='uc' id='L414' title='1|1|1 - Total: 1'>                } break L;
</span><span class='upc' id='L415' title='2|2|2 - Total: 4'>            case 8: switch (s.charAt(0)) {
</span><span class='nc' id='L416' title='0|0|0 - Total: 5'>                case 'c': X="continue";id=Id_continue; break L;
</span><span class='nc' id='L417' title='0|0|0 - Total: 5'>                case 'd': X="debugger";id=Id_debugger; break L;
</span><span class='uc' id='L418' title='5|5|5 - Total: 5'>                case 'f': X="function";id=Id_function; break L;
</span><span class='uc' id='L419' title='1|1|1 - Total: 1'>                } break L;
</span><span class='uc' id='L420' title='4|4|4 - Total: 4'>            case 9: c=s.charAt(0);
</span><span class='upc' id='L421' title='1|1|1 - Total: 4'>                if (c=='i' && isStrict) { X="interface";id=Id_interface; }
</span><span class='upc' id='L422' title='3|3|3 - Total: 4'>                else if (c=='p' && isStrict) { X="protected";id=Id_protected; }
</span>                break L;
<span class='uc' id='L424' title='4|4|4 - Total: 4'>            case 10: c=s.charAt(1);
</span><span class='upc' id='L425' title='1|1|1 - Total: 4'>                if (c=='m' && isStrict) { X="implements";id=Id_implements; }
</span><span class='uc' id='L426' title='2|2|2 - Total: 2'>                else if (c=='n') { X="instanceof";id=Id_instanceof; }
</span>                break L;
            }
<span class='upc' id='L429' title='5|5|5 - Total: 6'>            if (X!=null && X!=s && !X.equals(s)) id = 0;
</span>        }
// #/generated#
// #/string_id_map#
<span class='uc' id='L433' title='2|2|2 - Total: 2'>        if (id == 0) { return Token.EOF; }
</span><span class='uc' id='L434' title='4|4|4 - Total: 4'>        return id & 0xff;
</span>    }

<span class='nc' id='L437' title='0|0|0 - Total: 3'>    final String getSourceString() { return sourceString; }
</span>
<span class='uc' id='L439' title='3|3|3 - Total: 3'>    final int getLineno() { return lineno; }
</span>
<span class='uc' id='L441' title='3|3|3 - Total: 3'>    final String getString() { return string; }
</span>
    final char getQuoteChar() {
<span class='uc' id='L444' title='4|4|4 - Total: 4'>        return (char) quoteChar;
</span>    }

<span class='uc' id='L447' title='3|3|3 - Total: 3'>    final double getNumber() { return number; }
</span><span class='uc' id='L448' title='3|3|3 - Total: 3'>    final boolean isNumberBinary() { return isBinary; }
</span><span class='uc' id='L449' title='3|3|3 - Total: 3'>    final boolean isNumberOldOctal() { return isOldOctal; }
</span><span class='uc' id='L450' title='3|3|3 - Total: 3'>    final boolean isNumberOctal() { return isOctal; }
</span><span class='uc' id='L451' title='3|3|3 - Total: 3'>    final boolean isNumberHex() { return isHex; }
</span>
<span class='nc' id='L453' title='0|0|0 - Total: 3'>    final boolean eof() { return hitEOF; }
</span>
    final int getToken() throws IOException
    {
        int c;

    retry:
        for (;;) {
            // Eat whitespace, possibly sensitive to newlines.
            for (;;) {
<span class='uc' id='L463' title='3|3|3 - Total: 3'>                c = getChar();
</span><span class='uc' id='L464' title='2|2|2 - Total: 2'>                if (c == EOF_CHAR) {
</span><span class='uc' id='L465' title='6|6|6 - Total: 6'>                    tokenBeg = cursor - 1;
</span><span class='uc' id='L466' title='4|4|4 - Total: 4'>                    tokenEnd = cursor;
</span><span class='uc' id='L467' title='2|2|2 - Total: 2'>                    return Token.EOF;
</span><span class='uc' id='L468' title='2|2|2 - Total: 2'>                } else if (c == '\n') {
</span><span class='uc' id='L469' title='3|3|3 - Total: 3'>                    dirtyLine = false;
</span><span class='uc' id='L470' title='6|6|6 - Total: 6'>                    tokenBeg = cursor - 1;
</span><span class='uc' id='L471' title='4|4|4 - Total: 4'>                    tokenEnd = cursor;
</span><span class='uc' id='L472' title='2|2|2 - Total: 2'>                    return Token.EOL;
</span><span class='uc' id='L473' title='2|2|2 - Total: 2'>                } else if (!isJSSpace(c)) {
</span><span class='uc' id='L474' title='2|2|2 - Total: 2'>                    if (c != '-') {
</span><span class='uc' id='L475' title='4|4|4 - Total: 4'>                        dirtyLine = true;
</span>                    }
                    break;
                }
            }

            // Assume the token will be 1 char - fixed up below.
<span class='uc' id='L482' title='6|6|6 - Total: 6'>            tokenBeg = cursor - 1;
</span><span class='uc' id='L483' title='4|4|4 - Total: 4'>            tokenEnd = cursor;
</span>
<span class='uc' id='L485' title='2|2|2 - Total: 2'>            if (c == '@') return Token.XMLATTR;
</span>
            // identifier/keyword/instanceof?
            // watch out for starting with a <backslash>
            boolean identifierStart;
<span class='uc' id='L490' title='2|2|2 - Total: 2'>            boolean isUnicodeEscapeStart = false;
</span><span class='uc' id='L491' title='2|2|2 - Total: 2'>            if (c == '\\') {
</span><span class='uc' id='L492' title='3|3|3 - Total: 3'>                c = getChar();
</span><span class='upc' id='L493' title='1|1|1 - Total: 2'>                if (c == 'u') {
</span><span class='uc' id='L494' title='2|2|2 - Total: 2'>                    identifierStart = true;
</span><span class='uc' id='L495' title='2|2|2 - Total: 2'>                    isUnicodeEscapeStart = true;
</span><span class='uc' id='L496' title='4|4|4 - Total: 4'>                    stringBufferTop = 0;
</span>                } else {
<span class='nc' id='L498' title='0|0|0 - Total: 2'>                    identifierStart = false;
</span><span class='nc' id='L499' title='0|0|0 - Total: 3'>                    ungetChar(c);
</span><span class='nc' id='L500' title='0|0|0 - Total: 3'>                    c = '\\';
</span>                }
            } else {
<span class='uc' id='L503' title='4|4|4 - Total: 4'>                identifierStart = Character.isJavaIdentifierStart((char)c);
</span><span class='uc' id='L504' title='2|2|2 - Total: 2'>                if (identifierStart) {
</span><span class='uc' id='L505' title='3|3|3 - Total: 3'>                    stringBufferTop = 0;
</span><span class='uc' id='L506' title='3|3|3 - Total: 3'>                    addToString(c);
</span>                }
            }

<span class='uc' id='L510' title='2|2|2 - Total: 2'>            if (identifierStart) {
</span><span class='uc' id='L511' title='2|2|2 - Total: 2'>                boolean containsEscape = isUnicodeEscapeStart;
</span>                for (;;) {
<span class='uc' id='L513' title='2|2|2 - Total: 2'>                    if (isUnicodeEscapeStart) {
</span>                        // strictly speaking we should probably push-back
                        // all the bad characters if the <backslash>uXXXX
                        // sequence is malformed. But since there isn't a
                        // correct context(is there?) for a bad Unicode
                        // escape sequence in an identifier, we can report
                        // an error here.
<span class='uc' id='L520' title='2|2|2 - Total: 2'>                        int escapeVal = 0;
</span><span class='uc' id='L521' title='2|2|2 - Total: 2'>                        for (int i = 0; i != 4; ++i) {
</span><span class='uc' id='L522' title='3|3|3 - Total: 3'>                            c = getChar();
</span><span class='uc' id='L523' title='4|4|4 - Total: 4'>                            escapeVal = Kit.xDigitToInt(c, escapeVal);
</span>                            // Next check takes care about c < 0 and bad escape
<span class='upc' id='L525' title='1|1|1 - Total: 2'>                            if (escapeVal < 0) { break; }
</span>                        }
<span class='upc' id='L527' title='1|1|1 - Total: 2'>                        if (escapeVal < 0) {
</span><span class='nc' id='L528' title='0|0|0 - Total: 4'>                            parser.addError("msg.invalid.escape");
</span><span class='nc' id='L529' title='0|0|0 - Total: 2'>                            return Token.ERROR;
</span>                        }
<span class='uc' id='L531' title='3|3|3 - Total: 3'>                        addToString(escapeVal);
</span><span class='uc' id='L532' title='2|2|2 - Total: 2'>                        isUnicodeEscapeStart = false;
</span><span class='uc' id='L533' title='1|1|1 - Total: 1'>                    } else {
</span><span class='uc' id='L534' title='3|3|3 - Total: 3'>                        c = getChar();
</span><span class='uc' id='L535' title='2|2|2 - Total: 2'>                        if (c == '\\') {
</span><span class='uc' id='L536' title='3|3|3 - Total: 3'>                            c = getChar();
</span><span class='upc' id='L537' title='1|1|1 - Total: 2'>                            if (c == 'u') {
</span><span class='uc' id='L538' title='2|2|2 - Total: 2'>                                isUnicodeEscapeStart = true;
</span><span class='uc' id='L539' title='3|3|3 - Total: 3'>                                containsEscape = true;
</span>                            } else {
<span class='nc' id='L541' title='0|0|0 - Total: 5'>                                parser.addError("msg.illegal.character", c);
</span><span class='nc' id='L542' title='0|0|0 - Total: 2'>                                return Token.ERROR;
</span>                            }
                        } else {
<span class='uc' id='L545' title='4|4|4 - Total: 4'>                            if (c == EOF_CHAR || c == BYTE_ORDER_MARK
</span><span class='uc' id='L546' title='2|2|2 - Total: 2'>                                || !Character.isJavaIdentifierPart((char)c))
</span>                            {
<span class='uc' id='L548' title='1|1|1 - Total: 1'>                                break;
</span>                            }
<span class='uc' id='L550' title='4|4|4 - Total: 4'>                            addToString(c);
</span>                        }
                    }
                }
<span class='uc' id='L554' title='3|3|3 - Total: 3'>                ungetChar(c);
</span>
<span class='uc' id='L556' title='3|3|3 - Total: 3'>                String str = getStringFromBuffer();
</span><span class='uc' id='L557' title='2|2|2 - Total: 2'>                if (!containsEscape) {
</span>                    // OPT we shouldn't have to make a string (object!) to
                    // check if it's a keyword.

                    // Return the corresponding token if it's a keyword
<span class='uc' id='L562' title='10|10|10 - Total: 10'>                    int result = stringToKeyword(str, parser.compilerEnv.getLanguageVersion(), parser.inUseStrictDirective());
</span><span class='uc' id='L563' title='2|2|2 - Total: 2'>                    if (result != Token.EOF) {
</span><span class='uc' id='L564' title='4|4|4 - Total: 4'>                        if ((result == Token.LET || result == Token.YIELD) &&
</span><span class='uc' id='L565' title='2|2|2 - Total: 2'>                            parser.compilerEnv.getLanguageVersion()
</span>                               < Context.VERSION_1_7)
                        {
                            // LET and YIELD are tokens only in 1.7 and later
<span class='uc' id='L569' title='2|2|2 - Total: 2'>                            string = result == Token.LET ? "let" : "yield";
</span><span class='uc' id='L570' title='2|2|2 - Total: 2'>                            result = Token.NAME;
</span>                        }
                        // Save the string in case we need to use in
                        // object literal definitions.
<span class='uc' id='L574' title='7|7|7 - Total: 7'>                        this.string = (String)allStrings.intern(str);
</span><span class='uc' id='L575' title='2|2|2 - Total: 2'>                        if (result != Token.RESERVED) {
</span><span class='uc' id='L576' title='2|2|2 - Total: 2'>                            return result;
</span><span class='upc' id='L577' title='1|1|1 - Total: 2'>                        } else if (parser.compilerEnv.getLanguageVersion() >= Context.VERSION_ES6) {
</span><span class='nc' id='L578' title='0|0|0 - Total: 2'>                            return result;
</span><span class='uc' id='L579' title='2|2|2 - Total: 2'>                        } else if (!parser.compilerEnv.isReservedKeywordAsIdentifier()) {
</span><span class='uc' id='L580' title='2|2|2 - Total: 2'>                            return result;
</span>                        }
                    }
<span class='uc' id='L583' title='2|2|2 - Total: 2'>                } else if (isKeyword(str, parser.compilerEnv.getLanguageVersion(), parser.inUseStrictDirective())) {
</span>                    // If a string contains unicodes, and converted to a keyword,
                    // we convert the last character back to unicode
<span class='uc' id='L586' title='4|4|4 - Total: 4'>                    str = convertLastCharToHex(str);
</span>                }
<span class='uc' id='L588' title='7|7|7 - Total: 7'>                this.string = (String)allStrings.intern(str);
</span><span class='uc' id='L589' title='2|2|2 - Total: 2'>                return Token.NAME;
</span>            }

            // is it a number?
<span class='uc' id='L593' title='6|6|6 - Total: 6'>            if (isDigit(c) || (c == '.' && isDigit(peekChar()))) {
</span><span class='uc' id='L594' title='3|3|3 - Total: 3'>                stringBufferTop = 0;
</span><span class='uc' id='L595' title='2|2|2 - Total: 2'>                int base = 10;
</span><span class='uc' id='L596' title='12|12|12 - Total: 12'>                isHex = isOldOctal = isOctal = isBinary = false;
</span><span class='uc' id='L597' title='2|2|2 - Total: 2'>                boolean es6 = parser.compilerEnv.getLanguageVersion() >= Context.VERSION_ES6;
</span>
<span class='uc' id='L599' title='2|2|2 - Total: 2'>                if (c == '0') {
</span><span class='uc' id='L600' title='3|3|3 - Total: 3'>                    c = getChar();
</span><span class='uc' id='L601' title='4|4|4 - Total: 4'>                    if (c == 'x' || c == 'X') {
</span><span class='uc' id='L602' title='2|2|2 - Total: 2'>                        base = 16;
</span><span class='uc' id='L603' title='3|3|3 - Total: 3'>                        isHex = true;
</span><span class='uc' id='L604' title='4|4|4 - Total: 4'>                        c = getChar();
</span><span class='upc' id='L605' title='4|4|4 - Total: 6'>                    } else if (es6 && (c == 'o' || c == 'O')) {
</span><span class='nc' id='L606' title='0|0|0 - Total: 2'>                        base = 8;
</span><span class='nc' id='L607' title='0|0|0 - Total: 3'>                        isOctal = true;
</span><span class='nc' id='L608' title='0|0|0 - Total: 4'>                        c = getChar();
</span><span class='upc' id='L609' title='4|4|4 - Total: 6'>                    } else if (es6 && (c == 'b' || c == 'B')) {
</span><span class='nc' id='L610' title='0|0|0 - Total: 2'>                        base = 2;
</span><span class='nc' id='L611' title='0|0|0 - Total: 3'>                        isBinary = true;
</span><span class='nc' id='L612' title='0|0|0 - Total: 4'>                        c = getChar();
</span><span class='uc' id='L613' title='2|2|2 - Total: 2'>                    } else if (isDigit(c)) {
</span><span class='uc' id='L614' title='2|2|2 - Total: 2'>                        base = 8;
</span><span class='uc' id='L615' title='4|4|4 - Total: 4'>                        isOldOctal = true;
</span>                    } else {
<span class='uc' id='L617' title='3|3|3 - Total: 3'>                        addToString('0');
</span>                    }
                }

<span class='uc' id='L621' title='2|2|2 - Total: 2'>                boolean isEmpty = true;
</span><span class='uc' id='L622' title='2|2|2 - Total: 2'>                if (base == 16) {
</span><span class='uc' id='L623' title='2|2|2 - Total: 2'>                    while (0 <= Kit.xDigitToInt(c, 0)) {
</span><span class='uc' id='L624' title='3|3|3 - Total: 3'>                        addToString(c);
</span><span class='uc' id='L625' title='3|3|3 - Total: 3'>                        c = getChar();
</span><span class='uc' id='L626' title='3|3|3 - Total: 3'>                        isEmpty = false;
</span>                    }
                } else {
<span class='uc' id='L629' title='4|4|4 - Total: 4'>                    while ('0' <= c && c <= '9') {
</span><span class='uc' id='L630' title='4|4|4 - Total: 4'>                        if (base == 8 && c >= '8') {
</span><span class='upc' id='L631' title='1|1|1 - Total: 2'>                            if (isOldOctal) {
</span>                                /*
                                 * We permit 08 and 09 as decimal numbers, which
                                 * makes our behavior a superset of the ECMA
                                 * numeric grammar.  We might not always be so
                                 * permissive, so we warn about it.
                                 */
<span class='uc' id='L638' title='2|2|2 - Total: 2'>                                parser.addWarning("msg.bad.octal.literal",
</span>                                                  c == '8' ? "8" : "9");
<span class='uc' id='L640' title='3|3|3 - Total: 3'>                                base = 10;
</span>                            } else {
<span class='nc' id='L642' title='0|0|0 - Total: 4'>                                parser.addError("msg.caught.nfe");
</span><span class='nc' id='L643' title='0|0|0 - Total: 2'>                                return Token.ERROR;
</span>                            }
<span class='upc' id='L645' title='1|1|1 - Total: 4'>                        } else if (base == 2 && c >= '2') {
</span><span class='nc' id='L646' title='0|0|0 - Total: 4'>                            parser.addError("msg.caught.nfe");
</span><span class='nc' id='L647' title='0|0|0 - Total: 2'>                            return Token.ERROR;
</span>                        }
<span class='uc' id='L649' title='3|3|3 - Total: 3'>                        addToString(c);
</span><span class='uc' id='L650' title='3|3|3 - Total: 3'>                        c = getChar();
</span><span class='uc' id='L651' title='3|3|3 - Total: 3'>                        isEmpty = false;
</span>                    }
                }
<span class='upc' id='L654' title='5|5|5 - Total: 8'>                if (isEmpty && (isBinary || isOctal || isHex)) {
</span><span class='nc' id='L655' title='0|0|0 - Total: 4'>                    parser.addError("msg.caught.nfe");
</span><span class='nc' id='L656' title='0|0|0 - Total: 2'>                    return Token.ERROR;
</span>                }

<span class='uc' id='L659' title='2|2|2 - Total: 2'>                boolean isInteger = true;
</span>
<span class='uc' id='L661' title='8|8|8 - Total: 8'>                if (base == 10 && (c == '.' || c == 'e' || c == 'E')) {
</span><span class='uc' id='L662' title='2|2|2 - Total: 2'>                    isInteger = false;
</span><span class='uc' id='L663' title='2|2|2 - Total: 2'>                    if (c == '.') {
</span>                        do {
<span class='uc' id='L665' title='3|3|3 - Total: 3'>                            addToString(c);
</span><span class='uc' id='L666' title='3|3|3 - Total: 3'>                            c = getChar();
</span><span class='uc' id='L667' title='2|2|2 - Total: 2'>                        } while (isDigit(c));
</span>                    }
<span class='uc' id='L669' title='4|4|4 - Total: 4'>                    if (c == 'e' || c == 'E') {
</span><span class='uc' id='L670' title='3|3|3 - Total: 3'>                        addToString(c);
</span><span class='uc' id='L671' title='3|3|3 - Total: 3'>                        c = getChar();
</span><span class='uc' id='L672' title='4|4|4 - Total: 4'>                        if (c == '+' || c == '-') {
</span><span class='uc' id='L673' title='3|3|3 - Total: 3'>                            addToString(c);
</span><span class='uc' id='L674' title='3|3|3 - Total: 3'>                            c = getChar();
</span>                        }
<span class='upc' id='L676' title='1|1|1 - Total: 2'>                        if (!isDigit(c)) {
</span><span class='nc' id='L677' title='0|0|0 - Total: 4'>                            parser.addError("msg.missing.exponent");
</span><span class='nc' id='L678' title='0|0|0 - Total: 2'>                            return Token.ERROR;
</span>                        }
                        do {
<span class='uc' id='L681' title='3|3|3 - Total: 3'>                            addToString(c);
</span><span class='uc' id='L682' title='3|3|3 - Total: 3'>                            c = getChar();
</span><span class='uc' id='L683' title='2|2|2 - Total: 2'>                        } while (isDigit(c));
</span>                    }
                }
<span class='uc' id='L686' title='3|3|3 - Total: 3'>                ungetChar(c);
</span><span class='uc' id='L687' title='3|3|3 - Total: 3'>                String numString = getStringFromBuffer();
</span><span class='uc' id='L688' title='3|3|3 - Total: 3'>                this.string = numString;
</span>
                double dval;
<span class='uc' id='L691' title='4|4|4 - Total: 4'>                if (base == 10 && !isInteger) {
</span>                    try {
                        // Use Java conversion to number from string...
<span class='uc' id='L694' title='3|3|3 - Total: 3'>                        dval = Double.parseDouble(numString);
</span>                    }
<span class='nc' id='L696' title='0|0|0 - Total: 1'>                    catch (NumberFormatException ex) {
</span><span class='nc' id='L697' title='0|0|0 - Total: 4'>                        parser.addError("msg.caught.nfe");
</span><span class='nc' id='L698' title='0|0|0 - Total: 2'>                        return Token.ERROR;
</span><span class='uc' id='L699' title='1|1|1 - Total: 1'>                    }
</span>                } else {
<span class='uc' id='L701' title='5|5|5 - Total: 5'>                    dval = ScriptRuntime.stringPrefixToNumber(numString, 0, base);
</span>                }

<span class='uc' id='L704' title='3|3|3 - Total: 3'>                this.number = dval;
</span><span class='uc' id='L705' title='2|2|2 - Total: 2'>                return Token.NUMBER;
</span>            }

            // is it a string?
<span class='uc' id='L709' title='4|4|4 - Total: 4'>            if (c == '"' || c == '\'') {
</span>                // We attempt to accumulate a string the fast way, by
                // building it directly out of the reader.  But if there
                // are any escaped characters in the string, we revert to
                // building it out of a StringBuffer.

<span class='uc' id='L715' title='3|3|3 - Total: 3'>                quoteChar = c;
</span><span class='uc' id='L716' title='3|3|3 - Total: 3'>                stringBufferTop = 0;
</span>
<span class='uc' id='L718' title='4|4|4 - Total: 4'>                c = getChar(false);
</span><span class='uc' id='L719' title='2|2|2 - Total: 2'>            strLoop: while (c != quoteChar) {
</span><span class='uc' id='L720' title='4|4|4 - Total: 4'>                    if (c == '\n' || c == EOF_CHAR) {
</span><span class='uc' id='L721' title='3|3|3 - Total: 3'>                        ungetChar(c);
</span><span class='uc' id='L722' title='4|4|4 - Total: 4'>                        tokenEnd = cursor;
</span><span class='nc' id='L723' title='0|0|0 - Total: 4'>                        parser.addError("msg.unterminated.string.lit");
</span><span class='nc' id='L724' title='0|0|0 - Total: 2'>                        return Token.ERROR;
</span>                    }

<span class='uc' id='L727' title='2|2|2 - Total: 2'>                    if (c == '\\') {
</span>                        // We've hit an escaped character
                        int escapeVal;

<span class='uc' id='L731' title='3|3|3 - Total: 3'>                        c = getChar();
</span><span class='uc' id='L732' title='10|10|10 - Total: 10'>                        switch (c) {
</span><span class='uc' id='L733' title='3|3|3 - Total: 3'>                        case 'b': c = '\b'; break;
</span><span class='uc' id='L734' title='3|3|3 - Total: 3'>                        case 'f': c = '\f'; break;
</span><span class='uc' id='L735' title='3|3|3 - Total: 3'>                        case 'n': c = '\n'; break;
</span><span class='uc' id='L736' title='3|3|3 - Total: 3'>                        case 'r': c = '\r'; break;
</span><span class='uc' id='L737' title='3|3|3 - Total: 3'>                        case 't': c = '\t'; break;
</span>
                        // \v a late addition to the ECMA spec,
                        // it is not in Java, so use 0xb
<span class='uc' id='L741' title='3|3|3 - Total: 3'>                        case 'v': c = 0xb; break;
</span>
                        case 'u':
                            // Get 4 hex digits; if the u escape is not
                            // followed by 4 hex digits, use 'u' + the
                            // literal character sequence that follows.
<span class='uc' id='L747' title='3|3|3 - Total: 3'>                            int escapeStart = stringBufferTop;
</span><span class='uc' id='L748' title='3|3|3 - Total: 3'>                            addToString('u');
</span><span class='uc' id='L749' title='2|2|2 - Total: 2'>                            escapeVal = 0;
</span><span class='uc' id='L750' title='2|2|2 - Total: 2'>                            for (int i = 0; i != 4; ++i) {
</span><span class='uc' id='L751' title='3|3|3 - Total: 3'>                                c = getChar();
</span><span class='uc' id='L752' title='4|4|4 - Total: 4'>                                escapeVal = Kit.xDigitToInt(c, escapeVal);
</span><span class='uc' id='L753' title='2|2|2 - Total: 2'>                                if (escapeVal < 0) {
</span><span class='uc' id='L754' title='1|1|1 - Total: 1'>                                    continue strLoop;
</span>                                }
<span class='uc' id='L756' title='3|3|3 - Total: 3'>                                addToString(c);
</span>                            }
                            // prepare for replace of stored 'u' sequence
                            // by escape value
<span class='uc' id='L760' title='3|3|3 - Total: 3'>                            stringBufferTop = escapeStart;
</span><span class='uc' id='L761' title='2|2|2 - Total: 2'>                            c = escapeVal;
</span><span class='uc' id='L762' title='1|1|1 - Total: 1'>                            break;
</span>                        case 'x':
                            // Get 2 hex digits, defaulting to 'x'+literal
                            // sequence, as above.
<span class='uc' id='L766' title='3|3|3 - Total: 3'>                            c = getChar();
</span><span class='uc' id='L767' title='4|4|4 - Total: 4'>                            escapeVal = Kit.xDigitToInt(c, 0);
</span><span class='uc' id='L768' title='2|2|2 - Total: 2'>                            if (escapeVal < 0) {
</span><span class='uc' id='L769' title='3|3|3 - Total: 3'>                                addToString('x');
</span><span class='uc' id='L770' title='1|1|1 - Total: 1'>                                continue strLoop;
</span>                            } else {
<span class='uc' id='L772' title='2|2|2 - Total: 2'>                                int c1 = c;
</span><span class='uc' id='L773' title='3|3|3 - Total: 3'>                                c = getChar();
</span><span class='uc' id='L774' title='4|4|4 - Total: 4'>                                escapeVal = Kit.xDigitToInt(c, escapeVal);
</span><span class='uc' id='L775' title='2|2|2 - Total: 2'>                                if (escapeVal < 0) {
</span><span class='uc' id='L776' title='3|3|3 - Total: 3'>                                    addToString('x');
</span><span class='uc' id='L777' title='3|3|3 - Total: 3'>                                    addToString(c1);
</span><span class='uc' id='L778' title='1|1|1 - Total: 1'>                                    continue strLoop;
</span>                                } else {
                                    // got 2 hex digits
<span class='uc' id='L781' title='2|2|2 - Total: 2'>                                    c = escapeVal;
</span>                                }
                            }
<span class='uc' id='L784' title='1|1|1 - Total: 1'>                            break;
</span>
                        case '\n':
                            // Remove line terminator after escape to follow
                            // SpiderMonkey and C/C++
<span class='uc' id='L789' title='3|3|3 - Total: 3'>                            c = getChar();
</span><span class='uc' id='L790' title='1|1|1 - Total: 1'>                            continue strLoop;
</span>
                        default:
<span class='uc' id='L793' title='4|4|4 - Total: 4'>                            if ('0' <= c && c < '8') {
</span><span class='uc' id='L794' title='4|4|4 - Total: 4'>                                int val = c - '0';
</span><span class='uc' id='L795' title='3|3|3 - Total: 3'>                                c = getChar();
</span><span class='uc' id='L796' title='4|4|4 - Total: 4'>                                if ('0' <= c && c < '8') {
</span><span class='uc' id='L797' title='8|8|8 - Total: 8'>                                    val = 8 * val + c - '0';
</span><span class='uc' id='L798' title='3|3|3 - Total: 3'>                                    c = getChar();
</span><span class='uc' id='L799' title='6|6|6 - Total: 6'>                                    if ('0' <= c && c < '8' && val <= 037) {
</span>                                        // c is 3rd char of octal sequence only
                                        // if the resulting val <= 0377
<span class='uc' id='L802' title='8|8|8 - Total: 8'>                                        val = 8 * val + c - '0';
</span><span class='uc' id='L803' title='3|3|3 - Total: 3'>                                        c = getChar();
</span>                                    }
                                }
<span class='uc' id='L806' title='3|3|3 - Total: 3'>                                ungetChar(c);
</span><span class='uc' id='L807' title='2|2|2 - Total: 2'>                                c = val;
</span>                            }
                        }
                    }
<span class='uc' id='L811' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L812' title='5|5|5 - Total: 5'>                    c = getChar(false);
</span>                }

<span class='uc' id='L815' title='3|3|3 - Total: 3'>                String str = getStringFromBuffer();
</span><span class='uc' id='L816' title='7|7|7 - Total: 7'>                this.string = (String)allStrings.intern(str);
</span><span class='uc' id='L817' title='2|2|2 - Total: 2'>                return Token.STRING;
</span>            }

<span class='upc' id='L820' title='24|24|24 - Total: 25'>            switch (c) {
</span><span class='uc' id='L821' title='2|2|2 - Total: 2'>            case ';': return Token.SEMI;
</span><span class='uc' id='L822' title='2|2|2 - Total: 2'>            case '[': return Token.LB;
</span><span class='uc' id='L823' title='2|2|2 - Total: 2'>            case ']': return Token.RB;
</span><span class='uc' id='L824' title='2|2|2 - Total: 2'>            case '{': return Token.LC;
</span><span class='uc' id='L825' title='2|2|2 - Total: 2'>            case '}': return Token.RC;
</span><span class='uc' id='L826' title='2|2|2 - Total: 2'>            case '(': return Token.LP;
</span><span class='uc' id='L827' title='2|2|2 - Total: 2'>            case ')': return Token.RP;
</span><span class='uc' id='L828' title='2|2|2 - Total: 2'>            case ',': return Token.COMMA;
</span><span class='uc' id='L829' title='2|2|2 - Total: 2'>            case '?': return Token.HOOK;
</span>            case ':':
<span class='uc' id='L831' title='2|2|2 - Total: 2'>                if (matchChar(':')) {
</span><span class='uc' id='L832' title='2|2|2 - Total: 2'>                    return Token.COLONCOLON;
</span>                } else {
<span class='uc' id='L834' title='2|2|2 - Total: 2'>                    return Token.COLON;
</span>                }
            case '.':
<span class='uc' id='L837' title='2|2|2 - Total: 2'>                if (matchChar('.')) {
</span><span class='uc' id='L838' title='2|2|2 - Total: 2'>                    return Token.DOTDOT;
</span><span class='uc' id='L839' title='2|2|2 - Total: 2'>                } else if (matchChar('(')) {
</span><span class='uc' id='L840' title='2|2|2 - Total: 2'>                    return Token.DOTQUERY;
</span>                } else {
<span class='uc' id='L842' title='2|2|2 - Total: 2'>                    return Token.DOT;
</span>                }

            case '|':
<span class='uc' id='L846' title='2|2|2 - Total: 2'>                if (matchChar('|')) {
</span><span class='uc' id='L847' title='2|2|2 - Total: 2'>                    return Token.OR;
</span><span class='uc' id='L848' title='2|2|2 - Total: 2'>                } else if (matchChar('=')) {
</span><span class='uc' id='L849' title='2|2|2 - Total: 2'>                    return Token.ASSIGN_BITOR;
</span>                } else {
<span class='uc' id='L851' title='2|2|2 - Total: 2'>                    return Token.BITOR;
</span>                }

            case '^':
<span class='uc' id='L855' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L856' title='2|2|2 - Total: 2'>                    return Token.ASSIGN_BITXOR;
</span>                } else {
<span class='uc' id='L858' title='2|2|2 - Total: 2'>                    return Token.BITXOR;
</span>                }

            case '&':
<span class='uc' id='L862' title='2|2|2 - Total: 2'>                if (matchChar('&')) {
</span><span class='uc' id='L863' title='2|2|2 - Total: 2'>                    return Token.AND;
</span><span class='uc' id='L864' title='2|2|2 - Total: 2'>                } else if (matchChar('=')) {
</span><span class='uc' id='L865' title='2|2|2 - Total: 2'>                    return Token.ASSIGN_BITAND;
</span>                } else {
<span class='uc' id='L867' title='2|2|2 - Total: 2'>                    return Token.BITAND;
</span>                }

            case '=':
<span class='uc' id='L871' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L872' title='2|2|2 - Total: 2'>                    if (matchChar('=')) {
</span><span class='uc' id='L873' title='2|2|2 - Total: 2'>                        return Token.SHEQ;
</span>                    } else {
<span class='uc' id='L875' title='2|2|2 - Total: 2'>                        return Token.EQ;
</span>                    }
<span class='uc' id='L877' title='2|2|2 - Total: 2'>                } else if (matchChar('>')) {
</span><span class='uc' id='L878' title='2|2|2 - Total: 2'>                    return Token.ARROW;
</span>                } else {
<span class='uc' id='L880' title='2|2|2 - Total: 2'>                    return Token.ASSIGN;
</span>                }

            case '!':
<span class='uc' id='L884' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L885' title='2|2|2 - Total: 2'>                    if (matchChar('=')) {
</span><span class='uc' id='L886' title='2|2|2 - Total: 2'>                        return Token.SHNE;
</span>                    } else {
<span class='uc' id='L888' title='2|2|2 - Total: 2'>                        return Token.NE;
</span>                    }
                } else {
<span class='uc' id='L891' title='2|2|2 - Total: 2'>                    return Token.NOT;
</span>                }

            case '<':
                /* NB:treat HTML begin-comment as comment-till-eol */
<span class='uc' id='L896' title='2|2|2 - Total: 2'>                if (matchChar('!')) {
</span><span class='upc' id='L897' title='1|1|1 - Total: 2'>                    if (matchChar('-')) {
</span><span class='uc' id='L898' title='2|2|2 - Total: 2'>                        if (matchChar('-')) {
</span><span class='uc' id='L899' title='6|6|6 - Total: 6'>                            tokenBeg = cursor - 4;
</span><span class='uc' id='L900' title='2|2|2 - Total: 2'>                            skipLine();
</span><span class='uc' id='L901' title='3|3|3 - Total: 3'>                            commentType = Token.CommentType.HTML;
</span><span class='uc' id='L902' title='2|2|2 - Total: 2'>                            return Token.COMMENT;
</span>                        }
<span class='uc' id='L904' title='3|3|3 - Total: 3'>                        ungetCharIgnoreLineEnd('-');
</span>                    }
<span class='uc' id='L906' title='3|3|3 - Total: 3'>                    ungetCharIgnoreLineEnd('!');
</span>                }
<span class='uc' id='L908' title='2|2|2 - Total: 2'>                if (matchChar('<')) {
</span><span class='uc' id='L909' title='2|2|2 - Total: 2'>                    if (matchChar('=')) {
</span><span class='uc' id='L910' title='2|2|2 - Total: 2'>                        return Token.ASSIGN_LSH;
</span>                    } else {
<span class='uc' id='L912' title='2|2|2 - Total: 2'>                        return Token.LSH;
</span>                    }
                } else {
<span class='uc' id='L915' title='2|2|2 - Total: 2'>                    if (matchChar('=')) {
</span><span class='uc' id='L916' title='2|2|2 - Total: 2'>                        return Token.LE;
</span>                    } else {
<span class='uc' id='L918' title='2|2|2 - Total: 2'>                        return Token.LT;
</span>                    }
                }

            case '>':
<span class='uc' id='L923' title='2|2|2 - Total: 2'>                if (matchChar('>')) {
</span><span class='uc' id='L924' title='2|2|2 - Total: 2'>                    if (matchChar('>')) {
</span><span class='uc' id='L925' title='2|2|2 - Total: 2'>                        if (matchChar('=')) {
</span><span class='uc' id='L926' title='2|2|2 - Total: 2'>                            return Token.ASSIGN_URSH;
</span>                        } else {
<span class='uc' id='L928' title='2|2|2 - Total: 2'>                            return Token.URSH;
</span>                        }
                    } else {
<span class='uc' id='L931' title='2|2|2 - Total: 2'>                        if (matchChar('=')) {
</span><span class='uc' id='L932' title='2|2|2 - Total: 2'>                            return Token.ASSIGN_RSH;
</span>                        } else {
<span class='uc' id='L934' title='2|2|2 - Total: 2'>                            return Token.RSH;
</span>                        }
                    }
                } else {
<span class='uc' id='L938' title='2|2|2 - Total: 2'>                    if (matchChar('=')) {
</span><span class='uc' id='L939' title='2|2|2 - Total: 2'>                        return Token.GE;
</span>                    } else {
<span class='uc' id='L941' title='2|2|2 - Total: 2'>                        return Token.GT;
</span>                    }
                }

            case '*':
<span class='uc' id='L946' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L947' title='2|2|2 - Total: 2'>                    return Token.ASSIGN_MUL;
</span>                } else {
<span class='uc' id='L949' title='2|2|2 - Total: 2'>                    return Token.MUL;
</span>                }

            case '/':
<span class='uc' id='L953' title='2|2|2 - Total: 2'>                markCommentStart();
</span>                // is it a // comment?
<span class='uc' id='L955' title='2|2|2 - Total: 2'>                if (matchChar('/')) {
</span><span class='uc' id='L956' title='6|6|6 - Total: 6'>                    tokenBeg = cursor - 2;
</span><span class='uc' id='L957' title='2|2|2 - Total: 2'>                    skipLine();
</span><span class='uc' id='L958' title='3|3|3 - Total: 3'>                    commentType = Token.CommentType.LINE;
</span><span class='uc' id='L959' title='2|2|2 - Total: 2'>                    return Token.COMMENT;
</span>                }
                // is it a /* or /** comment?
<span class='uc' id='L962' title='2|2|2 - Total: 2'>                if (matchChar('*')) {
</span><span class='uc' id='L963' title='2|2|2 - Total: 2'>                    boolean lookForSlash = false;
</span><span class='uc' id='L964' title='6|6|6 - Total: 6'>                    tokenBeg = cursor - 2;
</span><span class='uc' id='L965' title='2|2|2 - Total: 2'>                    if (matchChar('*')) {
</span><span class='uc' id='L966' title='2|2|2 - Total: 2'>                        lookForSlash = true;
</span><span class='uc' id='L967' title='4|4|4 - Total: 4'>                        commentType = Token.CommentType.JSDOC;
</span>                    } else {
<span class='uc' id='L969' title='3|3|3 - Total: 3'>                        commentType = Token.CommentType.BLOCK_COMMENT;
</span>                    }
                    for (;;) {
<span class='uc' id='L972' title='3|3|3 - Total: 3'>                        c = getChar();
</span><span class='uc' id='L973' title='2|2|2 - Total: 2'>                        if (c == EOF_CHAR) {
</span><span class='uc' id='L974' title='6|6|6 - Total: 6'>                            tokenEnd = cursor - 1;
</span><span class='nc' id='L975' title='0|0|0 - Total: 4'>                            parser.addError("msg.unterminated.comment");
</span><span class='nc' id='L976' title='0|0|0 - Total: 2'>                            return Token.COMMENT;
</span><span class='uc' id='L977' title='2|2|2 - Total: 2'>                        } else if (c == '*') {
</span><span class='uc' id='L978' title='3|3|3 - Total: 3'>                            lookForSlash = true;
</span><span class='uc' id='L979' title='2|2|2 - Total: 2'>                        } else if (c == '/') {
</span><span class='uc' id='L980' title='2|2|2 - Total: 2'>                            if (lookForSlash) {
</span><span class='uc' id='L981' title='4|4|4 - Total: 4'>                                tokenEnd = cursor;
</span><span class='uc' id='L982' title='2|2|2 - Total: 2'>                                return Token.COMMENT;
</span>                            }
                        } else {
<span class='uc' id='L985' title='2|2|2 - Total: 2'>                            lookForSlash = false;
</span><span class='uc' id='L986' title='5|5|5 - Total: 5'>                            tokenEnd = cursor;
</span>                        }
                    }
                }

<span class='uc' id='L991' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L992' title='2|2|2 - Total: 2'>                    return Token.ASSIGN_DIV;
</span>                } else {
<span class='uc' id='L994' title='2|2|2 - Total: 2'>                    return Token.DIV;
</span>                }

            case '%':
<span class='uc' id='L998' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L999' title='2|2|2 - Total: 2'>                    return Token.ASSIGN_MOD;
</span>                } else {
<span class='uc' id='L1001' title='2|2|2 - Total: 2'>                    return Token.MOD;
</span>                }

            case '~':
<span class='uc' id='L1005' title='2|2|2 - Total: 2'>                return Token.BITNOT;
</span>
            case '+':
<span class='uc' id='L1008' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L1009' title='2|2|2 - Total: 2'>                    return Token.ASSIGN_ADD;
</span><span class='uc' id='L1010' title='2|2|2 - Total: 2'>                } else if (matchChar('+')) {
</span><span class='uc' id='L1011' title='2|2|2 - Total: 2'>                    return Token.INC;
</span>                } else {
<span class='uc' id='L1013' title='2|2|2 - Total: 2'>                    return Token.ADD;
</span>                }

            case '-':
<span class='uc' id='L1017' title='2|2|2 - Total: 2'>                if (matchChar('=')) {
</span><span class='uc' id='L1018' title='3|3|3 - Total: 3'>                    c = Token.ASSIGN_SUB;
</span><span class='uc' id='L1019' title='2|2|2 - Total: 2'>                } else if (matchChar('-')) {
</span><span class='uc' id='L1020' title='2|2|2 - Total: 2'>                    if (!dirtyLine) {
</span>                        // treat HTML end-comment after possible whitespace
                        // after line start as comment-until-eol
<span class='uc' id='L1023' title='2|2|2 - Total: 2'>                        if (matchChar('>')) {
</span><span class='uc' id='L1024' title='3|3|3 - Total: 3'>                            markCommentStart("--");
</span><span class='uc' id='L1025' title='2|2|2 - Total: 2'>                            skipLine();
</span><span class='uc' id='L1026' title='3|3|3 - Total: 3'>                            commentType = Token.CommentType.HTML;
</span><span class='uc' id='L1027' title='2|2|2 - Total: 2'>                            return Token.COMMENT;
</span>                        }
                    }
<span class='uc' id='L1030' title='3|3|3 - Total: 3'>                    c = Token.DEC;
</span>                } else {
<span class='uc' id='L1032' title='2|2|2 - Total: 2'>                    c = Token.SUB;
</span>                }
<span class='uc' id='L1034' title='3|3|3 - Total: 3'>                dirtyLine = true;
</span><span class='uc' id='L1035' title='2|2|2 - Total: 2'>                return c;
</span>
            default:
<span class='nc' id='L1038' title='0|0|0 - Total: 5'>                parser.addError("msg.illegal.character", c);
</span><span class='nc' id='L1039' title='0|0|0 - Total: 2'>                return Token.ERROR;
</span>            }
        }
    }

    private static boolean isAlpha(int c)
    {
        // Use 'Z' < 'a'
<span class='uc' id='L1047' title='2|2|2 - Total: 2'>        if (c <= 'Z') {
</span><span class='upc' id='L1048' title='1|1|1 - Total: 2'>            return 'A' <= c;
</span>        } else {
<span class='upc' id='L1050' title='3|3|3 - Total: 4'>            return 'a' <= c && c <= 'z';
</span>        }
    }

    static boolean isDigit(int c)
    {
<span class='uc' id='L1056' title='4|4|4 - Total: 4'>        return '0' <= c && c <= '9';
</span>    }

    /* As defined in ECMA.  jsscan.c uses C isspace() (which allows
     * \v, I think.)  note that code in getChar() implicitly accepts
     * '\r' == \u000D as well.
     */
    static boolean isJSSpace(int c)
    {
<span class='uc' id='L1065' title='2|2|2 - Total: 2'>        if (c <= 127) {
</span><span class='uc' id='L1066' title='8|8|8 - Total: 8'>            return c == 0x20 || c == 0x9 || c == 0xC || c == 0xB;
</span>        } else {
<span class='upc' id='L1068' title='3|3|3 - Total: 4'>            return c == 0xA0 || c == BYTE_ORDER_MARK
</span><span class='nc' id='L1069' title='0|0|0 - Total: 2'>                || Character.getType((char)c) == Character.SPACE_SEPARATOR;
</span>        }
    }

    private static boolean isJSFormatChar(int c)
    {
<span class='upc' id='L1075' title='3|3|3 - Total: 4'>        return c > 127 && Character.getType((char)c) == Character.FORMAT;
</span>    }

    /**
     * Parser calls the method when it gets / or /= in literal context.
     */
    void readRegExp(int startToken)
        throws IOException
    {
<span class='uc' id='L1084' title='3|3|3 - Total: 3'>        int start = tokenBeg;
</span><span class='uc' id='L1085' title='3|3|3 - Total: 3'>        stringBufferTop = 0;
</span><span class='upc' id='L1086' title='1|1|1 - Total: 2'>        if (startToken == Token.ASSIGN_DIV) {
</span>            // Miss-scanned /=
<span class='nc' id='L1088' title='0|0|0 - Total: 4'>            addToString('=');
</span>        } else {
<span class='upc' id='L1090' title='1|1|1 - Total: 2'>            if (startToken != Token.DIV) Kit.codeBug();
</span>        }

<span class='uc' id='L1093' title='2|2|2 - Total: 2'>        boolean inCharSet = false; // true if inside a '['..']' pair
</span>        int c;
<span class='uc' id='L1095' title='4|4|4 - Total: 4'>        while ((c = getChar()) != '/' || inCharSet) {
</span><span class='uc' id='L1096' title='4|4|4 - Total: 4'>            if (c == '\n' || c == EOF_CHAR) {
</span><span class='uc' id='L1097' title='3|3|3 - Total: 3'>                ungetChar(c);
</span><span class='uc' id='L1098' title='6|6|6 - Total: 6'>                tokenEnd = cursor - 1;
</span><span class='uc' id='L1099' title='10|10|10 - Total: 10'>                this.string = new String(stringBuffer, 0, stringBufferTop);
</span><span class='nc' id='L1100' title='0|0|0 - Total: 4'>                parser.reportError("msg.unterminated.re.lit");
</span><span class='nc' id='L1101' title='0|0|0 - Total: 1'>                return;
</span>            }
<span class='uc' id='L1103' title='2|2|2 - Total: 2'>            if (c == '\\') {
</span><span class='uc' id='L1104' title='3|3|3 - Total: 3'>                addToString(c);
</span><span class='uc' id='L1105' title='4|4|4 - Total: 4'>                c = getChar();
</span><span class='uc' id='L1106' title='2|2|2 - Total: 2'>            } else if (c == '[') {
</span><span class='uc' id='L1107' title='3|3|3 - Total: 3'>                inCharSet = true;
</span><span class='uc' id='L1108' title='2|2|2 - Total: 2'>            } else if (c == ']') {
</span><span class='uc' id='L1109' title='2|2|2 - Total: 2'>                inCharSet = false;
</span>            }
<span class='uc' id='L1111' title='4|4|4 - Total: 4'>            addToString(c);
</span>        }
<span class='uc' id='L1113' title='3|3|3 - Total: 3'>        int reEnd = stringBufferTop;
</span>
        while (true) {
<span class='uc' id='L1116' title='2|2|2 - Total: 2'>            if (matchChar('g'))
</span><span class='uc' id='L1117' title='4|4|4 - Total: 4'>                addToString('g');
</span><span class='uc' id='L1118' title='2|2|2 - Total: 2'>            else if (matchChar('i'))
</span><span class='uc' id='L1119' title='4|4|4 - Total: 4'>                addToString('i');
</span><span class='uc' id='L1120' title='2|2|2 - Total: 2'>            else if (matchChar('m'))
</span><span class='uc' id='L1121' title='4|4|4 - Total: 4'>                addToString('m');
</span><span class='upc' id='L1122' title='1|1|1 - Total: 2'>            else if (matchChar('y'))  // FireFox 3
</span><span class='nc' id='L1123' title='0|0|0 - Total: 4'>                addToString('y');
</span>            else
                break;
        }
<span class='uc' id='L1127' title='8|8|8 - Total: 8'>        tokenEnd = start + stringBufferTop + 2;  // include slashes
</span>
<span class='upc' id='L1129' title='1|1|1 - Total: 2'>        if (isAlpha(peekChar())) {
</span><span class='nc' id='L1130' title='0|0|0 - Total: 4'>            parser.reportError("msg.invalid.re.flag");
</span>        }

<span class='uc' id='L1133' title='9|9|9 - Total: 9'>        this.string = new String(stringBuffer, 0, reEnd);
</span><span class='uc' id='L1134' title='12|12|12 - Total: 12'>        this.regExpFlags = new String(stringBuffer, reEnd,
</span>                                      stringBufferTop - reEnd);
<span class='uc' id='L1136' title='1|1|1 - Total: 1'>    }
</span>
    String readAndClearRegExpFlags() {
<span class='uc' id='L1139' title='3|3|3 - Total: 3'>        String flags = this.regExpFlags;
</span><span class='uc' id='L1140' title='3|3|3 - Total: 3'>        this.regExpFlags = null;
</span><span class='uc' id='L1141' title='2|2|2 - Total: 2'>        return flags;
</span>    }

    boolean isXMLAttribute()
    {
<span class='uc' id='L1146' title='3|3|3 - Total: 3'>        return xmlIsAttribute;
</span>    }

    int getFirstXMLToken() throws IOException
    {
<span class='uc' id='L1151' title='3|3|3 - Total: 3'>        xmlOpenTagsCount = 0;
</span><span class='uc' id='L1152' title='3|3|3 - Total: 3'>        xmlIsAttribute = false;
</span><span class='uc' id='L1153' title='3|3|3 - Total: 3'>        xmlIsTagContent = false;
</span><span class='upc' id='L1154' title='1|1|1 - Total: 2'>        if (!canUngetChar())
</span><span class='nc' id='L1155' title='0|0|0 - Total: 2'>            return Token.ERROR;
</span><span class='uc' id='L1156' title='3|3|3 - Total: 3'>        ungetChar('<');
</span><span class='uc' id='L1157' title='3|3|3 - Total: 3'>        return getNextXMLToken();
</span>    }

    int getNextXMLToken() throws IOException
    {
<span class='uc' id='L1162' title='4|4|4 - Total: 4'>        tokenBeg = cursor;
</span><span class='uc' id='L1163' title='3|3|3 - Total: 3'>        stringBufferTop = 0; // remember the XML
</span>
<span class='uc' id='L1165' title='2|2|2 - Total: 2'>        for (int c = getChar(); c != EOF_CHAR; c = getChar()) {
</span><span class='uc' id='L1166' title='2|2|2 - Total: 2'>            if (xmlIsTagContent) {
</span><span class='uc' id='L1167' title='7|7|7 - Total: 7'>                switch (c) {
</span>                case '>':
<span class='uc' id='L1169' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L1170' title='3|3|3 - Total: 3'>                    xmlIsTagContent = false;
</span><span class='uc' id='L1171' title='3|3|3 - Total: 3'>                    xmlIsAttribute = false;
</span><span class='uc' id='L1172' title='1|1|1 - Total: 1'>                    break;
</span>                case '/':
<span class='uc' id='L1174' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='upc' id='L1175' title='1|1|1 - Total: 2'>                    if (peekChar() == '>') {
</span><span class='uc' id='L1176' title='3|3|3 - Total: 3'>                        c = getChar();
</span><span class='uc' id='L1177' title='3|3|3 - Total: 3'>                        addToString(c);
</span><span class='uc' id='L1178' title='3|3|3 - Total: 3'>                        xmlIsTagContent = false;
</span><span class='uc' id='L1179' title='7|7|7 - Total: 7'>                        xmlOpenTagsCount--;
</span>                    }
                    break;
                case '{':
<span class='uc' id='L1183' title='3|3|3 - Total: 3'>                    ungetChar(c);
</span><span class='uc' id='L1184' title='4|4|4 - Total: 4'>                    this.string = getStringFromBuffer();
</span><span class='uc' id='L1185' title='2|2|2 - Total: 2'>                    return Token.XML;
</span>                case '\'':
                case '"':
<span class='uc' id='L1188' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='upc' id='L1189' title='1|1|1 - Total: 2'>                    if (!readQuotedString(c)) return Token.ERROR;
</span>                    break;
                case '=':
<span class='uc' id='L1192' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L1193' title='3|3|3 - Total: 3'>                    xmlIsAttribute = true;
</span><span class='uc' id='L1194' title='1|1|1 - Total: 1'>                    break;
</span>                case ' ':
                case '\t':
                case '\r':
                case '\n':
<span class='uc' id='L1199' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L1200' title='1|1|1 - Total: 1'>                    break;
</span>                default:
<span class='uc' id='L1202' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L1203' title='3|3|3 - Total: 3'>                    xmlIsAttribute = false;
</span>                    break;
                }

<span class='uc' id='L1207' title='4|4|4 - Total: 4'>                if (!xmlIsTagContent && xmlOpenTagsCount == 0) {
</span><span class='uc' id='L1208' title='4|4|4 - Total: 4'>                    this.string = getStringFromBuffer();
</span><span class='uc' id='L1209' title='2|2|2 - Total: 2'>                    return Token.XMLEND;
</span>                }
            } else {
<span class='uc' id='L1212' title='3|3|3 - Total: 3'>                switch (c) {
</span>                case '<':
<span class='uc' id='L1214' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L1215' title='3|3|3 - Total: 3'>                    c = peekChar();
</span><span class='uc' id='L1216' title='4|4|4 - Total: 4'>                    switch (c) {
</span>                    case '!':
<span class='uc' id='L1218' title='3|3|3 - Total: 3'>                        c = getChar(); // Skip !
</span><span class='uc' id='L1219' title='3|3|3 - Total: 3'>                        addToString(c);
</span><span class='uc' id='L1220' title='3|3|3 - Total: 3'>                        c = peekChar();
</span><span class='upc' id='L1221' title='2|2|2 - Total: 3'>                        switch (c) {
</span>                        case '-':
<span class='uc' id='L1223' title='3|3|3 - Total: 3'>                            c = getChar(); // Skip -
</span><span class='uc' id='L1224' title='3|3|3 - Total: 3'>                            addToString(c);
</span><span class='uc' id='L1225' title='3|3|3 - Total: 3'>                            c = getChar();
</span><span class='upc' id='L1226' title='1|1|1 - Total: 2'>                            if (c == '-') {
</span><span class='uc' id='L1227' title='3|3|3 - Total: 3'>                                addToString(c);
</span><span class='upc' id='L1228' title='1|1|1 - Total: 2'>                                if(!readXmlComment()) return Token.ERROR;
</span>                            } else {
                                // throw away the string in progress
<span class='nc' id='L1231' title='0|0|0 - Total: 3'>                                stringBufferTop = 0;
</span><span class='nc' id='L1232' title='0|0|0 - Total: 3'>                                this.string = null;
</span><span class='nc' id='L1233' title='0|0|0 - Total: 4'>                                parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1234' title='0|0|0 - Total: 2'>                                return Token.ERROR;
</span>                            }
                            break;
                        case '[':
<span class='uc' id='L1238' title='3|3|3 - Total: 3'>                            c = getChar(); // Skip [
</span><span class='uc' id='L1239' title='3|3|3 - Total: 3'>                            addToString(c);
</span><span class='upc' id='L1240' title='1|1|1 - Total: 2'>                            if (getChar() == 'C' &&
</span><span class='upc' id='L1241' title='1|1|1 - Total: 2'>                                getChar() == 'D' &&
</span><span class='upc' id='L1242' title='1|1|1 - Total: 2'>                                getChar() == 'A' &&
</span><span class='upc' id='L1243' title='1|1|1 - Total: 2'>                                getChar() == 'T' &&
</span><span class='upc' id='L1244' title='1|1|1 - Total: 2'>                                getChar() == 'A' &&
</span><span class='upc' id='L1245' title='1|1|1 - Total: 2'>                                getChar() == '[')
</span>                            {
<span class='uc' id='L1247' title='3|3|3 - Total: 3'>                                addToString('C');
</span><span class='uc' id='L1248' title='3|3|3 - Total: 3'>                                addToString('D');
</span><span class='uc' id='L1249' title='3|3|3 - Total: 3'>                                addToString('A');
</span><span class='uc' id='L1250' title='3|3|3 - Total: 3'>                                addToString('T');
</span><span class='uc' id='L1251' title='3|3|3 - Total: 3'>                                addToString('A');
</span><span class='uc' id='L1252' title='3|3|3 - Total: 3'>                                addToString('[');
</span><span class='upc' id='L1253' title='1|1|1 - Total: 2'>                                if (!readCDATA()) return Token.ERROR;
</span>
                            } else {
                                // throw away the string in progress
<span class='nc' id='L1257' title='0|0|0 - Total: 3'>                                stringBufferTop = 0;
</span><span class='nc' id='L1258' title='0|0|0 - Total: 3'>                                this.string = null;
</span><span class='nc' id='L1259' title='0|0|0 - Total: 4'>                                parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1260' title='0|0|0 - Total: 2'>                                return Token.ERROR;
</span>                            }
                            break;
                        default:
<span class='nc' id='L1264' title='0|0|0 - Total: 2'>                            if(!readEntity()) return Token.ERROR;
</span>                            break;
                        }
                        break;
                    case '?':
<span class='uc' id='L1269' title='3|3|3 - Total: 3'>                        c = getChar(); // Skip ?
</span><span class='uc' id='L1270' title='3|3|3 - Total: 3'>                        addToString(c);
</span><span class='upc' id='L1271' title='1|1|1 - Total: 2'>                        if (!readPI()) return Token.ERROR;
</span>                        break;
                    case '/':
                        // End tag
<span class='uc' id='L1275' title='3|3|3 - Total: 3'>                        c = getChar(); // Skip /
</span><span class='uc' id='L1276' title='3|3|3 - Total: 3'>                        addToString(c);
</span><span class='uc' id='L1277' title='2|2|2 - Total: 2'>                        if (xmlOpenTagsCount == 0) {
</span>                            // throw away the string in progress
<span class='uc' id='L1279' title='3|3|3 - Total: 3'>                            stringBufferTop = 0;
</span><span class='uc' id='L1280' title='3|3|3 - Total: 3'>                            this.string = null;
</span><span class='nc' id='L1281' title='0|0|0 - Total: 4'>                            parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1282' title='0|0|0 - Total: 2'>                            return Token.ERROR;
</span>                        }
<span class='uc' id='L1284' title='3|3|3 - Total: 3'>                        xmlIsTagContent = true;
</span><span class='uc' id='L1285' title='6|6|6 - Total: 6'>                        xmlOpenTagsCount--;
</span><span class='uc' id='L1286' title='1|1|1 - Total: 1'>                        break;
</span>                    default:
                        // Start tag
<span class='uc' id='L1289' title='3|3|3 - Total: 3'>                        xmlIsTagContent = true;
</span><span class='uc' id='L1290' title='6|6|6 - Total: 6'>                        xmlOpenTagsCount++;
</span><span class='uc' id='L1291' title='1|1|1 - Total: 1'>                        break;
</span>                    }
                    break;
                case '{':
<span class='uc' id='L1295' title='3|3|3 - Total: 3'>                    ungetChar(c);
</span><span class='uc' id='L1296' title='4|4|4 - Total: 4'>                    this.string = getStringFromBuffer();
</span><span class='uc' id='L1297' title='2|2|2 - Total: 2'>                    return Token.XML;
</span>                default:
<span class='uc' id='L1299' title='3|3|3 - Total: 3'>                    addToString(c);
</span>                    break;
                }
            }
        }

<span class='uc' id='L1305' title='4|4|4 - Total: 4'>        tokenEnd = cursor;
</span><span class='uc' id='L1306' title='3|3|3 - Total: 3'>        stringBufferTop = 0; // throw away the string in progress
</span><span class='uc' id='L1307' title='3|3|3 - Total: 3'>        this.string = null;
</span><span class='nc' id='L1308' title='0|0|0 - Total: 4'>        parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1309' title='0|0|0 - Total: 2'>        return Token.ERROR;
</span>    }

    /**
     *
     */
    private boolean readQuotedString(int quote) throws IOException
    {
<span class='uc' id='L1317' title='2|2|2 - Total: 2'>        for (int c = getChar(); c != EOF_CHAR; c = getChar()) {
</span><span class='uc' id='L1318' title='3|3|3 - Total: 3'>            addToString(c);
</span><span class='uc' id='L1319' title='2|2|2 - Total: 2'>            if (c == quote) return true;
</span>        }

<span class='uc' id='L1322' title='3|3|3 - Total: 3'>        stringBufferTop = 0; // throw away the string in progress
</span><span class='uc' id='L1323' title='3|3|3 - Total: 3'>        this.string = null;
</span><span class='nc' id='L1324' title='0|0|0 - Total: 4'>        parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1325' title='0|0|0 - Total: 2'>        return false;
</span>    }

    /**
     *
     */
    private boolean readXmlComment() throws IOException
    {
<span class='upc' id='L1333' title='1|1|1 - Total: 2'>        for (int c = getChar(); c != EOF_CHAR;) {
</span><span class='uc' id='L1334' title='3|3|3 - Total: 3'>            addToString(c);
</span><span class='upc' id='L1335' title='3|3|3 - Total: 4'>            if (c == '-' && peekChar() == '-') {
</span><span class='uc' id='L1336' title='3|3|3 - Total: 3'>                c = getChar();
</span><span class='uc' id='L1337' title='3|3|3 - Total: 3'>                addToString(c);
</span><span class='upc' id='L1338' title='1|1|1 - Total: 2'>                if (peekChar() == '>') {
</span><span class='uc' id='L1339' title='3|3|3 - Total: 3'>                    c = getChar(); // Skip >
</span><span class='uc' id='L1340' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L1341' title='2|2|2 - Total: 2'>                    return true;
</span>                } else {
                    continue;
                }
            }
<span class='uc' id='L1346' title='4|4|4 - Total: 4'>            c = getChar();
</span>        }

<span class='nc' id='L1349' title='0|0|0 - Total: 3'>        stringBufferTop = 0; // throw away the string in progress
</span><span class='nc' id='L1350' title='0|0|0 - Total: 3'>        this.string = null;
</span><span class='nc' id='L1351' title='0|0|0 - Total: 4'>        parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1352' title='0|0|0 - Total: 2'>        return false;
</span>    }

    /**
     *
     */
    private boolean readCDATA() throws IOException
    {
<span class='upc' id='L1360' title='1|1|1 - Total: 2'>        for (int c = getChar(); c != EOF_CHAR;) {
</span><span class='uc' id='L1361' title='3|3|3 - Total: 3'>            addToString(c);
</span><span class='upc' id='L1362' title='3|3|3 - Total: 4'>            if (c == ']' && peekChar() == ']') {
</span><span class='uc' id='L1363' title='3|3|3 - Total: 3'>                c = getChar();
</span><span class='uc' id='L1364' title='3|3|3 - Total: 3'>                addToString(c);
</span><span class='upc' id='L1365' title='1|1|1 - Total: 2'>                if (peekChar() == '>') {
</span><span class='uc' id='L1366' title='3|3|3 - Total: 3'>                    c = getChar(); // Skip >
</span><span class='uc' id='L1367' title='3|3|3 - Total: 3'>                    addToString(c);
</span><span class='uc' id='L1368' title='2|2|2 - Total: 2'>                    return true;
</span>                } else {
                    continue;
                }
            }
<span class='uc' id='L1373' title='4|4|4 - Total: 4'>            c = getChar();
</span>        }

<span class='nc' id='L1376' title='0|0|0 - Total: 3'>        stringBufferTop = 0; // throw away the string in progress
</span><span class='nc' id='L1377' title='0|0|0 - Total: 3'>        this.string = null;
</span><span class='nc' id='L1378' title='0|0|0 - Total: 4'>        parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1379' title='0|0|0 - Total: 2'>        return false;
</span>    }

    /**
     *
     */
    private boolean readEntity() throws IOException
    {
<span class='nc' id='L1387' title='0|0|0 - Total: 2'>        int declTags = 1;
</span><span class='nc' id='L1388' title='0|0|0 - Total: 2'>        for (int c = getChar(); c != EOF_CHAR; c = getChar()) {
</span><span class='nc' id='L1389' title='0|0|0 - Total: 3'>            addToString(c);
</span><span class='nc' id='L1390' title='0|0|0 - Total: 3'>            switch (c) {
</span>            case '<':
<span class='nc' id='L1392' title='0|0|0 - Total: 1'>                declTags++;
</span><span class='nc' id='L1393' title='0|0|0 - Total: 1'>                break;
</span>            case '>':
<span class='nc' id='L1395' title='0|0|0 - Total: 1'>                declTags--;
</span><span class='nc' id='L1396' title='0|0|0 - Total: 2'>                if (declTags == 0) return true;
</span>                break;
            }
        }

<span class='nc' id='L1401' title='0|0|0 - Total: 3'>        stringBufferTop = 0; // throw away the string in progress
</span><span class='nc' id='L1402' title='0|0|0 - Total: 3'>        this.string = null;
</span><span class='nc' id='L1403' title='0|0|0 - Total: 4'>        parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1404' title='0|0|0 - Total: 2'>        return false;
</span>    }

    /**
     *
     */
    private boolean readPI() throws IOException
    {
<span class='upc' id='L1412' title='1|1|1 - Total: 2'>        for (int c = getChar(); c != EOF_CHAR; c = getChar()) {
</span><span class='uc' id='L1413' title='3|3|3 - Total: 3'>            addToString(c);
</span><span class='upc' id='L1414' title='3|3|3 - Total: 4'>            if (c == '?' && peekChar() == '>') {
</span><span class='uc' id='L1415' title='3|3|3 - Total: 3'>                c = getChar(); // Skip >
</span><span class='uc' id='L1416' title='3|3|3 - Total: 3'>                addToString(c);
</span><span class='uc' id='L1417' title='2|2|2 - Total: 2'>                return true;
</span>            }
        }

<span class='nc' id='L1421' title='0|0|0 - Total: 3'>        stringBufferTop = 0; // throw away the string in progress
</span><span class='nc' id='L1422' title='0|0|0 - Total: 3'>        this.string = null;
</span><span class='nc' id='L1423' title='0|0|0 - Total: 4'>        parser.addError("msg.XML.bad.form");
</span><span class='nc' id='L1424' title='0|0|0 - Total: 2'>        return false;
</span>    }

    private String getStringFromBuffer()
    {
<span class='uc' id='L1429' title='4|4|4 - Total: 4'>        tokenEnd = cursor;
</span><span class='uc' id='L1430' title='9|9|9 - Total: 9'>        return new String(stringBuffer, 0, stringBufferTop);
</span>    }

    private void addToString(int c)
    {
<span class='uc' id='L1435' title='3|3|3 - Total: 3'>        int N = stringBufferTop;
</span><span class='uc' id='L1436' title='2|2|2 - Total: 2'>        if (N == stringBuffer.length) {
</span><span class='uc' id='L1437' title='7|7|7 - Total: 7'>            char[] tmp = new char[stringBuffer.length * 2];
</span><span class='uc' id='L1438' title='7|7|7 - Total: 7'>            System.arraycopy(stringBuffer, 0, tmp, 0, N);
</span><span class='uc' id='L1439' title='3|3|3 - Total: 3'>            stringBuffer = tmp;
</span>        }
<span class='uc' id='L1441' title='6|6|6 - Total: 6'>        stringBuffer[N] = (char)c;
</span><span class='uc' id='L1442' title='5|5|5 - Total: 5'>        stringBufferTop = N + 1;
</span><span class='uc' id='L1443' title='1|1|1 - Total: 1'>    }
</span>
    private boolean canUngetChar() {
<span class='upc' id='L1446' title='2|2|2 - Total: 4'>        return ungetCursor == 0 || ungetBuffer[ungetCursor - 1] != '\n';
</span>    }

    private void ungetChar(int c)
    {
        // can not unread past across line boundary
<span class='upc' id='L1452' title='3|3|3 - Total: 4'>        if (ungetCursor != 0 && ungetBuffer[ungetCursor - 1] == '\n')
</span><span class='nc' id='L1453' title='0|0|0 - Total: 2'>            Kit.codeBug();
</span><span class='uc' id='L1454' title='11|11|11 - Total: 11'>        ungetBuffer[ungetCursor++] = c;
</span><span class='uc' id='L1455' title='6|6|6 - Total: 6'>        cursor--;
</span><span class='uc' id='L1456' title='1|1|1 - Total: 1'>    }
</span>
    private boolean matchChar(int test) throws IOException
    {
<span class='uc' id='L1460' title='3|3|3 - Total: 3'>        int c = getCharIgnoreLineEnd();
</span><span class='uc' id='L1461' title='2|2|2 - Total: 2'>        if (c == test) {
</span><span class='uc' id='L1462' title='4|4|4 - Total: 4'>            tokenEnd = cursor;
</span><span class='uc' id='L1463' title='2|2|2 - Total: 2'>            return true;
</span>        } else {
<span class='uc' id='L1465' title='3|3|3 - Total: 3'>            ungetCharIgnoreLineEnd(c);
</span><span class='uc' id='L1466' title='2|2|2 - Total: 2'>            return false;
</span>        }
    }

    private int peekChar() throws IOException
    {
<span class='uc' id='L1472' title='3|3|3 - Total: 3'>        int c = getChar();
</span><span class='uc' id='L1473' title='3|3|3 - Total: 3'>        ungetChar(c);
</span><span class='uc' id='L1474' title='2|2|2 - Total: 2'>        return c;
</span>    }

    private int getChar() throws IOException
    {
<span class='uc' id='L1479' title='4|4|4 - Total: 4'>        return getChar(true);
</span>    }

    private int getChar(boolean skipFormattingChars) throws IOException
    {
<span class='uc' id='L1484' title='2|2|2 - Total: 2'>        if (ungetCursor != 0) {
</span><span class='uc' id='L1485' title='6|6|6 - Total: 6'>            cursor++;
</span><span class='uc' id='L1486' title='11|11|11 - Total: 11'>            return ungetBuffer[--ungetCursor];
</span>        }

        for(;;) {
            int c;
<span class='uc' id='L1491' title='2|2|2 - Total: 2'>            if (sourceString != null) {
</span><span class='uc' id='L1492' title='2|2|2 - Total: 2'>                if (sourceCursor == sourceEnd) {
</span><span class='uc' id='L1493' title='3|3|3 - Total: 3'>                    hitEOF = true;
</span><span class='uc' id='L1494' title='2|2|2 - Total: 2'>                    return EOF_CHAR;
</span>                }
<span class='uc' id='L1496' title='6|6|6 - Total: 6'>                cursor++;
</span><span class='uc' id='L1497' title='12|12|12 - Total: 12'>                c = sourceString.charAt(sourceCursor++);
</span>            } else {
<span class='uc' id='L1499' title='2|2|2 - Total: 2'>                if (sourceCursor == sourceEnd) {
</span><span class='uc' id='L1500' title='2|2|2 - Total: 2'>                    if (!fillSourceBuffer()) {
</span><span class='uc' id='L1501' title='3|3|3 - Total: 3'>                        hitEOF = true;
</span><span class='uc' id='L1502' title='2|2|2 - Total: 2'>                        return EOF_CHAR;
</span>                    }
                }
<span class='uc' id='L1505' title='6|6|6 - Total: 6'>                cursor++;
</span><span class='uc' id='L1506' title='11|11|11 - Total: 11'>                c = sourceBuffer[sourceCursor++];
</span>            }

<span class='uc' id='L1509' title='2|2|2 - Total: 2'>            if (lineEndChar >= 0) {
</span><span class='uc' id='L1510' title='4|4|4 - Total: 4'>                if (lineEndChar == '\r' && c == '\n') {
</span><span class='uc' id='L1511' title='3|3|3 - Total: 3'>                    lineEndChar = '\n';
</span><span class='uc' id='L1512' title='1|1|1 - Total: 1'>                    continue;
</span>                }
<span class='uc' id='L1514' title='3|3|3 - Total: 3'>                lineEndChar = -1;
</span><span class='uc' id='L1515' title='6|6|6 - Total: 6'>                lineStart = sourceCursor - 1;
</span><span class='uc' id='L1516' title='6|6|6 - Total: 6'>                lineno++;
</span>            }

<span class='uc' id='L1519' title='2|2|2 - Total: 2'>            if (c <= 127) {
</span><span class='uc' id='L1520' title='4|4|4 - Total: 4'>                if (c == '\n' || c == '\r') {
</span><span class='uc' id='L1521' title='3|3|3 - Total: 3'>                    lineEndChar = c;
</span><span class='uc' id='L1522' title='3|3|3 - Total: 3'>                    c = '\n';
</span>                }
            } else {
<span class='uc' id='L1525' title='2|2|2 - Total: 2'>                if (c == BYTE_ORDER_MARK) return c; // BOM is considered whitespace
</span><span class='uc' id='L1526' title='4|4|4 - Total: 4'>                if (skipFormattingChars && isJSFormatChar(c)) {
</span><span class='uc' id='L1527' title='1|1|1 - Total: 1'>                    continue;
</span>                }
<span class='upc' id='L1529' title='1|1|1 - Total: 2'>                if (ScriptRuntime.isJSLineTerminator(c)) {
</span><span class='nc' id='L1530' title='0|0|0 - Total: 3'>                    lineEndChar = c;
</span><span class='nc' id='L1531' title='0|0|0 - Total: 2'>                    c = '\n';
</span>                }
            }
<span class='uc' id='L1534' title='2|2|2 - Total: 2'>            return c;
</span>        }
    }

    private int getCharIgnoreLineEnd() throws IOException
    {
<span class='uc' id='L1540' title='2|2|2 - Total: 2'>        if (ungetCursor != 0) {
</span><span class='uc' id='L1541' title='6|6|6 - Total: 6'>            cursor++;
</span><span class='uc' id='L1542' title='11|11|11 - Total: 11'>            return ungetBuffer[--ungetCursor];
</span>        }

        for(;;) {
            int c;
<span class='uc' id='L1547' title='2|2|2 - Total: 2'>            if (sourceString != null) {
</span><span class='uc' id='L1548' title='2|2|2 - Total: 2'>                if (sourceCursor == sourceEnd) {
</span><span class='uc' id='L1549' title='3|3|3 - Total: 3'>                    hitEOF = true;
</span><span class='uc' id='L1550' title='2|2|2 - Total: 2'>                    return EOF_CHAR;
</span>                }
<span class='uc' id='L1552' title='6|6|6 - Total: 6'>                cursor++;
</span><span class='uc' id='L1553' title='12|12|12 - Total: 12'>                c = sourceString.charAt(sourceCursor++);
</span>            } else {
<span class='uc' id='L1555' title='2|2|2 - Total: 2'>                if (sourceCursor == sourceEnd) {
</span><span class='upc' id='L1556' title='1|1|1 - Total: 2'>                    if (!fillSourceBuffer()) {
</span><span class='nc' id='L1557' title='0|0|0 - Total: 3'>                        hitEOF = true;
</span><span class='nc' id='L1558' title='0|0|0 - Total: 2'>                        return EOF_CHAR;
</span>                    }
                }
<span class='uc' id='L1561' title='6|6|6 - Total: 6'>                cursor++;
</span><span class='uc' id='L1562' title='11|11|11 - Total: 11'>                c = sourceBuffer[sourceCursor++];
</span>            }

<span class='uc' id='L1565' title='2|2|2 - Total: 2'>            if (c <= 127) {
</span><span class='upc' id='L1566' title='3|3|3 - Total: 4'>                if (c == '\n' || c == '\r') {
</span><span class='uc' id='L1567' title='3|3|3 - Total: 3'>                    lineEndChar = c;
</span><span class='uc' id='L1568' title='3|3|3 - Total: 3'>                    c = '\n';
</span>                }
            } else {
<span class='upc' id='L1571' title='1|1|1 - Total: 2'>                if (c == BYTE_ORDER_MARK) return c; // BOM is considered whitespace
</span><span class='uc' id='L1572' title='2|2|2 - Total: 2'>                if (isJSFormatChar(c)) {
</span><span class='uc' id='L1573' title='1|1|1 - Total: 1'>                    continue;
</span>                }
<span class='upc' id='L1575' title='1|1|1 - Total: 2'>                if (ScriptRuntime.isJSLineTerminator(c)) {
</span><span class='nc' id='L1576' title='0|0|0 - Total: 3'>                    lineEndChar = c;
</span><span class='nc' id='L1577' title='0|0|0 - Total: 2'>                    c = '\n';
</span>                }
            }
<span class='uc' id='L1580' title='2|2|2 - Total: 2'>            return c;
</span>        }
    }

    private void ungetCharIgnoreLineEnd(int c)
    {
<span class='uc' id='L1586' title='11|11|11 - Total: 11'>        ungetBuffer[ungetCursor++] = c;
</span><span class='uc' id='L1587' title='6|6|6 - Total: 6'>        cursor--;
</span><span class='uc' id='L1588' title='1|1|1 - Total: 1'>    }
</span>
    private void skipLine() throws IOException
    {
        // skip to end of line
        int c;
<span class='upc' id='L1594' title='3|3|3 - Total: 4'>        while ((c = getChar()) != EOF_CHAR && c != '\n') { }
</span><span class='uc' id='L1595' title='3|3|3 - Total: 3'>        ungetChar(c);
</span><span class='uc' id='L1596' title='4|4|4 - Total: 4'>        tokenEnd = cursor;
</span><span class='uc' id='L1597' title='1|1|1 - Total: 1'>    }
</span>
    /**
     * Returns the offset into the current line.
     */
    final int getOffset()
    {
<span class='uc' id='L1604' title='6|6|6 - Total: 6'>        int n = sourceCursor - lineStart;
</span><span class='uc' id='L1605' title='2|2|2 - Total: 2'>        if (lineEndChar >= 0) { --n; }
</span><span class='uc' id='L1606' title='2|2|2 - Total: 2'>        return n;
</span>    }

    private final int charAt(int index) {
<span class='upc' id='L1610' title='1|1|1 - Total: 2'>        if (index < 0) {
</span><span class='nc' id='L1611' title='0|0|0 - Total: 2'>            return EOF_CHAR;
</span>        }
<span class='uc' id='L1613' title='2|2|2 - Total: 2'>        if (sourceString != null) {
</span><span class='uc' id='L1614' title='2|2|2 - Total: 2'>            if (index >= sourceEnd) {
</span><span class='uc' id='L1615' title='2|2|2 - Total: 2'>                return EOF_CHAR;
</span>            }
<span class='uc' id='L1617' title='5|5|5 - Total: 5'>            return sourceString.charAt(index);
</span>        } else {
<span class='uc' id='L1619' title='2|2|2 - Total: 2'>            if (index >= sourceEnd) {
</span><span class='uc' id='L1620' title='3|3|3 - Total: 3'>                int oldSourceCursor = sourceCursor;
</span>                try {
<span class='upc' id='L1622' title='1|1|1 - Total: 2'>                    if (!fillSourceBuffer()) { return EOF_CHAR; }
</span><span class='nc' id='L1623' title='0|0|0 - Total: 1'>                } catch (IOException ioe) {
</span>                    // ignore it, we're already displaying an error...
<span class='nc' id='L1625' title='0|0|0 - Total: 2'>                    return EOF_CHAR;
</span><span class='nc' id='L1626' title='0|0|0 - Total: 1'>                }
</span>                // index recalculuation as fillSourceBuffer can move saved
                // line buffer and change sourceCursor
<span class='nc' id='L1629' title='0|0|0 - Total: 7'>                index -= (oldSourceCursor - sourceCursor);
</span>            }
<span class='uc' id='L1631' title='5|5|5 - Total: 5'>            return sourceBuffer[index];
</span>        }
    }

    private final String substring(int beginIndex, int endIndex) {
<span class='uc' id='L1636' title='2|2|2 - Total: 2'>        if (sourceString != null) {
</span><span class='uc' id='L1637' title='6|6|6 - Total: 6'>            return sourceString.substring(beginIndex, endIndex);
</span>        } else {
<span class='uc' id='L1639' title='4|4|4 - Total: 4'>            int count = endIndex - beginIndex;
</span><span class='uc' id='L1640' title='8|8|8 - Total: 8'>            return new String(sourceBuffer, beginIndex, count);
</span>        }
    }

    final String getLine() {
<span class='uc' id='L1645' title='3|3|3 - Total: 3'>        int lineEnd = sourceCursor;
</span><span class='uc' id='L1646' title='2|2|2 - Total: 2'>        if (lineEndChar >= 0) {
</span>            // move cursor before newline sequence
<span class='uc' id='L1648' title='1|1|1 - Total: 1'>            lineEnd -= 1;
</span><span class='upc' id='L1649' title='2|2|2 - Total: 4'>            if (lineEndChar == '\n' && charAt(lineEnd - 1) == '\r') {
</span><span class='nc' id='L1650' title='0|0|0 - Total: 2'>                lineEnd -= 1;
</span>            }
        } else {
            // Read until the end of line
<span class='uc' id='L1654' title='5|5|5 - Total: 5'>            int lineLength = lineEnd - lineStart;
</span><span class='uc' id='L1655' title='2|2|2 - Total: 2'>            for (;; ++lineLength) {
</span><span class='uc' id='L1656' title='7|7|7 - Total: 7'>                int c = charAt(lineStart + lineLength);
</span><span class='uc' id='L1657' title='4|4|4 - Total: 4'>                if (c == EOF_CHAR || ScriptRuntime.isJSLineTerminator(c)) {
</span><span class='uc' id='L1658' title='1|1|1 - Total: 1'>                    break;
</span>                }
            }
<span class='uc' id='L1661' title='5|5|5 - Total: 5'>            lineEnd = lineStart + lineLength;
</span>        }
<span class='uc' id='L1663' title='6|6|6 - Total: 6'>        return substring(lineStart, lineEnd);
</span>    }

    final String getLine(int position, int[] linep) {
<span class='upc' id='L1667' title='3|3|3 - Total: 6'>        assert position >= 0 && position <= cursor;
</span><span class='upc' id='L1668' title='2|2|2 - Total: 4'>        assert linep.length == 2;
</span><span class='uc' id='L1669' title='8|8|8 - Total: 8'>        int delta = (cursor + ungetCursor) - position;
</span><span class='uc' id='L1670' title='3|3|3 - Total: 3'>        int cur = sourceCursor;
</span><span class='uc' id='L1671' title='2|2|2 - Total: 2'>        if (delta > cur) {
</span>            // requested line outside of source buffer
<span class='uc' id='L1673' title='2|2|2 - Total: 2'>            return null;
</span>        }
        // read back until position
<span class='uc' id='L1676' title='4|4|4 - Total: 4'>        int end = 0, lines = 0;
</span><span class='uc' id='L1677' title='2|2|2 - Total: 2'>        for (; delta > 0; --delta, --cur) {
</span><span class='upc' id='L1678' title='2|2|2 - Total: 4'>            assert cur > 0;
</span><span class='uc' id='L1679' title='6|6|6 - Total: 6'>            int c = charAt(cur - 1);
</span><span class='uc' id='L1680' title='2|2|2 - Total: 2'>            if (ScriptRuntime.isJSLineTerminator(c)) {
</span><span class='uc' id='L1681' title='4|4|4 - Total: 4'>                if (c == '\n' && charAt(cur - 2) == '\r') {
</span>                    // \r\n sequence
<span class='uc' id='L1683' title='1|1|1 - Total: 1'>                    delta -= 1;
</span><span class='uc' id='L1684' title='1|1|1 - Total: 1'>                    cur -= 1;
</span>                }
<span class='uc' id='L1686' title='1|1|1 - Total: 1'>                lines += 1;
</span><span class='uc' id='L1687' title='4|4|4 - Total: 4'>                end = cur - 1;
</span>            }
        }
        // read back until line start
<span class='uc' id='L1691' title='4|4|4 - Total: 4'>        int start = 0, offset = 0;
</span><span class='uc' id='L1692' title='2|2|2 - Total: 2'>        for (; cur > 0; --cur, ++offset) {
</span><span class='uc' id='L1693' title='6|6|6 - Total: 6'>            int c = charAt(cur - 1);
</span><span class='uc' id='L1694' title='2|2|2 - Total: 2'>            if (ScriptRuntime.isJSLineTerminator(c)) {
</span><span class='uc' id='L1695' title='2|2|2 - Total: 2'>                start = cur;
</span><span class='uc' id='L1696' title='1|1|1 - Total: 1'>                break;
</span>            }
        }
<span class='uc' id='L1699' title='2|2|2 - Total: 2'>        linep[0] = lineno - lines + (lineEndChar >= 0 ? 1 : 0);
</span><span class='uc' id='L1700' title='4|4|4 - Total: 4'>        linep[1] = offset;
</span><span class='uc' id='L1701' title='2|2|2 - Total: 2'>        if (lines == 0) {
</span><span class='uc' id='L1702' title='3|3|3 - Total: 3'>            return getLine();
</span>        } else {
<span class='uc' id='L1704' title='5|5|5 - Total: 5'>            return substring(start, end);
</span>        }
    }

    private boolean fillSourceBuffer() throws IOException
    {
<span class='upc' id='L1710' title='1|1|1 - Total: 2'>        if (sourceString != null) Kit.codeBug();
</span><span class='uc' id='L1711' title='2|2|2 - Total: 2'>        if (sourceEnd == sourceBuffer.length) {
</span><span class='uc' id='L1712' title='4|4|4 - Total: 4'>            if (lineStart != 0 && !isMarkingComment()) {
</span><span class='uc' id='L1713' title='13|13|13 - Total: 13'>                System.arraycopy(sourceBuffer, lineStart, sourceBuffer, 0,
</span>                                 sourceEnd - lineStart);
<span class='uc' id='L1715' title='7|7|7 - Total: 7'>                sourceEnd -= lineStart;
</span><span class='uc' id='L1716' title='7|7|7 - Total: 7'>                sourceCursor -= lineStart;
</span><span class='uc' id='L1717' title='4|4|4 - Total: 4'>                lineStart = 0;
</span>            } else {
<span class='uc' id='L1719' title='7|7|7 - Total: 7'>                char[] tmp = new char[sourceBuffer.length * 2];
</span><span class='uc' id='L1720' title='8|8|8 - Total: 8'>                System.arraycopy(sourceBuffer, 0, tmp, 0, sourceEnd);
</span><span class='uc' id='L1721' title='3|3|3 - Total: 3'>                sourceBuffer = tmp;
</span>            }
        }
<span class='uc' id='L1724' title='14|14|14 - Total: 14'>        int n = sourceReader.read(sourceBuffer, sourceEnd,
</span>                                  sourceBuffer.length - sourceEnd);
<span class='uc' id='L1726' title='2|2|2 - Total: 2'>        if (n < 0) {
</span><span class='uc' id='L1727' title='2|2|2 - Total: 2'>            return false;
</span>        }
<span class='uc' id='L1729' title='6|6|6 - Total: 6'>        sourceEnd += n;
</span><span class='uc' id='L1730' title='2|2|2 - Total: 2'>        return true;
</span>    }

    /**
     * Return the current position of the scanner cursor.
     */
    public int getCursor() {
<span class='nc' id='L1737' title='0|0|0 - Total: 3'>        return cursor;
</span>    }

    /**
     * Return the absolute source offset of the last scanned token.
     */
    public int getTokenBeg() {
<span class='nc' id='L1744' title='0|0|0 - Total: 3'>        return tokenBeg;
</span>    }

    /**
     * Return the absolute source end-offset of the last scanned token.
     */
    public int getTokenEnd() {
<span class='nc' id='L1751' title='0|0|0 - Total: 3'>        return tokenEnd;
</span>    }

    /**
     * Return tokenEnd - tokenBeg
     */
    public int getTokenLength() {
<span class='uc' id='L1758' title='6|6|6 - Total: 6'>        return tokenEnd - tokenBeg;
</span>    }

    /**
     * Return the type of the last scanned comment.
     * @return type of last scanned comment, or 0 if none have been scanned.
     */
    public Token.CommentType getCommentType() {
<span class='nc' id='L1766' title='0|0|0 - Total: 3'>        return commentType;
</span>    }

    private void markCommentStart() {
<span class='uc' id='L1770' title='3|3|3 - Total: 3'>        markCommentStart("");
</span><span class='uc' id='L1771' title='1|1|1 - Total: 1'>    }
</span>
    private void markCommentStart(String prefix) {
<span class='uc' id='L1774' title='4|4|4 - Total: 4'>        if (parser.compilerEnv.isRecordingComments() && sourceReader != null) {
</span><span class='uc' id='L1775' title='3|3|3 - Total: 3'>            commentPrefix = prefix;
</span><span class='uc' id='L1776' title='6|6|6 - Total: 6'>            commentCursor = sourceCursor - 1;
</span>        }
<span class='uc' id='L1778' title='1|1|1 - Total: 1'>    }
</span>
    private boolean isMarkingComment() {
<span class='uc' id='L1781' title='2|2|2 - Total: 2'>        return commentCursor != -1;
</span>    }

     final String getAndResetCurrentComment() {
<span class='uc' id='L1785' title='2|2|2 - Total: 2'>        if (sourceString != null) {
</span><span class='upc' id='L1786' title='1|1|1 - Total: 2'>            if (isMarkingComment()) Kit.codeBug();
</span><span class='uc' id='L1787' title='8|8|8 - Total: 8'>            return sourceString.substring(tokenBeg, tokenEnd);
</span>        } else {
<span class='upc' id='L1789' title='1|1|1 - Total: 2'>            if (!isMarkingComment()) Kit.codeBug();
</span><span class='uc' id='L1790' title='6|6|6 - Total: 6'>            StringBuilder comment = new StringBuilder(commentPrefix);
</span><span class='uc' id='L1791' title='8|8|8 - Total: 8'>            comment.append(sourceBuffer, commentCursor,
</span><span class='uc' id='L1792' title='5|5|5 - Total: 5'>                getTokenLength() - commentPrefix.length());
</span><span class='uc' id='L1793' title='3|3|3 - Total: 3'>            commentCursor = -1;
</span><span class='uc' id='L1794' title='3|3|3 - Total: 3'>            return comment.toString();
</span>        }
    }

    private String convertLastCharToHex(String str) {
<span class='uc' id='L1799' title='5|5|5 - Total: 5'>      int lastIndex = str.length()-1;
</span><span class='uc' id='L1800' title='5|5|5 - Total: 5'>      StringBuilder buf = new StringBuilder(
</span><span class='uc' id='L1801' title='3|3|3 - Total: 3'>          str.substring(0, lastIndex));
</span><span class='uc' id='L1802' title='4|4|4 - Total: 4'>      buf.append("\\u");
</span><span class='uc' id='L1803' title='5|5|5 - Total: 5'>      String hexCode = Integer.toHexString(str.charAt(lastIndex));
</span><span class='uc' id='L1804' title='2|2|2 - Total: 2'>      for (int i = 0; i < 4-hexCode.length(); ++i) {
</span><span class='uc' id='L1805' title='4|4|4 - Total: 4'>        buf.append('0');
</span>      }
<span class='uc' id='L1807' title='4|4|4 - Total: 4'>      buf.append(hexCode);
</span><span class='uc' id='L1808' title='3|3|3 - Total: 3'>      return buf.toString();
</span>    }

    // stuff other than whitespace since start of line
    private boolean dirtyLine;

    String regExpFlags;

    // Set this to an initial non-null value so that the Parser has
    // something to retrieve even if an error has occurred and no
    // string is found.  Fosters one class of error, but saves lots of
    // code.
<span class='uc' id='L1820' title='3|3|3 - Total: 3'>    private String string = "";
</span>    private double number;
    private boolean isBinary;
    private boolean isOldOctal;
    private boolean isOctal;
    private boolean isHex;

    // delimiter for last string literal scanned
    private int quoteChar;

<span class='uc' id='L1830' title='4|4|4 - Total: 4'>    private char[] stringBuffer = new char[128];
</span>    private int stringBufferTop;
<span class='uc' id='L1832' title='6|6|6 - Total: 6'>    private ObjToIntMap allStrings = new ObjToIntMap(50);
</span>
    // Room to backtrace from to < on failed match of the last - in <!--
<span class='uc' id='L1835' title='4|4|4 - Total: 4'>    private final int[] ungetBuffer = new int[3];
</span>    private int ungetCursor;

<span class='uc' id='L1838' title='3|3|3 - Total: 3'>    private boolean hitEOF = false;
</span>
<span class='uc' id='L1840' title='3|3|3 - Total: 3'>    private int lineStart = 0;
</span><span class='uc' id='L1841' title='3|3|3 - Total: 3'>    private int lineEndChar = -1;
</span>    int lineno;

    private String sourceString;
    private Reader sourceReader;
    private char[] sourceBuffer;
    private int sourceEnd;

    // sourceCursor is an index into a small buffer that keeps a
    // sliding window of the source stream.
    int sourceCursor;

    // cursor is a monotonically increasing index into the original
    // source stream, tracking exactly how far scanning has progressed.
    // Its value is the index of the next character to be scanned.
    int cursor;

    // Record start and end positions of last scanned token.
    int tokenBeg;
    int tokenEnd;

    // Type of last comment scanned.
    Token.CommentType commentType;

    // for xml tokenizer
    private boolean xmlIsAttribute;
    private boolean xmlIsTagContent;
    private int xmlOpenTagsCount;

    private Parser parser;

<span class='uc' id='L1872' title='3|3|3 - Total: 3'>    private String commentPrefix = "";
</span><span class='uc' id='L1873' title='3|3|3 - Total: 3'>    private int commentCursor = -1;
</span>}
</pre></body></html><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table>