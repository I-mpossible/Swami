<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml' lang='en'><head><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><title>org.mozilla.javascript.NativeGlobal.java</title><link rel='stylesheet' href='../.resources/report.css' type='text/css'/><link rel='stylesheet' href='../.resources/prettify.css' type='text/css'/><link rel='stylesheet' href='../.resources/custom.css' type='text/css'/><script type='text/javascript' src='../.resources/prettify.js'></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><h1>org.mozilla.javascript.NativeGlobal.java</h1><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table><pre class='source lang-java linenums'>/* -*- Mode: java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

package org.mozilla.javascript;

import java.io.Serializable;

import org.mozilla.javascript.xml.XMLLib;
import static org.mozilla.javascript.ScriptableObject.DONTENUM;
import static org.mozilla.javascript.ScriptableObject.READONLY;
import static org.mozilla.javascript.ScriptableObject.PERMANENT;

/**
 * This class implements the global native object (function and value
 * properties only).
 *
 * See ECMA 15.1.[12].
 *
 * @author Mike Shaver
 */

<span class='uc' id='L25' title='3|3|3 - Total: 3'>public class NativeGlobal implements Serializable, IdFunctionCall
</span>{
    static final long serialVersionUID = 6080442165748707530L;

    public static void init(Context cx, Scriptable scope, boolean sealed) {
<span class='uc' id='L30' title='4|4|4 - Total: 4'>        NativeGlobal obj = new NativeGlobal();
</span>
<span class='uc' id='L32' title='2|2|2 - Total: 2'>        for (int id = 1; id <= LAST_SCOPE_FUNCTION_ID; ++id) {
</span>            String name;
<span class='uc' id='L34' title='2|2|2 - Total: 2'>            int arity = 1;
</span><span class='upc' id='L35' title='13|13|13 - Total: 14'>            switch (id) {
</span>              case Id_decodeURI:
<span class='uc' id='L37' title='2|2|2 - Total: 2'>                name = "decodeURI";
</span><span class='uc' id='L38' title='1|1|1 - Total: 1'>                break;
</span>              case Id_decodeURIComponent:
<span class='uc' id='L40' title='2|2|2 - Total: 2'>                name = "decodeURIComponent";
</span><span class='uc' id='L41' title='1|1|1 - Total: 1'>                break;
</span>              case Id_encodeURI:
<span class='uc' id='L43' title='2|2|2 - Total: 2'>                name = "encodeURI";
</span><span class='uc' id='L44' title='1|1|1 - Total: 1'>                break;
</span>              case Id_encodeURIComponent:
<span class='uc' id='L46' title='2|2|2 - Total: 2'>                name = "encodeURIComponent";
</span><span class='uc' id='L47' title='1|1|1 - Total: 1'>                break;
</span>              case Id_escape:
<span class='uc' id='L49' title='2|2|2 - Total: 2'>                name = "escape";
</span><span class='uc' id='L50' title='1|1|1 - Total: 1'>                break;
</span>              case Id_eval:
<span class='uc' id='L52' title='2|2|2 - Total: 2'>                name = "eval";
</span><span class='uc' id='L53' title='1|1|1 - Total: 1'>                break;
</span>              case Id_isFinite:
<span class='uc' id='L55' title='2|2|2 - Total: 2'>                name = "isFinite";
</span><span class='uc' id='L56' title='1|1|1 - Total: 1'>                break;
</span>              case Id_isNaN:
<span class='uc' id='L58' title='2|2|2 - Total: 2'>                name = "isNaN";
</span><span class='uc' id='L59' title='1|1|1 - Total: 1'>                break;
</span>              case Id_isXMLName:
<span class='uc' id='L61' title='2|2|2 - Total: 2'>                name = "isXMLName";
</span><span class='uc' id='L62' title='1|1|1 - Total: 1'>                break;
</span>              case Id_parseFloat:
<span class='uc' id='L64' title='2|2|2 - Total: 2'>                name = "parseFloat";
</span><span class='uc' id='L65' title='1|1|1 - Total: 1'>                break;
</span>              case Id_parseInt:
<span class='uc' id='L67' title='2|2|2 - Total: 2'>                name = "parseInt";
</span><span class='uc' id='L68' title='2|2|2 - Total: 2'>                arity = 2;
</span><span class='uc' id='L69' title='1|1|1 - Total: 1'>                break;
</span>              case Id_unescape:
<span class='uc' id='L71' title='2|2|2 - Total: 2'>                name = "unescape";
</span><span class='uc' id='L72' title='1|1|1 - Total: 1'>                break;
</span>              case Id_uneval:
<span class='uc' id='L74' title='2|2|2 - Total: 2'>                name = "uneval";
</span><span class='uc' id='L75' title='1|1|1 - Total: 1'>                break;
</span>              default:
<span class='nc' id='L77' title='0|0|0 - Total: 2'>                  throw Kit.codeBug();
</span>            }
<span class='uc' id='L79' title='10|10|10 - Total: 10'>            IdFunctionObject f = new IdFunctionObject(obj, FTAG, id, name,
</span>                                                      arity, scope);
<span class='uc' id='L81' title='2|2|2 - Total: 2'>            if (sealed) {
</span><span class='uc' id='L82' title='2|2|2 - Total: 2'>                f.sealObject();
</span>            }
<span class='uc' id='L84' title='2|2|2 - Total: 2'>            f.exportAsScopeProperty();
</span>        }

<span class='uc' id='L87' title='5|5|5 - Total: 5'>        ScriptableObject.defineProperty(
</span>            scope, "NaN", ScriptRuntime.NaNobj,
            READONLY|DONTENUM|PERMANENT);
<span class='uc' id='L90' title='4|4|4 - Total: 4'>        ScriptableObject.defineProperty(
</span>            scope, "Infinity",
<span class='uc' id='L92' title='2|2|2 - Total: 2'>            ScriptRuntime.wrapNumber(Double.POSITIVE_INFINITY),
</span>            READONLY|DONTENUM|PERMANENT);
<span class='uc' id='L94' title='5|5|5 - Total: 5'>        ScriptableObject.defineProperty(
</span>            scope, "undefined", Undefined.instance,
            READONLY|DONTENUM|PERMANENT);

        /*
            Each error constructor gets its own Error object as a prototype,
            with the 'name' property set to the name of the error.
        */
<span class='uc' id='L102' title='2|2|2 - Total: 2'>        for (TopLevel.NativeErrors error : TopLevel.NativeErrors.values()) {
</span><span class='uc' id='L103' title='2|2|2 - Total: 2'>            if (error == TopLevel.NativeErrors.Error) {
</span>                // Error is initialized elsewhere and we should not overwrite it.
<span class='uc' id='L105' title='1|1|1 - Total: 1'>                continue;
</span>            }
<span class='uc' id='L107' title='3|3|3 - Total: 3'>            String name = error.name();
</span><span class='uc' id='L108' title='4|4|4 - Total: 4'>            ScriptableObject errorProto =
</span><span class='uc' id='L109' title='3|3|3 - Total: 3'>              (ScriptableObject) ScriptRuntime.newBuiltinObject(cx, scope,
</span>                                                  TopLevel.Builtins.Error,
                                                  ScriptRuntime.emptyArgs);
<span class='uc' id='L112' title='5|5|5 - Total: 5'>            errorProto.put("name", errorProto, name);
</span><span class='uc' id='L113' title='5|5|5 - Total: 5'>            errorProto.put("message", errorProto, "");
</span><span class='uc' id='L114' title='10|10|10 - Total: 10'>            IdFunctionObject ctor = new IdFunctionObject(obj, FTAG,
</span>                                                         Id_new_CommonError,
                                                         name, 1, scope);
<span class='uc' id='L117' title='3|3|3 - Total: 3'>            ctor.markAsConstructor(errorProto);
</span><span class='uc' id='L118' title='5|5|5 - Total: 5'>            errorProto.put("constructor", errorProto, ctor);
</span><span class='uc' id='L119' title='4|4|4 - Total: 4'>            errorProto.setAttributes("constructor", ScriptableObject.DONTENUM);
</span><span class='uc' id='L120' title='2|2|2 - Total: 2'>            if (sealed) {
</span><span class='uc' id='L121' title='2|2|2 - Total: 2'>                errorProto.sealObject();
</span><span class='uc' id='L122' title='2|2|2 - Total: 2'>                ctor.sealObject();
</span>            }
<span class='uc' id='L124' title='2|2|2 - Total: 2'>            ctor.exportAsScopeProperty();
</span>        }
<span class='uc' id='L126' title='1|1|1 - Total: 1'>    }
</span>
    public Object execIdCall(IdFunctionObject f, Context cx, Scriptable scope,
                             Scriptable thisObj, Object[] args)
    {
<span class='upc' id='L131' title='1|1|1 - Total: 2'>        if (f.hasTag(FTAG)) {
</span><span class='uc' id='L132' title='3|3|3 - Total: 3'>            int methodId = f.methodId();
</span><span class='upc' id='L133' title='11|11|11 - Total: 13'>            switch (methodId) {
</span>                case Id_decodeURI:
                case Id_decodeURIComponent: {
<span class='uc' id='L136' title='4|4|4 - Total: 4'>                    String str = ScriptRuntime.toString(args, 0);
</span><span class='uc' id='L137' title='2|2|2 - Total: 2'>                    return decode(str, methodId == Id_decodeURI);
</span>                }

                case Id_encodeURI:
                case Id_encodeURIComponent: {
<span class='uc' id='L142' title='4|4|4 - Total: 4'>                    String str = ScriptRuntime.toString(args, 0);
</span><span class='uc' id='L143' title='2|2|2 - Total: 2'>                    return encode(str, methodId == Id_encodeURI);
</span>                }

                case Id_escape:
<span class='uc' id='L147' title='4|4|4 - Total: 4'>                    return js_escape(args);
</span>
                case Id_eval:
<span class='uc' id='L150' title='6|6|6 - Total: 6'>                    return js_eval(cx, scope, args);
</span>
                case Id_isFinite: {
<span class='upc' id='L153' title='1|1|1 - Total: 2'>                    if (args.length < 1) {
</span><span class='nc' id='L154' title='0|0|0 - Total: 2'>                        return Boolean.FALSE;
</span>                    }
<span class='uc' id='L156' title='5|5|5 - Total: 5'>                    return NativeNumber.isFinite(args[0]);
</span>                }

                case Id_isNaN: {
                    // The global method isNaN, as per ECMA-262 15.1.2.6.
                    boolean result;
<span class='uc' id='L162' title='2|2|2 - Total: 2'>                    if (args.length < 1) {
</span><span class='uc' id='L163' title='3|3|3 - Total: 3'>                        result = true;
</span>                    } else {
<span class='uc' id='L165' title='5|5|5 - Total: 5'>                        double d = ScriptRuntime.toNumber(args[0]);
</span><span class='uc' id='L166' title='2|2|2 - Total: 2'>                        result = (d != d);
</span>                    }
<span class='uc' id='L168' title='3|3|3 - Total: 3'>                    return ScriptRuntime.wrapBoolean(result);
</span>                }

                case Id_isXMLName: {
<span class='nc' id='L172' title='0|0|0 - Total: 2'>                    Object name = (args.length == 0)
</span>                                  ? Undefined.instance : args[0];
<span class='nc' id='L174' title='0|0|0 - Total: 3'>                    XMLLib xmlLib = XMLLib.extractFromScope(scope);
</span><span class='nc' id='L175' title='0|0|0 - Total: 5'>                    return ScriptRuntime.wrapBoolean(
</span><span class='nc' id='L176' title='0|0|0 - Total: 1'>                        xmlLib.isXMLName(cx, name));
</span>                }

                case Id_parseFloat:
<span class='uc' id='L180' title='3|3|3 - Total: 3'>                    return js_parseFloat(args);
</span>
                case Id_parseInt:
<span class='uc' id='L183' title='3|3|3 - Total: 3'>                    return js_parseInt(args);
</span>
                case Id_unescape:
<span class='uc' id='L186' title='4|4|4 - Total: 4'>                    return js_unescape(args);
</span>
                case Id_uneval: {
<span class='upc' id='L189' title='1|1|1 - Total: 2'>                    Object value = (args.length != 0)
</span>                                   ? args[0] : Undefined.instance;
<span class='uc' id='L191' title='5|5|5 - Total: 5'>                    return ScriptRuntime.uneval(cx, scope, value);
</span>                }

                case Id_new_CommonError:
                    // The implementation of all the ECMA error constructors
                    // (SyntaxError, TypeError, etc.)
<span class='uc' id='L197' title='6|6|6 - Total: 6'>                    return NativeError.make(cx, scope, f, args);
</span>            }
        }
<span class='nc' id='L200' title='0|0|0 - Total: 3'>        throw f.unknown();
</span>    }

    /**
     * The global method parseInt, as per ECMA-262 15.1.2.2.
     */
    static Object js_parseInt(Object[] args) {
<span class='uc' id='L207' title='4|4|4 - Total: 4'>        String s = ScriptRuntime.toString(args, 0);
</span><span class='uc' id='L208' title='4|4|4 - Total: 4'>        int radix = ScriptRuntime.toInt32(args, 1);
</span>
<span class='uc' id='L210' title='3|3|3 - Total: 3'>        int len = s.length();
</span><span class='upc' id='L211' title='1|1|1 - Total: 2'>        if (len == 0)
</span><span class='nc' id='L212' title='0|0|0 - Total: 2'>            return ScriptRuntime.NaNobj;
</span>
<span class='uc' id='L214' title='2|2|2 - Total: 2'>        boolean negative = false;
</span><span class='uc' id='L215' title='2|2|2 - Total: 2'>        int start = 0;
</span>        char c;
        do {
<span class='uc' id='L218' title='4|4|4 - Total: 4'>            c = s.charAt(start);
</span><span class='uc' id='L219' title='2|2|2 - Total: 2'>            if (!ScriptRuntime.isStrWhiteSpaceChar(c))
</span><span class='uc' id='L220' title='1|1|1 - Total: 1'>                break;
</span><span class='uc' id='L221' title='1|1|1 - Total: 1'>            start++;
</span><span class='upc' id='L222' title='1|1|1 - Total: 2'>        } while (start < len);
</span>
<span class='uc' id='L224' title='6|6|6 - Total: 6'>        if (c == '+' || (negative = (c == '-')))
</span><span class='uc' id='L225' title='1|1|1 - Total: 1'>            start++;
</span>
<span class='uc' id='L227' title='2|2|2 - Total: 2'>        final int NO_RADIX = -1;
</span><span class='uc' id='L228' title='2|2|2 - Total: 2'>        if (radix == 0) {
</span><span class='uc' id='L229' title='3|3|3 - Total: 3'>            radix = NO_RADIX;
</span><span class='upc' id='L230' title='3|3|3 - Total: 4'>        } else if (radix < 2 || radix > 36) {
</span><span class='uc' id='L231' title='2|2|2 - Total: 2'>            return ScriptRuntime.NaNobj;
</span><span class='upc' id='L232' title='4|4|4 - Total: 6'>        } else if (radix == 16 && len - start > 1 && s.charAt(start) == '0') {
</span><span class='uc' id='L233' title='6|6|6 - Total: 6'>            c = s.charAt(start+1);
</span><span class='upc' id='L234' title='1|1|1 - Total: 4'>            if (c == 'x' || c == 'X')
</span><span class='uc' id='L235' title='1|1|1 - Total: 1'>                start += 2;
</span>        }

<span class='uc' id='L238' title='2|2|2 - Total: 2'>        if (radix == NO_RADIX) {
</span><span class='uc' id='L239' title='2|2|2 - Total: 2'>            radix = 10;
</span><span class='uc' id='L240' title='4|4|4 - Total: 4'>            if (len - start > 1 && s.charAt(start) == '0') {
</span><span class='uc' id='L241' title='6|6|6 - Total: 6'>                c = s.charAt(start+1);
</span><span class='upc' id='L242' title='3|3|3 - Total: 4'>                if (c == 'x' || c == 'X') {
</span><span class='uc' id='L243' title='2|2|2 - Total: 2'>                    radix = 16;
</span><span class='uc' id='L244' title='2|2|2 - Total: 2'>                    start += 2;
</span><span class='upc' id='L245' title='3|3|3 - Total: 4'>                } else if ('0' <= c && c <= '9') {
</span><span class='uc' id='L246' title='2|2|2 - Total: 2'>                    radix = 8;
</span><span class='uc' id='L247' title='1|1|1 - Total: 1'>                    start++;
</span>                }
            }
        }

<span class='uc' id='L252' title='5|5|5 - Total: 5'>        double d = ScriptRuntime.stringPrefixToNumber(s, start, radix);
</span><span class='uc' id='L253' title='2|2|2 - Total: 2'>        return ScriptRuntime.wrapNumber(negative ? -d : d);
</span>    }

    /**
     * The global method parseFloat, as per ECMA-262 15.1.2.3.
     *
     * @param args the arguments to parseFloat, ignoring args[>=1]
     */
    static Object js_parseFloat(Object[] args)
    {
<span class='upc' id='L263' title='1|1|1 - Total: 2'>        if (args.length < 1)
</span><span class='nc' id='L264' title='0|0|0 - Total: 2'>            return ScriptRuntime.NaNobj;
</span>
<span class='uc' id='L266' title='5|5|5 - Total: 5'>        String s = ScriptRuntime.toString(args[0]);
</span><span class='uc' id='L267' title='3|3|3 - Total: 3'>        int len = s.length();
</span><span class='uc' id='L268' title='2|2|2 - Total: 2'>        int start = 0;
</span>        // Scan forward to skip whitespace
        char c;
        for (;;) {
<span class='upc' id='L272' title='1|1|1 - Total: 2'>            if (start == len) {
</span><span class='nc' id='L273' title='0|0|0 - Total: 2'>                return ScriptRuntime.NaNobj;
</span>            }
<span class='uc' id='L275' title='4|4|4 - Total: 4'>            c = s.charAt(start);
</span><span class='uc' id='L276' title='2|2|2 - Total: 2'>            if (!ScriptRuntime.isStrWhiteSpaceChar(c)) {
</span><span class='uc' id='L277' title='1|1|1 - Total: 1'>                break;
</span>            }
<span class='uc' id='L279' title='2|2|2 - Total: 2'>            ++start;
</span>        }

<span class='uc' id='L282' title='2|2|2 - Total: 2'>        int i = start;
</span><span class='uc' id='L283' title='4|4|4 - Total: 4'>        if (c == '+' || c == '-') {
</span><span class='uc' id='L284' title='1|1|1 - Total: 1'>            ++i;
</span><span class='upc' id='L285' title='1|1|1 - Total: 2'>            if (i == len) {
</span><span class='nc' id='L286' title='0|0|0 - Total: 2'>                return ScriptRuntime.NaNobj;
</span>            }
<span class='uc' id='L288' title='4|4|4 - Total: 4'>            c = s.charAt(i);
</span>        }

<span class='uc' id='L291' title='2|2|2 - Total: 2'>        if (c == 'I') {
</span>            // check for "Infinity"
<span class='upc' id='L293' title='2|2|2 - Total: 4'>            if (i+8 <= len && s.regionMatches(i, "Infinity", 0, 8)) {
</span>                double d;
<span class='uc' id='L295' title='2|2|2 - Total: 2'>                if (s.charAt(start) == '-') {
</span><span class='uc' id='L296' title='3|3|3 - Total: 3'>                    d = Double.NEGATIVE_INFINITY;
</span>                } else {
<span class='uc' id='L298' title='2|2|2 - Total: 2'>                    d = Double.POSITIVE_INFINITY;
</span>                }
<span class='uc' id='L300' title='3|3|3 - Total: 3'>                return ScriptRuntime.wrapNumber(d);
</span>            }
<span class='nc' id='L302' title='0|0|0 - Total: 2'>            return ScriptRuntime.NaNobj;
</span>        }

        // Find the end of the legal bit
<span class='uc' id='L306' title='2|2|2 - Total: 2'>        int decimal = -1;
</span><span class='uc' id='L307' title='2|2|2 - Total: 2'>        int exponent = -1;
</span><span class='uc' id='L308' title='2|2|2 - Total: 2'>        boolean exponentValid = false;
</span><span class='uc' id='L309' title='2|2|2 - Total: 2'>        for (; i < len; i++) {
</span><span class='uc' id='L310' title='5|5|5 - Total: 5'>            switch (s.charAt(i)) {
</span>              case '.':
<span class='upc' id='L312' title='1|1|1 - Total: 2'>                if (decimal != -1) // Only allow a single decimal point.
</span><span class='nc' id='L313' title='0|0|0 - Total: 1'>                    break;
</span><span class='uc' id='L314' title='2|2|2 - Total: 2'>                decimal = i;
</span><span class='uc' id='L315' title='1|1|1 - Total: 1'>                continue;
</span>
              case 'e':
              case 'E':
<span class='uc' id='L319' title='2|2|2 - Total: 2'>                if (exponent != -1) {
</span><span class='uc' id='L320' title='1|1|1 - Total: 1'>                    break;
</span><span class='uc' id='L321' title='2|2|2 - Total: 2'>                } else if (i == len - 1) {
</span><span class='uc' id='L322' title='1|1|1 - Total: 1'>                    break;
</span>                }
<span class='uc' id='L324' title='2|2|2 - Total: 2'>                exponent = i;
</span><span class='uc' id='L325' title='1|1|1 - Total: 1'>                continue;
</span>
              case '+':
              case '-':
                 // Only allow '+' or '-' after 'e' or 'E'
<span class='uc' id='L330' title='2|2|2 - Total: 2'>                if (exponent != i-1) {
</span><span class='uc' id='L331' title='1|1|1 - Total: 1'>                    break;
</span><span class='uc' id='L332' title='2|2|2 - Total: 2'>                } else if (i == len - 1) {
</span><span class='uc' id='L333' title='1|1|1 - Total: 1'>                    --i;
</span><span class='uc' id='L334' title='1|1|1 - Total: 1'>                    break;
</span>                }
                continue;

              case '0': case '1': case '2': case '3': case '4':
              case '5': case '6': case '7': case '8': case '9':
<span class='uc' id='L340' title='2|2|2 - Total: 2'>                if (exponent != -1) {
</span><span class='uc' id='L341' title='3|3|3 - Total: 3'>                    exponentValid = true;
</span>                }
                continue;

              default:
<span class='uc' id='L346' title='1|1|1 - Total: 1'>                break;
</span>            }
            break;
        }
<span class='uc' id='L350' title='4|4|4 - Total: 4'>        if (exponent != -1 && !exponentValid) {
</span><span class='uc' id='L351' title='2|2|2 - Total: 2'>            i = exponent;
</span>        }
<span class='uc' id='L353' title='5|5|5 - Total: 5'>        s = s.substring(start, i);
</span>        try {
<span class='uc' id='L355' title='3|3|3 - Total: 3'>            return Double.valueOf(s);
</span>        }
<span class='uc' id='L357' title='1|1|1 - Total: 1'>        catch (NumberFormatException ex) {
</span><span class='uc' id='L358' title='2|2|2 - Total: 2'>            return ScriptRuntime.NaNobj;
</span>        }
    }

    /**
     * The global method escape, as per ECMA-262 15.1.2.4.

     * Includes code for the 'mask' argument supported by the C escape
     * method, which used to be part of the browser imbedding.  Blame
     * for the strange constant names should be directed there.
     */

    private Object js_escape(Object[] args) {
        final int
<span class='uc' id='L372' title='2|2|2 - Total: 2'>            URL_XALPHAS = 1,
</span><span class='uc' id='L373' title='2|2|2 - Total: 2'>            URL_XPALPHAS = 2,
</span><span class='uc' id='L374' title='2|2|2 - Total: 2'>            URL_PATH = 4;
</span>
<span class='uc' id='L376' title='4|4|4 - Total: 4'>        String s = ScriptRuntime.toString(args, 0);
</span>
<span class='uc' id='L378' title='2|2|2 - Total: 2'>        int mask = URL_XALPHAS | URL_XPALPHAS | URL_PATH;
</span><span class='upc' id='L379' title='1|1|1 - Total: 2'>        if (args.length > 1) { // the 'mask' argument.  Non-ECMA.
</span><span class='nc' id='L380' title='0|0|0 - Total: 5'>            double d = ScriptRuntime.toNumber(args[1]);
</span><span class='nc' id='L381' title='0|0|0 - Total: 6'>            if (d != d || ((mask = (int) d) != d) ||
</span>                0 != (mask & ~(URL_XALPHAS | URL_XPALPHAS | URL_PATH)))
            {
<span class='nc' id='L384' title='0|0|0 - Total: 3'>                throw Context.reportRuntimeError0("msg.bad.esc.mask");
</span>            }
        }

<span class='uc' id='L388' title='2|2|2 - Total: 2'>        StringBuilder sb = null;
</span><span class='uc' id='L389' title='2|2|2 - Total: 2'>        for (int k = 0, L = s.length(); k != L; ++k) {
</span><span class='uc' id='L390' title='4|4|4 - Total: 4'>            int c = s.charAt(k);
</span><span class='upc' id='L391' title='18|18|18 - Total: 30'>            if (mask != 0
</span>                && ((c >= '0' && c <= '9')
                    || (c >= 'A' && c <= 'Z') || (c >= 'a' && c <= 'z')
                    || c == '@' || c == '*' || c == '_' || c == '-' || c == '.'
                    || (0 != (mask & URL_PATH) && (c == '/' || c == '+'))))
            {
<span class='upc' id='L397' title='1|1|1 - Total: 2'>                if (sb != null) {
</span><span class='nc' id='L398' title='0|0|0 - Total: 6'>                    sb.append((char)c);
</span>                }
            } else {
<span class='upc' id='L401' title='1|1|1 - Total: 2'>                if (sb == null) {
</span><span class='uc' id='L402' title='7|7|7 - Total: 7'>                    sb = new StringBuilder(L + 3);
</span><span class='uc' id='L403' title='4|4|4 - Total: 4'>                    sb.append(s);
</span><span class='uc' id='L404' title='3|3|3 - Total: 3'>                    sb.setLength(k);
</span>                }

                int hexSize;
<span class='upc' id='L408' title='1|1|1 - Total: 2'>                if (c < 256) {
</span><span class='upc' id='L409' title='1|1|1 - Total: 4'>                    if (c == ' ' && mask == URL_XPALPHAS) {
</span><span class='nc' id='L410' title='0|0|0 - Total: 4'>                        sb.append('+');
</span><span class='nc' id='L411' title='0|0|0 - Total: 1'>                        continue;
</span>                    }
<span class='uc' id='L413' title='4|4|4 - Total: 4'>                    sb.append('%');
</span><span class='uc' id='L414' title='3|3|3 - Total: 3'>                    hexSize = 2;
</span>                } else {
<span class='nc' id='L416' title='0|0|0 - Total: 4'>                    sb.append('%');
</span><span class='nc' id='L417' title='0|0|0 - Total: 4'>                    sb.append('u');
</span><span class='nc' id='L418' title='0|0|0 - Total: 2'>                    hexSize = 4;
</span>                }

                // append hexadecimal form of c left-padded with 0
<span class='uc' id='L422' title='2|2|2 - Total: 2'>                for (int shift = (hexSize - 1) * 4; shift >= 0; shift -= 4) {
</span><span class='uc' id='L423' title='6|6|6 - Total: 6'>                    int digit = 0xf & (c >> shift);
</span><span class='upc' id='L424' title='1|1|1 - Total: 2'>                    int hc = (digit < 10) ? '0' + digit : 'A' - 10 + digit;
</span><span class='uc' id='L425' title='5|5|5 - Total: 5'>                    sb.append((char)hc);
</span>                }
            }
        }

<span class='uc' id='L430' title='2|2|2 - Total: 2'>        return (sb == null) ? s : sb.toString();
</span>    }

    /**
     * The global unescape method, as per ECMA-262 15.1.2.5.
     */

    private Object js_unescape(Object[] args)
    {
<span class='uc' id='L439' title='4|4|4 - Total: 4'>        String s = ScriptRuntime.toString(args, 0);
</span><span class='uc' id='L440' title='4|4|4 - Total: 4'>        int firstEscapePos = s.indexOf('%');
</span><span class='upc' id='L441' title='1|1|1 - Total: 2'>        if (firstEscapePos >= 0) {
</span><span class='uc' id='L442' title='3|3|3 - Total: 3'>            int L = s.length();
</span><span class='uc' id='L443' title='3|3|3 - Total: 3'>            char[] buf = s.toCharArray();
</span><span class='uc' id='L444' title='2|2|2 - Total: 2'>            int destination = firstEscapePos;
</span><span class='uc' id='L445' title='2|2|2 - Total: 2'>            for (int k = firstEscapePos; k != L;) {
</span><span class='uc' id='L446' title='4|4|4 - Total: 4'>                char c = buf[k];
</span><span class='uc' id='L447' title='1|1|1 - Total: 1'>                ++k;
</span><span class='upc' id='L448' title='3|3|3 - Total: 4'>                if (c == '%' && k != L) {
</span>                    int end, start;
<span class='uc' id='L450' title='2|2|2 - Total: 2'>                    if (buf[k] == 'u') {
</span><span class='uc' id='L451' title='4|4|4 - Total: 4'>                        start = k + 1;
</span><span class='uc' id='L452' title='5|5|5 - Total: 5'>                        end = k + 5;
</span>                    } else {
<span class='uc' id='L454' title='2|2|2 - Total: 2'>                        start = k;
</span><span class='uc' id='L455' title='4|4|4 - Total: 4'>                        end = k + 2;
</span>                    }
<span class='uc' id='L457' title='2|2|2 - Total: 2'>                    if (end <= L) {
</span><span class='uc' id='L458' title='2|2|2 - Total: 2'>                        int x = 0;
</span><span class='uc' id='L459' title='2|2|2 - Total: 2'>                        for (int i = start; i != end; ++i) {
</span><span class='uc' id='L460' title='6|6|6 - Total: 6'>                            x = Kit.xDigitToInt(buf[i], x);
</span>                        }
<span class='uc' id='L462' title='2|2|2 - Total: 2'>                        if (x >= 0) {
</span><span class='uc' id='L463' title='3|3|3 - Total: 3'>                            c = (char)x;
</span><span class='uc' id='L464' title='2|2|2 - Total: 2'>                            k = end;
</span>                        }
                    }
                }
<span class='uc' id='L468' title='4|4|4 - Total: 4'>                buf[destination] = c;
</span><span class='uc' id='L469' title='1|1|1 - Total: 1'>                ++destination;
</span><span class='uc' id='L470' title='1|1|1 - Total: 1'>            }
</span><span class='uc' id='L471' title='7|7|7 - Total: 7'>            s = new String(buf, 0, destination);
</span>        }
<span class='uc' id='L473' title='2|2|2 - Total: 2'>        return s;
</span>    }

    /**
     * This is an indirect call to eval, and thus uses the global environment.
     * Direct calls are executed via ScriptRuntime.callSpecial().
     */
    private Object js_eval(Context cx, Scriptable scope, Object[] args)
    {
<span class='uc' id='L482' title='3|3|3 - Total: 3'>        Scriptable global = ScriptableObject.getTopLevelScope(scope);
</span><span class='uc' id='L483' title='8|8|8 - Total: 8'>        return ScriptRuntime.evalSpecial(cx, global, global, args, "eval code", 1);
</span>    }

    static boolean isEvalFunction(Object functionObj)
    {
<span class='upc' id='L488' title='1|1|1 - Total: 2'>        if (functionObj instanceof IdFunctionObject) {
</span><span class='uc' id='L489' title='3|3|3 - Total: 3'>            IdFunctionObject function = (IdFunctionObject)functionObj;
</span><span class='upc' id='L490' title='2|2|2 - Total: 4'>            if (function.hasTag(FTAG) && function.methodId() == Id_eval) {
</span><span class='uc' id='L491' title='2|2|2 - Total: 2'>                return true;
</span>            }
        }
<span class='nc' id='L494' title='0|0|0 - Total: 2'>        return false;
</span>    }

    /**
     * @deprecated Use {@link ScriptRuntime#constructError(String,String)}
     * instead.
     */
    @Deprecated
    public static EcmaError constructError(Context cx,
                                           String error,
                                           String message,
                                           Scriptable scope)
    {
<span class='nc' id='L507' title='0|0|0 - Total: 4'>        return ScriptRuntime.constructError(error, message);
</span>    }

    /**
     * @deprecated Use
     * {@link ScriptRuntime#constructError(String,String,String,int,String,int)}
     * instead.
     */
    @Deprecated
    public static EcmaError constructError(Context cx,
                                           String error,
                                           String message,
                                           Scriptable scope,
                                           String sourceName,
                                           int lineNumber,
                                           int columnNumber,
                                           String lineSource)
    {
<span class='nc' id='L525' title='0|0|0 - Total: 8'>        return ScriptRuntime.constructError(error, message,
</span>                                            sourceName, lineNumber,
                                            lineSource, columnNumber);
    }

    /*
    *   ECMA 3, 15.1.3 URI Handling Function Properties
    *
    *   The following are implementations of the algorithms
    *   given in the ECMA specification for the hidden functions
    *   'Encode' and 'Decode'.
    */
    private static String encode(String str, boolean fullUri) {
<span class='uc' id='L538' title='2|2|2 - Total: 2'>        byte[] utf8buf = null;
</span><span class='uc' id='L539' title='2|2|2 - Total: 2'>        StringBuilder sb = null;
</span>
<span class='uc' id='L541' title='2|2|2 - Total: 2'>        for (int k = 0, length = str.length(); k != length; ++k) {
</span><span class='uc' id='L542' title='4|4|4 - Total: 4'>            char C = str.charAt(k);
</span><span class='uc' id='L543' title='2|2|2 - Total: 2'>            if (encodeUnescaped(C, fullUri)) {
</span><span class='upc' id='L544' title='1|1|1 - Total: 2'>                if (sb != null) {
</span><span class='uc' id='L545' title='5|5|5 - Total: 5'>                    sb.append(C);
</span>                }
            } else {
<span class='uc' id='L548' title='2|2|2 - Total: 2'>                if (sb == null) {
</span><span class='uc' id='L549' title='7|7|7 - Total: 7'>                    sb = new StringBuilder(length + 3);
</span><span class='uc' id='L550' title='4|4|4 - Total: 4'>                    sb.append(str);
</span><span class='uc' id='L551' title='3|3|3 - Total: 3'>                    sb.setLength(k);
</span><span class='uc' id='L552' title='3|3|3 - Total: 3'>                    utf8buf = new byte[6];
</span>                }
<span class='upc' id='L554' title='1|1|1 - Total: 4'>                if (0xDC00 <= C && C <= 0xDFFF) {
</span><span class='nc' id='L555' title='0|0|0 - Total: 2'>                    throw uriError();
</span>                }
                int V;
<span class='upc' id='L558' title='1|1|1 - Total: 4'>                if (C < 0xD800 || 0xDBFF < C) {
</span><span class='uc' id='L559' title='3|3|3 - Total: 3'>                    V = C;
</span>                } else {
<span class='nc' id='L561' title='0|0|0 - Total: 1'>                    k++;
</span><span class='nc' id='L562' title='0|0|0 - Total: 2'>                    if (k == length) {
</span><span class='nc' id='L563' title='0|0|0 - Total: 2'>                        throw uriError();
</span>                    }
<span class='nc' id='L565' title='0|0|0 - Total: 4'>                    char C2 = str.charAt(k);
</span><span class='nc' id='L566' title='0|0|0 - Total: 4'>                    if (!(0xDC00 <= C2 && C2 <= 0xDFFF)) {
</span><span class='nc' id='L567' title='0|0|0 - Total: 2'>                        throw uriError();
</span>                    }
<span class='nc' id='L569' title='0|0|0 - Total: 12'>                    V = ((C - 0xD800) << 10) + (C2 - 0xDC00) + 0x10000;
</span>                }
<span class='uc' id='L571' title='4|4|4 - Total: 4'>                int L = oneUcs4ToUtf8Char(utf8buf, V);
</span><span class='uc' id='L572' title='2|2|2 - Total: 2'>                for (int j = 0; j < L; j++) {
</span><span class='uc' id='L573' title='6|6|6 - Total: 6'>                    int d = 0xff & utf8buf[j];
</span><span class='uc' id='L574' title='4|4|4 - Total: 4'>                    sb.append('%');
</span><span class='uc' id='L575' title='7|7|7 - Total: 7'>                    sb.append(toHexChar(d >>> 4));
</span><span class='uc' id='L576' title='7|7|7 - Total: 7'>                    sb.append(toHexChar(d & 0xf));
</span>                }
            }
        }
<span class='upc' id='L580' title='1|1|1 - Total: 2'>        return (sb == null) ? str : sb.toString();
</span>    }

    private static char toHexChar(int i) {
<span class='upc' id='L584' title='1|1|1 - Total: 2'>        if (i >> 4 != 0) Kit.codeBug();
</span><span class='uc' id='L585' title='2|2|2 - Total: 2'>        return (char)((i < 10) ? i + '0' : i - 10 + 'A');
</span>    }

    private static int unHex(char c) {
<span class='upc' id='L589' title='3|3|3 - Total: 4'>        if ('A' <= c && c <= 'F') {
</span><span class='uc' id='L590' title='6|6|6 - Total: 6'>            return c - 'A' + 10;
</span><span class='upc' id='L591' title='1|1|1 - Total: 4'>        } else if ('a' <= c && c <= 'f') {
</span><span class='nc' id='L592' title='0|0|0 - Total: 6'>            return c - 'a' + 10;
</span><span class='upc' id='L593' title='2|2|2 - Total: 4'>        } else if ('0' <= c && c <= '9') {
</span><span class='uc' id='L594' title='4|4|4 - Total: 4'>            return c - '0';
</span>        } else {
<span class='nc' id='L596' title='0|0|0 - Total: 2'>            return -1;
</span>        }
    }

    private static int unHex(char c1, char c2) {
<span class='uc' id='L601' title='3|3|3 - Total: 3'>        int i1 = unHex(c1);
</span><span class='uc' id='L602' title='3|3|3 - Total: 3'>        int i2 = unHex(c2);
</span><span class='upc' id='L603' title='2|2|2 - Total: 4'>        if (i1 >= 0 && i2 >= 0) {
</span><span class='uc' id='L604' title='6|6|6 - Total: 6'>            return (i1 << 4) | i2;
</span>        }
<span class='nc' id='L606' title='0|0|0 - Total: 2'>        return -1;
</span>    }

    private static String decode(String str, boolean fullUri) {
<span class='uc' id='L610' title='2|2|2 - Total: 2'>        char[] buf = null;
</span><span class='uc' id='L611' title='2|2|2 - Total: 2'>        int bufTop = 0;
</span>
<span class='uc' id='L613' title='2|2|2 - Total: 2'>        for (int k = 0, length = str.length(); k != length;) {
</span><span class='uc' id='L614' title='4|4|4 - Total: 4'>            char C = str.charAt(k);
</span><span class='uc' id='L615' title='2|2|2 - Total: 2'>            if (C != '%') {
</span><span class='upc' id='L616' title='1|1|1 - Total: 2'>                if (buf != null) {
</span><span class='uc' id='L617' title='5|5|5 - Total: 5'>                    buf[bufTop++] = C;
</span>                }
<span class='uc' id='L619' title='2|2|2 - Total: 2'>                ++k;
</span>            } else {
<span class='uc' id='L621' title='2|2|2 - Total: 2'>                if (buf == null) {
</span>                    // decode always compress so result can not be bigger then
                    // str.length()
<span class='uc' id='L624' title='3|3|3 - Total: 3'>                    buf = new char[length];
</span><span class='uc' id='L625' title='6|6|6 - Total: 6'>                    str.getChars(0, k, buf, 0);
</span><span class='uc' id='L626' title='2|2|2 - Total: 2'>                    bufTop = k;
</span>                }
<span class='uc' id='L628' title='2|2|2 - Total: 2'>                int start = k;
</span><span class='upc' id='L629' title='1|1|1 - Total: 2'>                if (k + 3 > length)
</span><span class='nc' id='L630' title='0|0|0 - Total: 2'>                    throw uriError();
</span><span class='uc' id='L631' title='12|12|12 - Total: 12'>                int B = unHex(str.charAt(k + 1), str.charAt(k + 2));
</span><span class='upc' id='L632' title='1|1|1 - Total: 2'>                if (B < 0) throw uriError();
</span><span class='uc' id='L633' title='1|1|1 - Total: 1'>                k += 3;
</span><span class='uc' id='L634' title='2|2|2 - Total: 2'>                if ((B & 0x80) == 0) {
</span><span class='uc' id='L635' title='4|4|4 - Total: 4'>                    C = (char)B;
</span>                } else {
                    // Decode UTF-8 sequence into ucs4Char and encode it into
                    // UTF-16
                    int utf8Tail, ucs4Char, minUcs4Char;
<span class='upc' id='L640' title='1|1|1 - Total: 2'>                    if ((B & 0xC0) == 0x80) {
</span>                        // First  UTF-8 should be ouside 0x80..0xBF
<span class='nc' id='L642' title='0|0|0 - Total: 2'>                        throw uriError();
</span><span class='uc' id='L643' title='2|2|2 - Total: 2'>                    } else if ((B & 0x20) == 0) {
</span><span class='uc' id='L644' title='6|6|6 - Total: 6'>                        utf8Tail = 1; ucs4Char = B & 0x1F;
</span><span class='uc' id='L645' title='3|3|3 - Total: 3'>                        minUcs4Char = 0x80;
</span><span class='uc' id='L646' title='2|2|2 - Total: 2'>                    } else if ((B & 0x10) == 0) {
</span><span class='uc' id='L647' title='6|6|6 - Total: 6'>                        utf8Tail = 2; ucs4Char = B & 0x0F;
</span><span class='uc' id='L648' title='3|3|3 - Total: 3'>                        minUcs4Char = 0x800;
</span><span class='uc' id='L649' title='2|2|2 - Total: 2'>                    } else if ((B & 0x08) == 0) {
</span><span class='uc' id='L650' title='6|6|6 - Total: 6'>                        utf8Tail = 3; ucs4Char = B & 0x07;
</span><span class='uc' id='L651' title='3|3|3 - Total: 3'>                        minUcs4Char = 0x10000;
</span><span class='uc' id='L652' title='2|2|2 - Total: 2'>                    } else if ((B & 0x04) == 0) {
</span><span class='uc' id='L653' title='6|6|6 - Total: 6'>                        utf8Tail = 4; ucs4Char = B & 0x03;
</span><span class='uc' id='L654' title='3|3|3 - Total: 3'>                        minUcs4Char = 0x200000;
</span><span class='upc' id='L655' title='1|1|1 - Total: 2'>                    } else if ((B & 0x02) == 0) {
</span><span class='uc' id='L656' title='6|6|6 - Total: 6'>                        utf8Tail = 5; ucs4Char = B & 0x01;
</span><span class='uc' id='L657' title='3|3|3 - Total: 3'>                        minUcs4Char = 0x4000000;
</span>                    } else {
                        // First UTF-8 can not be 0xFF or 0xFE
<span class='nc' id='L660' title='0|0|0 - Total: 2'>                        throw uriError();
</span>                    }
<span class='upc' id='L662' title='1|1|1 - Total: 2'>                    if (k + 3 * utf8Tail > length)
</span><span class='nc' id='L663' title='0|0|0 - Total: 2'>                        throw uriError();
</span><span class='uc' id='L664' title='2|2|2 - Total: 2'>                    for (int j = 0; j != utf8Tail; j++) {
</span><span class='upc' id='L665' title='1|1|1 - Total: 2'>                        if (str.charAt(k) != '%')
</span><span class='nc' id='L666' title='0|0|0 - Total: 2'>                            throw uriError();
</span><span class='uc' id='L667' title='12|12|12 - Total: 12'>                        B = unHex(str.charAt(k + 1), str.charAt(k + 2));
</span><span class='upc' id='L668' title='3|3|3 - Total: 4'>                        if (B < 0 || (B & 0xC0) != 0x80)
</span><span class='uc' id='L669' title='2|2|2 - Total: 2'>                            throw uriError();
</span><span class='uc' id='L670' title='8|8|8 - Total: 8'>                        ucs4Char = (ucs4Char << 6) | (B & 0x3F);
</span><span class='uc' id='L671' title='1|1|1 - Total: 1'>                        k += 3;
</span>                    }
                    // Check for overlongs and other should-not-present codes
<span class='uc' id='L674' title='6|6|6 - Total: 6'>                    if (ucs4Char < minUcs4Char
</span>                            || (ucs4Char >= 0xD800 && ucs4Char <= 0xDFFF)) {
<span class='uc' id='L676' title='3|3|3 - Total: 3'>                        ucs4Char = INVALID_UTF8;
</span><span class='upc' id='L677' title='2|2|2 - Total: 4'>                    } else if (ucs4Char == 0xFFFE || ucs4Char == 0xFFFF) {
</span><span class='nc' id='L678' title='0|0|0 - Total: 2'>                        ucs4Char = 0xFFFD;
</span>                    }
<span class='uc' id='L680' title='2|2|2 - Total: 2'>                    if (ucs4Char >= 0x10000) {
</span><span class='uc' id='L681' title='4|4|4 - Total: 4'>                        ucs4Char -= 0x10000;
</span><span class='uc' id='L682' title='2|2|2 - Total: 2'>                        if (ucs4Char > 0xFFFFF) {
</span><span class='uc' id='L683' title='2|2|2 - Total: 2'>                            throw uriError();
</span>                        }
<span class='uc' id='L685' title='7|7|7 - Total: 7'>                        char H = (char)((ucs4Char >>> 10) + 0xD800);
</span><span class='uc' id='L686' title='7|7|7 - Total: 7'>                        C = (char)((ucs4Char & 0x3FF) + 0xDC00);
</span><span class='uc' id='L687' title='5|5|5 - Total: 5'>                        buf[bufTop++] = H;
</span><span class='uc' id='L688' title='1|1|1 - Total: 1'>                    } else {
</span><span class='uc' id='L689' title='3|3|3 - Total: 3'>                        C = (char)ucs4Char;
</span>                    }
                }
<span class='upc' id='L692' title='3|3|3 - Total: 4'>                if (fullUri && URI_DECODE_RESERVED.indexOf(C) >= 0) {
</span><span class='nc' id='L693' title='0|0|0 - Total: 2'>                    for (int x = start; x != k; x++) {
</span><span class='nc' id='L694' title='0|0|0 - Total: 7'>                        buf[bufTop++] = str.charAt(x);
</span>                    }
                } else {
<span class='uc' id='L697' title='5|5|5 - Total: 5'>                    buf[bufTop++] = C;
</span>                }
            }
<span class='uc' id='L700' title='1|1|1 - Total: 1'>        }
</span><span class='upc' id='L701' title='1|1|1 - Total: 2'>        return (buf == null) ? str : new String(buf, 0, bufTop);
</span>    }

    private static boolean encodeUnescaped(char c, boolean fullUri) {
<span class='upc' id='L705' title='10|10|10 - Total: 12'>        if (('A' <= c && c <= 'Z') || ('a' <= c && c <= 'z')
</span>                || ('0' <= c && c <= '9')) {
<span class='uc' id='L707' title='2|2|2 - Total: 2'>            return true;
</span>        }
<span class='uc' id='L709' title='2|2|2 - Total: 2'>        if ("-_.!~*'()".indexOf(c) >= 0) {
</span><span class='uc' id='L710' title='2|2|2 - Total: 2'>            return true;
</span>        }
<span class='uc' id='L712' title='2|2|2 - Total: 2'>        if (fullUri) {
</span><span class='uc' id='L713' title='2|2|2 - Total: 2'>            return URI_DECODE_RESERVED.indexOf(c) >= 0;
</span>        }
<span class='uc' id='L715' title='2|2|2 - Total: 2'>        return false;
</span>    }

    private static EcmaError uriError() {
<span class='uc' id='L719' title='4|4|4 - Total: 4'>        return ScriptRuntime.constructError("URIError",
</span><span class='uc' id='L720' title='1|1|1 - Total: 1'>                ScriptRuntime.getMessage0("msg.bad.uri"));
</span>    }

    private static final String URI_DECODE_RESERVED = ";/?:@&=+$,#";
    private static final int INVALID_UTF8 = Integer.MAX_VALUE;

    /* Convert one UCS-4 char and write it into a UTF-8 buffer, which must be
    * at least 6 bytes long.  Return the number of UTF-8 bytes of data written.
    */
    private static int oneUcs4ToUtf8Char(byte[] utf8Buffer, int ucs4Char) {
<span class='uc' id='L730' title='2|2|2 - Total: 2'>        int utf8Length = 1;
</span>
        //JS_ASSERT(ucs4Char <= 0x7FFFFFFF);
<span class='upc' id='L733' title='1|1|1 - Total: 2'>        if ((ucs4Char & ~0x7F) == 0)
</span><span class='uc' id='L734' title='6|6|6 - Total: 6'>            utf8Buffer[0] = (byte)ucs4Char;
</span>        else {
            int i;
<span class='nc' id='L737' title='0|0|0 - Total: 4'>            int a = ucs4Char >>> 11;
</span><span class='nc' id='L738' title='0|0|0 - Total: 2'>            utf8Length = 2;
</span><span class='nc' id='L739' title='0|0|0 - Total: 2'>            while (a != 0) {
</span><span class='nc' id='L740' title='0|0|0 - Total: 4'>                a >>>= 5;
</span><span class='nc' id='L741' title='0|0|0 - Total: 2'>                utf8Length++;
</span>            }
<span class='nc' id='L743' title='0|0|0 - Total: 2'>            i = utf8Length;
</span><span class='nc' id='L744' title='0|0|0 - Total: 2'>            while (--i > 0) {
</span><span class='nc' id='L745' title='0|0|0 - Total: 9'>                utf8Buffer[i] = (byte)((ucs4Char & 0x3F) | 0x80);
</span><span class='nc' id='L746' title='0|0|0 - Total: 5'>                ucs4Char >>>= 6;
</span>            }
<span class='nc' id='L748' title='0|0|0 - Total: 13'>            utf8Buffer[0] = (byte)(0x100 - (1 << (8-utf8Length)) + ucs4Char);
</span>        }
<span class='uc' id='L750' title='2|2|2 - Total: 2'>        return utf8Length;
</span>    }

<span class='uc' id='L753' title='3|3|3 - Total: 3'>    private static final Object FTAG = "Global";
</span>
    private static final int
        Id_decodeURI           =  1,
        Id_decodeURIComponent  =  2,
        Id_encodeURI           =  3,
        Id_encodeURIComponent  =  4,
        Id_escape              =  5,
        Id_eval                =  6,
        Id_isFinite            =  7,
        Id_isNaN               =  8,
        Id_isXMLName           =  9,
        Id_parseFloat          = 10,
        Id_parseInt            = 11,
        Id_unescape            = 12,
        Id_uneval              = 13,

        LAST_SCOPE_FUNCTION_ID = 13,

        Id_new_CommonError     = 14;
}
</pre></body></html><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table>