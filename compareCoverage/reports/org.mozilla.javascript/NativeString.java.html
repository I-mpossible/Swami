<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml' lang='en'><head><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><title>org.mozilla.javascript.NativeString.java</title><link rel='stylesheet' href='../.resources/report.css' type='text/css'/><link rel='stylesheet' href='../.resources/prettify.css' type='text/css'/><link rel='stylesheet' href='../.resources/custom.css' type='text/css'/><script type='text/javascript' src='../.resources/prettify.js'></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><h1>org.mozilla.javascript.NativeString.java</h1><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table><pre class='source lang-java linenums'>/* -*- Mode: java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

package org.mozilla.javascript;

import org.mozilla.javascript.regexp.NativeRegExp;

import java.text.Collator;
import java.text.Normalizer;

import static org.mozilla.javascript.ScriptRuntime.rangeError;
import static org.mozilla.javascript.ScriptRuntimeES6.requireObjectCoercible;

/**
 * This class implements the String native object.
 *
 * See ECMA 15.5.
 *
 * String methods for dealing with regular expressions are
 * ported directly from C. Latest port is from version 1.40.12.19
 * in the JSFUN13_BRANCH.
 *
 * @author Mike McCabe
 * @author Norris Boyd
 */
final class NativeString extends IdScriptableObject
{
    static final long serialVersionUID = 920268368584188687L;

<span class='uc' id='L33' title='3|3|3 - Total: 3'>    private static final Object STRING_TAG = "String";
</span>
    static void init(Scriptable scope, boolean sealed)
    {
<span class='uc' id='L37' title='5|5|5 - Total: 5'>        NativeString obj = new NativeString("");
</span><span class='uc' id='L38' title='6|6|6 - Total: 6'>        obj.exportAsJSClass(MAX_PROTOTYPE_ID, scope, sealed);
</span><span class='uc' id='L39' title='1|1|1 - Total: 1'>    }
</span>
<span class='uc' id='L41' title='2|2|2 - Total: 2'>    NativeString(CharSequence s) {
</span><span class='uc' id='L42' title='3|3|3 - Total: 3'>        string = s;
</span><span class='uc' id='L43' title='1|1|1 - Total: 1'>    }
</span>
    @Override
    public String getClassName() {
<span class='uc' id='L47' title='2|2|2 - Total: 2'>        return "String";
</span>    }

    private static final int
        Id_length                    =  1,
        MAX_INSTANCE_ID              =  1;

    @Override
    protected int getMaxInstanceId()
    {
<span class='uc' id='L57' title='2|2|2 - Total: 2'>        return MAX_INSTANCE_ID;
</span>    }

    @Override
    protected int findInstanceIdInfo(String s)
    {
<span class='uc' id='L63' title='2|2|2 - Total: 2'>        if (s.equals("length")) {
</span><span class='uc' id='L64' title='4|4|4 - Total: 4'>            return instanceIdInfo(DONTENUM | READONLY | PERMANENT, Id_length);
</span>        }
<span class='uc' id='L66' title='4|4|4 - Total: 4'>        return super.findInstanceIdInfo(s);
</span>    }

    @Override
    protected String getInstanceIdName(int id)
    {
<span class='upc' id='L72' title='1|1|1 - Total: 2'>        if (id == Id_length) { return "length"; }
</span><span class='nc' id='L73' title='0|0|0 - Total: 4'>        return super.getInstanceIdName(id);
</span>    }

    @Override
    protected Object getInstanceIdValue(int id)
    {
<span class='upc' id='L79' title='1|1|1 - Total: 2'>        if (id == Id_length) {
</span><span class='uc' id='L80' title='5|5|5 - Total: 5'>            return ScriptRuntime.wrapInt(string.length());
</span>        }
<span class='nc' id='L82' title='0|0|0 - Total: 4'>        return super.getInstanceIdValue(id);
</span>    }

    @Override
    protected void fillConstructorProperties(IdFunctionObject ctor)
    {
<span class='uc' id='L88' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG, ConstructorId_fromCharCode,
</span>                "fromCharCode", 1);
<span class='uc' id='L90' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_charAt, "charAt", 2);
<span class='uc' id='L92' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_charCodeAt, "charCodeAt", 2);
<span class='uc' id='L94' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_indexOf, "indexOf", 2);
<span class='uc' id='L96' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_lastIndexOf, "lastIndexOf", 2);
<span class='uc' id='L98' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_split, "split", 3);
<span class='uc' id='L100' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_substring, "substring", 3);
<span class='uc' id='L102' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_toLowerCase, "toLowerCase", 1);
<span class='uc' id='L104' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_toUpperCase, "toUpperCase", 1);
<span class='uc' id='L106' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_substr, "substr", 3);
<span class='uc' id='L108' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_concat, "concat", 2);
<span class='uc' id='L110' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_slice, "slice", 3);
<span class='uc' id='L112' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_equalsIgnoreCase, "equalsIgnoreCase", 2);
<span class='uc' id='L114' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_match, "match", 2);
<span class='uc' id='L116' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_search, "search", 2);
<span class='uc' id='L118' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_replace, "replace", 2);
<span class='uc' id='L120' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_localeCompare, "localeCompare", 2);
<span class='uc' id='L122' title='7|7|7 - Total: 7'>        addIdFunctionProperty(ctor, STRING_TAG,
</span>                ConstructorId_toLocaleLowerCase, "toLocaleLowerCase", 1);
<span class='uc' id='L124' title='3|3|3 - Total: 3'>        super.fillConstructorProperties(ctor);
</span><span class='uc' id='L125' title='1|1|1 - Total: 1'>    }
</span>
    @Override
    protected void initPrototypeId(int id)
    {
<span class='uc' id='L130' title='2|2|2 - Total: 2'>        if (id == SymbolId_iterator) {
</span><span class='uc' id='L131' title='8|8|8 - Total: 8'>            initPrototypeMethod(STRING_TAG, id, SymbolKey.ITERATOR, "[Symbol.iterator]", 0);
</span><span class='uc' id='L132' title='1|1|1 - Total: 1'>            return;
</span>        }

<span class='uc' id='L135' title='2|2|2 - Total: 2'>        String s, fnName = null;
</span>        int arity;
<span class='upc' id='L137' title='45|45|45 - Total: 46'>        switch (id) {
</span><span class='uc' id='L138' title='5|5|5 - Total: 5'>          case Id_constructor:       arity=1; s="constructor";       break;
</span><span class='uc' id='L139' title='5|5|5 - Total: 5'>          case Id_toString:          arity=0; s="toString";          break;
</span><span class='uc' id='L140' title='5|5|5 - Total: 5'>          case Id_toSource:          arity=0; s="toSource";          break;
</span><span class='uc' id='L141' title='5|5|5 - Total: 5'>          case Id_valueOf:           arity=0; s="valueOf";           break;
</span><span class='uc' id='L142' title='5|5|5 - Total: 5'>          case Id_charAt:            arity=1; s="charAt";            break;
</span><span class='uc' id='L143' title='5|5|5 - Total: 5'>          case Id_charCodeAt:        arity=1; s="charCodeAt";        break;
</span><span class='uc' id='L144' title='5|5|5 - Total: 5'>          case Id_indexOf:           arity=1; s="indexOf";           break;
</span><span class='uc' id='L145' title='5|5|5 - Total: 5'>          case Id_lastIndexOf:       arity=1; s="lastIndexOf";       break;
</span><span class='uc' id='L146' title='5|5|5 - Total: 5'>          case Id_split:             arity=2; s="split";             break;
</span><span class='uc' id='L147' title='5|5|5 - Total: 5'>          case Id_substring:         arity=2; s="substring";         break;
</span><span class='uc' id='L148' title='5|5|5 - Total: 5'>          case Id_toLowerCase:       arity=0; s="toLowerCase";       break;
</span><span class='uc' id='L149' title='5|5|5 - Total: 5'>          case Id_toUpperCase:       arity=0; s="toUpperCase";       break;
</span><span class='uc' id='L150' title='5|5|5 - Total: 5'>          case Id_substr:            arity=2; s="substr";            break;
</span><span class='uc' id='L151' title='5|5|5 - Total: 5'>          case Id_concat:            arity=1; s="concat";            break;
</span><span class='uc' id='L152' title='5|5|5 - Total: 5'>          case Id_slice:             arity=2; s="slice";             break;
</span><span class='uc' id='L153' title='5|5|5 - Total: 5'>          case Id_bold:              arity=0; s="bold";              break;
</span><span class='uc' id='L154' title='5|5|5 - Total: 5'>          case Id_italics:           arity=0; s="italics";           break;
</span><span class='uc' id='L155' title='5|5|5 - Total: 5'>          case Id_fixed:             arity=0; s="fixed";             break;
</span><span class='uc' id='L156' title='5|5|5 - Total: 5'>          case Id_strike:            arity=0; s="strike";            break;
</span><span class='uc' id='L157' title='5|5|5 - Total: 5'>          case Id_small:             arity=0; s="small";             break;
</span><span class='uc' id='L158' title='5|5|5 - Total: 5'>          case Id_big:               arity=0; s="big";               break;
</span><span class='uc' id='L159' title='5|5|5 - Total: 5'>          case Id_blink:             arity=0; s="blink";             break;
</span><span class='uc' id='L160' title='5|5|5 - Total: 5'>          case Id_sup:               arity=0; s="sup";               break;
</span><span class='uc' id='L161' title='5|5|5 - Total: 5'>          case Id_sub:               arity=0; s="sub";               break;
</span><span class='uc' id='L162' title='5|5|5 - Total: 5'>          case Id_fontsize:          arity=0; s="fontsize";          break;
</span><span class='uc' id='L163' title='5|5|5 - Total: 5'>          case Id_fontcolor:         arity=0; s="fontcolor";         break;
</span><span class='uc' id='L164' title='5|5|5 - Total: 5'>          case Id_link:              arity=0; s="link";              break;
</span><span class='uc' id='L165' title='5|5|5 - Total: 5'>          case Id_anchor:            arity=0; s="anchor";            break;
</span><span class='uc' id='L166' title='5|5|5 - Total: 5'>          case Id_equals:            arity=1; s="equals";            break;
</span><span class='uc' id='L167' title='5|5|5 - Total: 5'>          case Id_equalsIgnoreCase:  arity=1; s="equalsIgnoreCase";  break;
</span><span class='uc' id='L168' title='5|5|5 - Total: 5'>          case Id_match:             arity=1; s="match";             break;
</span><span class='uc' id='L169' title='5|5|5 - Total: 5'>          case Id_search:            arity=1; s="search";            break;
</span><span class='uc' id='L170' title='5|5|5 - Total: 5'>          case Id_replace:           arity=2; s="replace";           break;
</span><span class='uc' id='L171' title='5|5|5 - Total: 5'>          case Id_localeCompare:     arity=1; s="localeCompare";     break;
</span><span class='uc' id='L172' title='5|5|5 - Total: 5'>          case Id_toLocaleLowerCase: arity=0; s="toLocaleLowerCase"; break;
</span><span class='uc' id='L173' title='5|5|5 - Total: 5'>          case Id_toLocaleUpperCase: arity=0; s="toLocaleUpperCase"; break;
</span><span class='uc' id='L174' title='5|5|5 - Total: 5'>          case Id_trim:              arity=0; s="trim";              break;
</span><span class='uc' id='L175' title='5|5|5 - Total: 5'>          case Id_trimLeft:          arity=0; s="trimLeft";          break;
</span><span class='uc' id='L176' title='5|5|5 - Total: 5'>          case Id_trimRight:         arity=0; s="trimRight";         break;
</span><span class='uc' id='L177' title='5|5|5 - Total: 5'>          case Id_includes:          arity=1; s="includes";          break;
</span><span class='uc' id='L178' title='5|5|5 - Total: 5'>          case Id_startsWith:        arity=1; s="startsWith";        break;
</span><span class='uc' id='L179' title='5|5|5 - Total: 5'>          case Id_endsWith:          arity=1; s="endsWith";          break;
</span><span class='uc' id='L180' title='5|5|5 - Total: 5'>          case Id_normalize:         arity=0; s="normalize";         break;
</span><span class='uc' id='L181' title='5|5|5 - Total: 5'>          case Id_repeat:            arity=1; s="repeat";            break;
</span><span class='uc' id='L182' title='5|5|5 - Total: 5'>          case Id_codePointAt:       arity=1; s="codePointAt";       break;
</span><span class='nc' id='L183' title='0|0|0 - Total: 6'>          default: throw new IllegalArgumentException(String.valueOf(id));
</span>        }
<span class='uc' id='L185' title='8|8|8 - Total: 8'>        initPrototypeMethod(STRING_TAG, id, s, fnName, arity);
</span><span class='uc' id='L186' title='1|1|1 - Total: 1'>    }
</span>
    @Override
    public Object execIdCall(IdFunctionObject f, Context cx, Scriptable scope,
                             Scriptable thisObj, Object[] args)
    {
<span class='upc' id='L192' title='1|1|1 - Total: 2'>        if (!f.hasTag(STRING_TAG)) {
</span><span class='nc' id='L193' title='0|0|0 - Total: 8'>            return super.execIdCall(f, cx, scope, thisObj, args);
</span>        }
<span class='uc' id='L195' title='3|3|3 - Total: 3'>        int id = f.methodId();
</span>      again:
        for(;;) {
<span class='upc' id='L198' title='35|35|35 - Total: 42'>            switch (id) {
</span>                case ConstructorId_charAt:
                case ConstructorId_charCodeAt:
                case ConstructorId_indexOf:
                case ConstructorId_lastIndexOf:
                case ConstructorId_split:
                case ConstructorId_substring:
                case ConstructorId_toLowerCase:
                case ConstructorId_toUpperCase:
                case ConstructorId_substr:
                case ConstructorId_concat:
                case ConstructorId_slice:
                case ConstructorId_equalsIgnoreCase:
                case ConstructorId_match:
                case ConstructorId_search:
                case ConstructorId_replace:
                case ConstructorId_localeCompare:
                case ConstructorId_toLocaleLowerCase: {
<span class='uc' id='L216' title='2|2|2 - Total: 2'>                    if (args.length > 0) {
</span><span class='uc' id='L217' title='7|7|7 - Total: 7'>                        thisObj = ScriptRuntime.toObject(cx, scope,
</span><span class='uc' id='L218' title='1|1|1 - Total: 1'>                            ScriptRuntime.toCharSequence(args[0]));
</span><span class='uc' id='L219' title='6|6|6 - Total: 6'>                        Object[] newArgs = new Object[args.length - 1];
</span><span class='upc' id='L220' title='1|1|1 - Total: 2'>                        for (int i = 0; i < newArgs.length; i++)
</span><span class='nc' id='L221' title='0|0|0 - Total: 8'>                            newArgs[i] = args[i + 1];
</span><span class='uc' id='L222' title='2|2|2 - Total: 2'>                        args = newArgs;
</span><span class='uc' id='L223' title='1|1|1 - Total: 1'>                    } else {
</span><span class='uc' id='L224' title='5|5|5 - Total: 5'>                        thisObj = ScriptRuntime.toObject(cx, scope,
</span><span class='uc' id='L225' title='1|1|1 - Total: 1'>                            ScriptRuntime.toCharSequence(thisObj));
</span>                    }
<span class='uc' id='L227' title='3|3|3 - Total: 3'>                    id = -id;
</span><span class='uc' id='L228' title='1|1|1 - Total: 1'>                    continue again;
</span>                }

                case ConstructorId_fromCharCode: {
<span class='uc' id='L232' title='3|3|3 - Total: 3'>                    int N = args.length;
</span><span class='uc' id='L233' title='2|2|2 - Total: 2'>                    if (N < 1)
</span><span class='uc' id='L234' title='2|2|2 - Total: 2'>                        return "";
</span><span class='uc' id='L235' title='5|5|5 - Total: 5'>                    StringBuilder sb = new StringBuilder(N);
</span><span class='uc' id='L236' title='2|2|2 - Total: 2'>                    for (int i = 0; i != N; ++i) {
</span><span class='uc' id='L237' title='7|7|7 - Total: 7'>                        sb.append(ScriptRuntime.toUint16(args[i]));
</span>                    }
<span class='uc' id='L239' title='3|3|3 - Total: 3'>                    return sb.toString();
</span>                }

                case Id_constructor: {
                    CharSequence s;
<span class='uc' id='L244' title='2|2|2 - Total: 2'>                    if (args.length == 0) {
</span><span class='uc' id='L245' title='3|3|3 - Total: 3'>                        s = "";
</span><span class='uc' id='L246' title='3|3|3 - Total: 3'>                    } else if
</span><span class='uc' id='L247' title='4|4|4 - Total: 4'>                        (ScriptRuntime.isSymbol(args[0]) &&
</span>                        (thisObj != null)) {
                        // 19.4.3.2 et.al. Convert a symbol to a string with String() but not new String()
<span class='uc' id='L250' title='6|6|6 - Total: 6'>                        s = args[0].toString();
</span>                    } else {
<span class='uc' id='L252' title='5|5|5 - Total: 5'>                        s = ScriptRuntime.toCharSequence(args[0]);
</span>                    }
<span class='uc' id='L254' title='2|2|2 - Total: 2'>                    if (thisObj == null) {
</span>                        // new String(val) creates a new String object.
<span class='uc' id='L256' title='5|5|5 - Total: 5'>                        return new NativeString(s);
</span>                    }
                    // String(val) converts val to a string value.
<span class='uc' id='L259' title='2|2|2 - Total: 2'>                    return s instanceof String ? s : s.toString();
</span>                }

                case Id_toString:
                case Id_valueOf:
                    // ECMA 15.5.4.2: 'the toString function is not generic.
<span class='uc' id='L265' title='5|5|5 - Total: 5'>                    CharSequence cs = realThis(thisObj, f).string;
</span><span class='uc' id='L266' title='2|2|2 - Total: 2'>                    return cs instanceof String ? cs : cs.toString();
</span>
                case Id_toSource: {
<span class='uc' id='L269' title='5|5|5 - Total: 5'>                    CharSequence s = realThis(thisObj, f).string;
</span><span class='uc' id='L270' title='13|13|13 - Total: 13'>                    return "(new String(\"" + ScriptRuntime.escapeString(s.toString()) + "\"))";
</span>                }

                case Id_charAt:
                case Id_charCodeAt: {
                    // See ECMA 15.5.4.[4,5]
<span class='uc' id='L276' title='3|3|3 - Total: 3'>                    CharSequence target = ScriptRuntime.toCharSequence(thisObj);
</span><span class='uc' id='L277' title='4|4|4 - Total: 4'>                    double pos = ScriptRuntime.toInteger(args, 0);
</span><span class='uc' id='L278' title='4|4|4 - Total: 4'>                    if (pos < 0 || pos >= target.length()) {
</span><span class='uc' id='L279' title='2|2|2 - Total: 2'>                        if (id == Id_charAt) return "";
</span><span class='uc' id='L280' title='2|2|2 - Total: 2'>                        else return ScriptRuntime.NaNobj;
</span>                    }
<span class='uc' id='L282' title='5|5|5 - Total: 5'>                    char c = target.charAt((int) pos);
</span><span class='uc' id='L283' title='2|2|2 - Total: 2'>                    if (id == Id_charAt) return String.valueOf(c);
</span><span class='uc' id='L284' title='3|3|3 - Total: 3'>                    else return ScriptRuntime.wrapInt(c);
</span>                }

                case Id_indexOf:
<span class='uc' id='L288' title='7|7|7 - Total: 7'>                    return ScriptRuntime.wrapInt(js_indexOf(Id_indexOf, ScriptRuntime.toString(thisObj), args));
</span>
                case Id_includes:
                case Id_startsWith:
                case Id_endsWith:
<span class='uc' id='L293' title='6|6|6 - Total: 6'>                    String s = ScriptRuntime.toString(requireObjectCoercible(cx, thisObj, f));
</span><span class='uc' id='L294' title='4|4|4 - Total: 4'>                    if (args.length > 0 && args[0] instanceof NativeRegExp) {
</span><span class='uc' id='L295' title='7|7|7 - Total: 7'>                        throw ScriptRuntime.typeError2("msg.first.arg.not.regexp", String.class.getSimpleName(), f.getFunctionName());
</span>                    }

<span class='uc' id='L298' title='5|5|5 - Total: 5'>                    int idx = js_indexOf(id, s, args);
</span>
<span class='uc' id='L300' title='2|2|2 - Total: 2'>                    if (id == Id_includes) {
</span><span class='uc' id='L301' title='2|2|2 - Total: 2'>                        return idx != -1;
</span><span class='uc' id='L302' title='2|2|2 - Total: 2'>                    } else if (id == Id_startsWith) {
</span><span class='uc' id='L303' title='2|2|2 - Total: 2'>                        return idx == 0;
</span><span class='upc' id='L304' title='1|1|1 - Total: 2'>                    } else if (id == Id_endsWith) {
</span><span class='uc' id='L305' title='2|2|2 - Total: 2'>                        return idx != -1;
</span>                    }
                    // fallthrough

                case Id_lastIndexOf:
<span class='uc' id='L310' title='4|4|4 - Total: 4'>                    return ScriptRuntime.wrapInt(js_lastIndexOf(
</span><span class='uc' id='L311' title='2|2|2 - Total: 2'>                        ScriptRuntime.toString(thisObj), args));
</span>
                case Id_split:
<span class='uc' id='L314' title='6|6|6 - Total: 6'>                    return ScriptRuntime.checkRegExpProxy(cx).
</span><span class='uc' id='L315' title='3|3|3 - Total: 3'>                        js_split(cx, scope, ScriptRuntime.toString(thisObj),
</span>                            args);

                case Id_substring:
<span class='uc' id='L319' title='6|6|6 - Total: 6'>                    return js_substring(cx, ScriptRuntime.toCharSequence(thisObj), args);
</span>
                case Id_toLowerCase:
                    // See ECMA 15.5.4.11
<span class='uc' id='L323' title='5|5|5 - Total: 5'>                    return ScriptRuntime.toString(thisObj).toLowerCase(
</span>                        ScriptRuntime.ROOT_LOCALE);

                case Id_toUpperCase:
                    // See ECMA 15.5.4.12
<span class='uc' id='L328' title='5|5|5 - Total: 5'>                    return ScriptRuntime.toString(thisObj).toUpperCase(
</span>                        ScriptRuntime.ROOT_LOCALE);

                case Id_substr:
<span class='uc' id='L332' title='5|5|5 - Total: 5'>                    return js_substr(ScriptRuntime.toCharSequence(thisObj), args);
</span>
                case Id_concat:
<span class='uc' id='L335' title='5|5|5 - Total: 5'>                    return js_concat(ScriptRuntime.toString(thisObj), args);
</span>
                case Id_slice:
<span class='uc' id='L338' title='5|5|5 - Total: 5'>                    return js_slice(ScriptRuntime.toCharSequence(thisObj), args);
</span>
                case Id_bold:
<span class='uc' id='L341' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "b", null, null);
</span>
                case Id_italics:
<span class='uc' id='L344' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "i", null, null);
</span>
                case Id_fixed:
<span class='uc' id='L347' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "tt", null, null);
</span>
                case Id_strike:
<span class='uc' id='L350' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "strike", null, null);
</span>
                case Id_small:
<span class='uc' id='L353' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "small", null, null);
</span>
                case Id_big:
<span class='uc' id='L356' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "big", null, null);
</span>
                case Id_blink:
<span class='uc' id='L359' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "blink", null, null);
</span>
                case Id_sup:
<span class='uc' id='L362' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "sup", null, null);
</span>
                case Id_sub:
<span class='uc' id='L365' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "sub", null, null);
</span>
                case Id_fontsize:
<span class='uc' id='L368' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "font", "size", args);
</span>
                case Id_fontcolor:
<span class='uc' id='L371' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "font", "color", args);
</span>
                case Id_link:
<span class='uc' id='L374' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "a", "href", args);
</span>
                case Id_anchor:
<span class='uc' id='L377' title='6|6|6 - Total: 6'>                    return tagify(thisObj, "a", "name", args);
</span>
                case Id_equals:
                case Id_equalsIgnoreCase: {
<span class='nc' id='L381' title='0|0|0 - Total: 3'>                    String s1 = ScriptRuntime.toString(thisObj);
</span><span class='nc' id='L382' title='0|0|0 - Total: 4'>                    String s2 = ScriptRuntime.toString(args, 0);
</span><span class='nc' id='L383' title='0|0|0 - Total: 2'>                    return ScriptRuntime.wrapBoolean(
</span><span class='nc' id='L384' title='0|0|0 - Total: 4'>                        (id == Id_equals) ? s1.equals(s2)
</span><span class='nc' id='L385' title='0|0|0 - Total: 1'>                            : s1.equalsIgnoreCase(s2));
</span>                }

                case Id_match:
                case Id_search:
                case Id_replace: {
                    int actionType;
<span class='uc' id='L392' title='2|2|2 - Total: 2'>                    if (id == Id_match) {
</span><span class='uc' id='L393' title='3|3|3 - Total: 3'>                        actionType = RegExpProxy.RA_MATCH;
</span><span class='uc' id='L394' title='2|2|2 - Total: 2'>                    } else if (id == Id_search) {
</span><span class='uc' id='L395' title='3|3|3 - Total: 3'>                        actionType = RegExpProxy.RA_SEARCH;
</span>                    } else {
<span class='uc' id='L397' title='2|2|2 - Total: 2'>                        actionType = RegExpProxy.RA_REPLACE;
</span>                    }
<span class='uc' id='L399' title='8|8|8 - Total: 8'>                    return ScriptRuntime.checkRegExpProxy(cx).
</span><span class='uc' id='L400' title='1|1|1 - Total: 1'>                        action(cx, scope, thisObj, args, actionType);
</span>                }
                // ECMA-262 1 5.5.4.9
                case Id_localeCompare: {
                    // For now, create and configure a collator instance. I can't
                    // actually imagine that this'd be slower than caching them
                    // a la ClassCache, so we aren't trying to outsmart ourselves
                    // with a caching mechanism for now.
<span class='nc' id='L408' title='0|0|0 - Total: 4'>                    Collator collator = Collator.getInstance(cx.getLocale());
</span><span class='nc' id='L409' title='0|0|0 - Total: 3'>                    collator.setStrength(Collator.IDENTICAL);
</span><span class='nc' id='L410' title='0|0|0 - Total: 3'>                    collator.setDecomposition(Collator.CANONICAL_DECOMPOSITION);
</span><span class='nc' id='L411' title='0|0|0 - Total: 6'>                    return ScriptRuntime.wrapNumber(collator.compare(
</span><span class='nc' id='L412' title='0|0|0 - Total: 3'>                        ScriptRuntime.toString(thisObj),
</span><span class='nc' id='L413' title='0|0|0 - Total: 1'>                        ScriptRuntime.toString(args, 0)));
</span>                }
                case Id_toLocaleLowerCase: {
<span class='nc' id='L416' title='0|0|0 - Total: 4'>                    return ScriptRuntime.toString(thisObj)
</span><span class='nc' id='L417' title='0|0|0 - Total: 2'>                        .toLowerCase(cx.getLocale());
</span>                }
                case Id_toLocaleUpperCase: {
<span class='nc' id='L420' title='0|0|0 - Total: 4'>                    return ScriptRuntime.toString(thisObj)
</span><span class='nc' id='L421' title='0|0|0 - Total: 2'>                        .toUpperCase(cx.getLocale());
</span>                }
                case Id_trim: {
<span class='uc' id='L424' title='6|6|6 - Total: 6'>                    String str = ScriptRuntime.toString(requireObjectCoercible(cx, thisObj, f));
</span><span class='uc' id='L425' title='3|3|3 - Total: 3'>                    char[] chars = str.toCharArray();
</span>
<span class='uc' id='L427' title='2|2|2 - Total: 2'>                    int start = 0;
</span><span class='upc' id='L428' title='3|3|3 - Total: 4'>                    while (start < chars.length && ScriptRuntime.isJSWhitespaceOrLineTerminator(chars[start])) {
</span><span class='uc' id='L429' title='2|2|2 - Total: 2'>                        start++;
</span>                    }
<span class='uc' id='L431' title='3|3|3 - Total: 3'>                    int end = chars.length;
</span><span class='upc' id='L432' title='3|3|3 - Total: 4'>                    while (end > start && ScriptRuntime.isJSWhitespaceOrLineTerminator(chars[end - 1])) {
</span><span class='uc' id='L433' title='2|2|2 - Total: 2'>                        end--;
</span>                    }

<span class='uc' id='L436' title='5|5|5 - Total: 5'>                    return str.substring(start, end);
</span>                }
                case Id_trimLeft: {
<span class='nc' id='L439' title='0|0|0 - Total: 3'>                    String str = ScriptRuntime.toString(thisObj);
</span><span class='nc' id='L440' title='0|0|0 - Total: 3'>                    char[] chars = str.toCharArray();
</span>
<span class='nc' id='L442' title='0|0|0 - Total: 2'>                    int start = 0;
</span><span class='nc' id='L443' title='0|0|0 - Total: 4'>                    while (start < chars.length && ScriptRuntime.isJSWhitespaceOrLineTerminator(chars[start])) {
</span><span class='nc' id='L444' title='0|0|0 - Total: 2'>                        start++;
</span>                    }
<span class='nc' id='L446' title='0|0|0 - Total: 3'>                    int end = chars.length;
</span>
<span class='nc' id='L448' title='0|0|0 - Total: 5'>                    return str.substring(start, end);
</span>                }
                case Id_trimRight:
                {
<span class='nc' id='L452' title='0|0|0 - Total: 3'>                    String str = ScriptRuntime.toString(thisObj);
</span><span class='nc' id='L453' title='0|0|0 - Total: 3'>                    char[] chars = str.toCharArray();
</span>
<span class='nc' id='L455' title='0|0|0 - Total: 2'>                    int start = 0;
</span>
<span class='nc' id='L457' title='0|0|0 - Total: 3'>                    int end = chars.length;
</span><span class='nc' id='L458' title='0|0|0 - Total: 4'>                    while (end > start && ScriptRuntime.isJSWhitespaceOrLineTerminator(chars[end - 1])) {
</span><span class='nc' id='L459' title='0|0|0 - Total: 2'>                        end--;
</span>                    }

<span class='nc' id='L462' title='0|0|0 - Total: 5'>                    return str.substring(start, end);
</span>                }
                case Id_normalize:
                {
<span class='uc' id='L466' title='4|4|4 - Total: 4'>                    String formStr = ScriptRuntime.toString(args, 0);
</span>
                    Normalizer.Form form;
<span class='uc' id='L469' title='2|2|2 - Total: 2'>                    if (Normalizer.Form.NFD.name().equals(formStr)) form = Normalizer.Form.NFD;
</span><span class='uc' id='L470' title='2|2|2 - Total: 2'>                    else if (Normalizer.Form.NFKC.name().equals(formStr)) form = Normalizer.Form.NFKC;
</span><span class='uc' id='L471' title='2|2|2 - Total: 2'>                    else if (Normalizer.Form.NFKD.name().equals(formStr)) form = Normalizer.Form.NFKD;
</span><span class='uc' id='L472' title='4|4|4 - Total: 4'>                    else if (Normalizer.Form.NFC.name().equals(formStr) || args.length == 0) form = Normalizer.Form.NFC;
</span><span class='uc' id='L473' title='3|3|3 - Total: 3'>                    else throw rangeError("The normalization form should be one of NFC, NFD, NFKC, NFKD");
</span>
<span class='uc' id='L475' title='8|8|8 - Total: 8'>                    return Normalizer.normalize(ScriptRuntime.toString(requireObjectCoercible(cx, thisObj, f)), form);
</span>                }

                case Id_repeat:
                {
<span class='uc' id='L480' title='6|6|6 - Total: 6'>                    return js_repeat(cx, thisObj, f, args);
</span>                }
                case Id_codePointAt:
                {
<span class='uc' id='L484' title='6|6|6 - Total: 6'>                    String str = ScriptRuntime.toString(requireObjectCoercible(cx, thisObj, f));
</span><span class='uc' id='L485' title='4|4|4 - Total: 4'>                    double cnt = ScriptRuntime.toInteger(args, 0);
</span>
<span class='uc' id='L487' title='4|4|4 - Total: 4'>                    return (cnt < 0 || cnt >= str.length())
</span>                        ? Undefined.instance
<span class='uc' id='L489' title='2|2|2 - Total: 2'>                        : str.codePointAt((int) cnt);
</span>                }

              case SymbolId_iterator:
<span class='uc' id='L493' title='6|6|6 - Total: 6'>                  return new NativeStringIterator(scope, thisObj);
</span>
            }
<span class='nc' id='L496' title='0|0|0 - Total: 13'>            throw new IllegalArgumentException("String.prototype has no method: " + f.getFunctionName());
</span>        }
    }

    private static NativeString realThis(Scriptable thisObj, IdFunctionObject f)
    {
<span class='uc' id='L502' title='2|2|2 - Total: 2'>        if (!(thisObj instanceof NativeString))
</span><span class='nc' id='L503' title='0|0|0 - Total: 3'>            throw incompatibleCallError(f);
</span><span class='uc' id='L504' title='3|3|3 - Total: 3'>        return (NativeString)thisObj;
</span>    }

    /*
     * HTML composition aids.
     */
    private static String tagify(Object thisObj, String tag,
                                 String attribute, Object[] args)
    {
<span class='uc' id='L513' title='3|3|3 - Total: 3'>        String str = ScriptRuntime.toString(thisObj);
</span><span class='uc' id='L514' title='4|4|4 - Total: 4'>        StringBuilder result = new StringBuilder();
</span><span class='uc' id='L515' title='4|4|4 - Total: 4'>        result.append('<');
</span><span class='uc' id='L516' title='4|4|4 - Total: 4'>        result.append(tag);
</span><span class='uc' id='L517' title='2|2|2 - Total: 2'>        if (attribute != null) {
</span><span class='uc' id='L518' title='4|4|4 - Total: 4'>            result.append(' ');
</span><span class='uc' id='L519' title='4|4|4 - Total: 4'>            result.append(attribute);
</span><span class='uc' id='L520' title='4|4|4 - Total: 4'>            result.append("=\"");
</span><span class='uc' id='L521' title='6|6|6 - Total: 6'>            result.append(ScriptRuntime.toString(args, 0));
</span><span class='uc' id='L522' title='4|4|4 - Total: 4'>            result.append('"');
</span>        }
<span class='uc' id='L524' title='4|4|4 - Total: 4'>        result.append('>');
</span><span class='uc' id='L525' title='4|4|4 - Total: 4'>        result.append(str);
</span><span class='uc' id='L526' title='4|4|4 - Total: 4'>        result.append("</");
</span><span class='uc' id='L527' title='4|4|4 - Total: 4'>        result.append(tag);
</span><span class='uc' id='L528' title='4|4|4 - Total: 4'>        result.append('>');
</span><span class='uc' id='L529' title='3|3|3 - Total: 3'>        return result.toString();
</span>    }

    public CharSequence toCharSequence() {
<span class='uc' id='L533' title='3|3|3 - Total: 3'>        return string;
</span>    }

    @Override
    public String toString() {
<span class='upc' id='L538' title='1|1|1 - Total: 2'>        return string instanceof String ? (String)string : string.toString();
</span>    }

    /* Make array-style property lookup work for strings.
     * XXX is this ECMA?  A version check is probably needed. In js too.
     */
    @Override
    public Object get(int index, Scriptable start) {
<span class='uc' id='L546' title='4|4|4 - Total: 4'>        if (0 <= index && index < string.length()) {
</span><span class='uc' id='L547' title='6|6|6 - Total: 6'>            return String.valueOf(string.charAt(index));
</span>        }
<span class='uc' id='L549' title='5|5|5 - Total: 5'>        return super.get(index, start);
</span>    }

    @Override
    public void put(int index, Scriptable start, Object value) {
<span class='upc' id='L554' title='3|3|3 - Total: 4'>        if (0 <= index && index < string.length()) {
</span><span class='uc' id='L555' title='1|1|1 - Total: 1'>            return;
</span>        }
<span class='uc' id='L557' title='5|5|5 - Total: 5'>        super.put(index, start, value);
</span><span class='uc' id='L558' title='1|1|1 - Total: 1'>    }
</span>
    @Override
    public boolean has(int index, Scriptable start) {
<span class='upc' id='L562' title='3|3|3 - Total: 4'>        if (0 <= index && index < string.length()) {
</span><span class='uc' id='L563' title='2|2|2 - Total: 2'>            return true;
</span>        }
<span class='uc' id='L565' title='5|5|5 - Total: 5'>        return super.has(index, start);
</span>    }

    @Override
    protected Object[] getIds(boolean nonEnumerable, boolean getSymbols)
    {
        // In ES6, Strings have entries in the property map for each character.
<span class='uc' id='L572' title='2|2|2 - Total: 2'>        Context cx = Context.getCurrentContext();
</span><span class='upc' id='L573' title='3|3|3 - Total: 4'>        if ((cx != null) && (cx.getLanguageVersion() >= Context.VERSION_ES6)) {
</span><span class='uc' id='L574' title='5|5|5 - Total: 5'>            Object[] sids = super.getIds(nonEnumerable, getSymbols);
</span><span class='uc' id='L575' title='8|8|8 - Total: 8'>            Object[] a = new Object[sids.length + string.length()];
</span>            int i;
<span class='uc' id='L577' title='2|2|2 - Total: 2'>            for (i = 0; i < string.length(); i++) {
</span><span class='uc' id='L578' title='5|5|5 - Total: 5'>                a[i] = Integer.valueOf(i);
</span>            }
<span class='uc' id='L580' title='7|7|7 - Total: 7'>            System.arraycopy(sids, 0, a, i, sids.length);
</span><span class='uc' id='L581' title='2|2|2 - Total: 2'>            return a;
</span>        }
<span class='uc' id='L583' title='5|5|5 - Total: 5'>        return super.getIds(nonEnumerable, getSymbols);
</span>    }

    /*
     *
     * See ECMA 15.5.4.6.  Uses Java String.indexOf()
     * OPT to add - BMH searching from jsstr.c.
     */
    private static int  js_indexOf(int methodId, String target, Object[] args) {
<span class='uc' id='L592' title='4|4|4 - Total: 4'>        String searchStr = ScriptRuntime.toString(args, 0);
</span><span class='uc' id='L593' title='4|4|4 - Total: 4'>        double position = ScriptRuntime.toInteger(args, 1);
</span>
<span class='uc' id='L595' title='6|6|6 - Total: 6'>        if (position > target.length() && methodId != Id_startsWith && methodId != Id_endsWith) {
</span><span class='uc' id='L596' title='2|2|2 - Total: 2'>            return -1;
</span>        } else {
<span class='uc' id='L598' title='2|2|2 - Total: 2'>            if (position < 0) position = 0;
</span><span class='uc' id='L599' title='2|2|2 - Total: 2'>            else if (position > target.length()) position = target.length();
</span><span class='upc' id='L600' title='4|4|4 - Total: 6'>            else if (methodId == Id_endsWith && (position != position  || position > target.length())) position = target.length();
</span>
<span class='uc' id='L602' title='2|2|2 - Total: 2'>            if (Id_endsWith == methodId) {
</span><span class='upc' id='L603' title='7|7|7 - Total: 8'>                if (args.length == 0 || args.length == 1 || (args.length == 2 && args[1] == Undefined.instance)) position = target.length();
</span><span class='uc' id='L604' title='2|2|2 - Total: 2'>                return target.substring(0, (int)position).endsWith(searchStr) ? 0 : -1;
</span>            }
<span class='uc' id='L606' title='2|2|2 - Total: 2'>            return methodId == Id_startsWith
</span><span class='uc' id='L607' title='2|2|2 - Total: 2'>                    ? target.startsWith(searchStr, (int)position) ? 0 : -1
</span><span class='uc' id='L608' title='1|1|1 - Total: 1'>                    : target.indexOf(searchStr, (int)position);
</span>        }
    }

    /*
     *
     * See ECMA 15.5.4.7
     *
     */
    private static int js_lastIndexOf(String target, Object[] args) {
<span class='uc' id='L618' title='4|4|4 - Total: 4'>        String search = ScriptRuntime.toString(args, 0);
</span><span class='uc' id='L619' title='4|4|4 - Total: 4'>        double end = ScriptRuntime.toNumber(args, 1);
</span>
<span class='uc' id='L621' title='4|4|4 - Total: 4'>        if (end != end || end > target.length())
</span><span class='uc' id='L622' title='5|5|5 - Total: 5'>            end = target.length();
</span><span class='uc' id='L623' title='2|2|2 - Total: 2'>        else if (end < 0)
</span><span class='uc' id='L624' title='2|2|2 - Total: 2'>            end = 0;
</span>
<span class='uc' id='L626' title='6|6|6 - Total: 6'>        return target.lastIndexOf(search, (int)end);
</span>    }


    /*
     * See ECMA 15.5.4.15
     */
    private static CharSequence js_substring(Context cx, CharSequence target,
                                       Object[] args)
    {
<span class='uc' id='L636' title='3|3|3 - Total: 3'>        int length = target.length();
</span><span class='uc' id='L637' title='4|4|4 - Total: 4'>        double start = ScriptRuntime.toInteger(args, 0);
</span>        double end;

<span class='uc' id='L640' title='2|2|2 - Total: 2'>        if (start < 0)
</span><span class='uc' id='L641' title='3|3|3 - Total: 3'>            start = 0;
</span><span class='uc' id='L642' title='2|2|2 - Total: 2'>        else if (start > length)
</span><span class='uc' id='L643' title='3|3|3 - Total: 3'>            start = length;
</span>
<span class='upc' id='L645' title='3|3|3 - Total: 4'>        if (args.length <= 1 || args[1] == Undefined.instance) {
</span><span class='uc' id='L646' title='4|4|4 - Total: 4'>            end = length;
</span>        } else {
<span class='uc' id='L648' title='5|5|5 - Total: 5'>            end = ScriptRuntime.toInteger(args[1]);
</span><span class='uc' id='L649' title='2|2|2 - Total: 2'>            if (end < 0)
</span><span class='uc' id='L650' title='3|3|3 - Total: 3'>                end = 0;
</span><span class='uc' id='L651' title='2|2|2 - Total: 2'>            else if (end > length)
</span><span class='uc' id='L652' title='3|3|3 - Total: 3'>                end = length;
</span>
            // swap if end < start
<span class='uc' id='L655' title='2|2|2 - Total: 2'>            if (end < start) {
</span><span class='upc' id='L656' title='1|1|1 - Total: 2'>                if (cx.getLanguageVersion() != Context.VERSION_1_2) {
</span><span class='uc' id='L657' title='2|2|2 - Total: 2'>                    double temp = start;
</span><span class='uc' id='L658' title='2|2|2 - Total: 2'>                    start = end;
</span><span class='uc' id='L659' title='2|2|2 - Total: 2'>                    end = temp;
</span><span class='uc' id='L660' title='1|1|1 - Total: 1'>                } else {
</span>                    // Emulate old JDK1.0 java.lang.String.substring()
<span class='nc' id='L662' title='0|0|0 - Total: 2'>                    end = start;
</span>                }
            }
        }
<span class='uc' id='L666' title='7|7|7 - Total: 7'>        return target.subSequence((int)start, (int)end);
</span>    }

    int getLength() {
<span class='uc' id='L670' title='4|4|4 - Total: 4'>        return string.length();
</span>    }

    /*
     * Non-ECMA methods.
     */
    private static CharSequence js_substr(CharSequence target, Object[] args) {
<span class='upc' id='L677' title='1|1|1 - Total: 2'>        if (args.length < 1)
</span><span class='nc' id='L678' title='0|0|0 - Total: 2'>            return target;
</span>
<span class='uc' id='L680' title='5|5|5 - Total: 5'>        double begin = ScriptRuntime.toInteger(args[0]);
</span>        double end;
<span class='uc' id='L682' title='3|3|3 - Total: 3'>        int length = target.length();
</span>
<span class='upc' id='L684' title='1|1|1 - Total: 2'>        if (begin < 0) {
</span><span class='nc' id='L685' title='0|0|0 - Total: 5'>            begin += length;
</span><span class='nc' id='L686' title='0|0|0 - Total: 2'>            if (begin < 0)
</span><span class='nc' id='L687' title='0|0|0 - Total: 3'>                begin = 0;
</span><span class='upc' id='L688' title='1|1|1 - Total: 2'>        } else if (begin > length) {
</span><span class='nc' id='L689' title='0|0|0 - Total: 3'>            begin = length;
</span>        }

<span class='uc' id='L692' title='2|2|2 - Total: 2'>        if (args.length == 1) {
</span><span class='uc' id='L693' title='4|4|4 - Total: 4'>            end = length;
</span>        } else {
<span class='uc' id='L695' title='5|5|5 - Total: 5'>            end = ScriptRuntime.toInteger(args[1]);
</span><span class='upc' id='L696' title='1|1|1 - Total: 2'>            if (end < 0)
</span><span class='nc' id='L697' title='0|0|0 - Total: 2'>                end = 0;
</span><span class='uc' id='L698' title='4|4|4 - Total: 4'>            end += begin;
</span><span class='upc' id='L699' title='1|1|1 - Total: 2'>            if (end > length)
</span><span class='nc' id='L700' title='0|0|0 - Total: 3'>                end = length;
</span>        }

<span class='uc' id='L703' title='7|7|7 - Total: 7'>        return target.subSequence((int)begin, (int)end);
</span>    }

    /*
     * Python-esque sequence operations.
     */
    private static String js_concat(String target, Object[] args) {
<span class='uc' id='L710' title='3|3|3 - Total: 3'>        int N = args.length;
</span><span class='uc' id='L711' title='2|2|2 - Total: 2'>        if (N == 0) { return target; }
</span><span class='uc' id='L712' title='2|2|2 - Total: 2'>        else if (N == 1) {
</span><span class='uc' id='L713' title='5|5|5 - Total: 5'>            String arg = ScriptRuntime.toString(args[0]);
</span><span class='uc' id='L714' title='4|4|4 - Total: 4'>            return target.concat(arg);
</span>        }

        // Find total capacity for the final string to avoid unnecessary
        // re-allocations in StringBuilder
<span class='uc' id='L719' title='3|3|3 - Total: 3'>        int size = target.length();
</span><span class='uc' id='L720' title='3|3|3 - Total: 3'>        String[] argsAsStrings = new String[N];
</span><span class='uc' id='L721' title='2|2|2 - Total: 2'>        for (int i = 0; i != N; ++i) {
</span><span class='uc' id='L722' title='5|5|5 - Total: 5'>            String s = ScriptRuntime.toString(args[i]);
</span><span class='uc' id='L723' title='4|4|4 - Total: 4'>            argsAsStrings[i] = s;
</span><span class='uc' id='L724' title='5|5|5 - Total: 5'>            size += s.length();
</span>        }

<span class='uc' id='L727' title='5|5|5 - Total: 5'>        StringBuilder result = new StringBuilder(size);
</span><span class='uc' id='L728' title='4|4|4 - Total: 4'>        result.append(target);
</span><span class='uc' id='L729' title='2|2|2 - Total: 2'>        for (int i = 0; i != N; ++i) {
</span><span class='uc' id='L730' title='6|6|6 - Total: 6'>            result.append(argsAsStrings[i]);
</span>        }
<span class='uc' id='L732' title='3|3|3 - Total: 3'>        return result.toString();
</span>    }

    private static CharSequence js_slice(CharSequence target, Object[] args) {
<span class='upc' id='L736' title='1|1|1 - Total: 2'>        double begin = args.length < 1 ? 0 : ScriptRuntime.toInteger(args[0]);
</span>        double end;
<span class='uc' id='L738' title='3|3|3 - Total: 3'>        int length = target.length();
</span><span class='uc' id='L739' title='2|2|2 - Total: 2'>        if (begin < 0) {
</span><span class='uc' id='L740' title='5|5|5 - Total: 5'>            begin += length;
</span><span class='uc' id='L741' title='2|2|2 - Total: 2'>            if (begin < 0)
</span><span class='uc' id='L742' title='3|3|3 - Total: 3'>                begin = 0;
</span><span class='uc' id='L743' title='2|2|2 - Total: 2'>        } else if (begin > length) {
</span><span class='uc' id='L744' title='3|3|3 - Total: 3'>            begin = length;
</span>        }

<span class='upc' id='L747' title='3|3|3 - Total: 4'>        if (args.length < 2 || args[1] == Undefined.instance) {
</span><span class='uc' id='L748' title='4|4|4 - Total: 4'>            end = length;
</span>        } else {
<span class='uc' id='L750' title='5|5|5 - Total: 5'>            end = ScriptRuntime.toInteger(args[1]);
</span><span class='uc' id='L751' title='2|2|2 - Total: 2'>            if (end < 0) {
</span><span class='uc' id='L752' title='5|5|5 - Total: 5'>                end += length;
</span><span class='uc' id='L753' title='2|2|2 - Total: 2'>                if (end < 0)
</span><span class='uc' id='L754' title='3|3|3 - Total: 3'>                    end = 0;
</span><span class='uc' id='L755' title='2|2|2 - Total: 2'>            } else if (end > length) {
</span><span class='uc' id='L756' title='3|3|3 - Total: 3'>                end = length;
</span>            }
<span class='uc' id='L758' title='2|2|2 - Total: 2'>            if (end < begin)
</span><span class='uc' id='L759' title='2|2|2 - Total: 2'>                end = begin;
</span>        }
<span class='uc' id='L761' title='7|7|7 - Total: 7'>        return target.subSequence((int) begin, (int) end);
</span>    }

    private static String js_repeat(Context cx, Scriptable thisObj, IdFunctionObject f, Object[] args)
    {
<span class='uc' id='L766' title='6|6|6 - Total: 6'>        String str = ScriptRuntime.toString(requireObjectCoercible(cx, thisObj, f));
</span><span class='uc' id='L767' title='4|4|4 - Total: 4'>        double cnt = ScriptRuntime.toInteger(args, 0);
</span>
<span class='uc' id='L769' title='4|4|4 - Total: 4'>        if ((cnt < 0.0) || (cnt == Double.POSITIVE_INFINITY)) {
</span><span class='uc' id='L770' title='3|3|3 - Total: 3'>            throw rangeError("Invalid count value");
</span>        }

<span class='uc' id='L773' title='4|4|4 - Total: 4'>        if (cnt == 0.0 || str.length() == 0) {
</span><span class='uc' id='L774' title='2|2|2 - Total: 2'>            return "";
</span>        }

<span class='uc' id='L777' title='7|7|7 - Total: 7'>        long size = str.length() * (long)cnt;
</span>        // Check for overflow
<span class='upc' id='L779' title='2|2|2 - Total: 4'>        if ((cnt > Integer.MAX_VALUE) || (size > Integer.MAX_VALUE)) {
</span><span class='nc' id='L780' title='0|0|0 - Total: 3'>            throw rangeError("Invalid size or count value");
</span>        }

<span class='uc' id='L783' title='6|6|6 - Total: 6'>        StringBuilder retval = new StringBuilder((int) size);
</span><span class='uc' id='L784' title='4|4|4 - Total: 4'>        retval.append(str);
</span>
<span class='uc' id='L786' title='2|2|2 - Total: 2'>        int i = 1;
</span><span class='uc' id='L787' title='3|3|3 - Total: 3'>        int icnt = (int)cnt;
</span><span class='uc' id='L788' title='2|2|2 - Total: 2'>        while (i <= (icnt / 2)) {
</span><span class='uc' id='L789' title='4|4|4 - Total: 4'>            retval.append(retval);
</span><span class='uc' id='L790' title='5|5|5 - Total: 5'>            i *= 2;
</span>        }
<span class='uc' id='L792' title='2|2|2 - Total: 2'>        if (i < icnt) {
</span><span class='uc' id='L793' title='12|12|12 - Total: 12'>            retval.append(retval.substring(0, str.length() * (icnt - i)));
</span>        }

<span class='uc' id='L796' title='3|3|3 - Total: 3'>        return retval.toString();
</span>    }

    @Override
    protected int findPrototypeId(Symbol k)
    {
<span class='upc' id='L802' title='1|1|1 - Total: 2'>        if (SymbolKey.ITERATOR.equals(k)) {
</span><span class='uc' id='L803' title='2|2|2 - Total: 2'>            return SymbolId_iterator;
</span>        }
<span class='nc' id='L805' title='0|0|0 - Total: 2'>        return 0;
</span>    }

// #string_id_map#

    @Override
    protected int findPrototypeId(String s)
    {
        int id;
// #generated# Last update: 2016-03-04 20:51:44 GMT
<span class='uc' id='L815' title='4|4|4 - Total: 4'>        L0: { id = 0; String X = null; int c;
</span><span class='uc' id='L816' title='13|13|13 - Total: 13'>            L: switch (s.length()) {
</span><span class='uc' id='L817' title='4|4|4 - Total: 4'>            case 3: c=s.charAt(2);
</span><span class='upc' id='L818' title='4|4|4 - Total: 6'>                if (c=='b') { if (s.charAt(0)=='s' && s.charAt(1)=='u') {id=Id_sub; break L0;} }
</span><span class='upc' id='L819' title='4|4|4 - Total: 6'>                else if (c=='g') { if (s.charAt(0)=='b' && s.charAt(1)=='i') {id=Id_big; break L0;} }
</span><span class='upc' id='L820' title='4|4|4 - Total: 6'>                else if (c=='p') { if (s.charAt(0)=='s' && s.charAt(1)=='u') {id=Id_sup; break L0;} }
</span>                break L;
<span class='uc' id='L822' title='4|4|4 - Total: 4'>            case 4: c=s.charAt(0);
</span><span class='uc' id='L823' title='2|2|2 - Total: 2'>                if (c=='b') { X="bold";id=Id_bold; }
</span><span class='uc' id='L824' title='2|2|2 - Total: 2'>                else if (c=='l') { X="link";id=Id_link; }
</span><span class='uc' id='L825' title='2|2|2 - Total: 2'>                else if (c=='t') { X="trim";id=Id_trim; }
</span>                break L;
<span class='upc' id='L827' title='6|6|6 - Total: 7'>            case 5: switch (s.charAt(4)) {
</span><span class='uc' id='L828' title='5|5|5 - Total: 5'>                case 'd': X="fixed";id=Id_fixed; break L;
</span><span class='uc' id='L829' title='5|5|5 - Total: 5'>                case 'e': X="slice";id=Id_slice; break L;
</span><span class='uc' id='L830' title='5|5|5 - Total: 5'>                case 'h': X="match";id=Id_match; break L;
</span><span class='uc' id='L831' title='5|5|5 - Total: 5'>                case 'k': X="blink";id=Id_blink; break L;
</span><span class='uc' id='L832' title='5|5|5 - Total: 5'>                case 'l': X="small";id=Id_small; break L;
</span><span class='uc' id='L833' title='5|5|5 - Total: 5'>                case 't': X="split";id=Id_split; break L;
</span><span class='nc' id='L834' title='0|0|0 - Total: 1'>                } break L;
</span><span class='upc' id='L835' title='7|7|7 - Total: 8'>            case 6: switch (s.charAt(1)) {
</span><span class='uc' id='L836' title='4|4|4 - Total: 4'>                case 'e': c=s.charAt(0);
</span><span class='uc' id='L837' title='2|2|2 - Total: 2'>                    if (c=='r') { X="repeat";id=Id_repeat; }
</span><span class='uc' id='L838' title='2|2|2 - Total: 2'>                    else if (c=='s') { X="search";id=Id_search; }
</span>                    break L;
<span class='uc' id='L840' title='5|5|5 - Total: 5'>                case 'h': X="charAt";id=Id_charAt; break L;
</span><span class='uc' id='L841' title='5|5|5 - Total: 5'>                case 'n': X="anchor";id=Id_anchor; break L;
</span><span class='uc' id='L842' title='5|5|5 - Total: 5'>                case 'o': X="concat";id=Id_concat; break L;
</span><span class='uc' id='L843' title='5|5|5 - Total: 5'>                case 'q': X="equals";id=Id_equals; break L;
</span><span class='uc' id='L844' title='5|5|5 - Total: 5'>                case 't': X="strike";id=Id_strike; break L;
</span><span class='uc' id='L845' title='5|5|5 - Total: 5'>                case 'u': X="substr";id=Id_substr; break L;
</span><span class='nc' id='L846' title='0|0|0 - Total: 1'>                } break L;
</span><span class='upc' id='L847' title='4|4|4 - Total: 5'>            case 7: switch (s.charAt(1)) {
</span><span class='uc' id='L848' title='5|5|5 - Total: 5'>                case 'a': X="valueOf";id=Id_valueOf; break L;
</span><span class='uc' id='L849' title='5|5|5 - Total: 5'>                case 'e': X="replace";id=Id_replace; break L;
</span><span class='uc' id='L850' title='5|5|5 - Total: 5'>                case 'n': X="indexOf";id=Id_indexOf; break L;
</span><span class='uc' id='L851' title='5|5|5 - Total: 5'>                case 't': X="italics";id=Id_italics; break L;
</span><span class='nc' id='L852' title='0|0|0 - Total: 1'>                } break L;
</span><span class='uc' id='L853' title='7|7|7 - Total: 7'>            case 8: switch (s.charAt(6)) {
</span><span class='uc' id='L854' title='5|5|5 - Total: 5'>                case 'c': X="toSource";id=Id_toSource; break L;
</span><span class='uc' id='L855' title='5|5|5 - Total: 5'>                case 'e': X="includes";id=Id_includes; break L;
</span><span class='uc' id='L856' title='5|5|5 - Total: 5'>                case 'f': X="trimLeft";id=Id_trimLeft; break L;
</span><span class='uc' id='L857' title='5|5|5 - Total: 5'>                case 'n': X="toString";id=Id_toString; break L;
</span><span class='uc' id='L858' title='5|5|5 - Total: 5'>                case 't': X="endsWith";id=Id_endsWith; break L;
</span><span class='uc' id='L859' title='5|5|5 - Total: 5'>                case 'z': X="fontsize";id=Id_fontsize; break L;
</span><span class='uc' id='L860' title='1|1|1 - Total: 1'>                } break L;
</span><span class='upc' id='L861' title='4|4|4 - Total: 5'>            case 9: switch (s.charAt(0)) {
</span><span class='uc' id='L862' title='5|5|5 - Total: 5'>                case 'f': X="fontcolor";id=Id_fontcolor; break L;
</span><span class='uc' id='L863' title='5|5|5 - Total: 5'>                case 'n': X="normalize";id=Id_normalize; break L;
</span><span class='uc' id='L864' title='5|5|5 - Total: 5'>                case 's': X="substring";id=Id_substring; break L;
</span><span class='uc' id='L865' title='5|5|5 - Total: 5'>                case 't': X="trimRight";id=Id_trimRight; break L;
</span><span class='nc' id='L866' title='0|0|0 - Total: 1'>                } break L;
</span><span class='uc' id='L867' title='4|4|4 - Total: 4'>            case 10: c=s.charAt(0);
</span><span class='uc' id='L868' title='2|2|2 - Total: 2'>                if (c=='c') { X="charCodeAt";id=Id_charCodeAt; }
</span><span class='upc' id='L869' title='1|1|1 - Total: 2'>                else if (c=='s') { X="startsWith";id=Id_startsWith; }
</span>                break L;
<span class='upc' id='L871' title='5|5|5 - Total: 6'>            case 11: switch (s.charAt(2)) {
</span><span class='uc' id='L872' title='5|5|5 - Total: 5'>                case 'L': X="toLowerCase";id=Id_toLowerCase; break L;
</span><span class='uc' id='L873' title='5|5|5 - Total: 5'>                case 'U': X="toUpperCase";id=Id_toUpperCase; break L;
</span><span class='uc' id='L874' title='5|5|5 - Total: 5'>                case 'd': X="codePointAt";id=Id_codePointAt; break L;
</span><span class='uc' id='L875' title='5|5|5 - Total: 5'>                case 'n': X="constructor";id=Id_constructor; break L;
</span><span class='uc' id='L876' title='5|5|5 - Total: 5'>                case 's': X="lastIndexOf";id=Id_lastIndexOf; break L;
</span><span class='nc' id='L877' title='0|0|0 - Total: 1'>                } break L;
</span><span class='uc' id='L878' title='5|5|5 - Total: 5'>            case 13: X="localeCompare";id=Id_localeCompare; break L;
</span><span class='uc' id='L879' title='5|5|5 - Total: 5'>            case 16: X="equalsIgnoreCase";id=Id_equalsIgnoreCase; break L;
</span><span class='uc' id='L880' title='4|4|4 - Total: 4'>            case 17: c=s.charAt(8);
</span><span class='uc' id='L881' title='2|2|2 - Total: 2'>                if (c=='L') { X="toLocaleLowerCase";id=Id_toLocaleLowerCase; }
</span><span class='upc' id='L882' title='1|1|1 - Total: 2'>                else if (c=='U') { X="toLocaleUpperCase";id=Id_toLocaleUpperCase; }
</span>                break L;
            }
<span class='uc' id='L885' title='6|6|6 - Total: 6'>            if (X!=null && X!=s && !X.equals(s)) id = 0;
</span>            break L0;
        }
// #/generated#
<span class='uc' id='L889' title='2|2|2 - Total: 2'>        return id;
</span>    }

    private static final int
        ConstructorId_fromCharCode   = -1,

        Id_constructor               = 1,
        Id_toString                  = 2,
        Id_toSource                  = 3,
        Id_valueOf                   = 4,
        Id_charAt                    = 5,
        Id_charCodeAt                = 6,
        Id_indexOf                   = 7,
        Id_lastIndexOf               = 8,
        Id_split                     = 9,
        Id_substring                 = 10,
        Id_toLowerCase               = 11,
        Id_toUpperCase               = 12,
        Id_substr                    = 13,
        Id_concat                    = 14,
        Id_slice                     = 15,
        Id_bold                      = 16,
        Id_italics                   = 17,
        Id_fixed                     = 18,
        Id_strike                    = 19,
        Id_small                     = 20,
        Id_big                       = 21,
        Id_blink                     = 22,
        Id_sup                       = 23,
        Id_sub                       = 24,
        Id_fontsize                  = 25,
        Id_fontcolor                 = 26,
        Id_link                      = 27,
        Id_anchor                    = 28,
        Id_equals                    = 29,
        Id_equalsIgnoreCase          = 30,
        Id_match                     = 31,
        Id_search                    = 32,
        Id_replace                   = 33,
        Id_localeCompare             = 34,
        Id_toLocaleLowerCase         = 35,
        Id_toLocaleUpperCase         = 36,
        Id_trim                      = 37,
        Id_trimLeft                  = 38,
        Id_trimRight                 = 39,
        Id_includes                  = 40,
        Id_startsWith                = 41,
        Id_endsWith                  = 42,
        Id_normalize                 = 43,
        Id_repeat                    = 44,
        Id_codePointAt               = 45,
        SymbolId_iterator            = 46,
        MAX_PROTOTYPE_ID             = SymbolId_iterator;

// #/string_id_map#

    private static final int
        ConstructorId_charAt         = -Id_charAt,
        ConstructorId_charCodeAt     = -Id_charCodeAt,
        ConstructorId_indexOf        = -Id_indexOf,
        ConstructorId_lastIndexOf    = -Id_lastIndexOf,
        ConstructorId_split          = -Id_split,
        ConstructorId_substring      = -Id_substring,
        ConstructorId_toLowerCase    = -Id_toLowerCase,
        ConstructorId_toUpperCase    = -Id_toUpperCase,
        ConstructorId_substr         = -Id_substr,
        ConstructorId_concat         = -Id_concat,
        ConstructorId_slice          = -Id_slice,
        ConstructorId_equalsIgnoreCase = -Id_equalsIgnoreCase,
        ConstructorId_match          = -Id_match,
        ConstructorId_search         = -Id_search,
        ConstructorId_replace        = -Id_replace,
        ConstructorId_localeCompare  = -Id_localeCompare,
        ConstructorId_toLocaleLowerCase = -Id_toLocaleLowerCase;

    private CharSequence string;
}

</pre></body></html><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table>