<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml' lang='en'><head><meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/><title>org.mozilla.javascript.NativeCallSite.java</title><link rel='stylesheet' href='../.resources/report.css' type='text/css'/><link rel='stylesheet' href='../.resources/prettify.css' type='text/css'/><link rel='stylesheet' href='../.resources/custom.css' type='text/css'/><script type='text/javascript' src='../.resources/prettify.js'></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><h1>org.mozilla.javascript.NativeCallSite.java</h1><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table><pre class='source lang-java linenums'>/* -*- Mode: java; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*-
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

package org.mozilla.javascript;

/**
 * This class is used by the V8 extension "Error.prepareStackTrace." It is passed to
 * that function, which may then use it to format the stack as it sees fit.
 */

public class NativeCallSite extends IdScriptableObject
{
    private static final String CALLSITE_TAG = "CallSite";

    private ScriptStackElement element;

    static void init(Scriptable scope, boolean sealed)
    {
<span class='uc' id='L22' title='4|4|4 - Total: 4'>        NativeCallSite cs = new NativeCallSite();
</span><span class='uc' id='L23' title='6|6|6 - Total: 6'>        cs.exportAsJSClass(MAX_PROTOTYPE_ID, scope, sealed);
</span><span class='uc' id='L24' title='1|1|1 - Total: 1'>    }
</span>
    static NativeCallSite make(Scriptable scope, Scriptable ctorObj)
    {
<span class='uc' id='L28' title='4|4|4 - Total: 4'>        NativeCallSite cs = new NativeCallSite();
</span><span class='uc' id='L29' title='7|7|7 - Total: 7'>        Scriptable proto = (Scriptable)(ctorObj.get("prototype", ctorObj));
</span><span class='uc' id='L30' title='3|3|3 - Total: 3'>        cs.setParentScope(scope);
</span><span class='uc' id='L31' title='3|3|3 - Total: 3'>        cs.setPrototype(proto);
</span><span class='uc' id='L32' title='2|2|2 - Total: 2'>        return cs;
</span>    }

    private NativeCallSite()
<span class='uc' id='L36' title='2|2|2 - Total: 2'>    {
</span><span class='uc' id='L37' title='1|1|1 - Total: 1'>    }
</span>
    void setElement(ScriptStackElement elt)
    {
<span class='uc' id='L41' title='3|3|3 - Total: 3'>        this.element = elt;
</span><span class='uc' id='L42' title='1|1|1 - Total: 1'>    }
</span>
    @Override
    public String getClassName()
    {
<span class='uc' id='L47' title='2|2|2 - Total: 2'>        return "CallSite";
</span>    }

    @Override
    protected void initPrototypeId(int id)
    {
        String s;
        int arity;
<span class='upc' id='L55' title='14|14|14 - Total: 16'>        switch (id) {
</span><span class='uc' id='L56' title='5|5|5 - Total: 5'>        case Id_constructor: arity = 0; s="constructor"; break;
</span><span class='uc' id='L57' title='5|5|5 - Total: 5'>        case Id_getThis: arity = 0; s="getThis"; break;
</span><span class='uc' id='L58' title='5|5|5 - Total: 5'>        case Id_getTypeName: arity = 0; s="getTypeName"; break;
</span><span class='uc' id='L59' title='5|5|5 - Total: 5'>        case Id_getFunction: arity = 0; s="getFunction"; break;
</span><span class='uc' id='L60' title='5|5|5 - Total: 5'>        case Id_getFunctionName: arity = 0; s="getFunctionName"; break;
</span><span class='uc' id='L61' title='5|5|5 - Total: 5'>        case Id_getMethodName: arity = 0; s="getMethodName"; break;
</span><span class='uc' id='L62' title='5|5|5 - Total: 5'>        case Id_getFileName: arity = 0; s="getFileName"; break;
</span><span class='uc' id='L63' title='5|5|5 - Total: 5'>        case Id_getLineNumber: arity = 0; s="getLineNumber"; break;
</span><span class='uc' id='L64' title='5|5|5 - Total: 5'>        case Id_getColumnNumber: arity = 0; s="getColumnNumber"; break;
</span><span class='uc' id='L65' title='5|5|5 - Total: 5'>        case Id_getEvalOrigin: arity = 0; s="getEvalOrigin"; break;
</span><span class='uc' id='L66' title='5|5|5 - Total: 5'>        case Id_isToplevel: arity = 0; s="isToplevel"; break;
</span><span class='uc' id='L67' title='5|5|5 - Total: 5'>        case Id_isEval: arity = 0; s="isEval"; break;
</span><span class='uc' id='L68' title='5|5|5 - Total: 5'>        case Id_isNative: arity = 0; s="isNative"; break;
</span><span class='uc' id='L69' title='5|5|5 - Total: 5'>        case Id_isConstructor: arity = 0; s="isConstructor"; break;
</span><span class='nc' id='L70' title='0|0|0 - Total: 5'>        case Id_toString: arity = 0; s="toString"; break;
</span><span class='nc' id='L71' title='0|0|0 - Total: 6'>        default: throw new IllegalArgumentException(String.valueOf(id));
</span>        }
<span class='uc' id='L73' title='7|7|7 - Total: 7'>        initPrototypeMethod(CALLSITE_TAG, id, s, arity);
</span><span class='uc' id='L74' title='1|1|1 - Total: 1'>    }
</span>
    @Override
    public Object execIdCall(IdFunctionObject f, Context cx, Scriptable scope,
                             Scriptable thisObj, Object[] args)
    {
<span class='upc' id='L80' title='1|1|1 - Total: 2'>        if (!f.hasTag(CALLSITE_TAG)) {
</span><span class='nc' id='L81' title='0|0|0 - Total: 8'>            return super.execIdCall(f, cx, scope, thisObj, args);
</span>        }
<span class='uc' id='L83' title='3|3|3 - Total: 3'>        int id = f.methodId();
</span><span class='upc' id='L84' title='7|7|7 - Total: 9'>        switch (id) {
</span>        case Id_constructor:
<span class='uc' id='L86' title='4|4|4 - Total: 4'>            return make(scope, f);
</span>        case Id_getFunctionName:
<span class='uc' id='L88' title='4|4|4 - Total: 4'>            return getFunctionName(thisObj);
</span>        case Id_getFileName:
<span class='uc' id='L90' title='4|4|4 - Total: 4'>            return getFileName(thisObj);
</span>        case Id_getLineNumber:
<span class='uc' id='L92' title='4|4|4 - Total: 4'>            return getLineNumber(thisObj);
</span>        case Id_getThis:
        case Id_getTypeName:
        case Id_getFunction:
        case Id_getColumnNumber:
<span class='uc' id='L97' title='3|3|3 - Total: 3'>            return getUndefined();
</span>        case Id_getMethodName:
<span class='uc' id='L99' title='3|3|3 - Total: 3'>            return getNull();
</span>        case Id_getEvalOrigin:
        case Id_isEval:
        case Id_isConstructor:
        case Id_isNative:
        case Id_isToplevel:
<span class='uc' id='L105' title='3|3|3 - Total: 3'>            return getFalse();
</span>        case Id_toString:
<span class='nc' id='L107' title='0|0|0 - Total: 4'>            return js_toString(thisObj);
</span>        default:
<span class='nc' id='L109' title='0|0|0 - Total: 6'>            throw new IllegalArgumentException(String.valueOf(id));
</span>        }
    }

    @Override
    public String toString()
    {
<span class='nc' id='L116' title='0|0|0 - Total: 2'>        if (element == null) {
</span><span class='nc' id='L117' title='0|0|0 - Total: 2'>            return "";
</span>        }
<span class='nc' id='L119' title='0|0|0 - Total: 4'>        return element.toString();
</span>    }

    private Object js_toString(Scriptable obj)
    {
<span class='nc' id='L124' title='0|0|0 - Total: 4'>        while(obj != null && !(obj instanceof NativeCallSite)) {
</span><span class='nc' id='L125' title='0|0|0 - Total: 4'>            obj = obj.getPrototype();
</span>        }
<span class='nc' id='L127' title='0|0|0 - Total: 2'>        if (obj == null) {
</span><span class='nc' id='L128' title='0|0|0 - Total: 2'>            return NOT_FOUND;
</span>        }
<span class='nc' id='L130' title='0|0|0 - Total: 3'>        NativeCallSite cs = (NativeCallSite)obj;
</span><span class='nc' id='L131' title='0|0|0 - Total: 4'>        StringBuilder sb = new StringBuilder();
</span><span class='nc' id='L132' title='0|0|0 - Total: 4'>        cs.element.renderJavaStyle(sb);
</span><span class='nc' id='L133' title='0|0|0 - Total: 3'>        return sb.toString();
</span>    }

    private Object getUndefined()
    {
<span class='uc' id='L138' title='2|2|2 - Total: 2'>        return Undefined.instance;
</span>    }

    private Object getNull()
    {
<span class='uc' id='L143' title='2|2|2 - Total: 2'>        return null;
</span>    }

    private Object getFalse()
    {
<span class='uc' id='L148' title='2|2|2 - Total: 2'>        return Boolean.FALSE;
</span>    }

    private Object getFunctionName(Scriptable obj)
    {
<span class='upc' id='L153' title='2|2|2 - Total: 4'>        while(obj != null && !(obj instanceof NativeCallSite)) {
</span><span class='nc' id='L154' title='0|0|0 - Total: 4'>            obj = obj.getPrototype();
</span>        }
<span class='upc' id='L156' title='1|1|1 - Total: 2'>        if (obj == null) {
</span><span class='nc' id='L157' title='0|0|0 - Total: 2'>            return NOT_FOUND;
</span>        }
<span class='uc' id='L159' title='3|3|3 - Total: 3'>        NativeCallSite cs = (NativeCallSite)obj;
</span><span class='upc' id='L160' title='1|1|1 - Total: 2'>        return (cs.element == null ? null : cs.element.functionName);
</span>    }

    private Object getFileName(Scriptable obj)
    {
<span class='upc' id='L165' title='2|2|2 - Total: 4'>        while(obj != null && !(obj instanceof NativeCallSite)) {
</span><span class='nc' id='L166' title='0|0|0 - Total: 4'>            obj = obj.getPrototype();
</span>        }
<span class='upc' id='L168' title='1|1|1 - Total: 2'>        if (obj == null) {
</span><span class='nc' id='L169' title='0|0|0 - Total: 2'>            return NOT_FOUND;
</span>        }
<span class='uc' id='L171' title='3|3|3 - Total: 3'>        NativeCallSite cs = (NativeCallSite)obj;
</span><span class='upc' id='L172' title='1|1|1 - Total: 2'>        return (cs.element == null ? null : cs.element.fileName);
</span>    }

    private Object getLineNumber(Scriptable obj)
    {
<span class='upc' id='L177' title='2|2|2 - Total: 4'>        while(obj != null && !(obj instanceof NativeCallSite)) {
</span><span class='nc' id='L178' title='0|0|0 - Total: 4'>            obj = obj.getPrototype();
</span>        }
<span class='upc' id='L180' title='1|1|1 - Total: 2'>        if (obj == null) {
</span><span class='nc' id='L181' title='0|0|0 - Total: 2'>            return NOT_FOUND;
</span>        }
<span class='uc' id='L183' title='3|3|3 - Total: 3'>        NativeCallSite cs = (NativeCallSite)obj;
</span><span class='upc' id='L184' title='2|2|2 - Total: 4'>        if ((cs.element == null) || (cs.element.lineNumber < 0)) {
</span><span class='nc' id='L185' title='0|0|0 - Total: 2'>            return Undefined.instance;
</span>        }
<span class='uc' id='L187' title='5|5|5 - Total: 5'>        return cs.element.lineNumber;
</span>    }

// #string_id_map#

    @Override
    protected int findPrototypeId(String s)
    {
        int id;
// #generated# Last update: 2015-03-02 23:42:12 PST
<span class='uc' id='L197' title='4|4|4 - Total: 4'>        L0: { id = 0; String X = null; int c;
</span><span class='upc' id='L198' title='7|7|7 - Total: 8'>            L: switch (s.length()) {
</span><span class='uc' id='L199' title='5|5|5 - Total: 5'>            case 6: X="isEval";id=Id_isEval; break L;
</span><span class='uc' id='L200' title='5|5|5 - Total: 5'>            case 7: X="getThis";id=Id_getThis; break L;
</span><span class='uc' id='L201' title='4|4|4 - Total: 4'>            case 8: c=s.charAt(0);
</span><span class='upc' id='L202' title='1|1|1 - Total: 2'>                if (c=='i') { X="isNative";id=Id_isNative; }
</span><span class='nc' id='L203' title='0|0|0 - Total: 2'>                else if (c=='t') { X="toString";id=Id_toString; }
</span>                break L;
<span class='uc' id='L205' title='5|5|5 - Total: 5'>            case 10: X="isToplevel";id=Id_isToplevel; break L;
</span><span class='upc' id='L206' title='4|4|4 - Total: 5'>            case 11: switch (s.charAt(4)) {
</span><span class='uc' id='L207' title='5|5|5 - Total: 5'>                case 'i': X="getFileName";id=Id_getFileName; break L;
</span><span class='uc' id='L208' title='5|5|5 - Total: 5'>                case 't': X="constructor";id=Id_constructor; break L;
</span><span class='uc' id='L209' title='5|5|5 - Total: 5'>                case 'u': X="getFunction";id=Id_getFunction; break L;
</span><span class='uc' id='L210' title='5|5|5 - Total: 5'>                case 'y': X="getTypeName";id=Id_getTypeName; break L;
</span><span class='nc' id='L211' title='0|0|0 - Total: 1'>                } break L;
</span><span class='upc' id='L212' title='4|4|4 - Total: 5'>            case 13: switch (s.charAt(3)) {
</span><span class='uc' id='L213' title='5|5|5 - Total: 5'>                case 'E': X="getEvalOrigin";id=Id_getEvalOrigin; break L;
</span><span class='uc' id='L214' title='5|5|5 - Total: 5'>                case 'L': X="getLineNumber";id=Id_getLineNumber; break L;
</span><span class='uc' id='L215' title='5|5|5 - Total: 5'>                case 'M': X="getMethodName";id=Id_getMethodName; break L;
</span><span class='uc' id='L216' title='5|5|5 - Total: 5'>                case 'o': X="isConstructor";id=Id_isConstructor; break L;
</span><span class='nc' id='L217' title='0|0|0 - Total: 1'>                } break L;
</span><span class='uc' id='L218' title='4|4|4 - Total: 4'>            case 15: c=s.charAt(3);
</span><span class='uc' id='L219' title='2|2|2 - Total: 2'>                if (c=='C') { X="getColumnNumber";id=Id_getColumnNumber; }
</span><span class='upc' id='L220' title='1|1|1 - Total: 2'>                else if (c=='F') { X="getFunctionName";id=Id_getFunctionName; }
</span>                break L;
            }
<span class='upc' id='L223' title='4|4|4 - Total: 6'>            if (X!=null && X!=s && !X.equals(s)) id = 0;
</span>            break L0;
        }
// #/generated#
<span class='uc' id='L227' title='2|2|2 - Total: 2'>        return id;
</span>    }

    private static final int
      Id_constructor = 1,
      Id_getThis = 2,
      Id_getTypeName = 3,
      Id_getFunction = 4,
      Id_getFunctionName = 5,
      Id_getMethodName = 6,
      Id_getFileName = 7,
      Id_getLineNumber = 8,
      Id_getColumnNumber = 9,
      Id_getEvalOrigin = 10,
      Id_isToplevel = 11,
      Id_isEval = 12,
      Id_isNative = 13,
      Id_isConstructor = 14,
      Id_toString = 15,
      MAX_PROTOTYPE_ID = 15;
// #/string_id_map#
}
</pre></body></html><table class='legend'><tr><td class='nc'>Not Covered</td><td class='ac'>Covered by test suite 1</td><td class='bc'>Covered by test suite 2</td><td class='uc'>Covered by the union test suite</td><td class='apc'>Partially Covered by test suite 1</td><td class='bpc'>Partially Covered by test suite 2</td><td class='upc'>Partially Covered by the union test suite</td></tr></table>